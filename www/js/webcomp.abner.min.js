"use strict";

//Verfica Sistema Operacional
window.isIOS = (/iPad|iPhone|iPod/.test(navigator.platform) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) && !window.MSStream;
window.isAndroid = /(android)/i.test(navigator.userAgent);
window.isDesktop = !window.isIOS && !window.isAndroid;

(function(w, $, undefined) {

    w.tapHandling = false;
    w.tappy = true;

    var tap = function($els) {
        return $els.each(function() {

            var $el = $(this),
                resetTimer,
                startY,
                startX,
                cancel,
                scrollTolerance = 10;

            function trigger(e) {
                $(e.target).trigger("tap", [e, $(e.target).attr("href")]);
            }

            function getCoords(e) {
                var ev = e.originalEvent || e,
                    touches = ev.touches || ev.targetTouches;

                if (touches) {
                    return [touches[0].pageX, touches[0].pageY];
                } else {
                    return null;
                }
            }

            function start(e) {
                if (e.touches && e.touches.length > 1 || e.targetTouches && e.targetTouches.length > 1) {
                    return false;
                }

                var coords = getCoords(e);
                startX = coords[0];
                startY = coords[1];
            }

            // any touchscroll that results in > tolerance should cancel the tap
            function move(e) {
                if (!cancel) {
                    var coords = getCoords(e);
                    if (coords && (Math.abs(startY - coords[1]) > scrollTolerance || Math.abs(startX - coords[0]) > scrollTolerance)) {
                        cancel = true;
                    }
                }
            }

            function end(e) {
                clearTimeout(resetTimer);
                resetTimer = setTimeout(function() {
                    w.tapHandling = false;
                    cancel = false;
                }, 1000);

                // make sure no modifiers are present. thx http://www.jacklmoore.com/notes/click-events/
                if ((e.which && e.which > 1) || e.shiftKey || e.altKey || e.metaKey || e.ctrlKey) {
                    return;
                }

                e.preventDefault();

                // this part prevents a double callback from touch and mouse on the same tap

                // if a scroll happened between touchstart and touchend
                if (cancel || w.tapHandling && w.tapHandling !== e.type) {
                    cancel = false;
                    return;
                }

                w.tapHandling = e.type;
                trigger(e);
            }

            $el
                .bind("touchstart.tappy MSPointerDown.tappy", start)
                .bind("touchmove.tappy MSPointerMove.tappy", move)
                .bind("touchend.tappy MSPointerUp.tappy", end)
                .bind("click.tappy", end);
        });
    };

    var untap = function($els) {
        return $els.unbind(".tappy");
    };

    // use special events api
    if ($.event && $.event.special) {
        $.event.special.tap = {
            add: function(handleObj) {
                tap($(this));
            },
            remove: function(handleObj) {
                untap($(this));
            }
        };
    } else {
        // monkeybind
        var oldBind = $.fn.bind,
            oldUnbind = $.fn.unbind;
        $.fn.bind = function(evt) {
            if (/(^| )tap( |$)/.test(evt)) {
                tap(this);
            }
            return oldBind.apply(this, arguments);
        };
        $.fn.unbind = function(evt) {
            if (/(^| )tap( |$)/.test(evt)) {
                untap(this);
            }
            return oldUnbind.apply(this, arguments);
        };
    }

}(this, jQuery));


// ARRUMA ERRO NO IE9 ONDE NAO EXISTE WINDOW.CONSOLE
if (!window.console) {
    var console = {
        log: function() {},
        warn: function() {},
        error: function() {},
        time: function() {},
        timeEnd: function() {}
    }
}

/* ARRUMA INPUT NO IOS QUE NAO FUNCIONA DIREITO */
/*$(document).ready(function() {
    if (window.isIOS) {
        $(document).ready(function() {
            document.addEventListener('keydown', function(e) {
                window.focus();
                $(':focus').focus();
            });
        });
    }

});*/

var getXY = function(event) {
    var x = null;
    var y = null;

    if (event.originalEvent != null && event.originalEvent.touches != null) {
        var touch = event.originalEvent.touches[0] || event.originalEvent.changedTouches[0];
        x = parseFloat(touch.pageX);
        y = parseFloat(touch.pageY);
    } else {
        x = parseFloat(event.pageX);
        y = parseFloat(event.pageY);
    }

    var pos = new Object();
    pos.x = x;
    pos.y = y;

    return pos;
}

var support3d = function() {
    var ret = false;
    var supports3DTransforms = document.body.style['webkitPerspective'] !== undefined || document.body.style['MozPerspective'] !== undefined;
    if (supports3DTransforms) {
        ret = true;
    }
    return ret;
}

var getTransform = function(el) {
    var prop = "";

    if (el.css('-webkit-transform') != undefined) {
        prop = el.css('-webkit-transform');
    } else if (el.css('transform') != undefined) {
        prop = el.css('transform');
    } else if (el.css('-moz-transform') != undefined) {
        prop = el.css('-moz-transform');
    } else if (el.css('-ms-transform') != undefined) {
        prop = el.css('-ms-transform');
    } else {
        return [0, 0, 0];
    }

    var results = prop.match(/matrix(?:(3d)\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))(?:, (-{0,1}\d+)), -{0,1}\d+\)|\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))\))/);

    if (!results)
        return [0, 0, 0];
    if (results[1] == '3d')
        return results.slice(2, 5);

    results.push(0);
    return results.slice(5, 8);
}

var goToNextTabindex = function(event, obj, command) {
    var key = event.keyCode ? event.keyCode : event.which;

    if (key == 13 || key == 9) {
        var ficar = true;
        var ret = true;
        var tabindex = obj.attr('tabindex');

        if (key == 13 && obj[0].nodeName == "TEXTAREA") {
            return;
        }

        do {
            //Verifica o tabindex
            var gotoTabindex = obj.attr('goto-tab-index');
            var stopTabindex = obj.attr('stop-tab-index');

            //Vai opara
            if (tabindex && stopTabindex != "true") {
                tabindex = parseInt(tabindex);

                //avanca o tabindex
                if (gotoTabindex) {
                    tabindex = gotoTabindex;
                } else {
                    tabindex++;
                }

                //se Existir o elemento foca nele
                var nextObj = $('[tab-index=' + tabindex + ']');

                //Verifica se encontrou um objeto
                if (nextObj.length > 0 && nextObj.attr("is-disabled") != "true") {
                    ficar = false;                    

                    if (nextObj[0].nodeName == "ABNER-SELECT-UNDERLINE") {
                        nextObj.find("select").trigger("focus");
                    } else {
                        nextObj.find("[div-focus=true]").trigger(command);
                    };
                } else {
                    if (nextObj.length > 0) {
                        //verifica o proximo objeto
                        obj = nextObj;
                    } else {
                        ficar = false;
                    }
                }

                //removido para funcionar o enter
                //return false;
            } else {
                if (stopTabindex == "true") {
                    ficar = false;
                    ret = false;
                } else {
                    ficar = false;
                    ret = true;
                }

            }
        }
        while (ficar);

        //Se for tab deixar false
        if (key == 9) {
            ret = false;
        }

        //rodar saida
        return ret;
    }

}

var randomNumber = function() {
    //var random_integer = Math.random()*101|0;    
    return Math.random().toString(36).substr(2, 10);
}

var guid = function() {
    function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    }
    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
}

var generateID = function() {
    return guid();
}

var pointerEventToXY = function(e) {
    var out = { x: 0, y: 0 };
    if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {
        var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
        out.x = touch.pageX;
        out.y = touch.pageY;
    } else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {
        out.x = e.pageX;
        out.y = e.pageY;
    }
    return out;
};
"use strict";

//component-wrapper: non-functional

//Criando namespace utils
var PmbUtils = function () { }


PmbUtils.prototype.removeAccent = function (word) {
    var _this = this;

    var map = {
        "á": "a",
        "à": "a",
        "â": "a",
        "ã": "a",
        "ä": "a",
        "Á": "A",
        "À": "A",
        "Â": "A",
        "Ã": "A",
        "Ä": "A",
        "é": "e",
        "è": "e",
        "ê": "e",
        "ẽ": "e",
        "ë": "e",
        "É": "E",
        "È": "E",
        "Ê": "E",
        "Ẽ": "E",
        "Ë": "E",
        "í": "i",
        "ì": "i",
        "î": "i",
        "ĩ": "i",
        "ï": "i",
        "Í": "I",
        "Ì": "I",
        "Î": "I",
        "Ĩ": "I",
        "Ï": "I",
        "ó": "o",
        "ò": "o",
        "ô": "o",
        "õ": "o",
        "ö": "o",
        "Ó": "O",
        "Ò": "O",
        "Ô": "O",
        "Õ": "O",
        "Ö": "O",
        "ú": "u",
        "ù": "u",
        "û": "u",
        "ũ": "u",
        "ü": "u",
        "Ú": "U",
        "Ù": "U",
        "Û": "U",
        "Ũ": "U",
        "Ü": "U",
        "ý": "y",
        "ỳ": "y",
        "ŷ": "y",
        "ỹ": "y",
        "ÿ": "y",
        "Ý": "Y",
        "Ỳ": "Y",
        "Ŷ": "Y",
        "Ỹ": "Y",
        "Ÿ": "Y",
        "ñ": "n",
        "Ñ": "n",
        "Ç": "c",
        "ç": "c"
    };

    if (word != "") {
        return word.replace(/[àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãẽĩũñõÃẼĨŨÑÕäëïöüÿÄËÏÖÜŸÇç]/g, function (match) {
            return map[match];
        });
    } else {
        return null;
    }
}

//PEga variaveis da URL
PmbUtils.prototype.getUrlVars = function () {
    var vars = new Object(),
        hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars[hash[0]] = hash[1];
    }
    return vars;
}

//Determina se é modo adaptativo 
PmbUtils.prototype.showBigScreen = function (obj) {
    if (parseInt(obj.outerWidth()) >= 1024) {
        return true;
    } else {
        return false;
    }
}

PmbUtils.prototype.getCheckedRadio = function (name) {
    if (name) {
        return $("input[type=radio][name=" + name + "]:checked").parent();
    } else {
        return $("input[type=radio]:checked").parent();
    }
}

PmbUtils.prototype.getPhoneAsObject = function (phone) {

    var phoneObj = {
        ddi: "",
        ddd: "",
        phone: phone
    };

    phone = phone ? phone.replace(/\D+/g, '') : phone;

    if (phone && phone.length > 11) {
        phoneObj.ddi = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$1");
        phoneObj.ddd = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$2");
        phoneObj.phone = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$3");
    } else if (phone && phone.length > 9) {
        phoneObj.ddd = phone.replace(/^(\d{2})(\d{8,9})$/g, "\$1");
        phoneObj.phone = phone.replace(/^(\d{2})(\d{8,9})$/g, "\$2");
    }

    return phoneObj;
}

PmbUtils.prototype.formatPhone = function (phone) {

    var phoneReturn = phone.replace(/[^0-9]/g, '');

    if (phone && phone.length > 11) {
        phoneReturn = phone.replace(/^(\d{2})(\d{2})(\d{4,5})(\d{4})$/g, "\+$1 \($2) \$3 \$4");
    } else if (phone && phone.length > 9) {
        phoneReturn = phone.replace(/^(\d{2})(\d{4,5})(\d{4})$/g, "\($1) \$2 \$3");
    };

    return phoneReturn;
}

PmbUtils.prototype.removeCpfCnpjFormat = function (valor, type) {

    if (valor) {
        //remove ponto e virgula
        valor = valor.replace(new RegExp(/[^\d]/g), "");

        if (type == "CNPJ") {
            var len = 14;
            var pad = "00000000000";
        } else if (type == "CPF") {
            var len = 11;
            var pad = "00000000000";
        } else {
            return "";
        }

        //transforma para numero
        valor = parseInt(valor);

        //se for maior que o valor defindo para len ele corta
        if (valor.length > len) {
            valor = valor.substring(0, len);
        }

        //Se ocorre algum erro, deixar vazio
        if (isNaN(valor)) {
            valor = "";

        } else {
            valor = pad.substring(0, pad.length - valor.length) + valor;
        }
    }
    return valor;
}

PmbUtils.prototype.validarCNPJ = function (cnpj) {

    cnpj = cnpj.replace(/[^\d]+/g, '');
    
    if (cnpj == "0" ||
        cnpj == "00000000000000" ||
        cnpj == "11111111111111" ||
        cnpj == "22222222222222" ||
        cnpj == "33333333333333" ||
        cnpj == "44444444444444" ||
        cnpj == "55555555555555" ||
        cnpj == "66666666666666" ||
        cnpj == "77777777777777" ||
        cnpj == "88888888888888" ||
        cnpj == "99999999999999") {
        return false;
    }

    // Valida DVs
    var tamanho = cnpj.length - 2
    var numeros = cnpj.substring(0, tamanho);
    var digitos = cnpj.substring(tamanho);
    var soma = 0;
    var pos = tamanho - 7;
    var i = tamanho;

    for (i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2)
            pos = 9;
    }
    var resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
    if (resultado != digitos.charAt(0)) {
        return false;
    }

    tamanho = tamanho + 1;
    numeros = cnpj.substring(0, tamanho);
    soma = 0;
    pos = tamanho - 7;
    for (i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2)
            pos = 9;
    }

    resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;

    if (resultado != digitos.charAt(1)) {
        return false;
    }

    return true;
}

//valida o CPF digitado
PmbUtils.prototype.validarCPF = function(cpf) {

    var exp = /\.|\-/g
    cpf = cpf.toString().replace(exp, "");
    if (cpf.length < 11) {
        var pad = "00000000000";
        cpf = pad.substring(0, pad.length - cpf.length) + cpf;
    }

    if (cpf == "0" ||
        cpf == "00000000000" ||
        cpf == "11111111111" ||
        cpf == "22222222222" ||
        cpf == "33333333333" ||
        cpf == "44444444444" ||
        cpf == "55555555555" ||
        cpf == "66666666666" ||
        cpf == "77777777777" ||
        cpf == "88888888888" ||
        cpf == "99999999999") {
        return false;
    }

    var soma;
    var resto;
    soma = 0;

    for (var i = 1; i <= 9; i++) {
        soma = soma + parseInt(cpf.substring(i - 1, i)) * (11 - i);
    }

    resto = (soma * 10) % 11;

    if ((resto == 10) || (resto == 11)) {
        resto = 0;
    }
    if (resto != parseInt(cpf.substring(9, 10))) {
        return false;
    }

    soma = 0;
    for (var i = 1; i <= 10; i++) {
        soma = soma + parseInt(cpf.substring(i - 1, i)) * (12 - i);
    }
    resto = (soma * 10) % 11;

    if ((resto == 10) || (resto == 11)) {
        resto = 0;
    }
    if (resto != parseInt(cpf.substring(10, 11))) {
        return false;
    }
    return true;
}

PmbUtils.prototype.validarEMAIL = function(email) {
    var emailValidation = email.match(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+$/);

    if (email == emailValidation) {
        return emailValidation;
    }
}

//Funcoes uteis de uso do JQUERY
window.addEventListener('WebComponentsReady', function () {
    document.querySelector("html").classList.add("html-page-loaded");
});

$(document).ready(function () {
    $.fn.setCursorPosition = function (pos) {
        this.each(function (index, elem) {
            if (elem.setSelectionRange) {
                elem.setSelectionRange(pos, pos);
            } else if (elem.createTextRange) {
                var range = elem.createTextRange();
                range.collapse(true);
                range.moveEnd('character', pos);
                range.moveStart('character', pos);
                range.select();
            }
        });
        return this;
    };

    $.fn.validate = function () {
        var change = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if ($(this).attr("onchange")) {
            change = $(this).attr("onchange");
            $(this).removeAttr("onchange");
        }

        //tira o foco de qualquer elemento
        document.activeElement.blur();
        $(window).focus();

        if (change != null) {
            $(this).attr("onchange", change);
        }

        //se ouver um erro validacao esta incorreta
        if ($(this).attr("error") && $(this).attr("error") != "") {
            return false;
        } else {
            return true;
        }
    };

    $.fn.setFocus = function () {
        if ($(this).length > 0) {
            $(this).find("input").focus();
        } else {
            return null;
        }
    }

    $.fn.removeFocus = function () {
        if (document.activeElement) {
            document.activeElement.blur();
        }
    }

    $.fn.getText = function () {
        var text = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase().startsWith("AB-INPUT") ? "AB-INPUT" : tag.toUpperCase();
                var tagsAceitas = ["AB-TEXT-READ-ONLY", "AB-TEXT-AREA-UNDERLINE", "AB-SELECT-UNDERLINE", "AB-INPUT"];
                if (tagsAceitas.indexOf(tag) == -1) {
                    return null;
                }
            }
        } else {
            return null;
        }

        if ($(this).length > 1) {
            var textArray = new Array();
            for (const radio of this) {
                textArray.push(radio.getText());
            }
            text = textArray;
        } else {
            text = this[0].getText();
        };

        return text;
    };

    $.fn.setText = function (text, cancel) {
        var tag = new String();

        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (tag == "AB-TEXT-READ-ONLY") {
            this[0].setText(text);

        } else if (tag.startsWith("AB-INPUT-DATE")) {
            this[0].setText(text);

        } else if (tag.startsWith("AB-INPUT")) {
            this[0].setText(text);

        } else if (tag == "AB-TEXT-AREA-UNDERLINE") {
            this[0].setText(text);

        } else if (tag.startsWith("AB-SELECT")) {
            if (cancel) {
                $(this).find("select").val(text);
            } else {
                $(this).find("select").val(text).change();
            }
        }

        //salva valor
        if (!tag.startsWith("AB-INPUT-CHECKBOX")) {
            $(this).attr("loaded-value", $(this).getText());
        }
    };


    //funcao para corrigir o data
    $.fn.getNumber = function () {
        var text = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (tag == "AB-TEXT-READ-ONLY") {
            text = this[0].getText();

        } else if (tag.startsWith("AB-INPUT-CHECKBOX")) {
            text = this[0].getNumber();

        } else if (tag.startsWith("AB-INPUT-RADIO")) {
            text = this[0].getNumber();
            
        } else if (tag.startsWith("AB-INPUT-SWITCH")) {
            text = this[0].getNumber();

        } else if (tag.startsWith("AB-INPUT-TIME")) {
            text = $(this).find("input").val() + "00";

        } else if (tag.startsWith("AB-INPUT-NUMBER")) {
            text = $(this).find("input").val();
            text = text.replace(new RegExp(/[^\d]/g), "");

        } else if (tag.startsWith("AB-INPUT-DATE")) {
            if (window.isIOS || window.isAndroid) {
                text = $(this).find("input").val();
                text = text.substring(8, 10) + "" + text.substring(5, 7) + "" + text.substring(0, 4);
            } else {
                text = $(this).find("input").val();
            }

        } else if (tag.startsWith("AB-INPUT")) {
            text = $(this).find("input").val();

        } else if (tag.startsWith("AB-TEXT-AREA-UNDERLINE")) {
            text = $(this).find("textarea").val();

        } else if (tag.startsWith("AB-SELECT")) {
            text = parseInt($(this).getObject().valor);

        } else if (tag.startsWith("AB-QUESTION")) {
            text = $(this).attr("answer");
        }

        if (text && tag != "AB-SELECT-UNDERLINE") {
            text = text.replace(new RegExp(/[^\d\,]/g), "");
        }

        return text;
    };

    //funcao para corrigir o data
    $.fn.setNumber = function (text, cancel) {
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (text || text == 0) {
            //Necessario ser string para regex
            text += "";
            text = text.replace(new RegExp(/[^\d-\,]/g), "");

            if (tag == "AB-TEXT-READ-ONLY") {
                this[0].setText(text);

            } else if (tag.startsWith("AB-INPUT-CHECKBOX")) {
                this[0].setNumber(text);

                $(this).attr("loaded-value", $(this).attr("is-checked"));

            } else if (tag.startsWith("AB-INPUT-RADIO")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-INPUT-SWITCH")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-INPUT-DATE")) {
                this[0].setText(text);

            } else if (tag.startsWith("AB-INPUT")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-SELECT")) {
                if (cancel) {
                    $(this[0].select).val(text);
                } else {
                    $(this[0].select).val(text).change();
                }
            }

            //salva valor
            if (!tag.startsWith("AB-INPUT-CHECKBOX")) {
                $(this).attr("loaded-value", $(this).getText());
            }
        }
    };

    $.fn.setOldValue = function () {
        $(this).setText($(this).attr("loaded-value"));
    };

    $.fn.isChanged = function (val) {
        var loadedValue = $(this).attr("loaded-value");
        var currentValue = $(this).getText();

        if (loadedValue || currentValue) {
            if (loadedValue !== currentValue) {
                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    $.fn.setObject = function (val) {
        var tag = $(this)[0].nodeName;
        if (tag.startsWith("AB-SELECT")) {
            $(this).find("select").val(val).change();
        }
    }

    $.fn.getObject = function () {
        var bean = new Object();

        if ((this)[0]) {
            var tag = $(this)[0].nodeName;

            if (tag.startsWith("AB-SELECT")) {
                bean.nome = $(this).find("select option:selected").text();
                bean.valor = $(this).find("select option:selected").attr("value");
            }
        }

        return bean;
    }


    //Avisar nossos componentes quando teve uma alteracao
    var origAppend = $.fn.append;
    $.fn.append = function () {
        if ($(this).hasClass("ab-container-content") && arguments[0].hasClass("ab-block")) {
            return false;
        } else {
            return origAppend.apply(this, arguments).trigger("append");
        }
    };

    //função para retornar se o campo esrá com erro ou não
    $.fn.hasError = function () {
        if ($(this).attr("error")) {
            return true;
        } else {
            return false;
        }
    }
});


//função para arrumar bug no iOS 8
if (!String.prototype.startsWith) {
    String.prototype.startsWith = function (searchString, position) {
        position = position || 0;
        return this.indexOf(searchString, position) === position;
    };
}

String.prototype.toUpperOnlyFirstLetter = function () {
    var str = this;

    var wordMap = {
        "rg": "RG",
        "cpf": "CPF",
        "cnpj": "CNPJ",
        "rne": "RNE",
        "cep": "CEP",
        "cnh": "CNH",
        "s.a.": "S.A."
    };

    if (str && str.length == 0) {
        return "";
    } else if (str && str.length == 1) {
        return str.toUpperCase()
    } else if (str && str.length > 1) {
        str = str.substr(0, 1).toUpperCase() + str.substr(1).toLowerCase();
        return str = str.replace(/\b(rg|cpf|cnpj|rne|cep|cnh)\b|s\.a\./gi, function (word) {
            return wordMap[word.toLowerCase()];
        });
    } else {
        return "";
    }
}

String.prototype.toCamelCase = function () {
    var str = this.toLowerCase();

    var wordsArray = ["de", "sem", "o", "do", "da"];

    var words = str.split(" ");

    var fullString = new String();

    for (var i = 0; i < words.length; i++) {
        if (wordsArray.indexOf(words[i]) == -1 && words[i].length > 1) {
            words[i] = words[i].toUpperOnlyFirstLetter();
        };
    };

    fullString = words.join(" ")

    return fullString;
}

String.prototype.formatPercent = function(decimals, integers) {
    var tmp = this;
    var dec = "1";
    var formatDecimal = 0;
    var negativeCheck = false;

    if (tmp.substring(0, 1) == "-") {
        negativeCheck = true;
        tmp = tmp.substring(1, tmp.length);
    };

    if (decimals) {
        dec = dec.rpad("0", parseInt(decimals) + 1);
        formatDecimal = parseInt(decimals);
    }
    dec = parseInt(dec);

    if ((tmp && parseInt(tmp) == 0) || tmp == "" || tmp == undefined || isNaN(parseInt(tmp))) {
        tmp = 0;
    } else {
        tmp = parseFloat(tmp) / dec;
    }

    if (negativeCheck) {
        tmp = tmp * -1;
    }

    var option = {
        minimumFractionDigits: formatDecimal,
        maximumFractionDigits: formatDecimal
    };

    tmp = new Intl.NumberFormat('pt-BR', option).format(tmp);

    return tmp;
}

String.prototype.formatCurrency = function () {
    var tmp = this;
    var negativeCheck = false;

    if (tmp.substring(0, 1) == "-") {
        negativeCheck = true;
        tmp = tmp.substring(1, tmp.length);
    };

    //remove zeros a esquerda
    if (tmp) {
        // tmp = parseInt(tmp) + "";
        tmp = tmp.replace(/^0+/, '');
    }

    //Qualquer coisa diferente de um numero valido retorna 0,00
    if ((tmp && parseInt(tmp) == 0) || tmp == "" || tmp == undefined || isNaN(parseInt(tmp))) {
        return "0,00";
    }

    //Verifica se existem somente decimais, e acrescenta um zero na frente
    if (tmp && tmp.length <= 2) {
        tmp = tmp.lpad("0", 3);
    }

    //se o tamanho for
    //coloca as casas decimais
    tmp = tmp.replace(/([0-9]{2})$/g, ",$1");

    //se tiver milhar coloca ponto
    if (tmp.length > 6) {
        tmp = tmp.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    if (negativeCheck == true) {
        tmp = "-" + tmp;
    }

    return tmp;
}

String.prototype.formatDate = function (options) {
    var dia = "";
    var mes = "";
    var ano = "";
    var itens = "";
    var dataFormatada = null;
    var str = this;

    if (options) {
        //options.date != "" && options.date != 0 && options.date != null
        options.date = str;

        switch (options.srcFormat) {
            case 'ddmmyyyy':
                ano = options.date.substring(4, 8);
                mes = options.date.substring(2, 4);
                dia = options.date.substring(0, 2);
                break;

            case 'yyyymmdd':
                ano = options.date.substring(0, 4);
                mes = options.date.substring(4, 6);
                dia = options.date.substring(6, 8);
                break;

            case 'dd.mm.yyyy':
                itens = options.date.split(".");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'dd/mm/yyyy':
                itens = options.date.split("/");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'yyyy.mm.dd':
                itens = options.date.split(".");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'dd-mm-yyyy':
                itens = options.date.split("-");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'yyyy-mm-dd':
                itens = options.date.split("-");
                ano = itens[0];
                mes = itens[1];
                dia = itens[2];
                break;

            case 'yyyymm':
                ano = options.date.substring(0, 4);
                mes = options.date.substring(4, 6);
                break;

            default:
                console.log("Data inválida");
        }

        switch (options.targetFormat) {
            case 'dd/mm/yyyy':
                dataFormatada = dia + '/' + mes + '/' + ano;
                break;

            case 'yyyy/mm/dd':
                dataFormatada = ano + '/' + mes + '/' + dia;
                break;

            case 'dd.mm.yyyy':
                dataFormatada = dia + '.' + mes + '.' + ano;
                break;

            case 'yyyy.mm.dd':
                dataFormatada = ano + '.' + mes + '.' + dia;
                break;

            case 'dd-mm-yyyy':
                dataFormatada = dia + '-' + mes + '-' + ano;
                break;

            case 'yyyy-mm-dd':
                dataFormatada = ano + '-' + mes + '-' + dia;
                break;

            case 'mm/yyyy':
                dataFormatada = mes + '/' + ano;
                break;

            case 'mmyy':
                dataFormatada = mes + "" + ano.substring(2, 4);
                break;

            case 'ddmmyyyy':
                dataFormatada = dia + mes + ano;
                break;

            case 'yyyymmdd':
                dataFormatada = ano + mes + dia;
                break;

            default:
                console.log("erro");
        }
    }
    return dataFormatada;
}

String.prototype.formatTime = function (options) {
    var hora = "";
    var min = "";
    var seg = "";
    var itens = "";
    var horaFormatada = null;
    var str = this;

    if (options) {
        options.time = str;

        switch (options.srcFormat) {
            case 'hhmmss':
                hora = options.time.substring(0, 2);
                min = options.time.substring(2, 4);
                seg = options.time.substring(4, 6);
                break;

            case 'hh:mm:ss':
                itens = options.time.split(":");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            case 'hh.mm.ss':
                itens = options.time.split(".");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            case 'hh-mm-ss':
                itens = options.time.split("-");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            default:
                console.log("Hora inválida");
        }

        switch (options.targetFormat) {
            case 'hh:mm:ss':
                horaFormatada = hora + ':' + min + ':' + seg;
                break;

            case 'hh.mm.ss':
                horaFormatada = hora + '.' + min + '.' + seg;
                break;

            case 'hh-mm-ss':
                horaFormatada = hora + '-' + min + '-' + seg;
                break;

            case 'hhmmss':
                horaFormatada = hora + min + seg;
                break;

            default:
                console.log("erro");
        }
    }
    return horaFormatada;
}

String.prototype.formatCpf = function () {
    var cpf = this.lpad("0", 11);
    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/g, "\$1.\$2.\$3\-\$4");
}

String.prototype.formatCnpj = function () {
    var cpf = this.lpad("0", 14);
    return cpf.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g, "\$1.\$2.\$3\/\$4\-$5");
}


String.prototype.dateDiff = function (srcFormat, targetData, type) {

    var dataIni = new Date(this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    }));
    var dataFim = new Date(targetData.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    }));

    if (type == "dia") {
        var difDias = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numDias = Math.ceil(difDias / (1000 * 3600 * 24));
        return numDias;
    } else if (type == "mes") {
        var difMeses = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numMeses = Math.ceil(difMeses / (1000 * 3600 * 24 * 30) - 1);
        return numMeses;
    } else if (type == 'ano') {
        var difMeses = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numMeses = Math.ceil(difMeses / (1000 * 3600 * 24 * 30) - 1);
        return Math.floor(numMeses / 12);
    }
}

String.prototype.plusDays = function (srcFormat, days) {
    var dataFormatada = this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    });
    var dataGerada = new Date(dataFormatada);
    var dataFinal = "";
    dataGerada.setDate(dataGerada.getDate() + days);
    var mes = new String(dataGerada.getMonth() + 1).lpad('0', 2);
    var dia = new String(dataGerada.getDate()).lpad('0', 2);
    dataFinal = dia + '/' + mes + '/' + dataGerada.getFullYear();
    return dataFinal;
}

String.prototype.minusDays = function (srcFormat, days) {
    var dataFormatada = this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    });
    var dataGerada = new Date(dataFormatada);
    var dataFinal = "";
    dataGerada.setDate(dataGerada.getDate() - days);
    var mes = new String(dataGerada.getMonth() + 1).lpad('0', 2);
    var dia = new String(dataGerada.getDate()).lpad('0', 2);
    dataFinal = dia + '/' + mes + '/' + dataGerada.getFullYear();
    return dataFinal;
}

String.prototype.convertToNumber = function () {
    var codeString = this.substring(1, 12);
    var letter = this.substring(0, 1).toLowerCase();
    return letter.charCodeAt(0) - 96 + codeString;
}

String.prototype.lpad = function (padString, length) {
    var str = this;
    while (str.length < length)
        str = padString + str;
    return str;
}

String.prototype.getSigla = function () {
    var sigla = "";
    var name = this;

    if (name) {
        var userName = name.replace(new RegExp(/[-]/g), "");
        userName = userName.replace(new RegExp(/[\s]+/g), " ").trim();
        userName = userName.split(" ");
        var firstName = userName[0];
        var lastName = userName[userName.length - 1];
        sigla = firstName[0] + lastName[0];
    }

    return sigla;
}

String.prototype.rpad = function (padString, length) {
    var str = this;
    while (str.length < length)
        str = str + padString;
    return str;
}

String.prototype.trim = function () {
    return this.replace(/^\s+|\s+$/g, "");
}

//trimming space from left side of the string
String.prototype.ltrim = function () {
    return this.replace(/^\s+/, "");
}

//trimming space from right side of the string
String.prototype.rtrim = function () {
    return this.replace(/\s+$/, "");
}
"use strict";

$(document).ready(function () {
    $(window).on("resize", function () {
        $("ab-page").find("ab-button").each(function () {
            if ($("ab-page").attr("fullscreen") == "true"){
                if ($(this).attr("width-on-bigscreen")) {
                    $(this).css("width", $(this).attr("width-on-bigscreen"));
                } else {
                    if ($(this).attr("max-width")) {
                        $(this).css("max-width", $(this).attr("max-width"));
                    } else {
                        $(this).css("max-width", "340px");
                    }
                }
            } else {
                $(this).css("max-width", "100%");
                if ($(this).attr("width")) {
                    $(this).css("width", $(this).attr("width"));
                }
            }
        });
    });
});

class AbButton extends HTMLElement {

    constructor() {
        super();

        this.button = document.createElement("button");
        this.span = document.createElement("span");
        this.img = document.createElement("div");
        this.blocker = document.createElement("div");

        this.mainClass = "ab-button";

    }

    _render() {
        //coloca classe
        this.classList.add(this.mainClass);

        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificador único do objeto, com prefixo "btn"| Alfanumérico |não| randômico|
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        //Coloca os atributos no objeto
        if (this.hasAttribute("width")) {
            //description: Largura do botão| Alfanumérico| não| auto |
            this.style.width = this.getAttribute("width");
        }

        // if (this.hasAttribute("height")) {
        //     //description: Altura do botão| Alfanumérico| não| auto |
        //     this.style.height = this.getAttribute("height");
        // }

        if (this.getAttribute("last-button") == "true") {
            //description: Ultimo botão da página | Boolean | não | false |
            this.classList.add("ab-button-last-button");
        }

        //verifica width-on-bigscreen
        if ($("ab-page").attr("fullscreen") == "true") {
            if (this.hasAttribute("width-on-bigscreen")) {
                //description: Largura do componente em telas maiores| % ou px| não| |
                this.style.width = this.getAttribute("width-on-bigscreen");
            } else {
                this.style.maxWidth = "340px";
            }
        }

        //Cria botao
        this.button.setAttribute("id", id + "btn_button");
        this.appendChild(this.button);

        // adiciona o texto inserido no objeto para o span criado
        this.span.setAttribute("id", id + "btn_span");

        if (this.hasAttribute("label")) {
            //description: Colocar um texto no botão| Alfanumérico| sim| vazio|
            this.span.innerText = this.getAttribute("label").toUpperOnlyFirstLetter();
        }
        this.button.appendChild(this.span);

        // adiciona a imagem inserida no objeto no background de uma div
        this.img.setAttribute("div-image", "true");
        this.img.setAttribute("id", id + "btn_img");
        this.button.insertAdjacentElement("afterbegin", this.img);
        if (this.hasAttribute("icon") || this.hasAttribute("icon-class")) {
            this.img.style.backgroundImage = "url(" + this.getAttribute("icon") + ")";
            if (this.hasAttribute("icon-class")) {
                this.img.classList.add(this.getAttribute("icon-class"));
            }
        } else {
            this.img.style.display = "none";
        }

        // verifica se o botão é somente para mostrar o ícone e adiciona a classe
        if (this.getAttribute("icon-button") == "true") {
            //values: true;false
            //description: Trava o botão para ter somente o ícone| true ou false| não| false|
            this.classList.add("ab-button-img");
        }

        // verifica se tem o tamanho do icone e adiciona no tamanho do background
        if (this.hasAttribute("icon-size")) {
            //description: Altera o tamanho do icone| Número em px| não| |
            this.img.style.backgroundSize = this.getAttribute("icon-size");
        }

        // verifica se tem o tamanho do espaço do ícone e define a largura da div
        if (this.hasAttribute("icon-space-width")) {
            //description: Espaçamento do ícone com o texto| Número em px| não| |
            this.img.style.width = this.getAttribute("icon-space-width");
        }

        //Coloca cor no botao
        if (this.hasAttribute("theme")) {
            //values: normal;light;keyboard;keyboard-ok;dark-rounded;red-rounded;dark;vk
            //description: Altera a cor do componente| [[#Temas | Ver temas]]| não | vazio|
            this.classList.add("ab-button-" + this.getAttribute("theme"));
        } else if (this.getAttribute("theme") == "ab-button-keyboard") {
            this.classList.add("ab-button-keyboard");
        } else {
            this.classList.add("ab-button-normal");
        }

        if (this.getAttribute("position") == "center") {
            //values: center;right;left
            //description: Posição do botão| Center, right ou left| não| center|
            if (pmb.utils.showBigScreen(top.$("body")) == true) {
                this.classList.add("ab-button-center-big");
            } else {
                this.classList.add("ab-button-center");
            }
        } else if (this.getAttribute("position") == "left") {
            //não faz nada
        } else if (this.getAttribute("position") == "right") {
            this.style.float = this.getAttribute("position");
        }

        //verifica se tem max width
        if (this.hasAttribute("max-width")) {
            //description: Largura máxima do botão| Número em px| não| |
            this.style.maxWidth = this.getAttribute("max-width");
        }

        this.blocker.classList.add("ab-button-block");
        this.blocker.setAttribute("id", id + "btn_iblocker");
        this.appendChild(this.blocker);

        if (this.getAttribute("is-disabled") == "true") {
            //values: true;false
            this.button.setAttribute("disabled", "disabled");
            this.blocker.style.display = "block";
        }

        if (this.getAttribute("is-blocked") == "true") {
            //values: true;false
            this.blocker.style.display = "block";
        }

        if (this.getAttribute("visibility") == "hidden") {
            //values: hidden;show
            this.style.display = "none";
        }

        //Mesmo comportamento porém com outro nome de atributo, necessário ajustar todos projetos que usam o de cima
        if (this.getAttribute("visible") == "false") {
            //values: true;false
            this.style.display = "none";
        }

        //Limpa variaveis
        id = null;
    }

    _addEvent() {
        var button = $(this.button);
        var _this = this;

        // altera o ícone do botão quando o botão é apertado e se é passado o atributo icon-active
        button.on("touchstart mousedown", function (e) {

            //Proibe o clique em dois botões ao mesmo tempo
            if (e && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length > 1) {
                return;
            };

            //tira o foco de qualquer elemento
            document.activeElement.blur();
            $(window).focus();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //se tiver especificado icon-active adiciona no lugar do normal quando o evento inicia
                if (_this.hasAttribute("icon-active")) {
                    //description: Caminho do ícone que aparecerá quando o botão for ativado. | Alfanumérico| não| vazio|
                    if (_this.hasAttribute("icon-active")) {
                        _this.img.style.backgroundImage = "url(" + _this.getAttribute("icon-active") + ")";
                    }
                }
                // se tiver tema adiciona o tema no objeto
                if (_this.hasAttribute("theme")) {
                    _this.classList.add("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.add("ab-button-normal-active");
                };
            };
        });

        // altera o ícone do botão quando o botão é solto e se é passado o atributo icon-active
        button.on("mouseup touchend", function (e) {
            e.preventDefault();

            //tira o foco de qualquer elemento
            document.activeElement.blur();
            $(window).focus();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //retorna o icone para o normal quando o evento termina
                if (_this.hasAttribute("icon-active")) {
                    if (_this.hasAttribute("icon")) {
                        _this.img.style.backgroundImage = "url(" + _this.getAttribute("icon") + ")";
                    }
                }
                //retira o tema adicionado
                if (_this.hasAttribute("theme")) {
                    _this.classList.remove("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.remove("ab-button-normal-active");
                }
            }
        });

        //ação quando o mouse ou o touch deixar a área do objeto botão
        button.on("mouseleave touchleave", function (e) {
            e.preventDefault();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //retorna o icone para o normal quando o evento termina
                if (_this.hasAttribute("icon-active")) {
                    if (_this.hasAttribute("icon")) {
                        _this.img.style.backgroundImage = "url(" + iconActive + ")";
                    }
                }
                //retira o tema adicionado
                if (_this.hasAttribute("theme")) {
                    _this.classList.remove("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.remove("ab-button-normal-active");
                }
            }
        });

        $(this.blocker).on("tap", function (e) {
            e.preventDefault();
            e.stopPropagation();

            return false;
        });


    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({ mode: 'open' }); */
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return ["is-disabled", "label", "theme", "icon", "icon-class", "width", "icon-button", "icon-size", "icon-space-width", "visibility", "visible", "position", "width-on-bigscreen", "id", "max-width", "is-blocked"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "is-disabled":
                //Quando is-disable = true, desabilita o botão
                if (newVal == "true") {
                    this.button.setAttribute("disabled", "disabled");
                    this.blocker.style.display = "block";
                } else {
                    //Se o novo valor não habilitar o disable, ele retira as classes de active e remove o disable do botão
                    if (this.hasAttribute("theme")) {
                        this.classList.remove("ab-button-" + this.getAttribute("theme") + "-active");
                    } else {
                        this.classList.remove("ab-button-normal-active");
                    }

                    this.button.removeAttribute("disabled");
                    this.blocker.style.display = "none";
                }

                break;

            case "label":
                this.span.innerText = newVal.toUpperOnlyFirstLetter();
                break;

            case "theme":
                this.classList.remove("ab-button-" + oldVal);
                this.classList.remove("ab-button-normal");
                this.classList.add("ab-button-" + newVal);
                break;

            case "icon":
                this.img.style.display = "inline-block";
                this.img.style.backgroundImage = "url(" + newVal + ")";
                break;

            case "icon-class":
                this.img.style.display = "inline-block";
                this.img.classList.add(newVal);
                break;

            case "width":
                this.style.width = newVal;
                break;

            case "icon-button":
                if (newVal == "true") {
                    this.classList.add("ab-button-img");
                } else {
                    this.classList.remove("ab-button-img");
                }
                break;

            case "icon-size":
                this.img.style.backgroundSize = newVal;
                break;

            case "icon-space-width":
                this.img.style.width = newVal;
                break;

            case "visibility":
                if (newVal == "show") {
                    this.style.display = "table";
                } else if (newVal == "hidden") {
                    this.style.display = "none";
                }
                break;

            case "visible":
                if (newVal == "true") {
                    this.style.display = "table";
                } else if (newVal == "false") {
                    this.style.display = "none";
                }
                break;

            case "position":
                if (newVal == "center") {
                    if (pmb.utils.showBigScreen(top.$("body")) == true) {
                        this.classList.add("ab-button-center-big");
                    } else {
                        this.classList.add("ab-button-center");
                    }
                } else if (newVal == "right") {
                    this.style.float = newVal;
                }
                break;

            case "width-on-bigscreen":
                if (pmb.utils.showBigScreen(top.$("body"))) {
                    this.style.width = newVal;
                }
                break;

            case "id":
                this.img.setAttribute("id", newVal + "btn_img");
                this.button.setAttribute("id", newVal + "btn_button");
                this.span.setAttribute("id", newVal + "btn_span");
                this.blocker.setAttribute("id", newVal + "btn_iblocker");
                break;

            case "max-width":
                this.style.maxWidth = newVal;
                break;

            case "is-blocked":
                //Trata a alteração do atributo is-disable
                //Quando is-disable = true, desabilita o botão
                if (newVal == "true") {
                    this.blocker.style.display = "block";
                } else {
                    //Se o novo valor não habilitar o disable, ele retira as classes de active e remove o disable do botão
                    if (this.hasAttribute("theme")) {
                        this.classList.remove("ab-button-" + this.getAttribute("theme") + "-active");
                    } else {
                        this.classList.remove("ab-button-normal-active");
                    }
                    this.blocker.style.display = "none";
                }
                break;

            default:
                break;
        }
    }
}
customElements.define("ab-button", AbButton);
"use strict";

$.fn.incrementRequest = function () {
    var curr = 0;
    if (this.attr("current-request")) {
        curr = parseInt(this.attr("current-request"));
    }

    curr++;
    this.attr("current-request", curr);
}

$.fn.resetRequest = function () {
    this.removeAttr("current-request");
}

class AbPage extends HTMLElement {

    constructor() {
        super();

        this.htmlObj = $("html,body")[0];

        //pageLoader
        this.pageLoad = document.createElement("div");
        this.wrapper = document.createElement("div");
        this.loadBar = document.createElement("div");
        this.barRange = document.createElement("div");
        this.loadText = document.createElement("p");

        this.mainClass = "ab-page";
    }

    _render() {
        this.classList.add(this.mainClass);

        //Cria um id
        if (!this.hasAttribute("id")) {
            //description: Atributo para identificar o objeto| Alfanumérico| não| vazio|
            this.setAttribute("id", generateID());
        }

        // parametros
        if (this.getAttribute("fullscreen") != "false") {
            //values: true;false
            //description: Usa o tamanho total da tela | true ou false | não | true |
            this.htmlObj.style.margin = "0px";
            this.htmlObj.style.padding = "0px";
            this.htmlObj.style.width = "100%";
            this.htmlObj.style.height = "100%";

            this.style.top = "0px";
            this.style.left = "0px";
            this.style.bottom = "0px";
            this.style.right = "0px";
            this.style.height = "100%";
            this.style.width = "100%";
            this.style.position = "fixed";
        } else{
            $(this).addClass("page--limited");
        }

        // Valor padrao
        this.style.zIndex = "0";

        //se existir um max-request, construir o sistema de load
        if (this.hasAttribute("max-request")) {
            //description: Máximo de requests que terá na página para o loader | Numérico | não | 0 |
            this._createLoader();
        } else{
            document.querySelector("html").classList.add("html-page-loaded");
        }

    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["loader-visibility", "current-request"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        if (attrName == "loader-visibility") {
            if (newVal != "true") {
                $(this.logo).fadeOut(100, function () {
                    this.remove();
                });

                $(this.pageLoad).fadeOut(100, function () {
                    this.remove();
                });
            } else if (this.pageLoad.length == 0) {
                this._createLoader();
            } else {
                $(this.pageLoad).fadeIn(100);
            }

        } else if (attrName == "current-request") {
            var reqAtual = parseInt(newVal);
            var reqMax = parseInt(this.getAttribute("max-request"));
            var total = ((100 / reqMax) * reqAtual);

            this.barRange.style.width = total + "%";

            if (total >= 100) {
                this.setAttribute("loader-visibility", "false");
                document.querySelector("html").classList.add("html-page-loaded");
            }

            reqAtual = null;
            reqMax = null;
            total = null;
        }
    }

    _createLoader() {

        this.pageLoad.classList.add("ab-page-loader");
        this.pageLoad.setAttribute("id", "ab-page-loader");
        this.pageLoad.style.display = "block";
        this.appendChild(this.pageLoad);

        this.wrapper.classList.add("ab-page-loader-wrapper");
        this.pageLoad.appendChild(this.wrapper);

        this.loadBar.classList.add("ab-page-loader-path");
        this.wrapper.appendChild(this.loadBar);

        this.barRange.classList.add("ab-page-loader-range");
        this.barRange.setAttribute("id", "ab-page-loader-range");
        this.loadBar.appendChild(this.barRange);

        this.loadText.classList.add("ab-page-loader-text");
        this.loadText.innerText = "carregando...";
        this.wrapper.appendChild(this.loadText);
    }
}
customElements.define('ab-page', AbPage);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFiLXN1cHBvcnQvanMvYWItZml4LmpzIiwiYWItc3VwcG9ydC9qcy9hYi11dGlsLmpzIiwiYWItYnV0dG9uL2pzL2FiLWJ1dHRvbi5qcyIsImFiLXBhZ2UvanMvYWItcGFnZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdFRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJ3ZWJjb21wLmFibmVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vL1ZlcmZpY2EgU2lzdGVtYSBPcGVyYWNpb25hbFxud2luZG93LmlzSU9TID0gKC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KG5hdmlnYXRvci5wbGF0Zm9ybSkgfHwgKG5hdmlnYXRvci5wbGF0Zm9ybSA9PT0gJ01hY0ludGVsJyAmJiBuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHMgPiAxKSkgJiYgIXdpbmRvdy5NU1N0cmVhbTtcbndpbmRvdy5pc0FuZHJvaWQgPSAvKGFuZHJvaWQpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcbndpbmRvdy5pc0Rlc2t0b3AgPSAhd2luZG93LmlzSU9TICYmICF3aW5kb3cuaXNBbmRyb2lkO1xuXG4oZnVuY3Rpb24odywgJCwgdW5kZWZpbmVkKSB7XG5cbiAgICB3LnRhcEhhbmRsaW5nID0gZmFsc2U7XG4gICAgdy50YXBweSA9IHRydWU7XG5cbiAgICB2YXIgdGFwID0gZnVuY3Rpb24oJGVscykge1xuICAgICAgICByZXR1cm4gJGVscy5lYWNoKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgJGVsID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICByZXNldFRpbWVyLFxuICAgICAgICAgICAgICAgIHN0YXJ0WSxcbiAgICAgICAgICAgICAgICBzdGFydFgsXG4gICAgICAgICAgICAgICAgY2FuY2VsLFxuICAgICAgICAgICAgICAgIHNjcm9sbFRvbGVyYW5jZSA9IDEwO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyKGUpIHtcbiAgICAgICAgICAgICAgICAkKGUudGFyZ2V0KS50cmlnZ2VyKFwidGFwXCIsIFtlLCAkKGUudGFyZ2V0KS5hdHRyKFwiaHJlZlwiKV0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRDb29yZHMoZSkge1xuICAgICAgICAgICAgICAgIHZhciBldiA9IGUub3JpZ2luYWxFdmVudCB8fCBlLFxuICAgICAgICAgICAgICAgICAgICB0b3VjaGVzID0gZXYudG91Y2hlcyB8fCBldi50YXJnZXRUb3VjaGVzO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRvdWNoZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFt0b3VjaGVzWzBdLnBhZ2VYLCB0b3VjaGVzWzBdLnBhZ2VZXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHN0YXJ0KGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50b3VjaGVzICYmIGUudG91Y2hlcy5sZW5ndGggPiAxIHx8IGUudGFyZ2V0VG91Y2hlcyAmJiBlLnRhcmdldFRvdWNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGNvb3JkcyA9IGdldENvb3JkcyhlKTtcbiAgICAgICAgICAgICAgICBzdGFydFggPSBjb29yZHNbMF07XG4gICAgICAgICAgICAgICAgc3RhcnRZID0gY29vcmRzWzFdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBhbnkgdG91Y2hzY3JvbGwgdGhhdCByZXN1bHRzIGluID4gdG9sZXJhbmNlIHNob3VsZCBjYW5jZWwgdGhlIHRhcFxuICAgICAgICAgICAgZnVuY3Rpb24gbW92ZShlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFjYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvb3JkcyA9IGdldENvb3JkcyhlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvb3JkcyAmJiAoTWF0aC5hYnMoc3RhcnRZIC0gY29vcmRzWzFdKSA+IHNjcm9sbFRvbGVyYW5jZSB8fCBNYXRoLmFicyhzdGFydFggLSBjb29yZHNbMF0pID4gc2Nyb2xsVG9sZXJhbmNlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZW5kKGUpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQocmVzZXRUaW1lcik7XG4gICAgICAgICAgICAgICAgcmVzZXRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHcudGFwSGFuZGxpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XG5cbiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgbm8gbW9kaWZpZXJzIGFyZSBwcmVzZW50LiB0aHggaHR0cDovL3d3dy5qYWNrbG1vb3JlLmNvbS9ub3Rlcy9jbGljay1ldmVudHMvXG4gICAgICAgICAgICAgICAgaWYgKChlLndoaWNoICYmIGUud2hpY2ggPiAxKSB8fCBlLnNoaWZ0S2V5IHx8IGUuYWx0S2V5IHx8IGUubWV0YUtleSB8fCBlLmN0cmxLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIC8vIHRoaXMgcGFydCBwcmV2ZW50cyBhIGRvdWJsZSBjYWxsYmFjayBmcm9tIHRvdWNoIGFuZCBtb3VzZSBvbiB0aGUgc2FtZSB0YXBcblxuICAgICAgICAgICAgICAgIC8vIGlmIGEgc2Nyb2xsIGhhcHBlbmVkIGJldHdlZW4gdG91Y2hzdGFydCBhbmQgdG91Y2hlbmRcbiAgICAgICAgICAgICAgICBpZiAoY2FuY2VsIHx8IHcudGFwSGFuZGxpbmcgJiYgdy50YXBIYW5kbGluZyAhPT0gZS50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdy50YXBIYW5kbGluZyA9IGUudHlwZTtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyKGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkZWxcbiAgICAgICAgICAgICAgICAuYmluZChcInRvdWNoc3RhcnQudGFwcHkgTVNQb2ludGVyRG93bi50YXBweVwiLCBzdGFydClcbiAgICAgICAgICAgICAgICAuYmluZChcInRvdWNobW92ZS50YXBweSBNU1BvaW50ZXJNb3ZlLnRhcHB5XCIsIG1vdmUpXG4gICAgICAgICAgICAgICAgLmJpbmQoXCJ0b3VjaGVuZC50YXBweSBNU1BvaW50ZXJVcC50YXBweVwiLCBlbmQpXG4gICAgICAgICAgICAgICAgLmJpbmQoXCJjbGljay50YXBweVwiLCBlbmQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHVudGFwID0gZnVuY3Rpb24oJGVscykge1xuICAgICAgICByZXR1cm4gJGVscy51bmJpbmQoXCIudGFwcHlcIik7XG4gICAgfTtcblxuICAgIC8vIHVzZSBzcGVjaWFsIGV2ZW50cyBhcGlcbiAgICBpZiAoJC5ldmVudCAmJiAkLmV2ZW50LnNwZWNpYWwpIHtcbiAgICAgICAgJC5ldmVudC5zcGVjaWFsLnRhcCA9IHtcbiAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oaGFuZGxlT2JqKSB7XG4gICAgICAgICAgICAgICAgdGFwKCQodGhpcykpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oaGFuZGxlT2JqKSB7XG4gICAgICAgICAgICAgICAgdW50YXAoJCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbW9ua2V5YmluZFxuICAgICAgICB2YXIgb2xkQmluZCA9ICQuZm4uYmluZCxcbiAgICAgICAgICAgIG9sZFVuYmluZCA9ICQuZm4udW5iaW5kO1xuICAgICAgICAkLmZuLmJpbmQgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgIGlmICgvKF58ICl0YXAoIHwkKS8udGVzdChldnQpKSB7XG4gICAgICAgICAgICAgICAgdGFwKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG9sZEJpbmQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfTtcbiAgICAgICAgJC5mbi51bmJpbmQgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgIGlmICgvKF58ICl0YXAoIHwkKS8udGVzdChldnQpKSB7XG4gICAgICAgICAgICAgICAgdW50YXAodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2xkVW5iaW5kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH07XG4gICAgfVxuXG59KHRoaXMsIGpRdWVyeSkpO1xuXG5cbi8vIEFSUlVNQSBFUlJPIE5PIElFOSBPTkRFIE5BTyBFWElTVEUgV0lORE9XLkNPTlNPTEVcbmlmICghd2luZG93LmNvbnNvbGUpIHtcbiAgICB2YXIgY29uc29sZSA9IHtcbiAgICAgICAgbG9nOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICB3YXJuOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgdGltZTogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgdGltZUVuZDogZnVuY3Rpb24oKSB7fVxuICAgIH1cbn1cblxuLyogQVJSVU1BIElOUFVUIE5PIElPUyBRVUUgTkFPIEZVTkNJT05BIERJUkVJVE8gKi9cbi8qJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgaWYgKHdpbmRvdy5pc0lPUykge1xuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgJCgnOmZvY3VzJykuZm9jdXMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn0pOyovXG5cbnZhciBnZXRYWSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdmFyIHggPSBudWxsO1xuICAgIHZhciB5ID0gbnVsbDtcblxuICAgIGlmIChldmVudC5vcmlnaW5hbEV2ZW50ICE9IG51bGwgJiYgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzICE9IG51bGwpIHtcbiAgICAgICAgdmFyIHRvdWNoID0gZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF07XG4gICAgICAgIHggPSBwYXJzZUZsb2F0KHRvdWNoLnBhZ2VYKTtcbiAgICAgICAgeSA9IHBhcnNlRmxvYXQodG91Y2gucGFnZVkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHggPSBwYXJzZUZsb2F0KGV2ZW50LnBhZ2VYKTtcbiAgICAgICAgeSA9IHBhcnNlRmxvYXQoZXZlbnQucGFnZVkpO1xuICAgIH1cblxuICAgIHZhciBwb3MgPSBuZXcgT2JqZWN0KCk7XG4gICAgcG9zLnggPSB4O1xuICAgIHBvcy55ID0geTtcblxuICAgIHJldHVybiBwb3M7XG59XG5cbnZhciBzdXBwb3J0M2QgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcmV0ID0gZmFsc2U7XG4gICAgdmFyIHN1cHBvcnRzM0RUcmFuc2Zvcm1zID0gZG9jdW1lbnQuYm9keS5zdHlsZVsnd2Via2l0UGVyc3BlY3RpdmUnXSAhPT0gdW5kZWZpbmVkIHx8IGRvY3VtZW50LmJvZHkuc3R5bGVbJ01velBlcnNwZWN0aXZlJ10gIT09IHVuZGVmaW5lZDtcbiAgICBpZiAoc3VwcG9ydHMzRFRyYW5zZm9ybXMpIHtcbiAgICAgICAgcmV0ID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn1cblxudmFyIGdldFRyYW5zZm9ybSA9IGZ1bmN0aW9uKGVsKSB7XG4gICAgdmFyIHByb3AgPSBcIlwiO1xuXG4gICAgaWYgKGVsLmNzcygnLXdlYmtpdC10cmFuc2Zvcm0nKSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcCA9IGVsLmNzcygnLXdlYmtpdC10cmFuc2Zvcm0nKTtcbiAgICB9IGVsc2UgaWYgKGVsLmNzcygndHJhbnNmb3JtJykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHByb3AgPSBlbC5jc3MoJ3RyYW5zZm9ybScpO1xuICAgIH0gZWxzZSBpZiAoZWwuY3NzKCctbW96LXRyYW5zZm9ybScpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICBwcm9wID0gZWwuY3NzKCctbW96LXRyYW5zZm9ybScpO1xuICAgIH0gZWxzZSBpZiAoZWwuY3NzKCctbXMtdHJhbnNmb3JtJykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHByb3AgPSBlbC5jc3MoJy1tcy10cmFuc2Zvcm0nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gWzAsIDAsIDBdO1xuICAgIH1cblxuICAgIHZhciByZXN1bHRzID0gcHJvcC5tYXRjaCgvbWF0cml4KD86KDNkKVxcKC17MCwxfVxcZCsoPzosIC17MCwxfVxcZCspKig/OiwgKC17MCwxfVxcZCspKSg/OiwgKC17MCwxfVxcZCspKSg/OiwgKC17MCwxfVxcZCspKSwgLXswLDF9XFxkK1xcKXxcXCgtezAsMX1cXGQrKD86LCAtezAsMX1cXGQrKSooPzosICgtezAsMX1cXGQrKSkoPzosICgtezAsMX1cXGQrKSlcXCkpLyk7XG5cbiAgICBpZiAoIXJlc3VsdHMpXG4gICAgICAgIHJldHVybiBbMCwgMCwgMF07XG4gICAgaWYgKHJlc3VsdHNbMV0gPT0gJzNkJylcbiAgICAgICAgcmV0dXJuIHJlc3VsdHMuc2xpY2UoMiwgNSk7XG5cbiAgICByZXN1bHRzLnB1c2goMCk7XG4gICAgcmV0dXJuIHJlc3VsdHMuc2xpY2UoNSwgOCk7XG59XG5cbnZhciBnb1RvTmV4dFRhYmluZGV4ID0gZnVuY3Rpb24oZXZlbnQsIG9iaiwgY29tbWFuZCkge1xuICAgIHZhciBrZXkgPSBldmVudC5rZXlDb2RlID8gZXZlbnQua2V5Q29kZSA6IGV2ZW50LndoaWNoO1xuXG4gICAgaWYgKGtleSA9PSAxMyB8fCBrZXkgPT0gOSkge1xuICAgICAgICB2YXIgZmljYXIgPSB0cnVlO1xuICAgICAgICB2YXIgcmV0ID0gdHJ1ZTtcbiAgICAgICAgdmFyIHRhYmluZGV4ID0gb2JqLmF0dHIoJ3RhYmluZGV4Jyk7XG5cbiAgICAgICAgaWYgKGtleSA9PSAxMyAmJiBvYmpbMF0ubm9kZU5hbWUgPT0gXCJURVhUQVJFQVwiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBkbyB7XG4gICAgICAgICAgICAvL1ZlcmlmaWNhIG8gdGFiaW5kZXhcbiAgICAgICAgICAgIHZhciBnb3RvVGFiaW5kZXggPSBvYmouYXR0cignZ290by10YWItaW5kZXgnKTtcbiAgICAgICAgICAgIHZhciBzdG9wVGFiaW5kZXggPSBvYmouYXR0cignc3RvcC10YWItaW5kZXgnKTtcblxuICAgICAgICAgICAgLy9WYWkgb3BhcmFcbiAgICAgICAgICAgIGlmICh0YWJpbmRleCAmJiBzdG9wVGFiaW5kZXggIT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICB0YWJpbmRleCA9IHBhcnNlSW50KHRhYmluZGV4KTtcblxuICAgICAgICAgICAgICAgIC8vYXZhbmNhIG8gdGFiaW5kZXhcbiAgICAgICAgICAgICAgICBpZiAoZ290b1RhYmluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmluZGV4ID0gZ290b1RhYmluZGV4O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmluZGV4Kys7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9zZSBFeGlzdGlyIG8gZWxlbWVudG8gZm9jYSBuZWxlXG4gICAgICAgICAgICAgICAgdmFyIG5leHRPYmogPSAkKCdbdGFiLWluZGV4PScgKyB0YWJpbmRleCArICddJyk7XG5cbiAgICAgICAgICAgICAgICAvL1ZlcmlmaWNhIHNlIGVuY29udHJvdSB1bSBvYmpldG9cbiAgICAgICAgICAgICAgICBpZiAobmV4dE9iai5sZW5ndGggPiAwICYmIG5leHRPYmouYXR0cihcImlzLWRpc2FibGVkXCIpICE9IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpY2FyID0gZmFsc2U7ICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgICAgICAgICBpZiAobmV4dE9ialswXS5ub2RlTmFtZSA9PSBcIkFCTkVSLVNFTEVDVC1VTkRFUkxJTkVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dE9iai5maW5kKFwic2VsZWN0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRPYmouZmluZChcIltkaXYtZm9jdXM9dHJ1ZV1cIikudHJpZ2dlcihjb21tYW5kKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV4dE9iai5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZlcmlmaWNhIG8gcHJveGltbyBvYmpldG9cbiAgICAgICAgICAgICAgICAgICAgICAgIG9iaiA9IG5leHRPYmo7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWNhciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9yZW1vdmlkbyBwYXJhIGZ1bmNpb25hciBvIGVudGVyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChzdG9wVGFiaW5kZXggPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmljYXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmljYXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAoZmljYXIpO1xuXG4gICAgICAgIC8vU2UgZm9yIHRhYiBkZWl4YXIgZmFsc2VcbiAgICAgICAgaWYgKGtleSA9PSA5KSB7XG4gICAgICAgICAgICByZXQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vcm9kYXIgc2FpZGFcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG5cbn1cblxudmFyIHJhbmRvbU51bWJlciA9IGZ1bmN0aW9uKCkge1xuICAgIC8vdmFyIHJhbmRvbV9pbnRlZ2VyID0gTWF0aC5yYW5kb20oKSoxMDF8MDsgICAgXG4gICAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCAxMCk7XG59XG5cbnZhciBndWlkID0gZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gczQoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKVxuICAgICAgICAgICAgLnRvU3RyaW5nKDE2KVxuICAgICAgICAgICAgLnN1YnN0cmluZygxKTtcbiAgICB9XG4gICAgcmV0dXJuIHM0KCkgKyBzNCgpICsgJy0nICsgczQoKSArICctJyArIHM0KCkgKyAnLScgK1xuICAgICAgICBzNCgpICsgJy0nICsgczQoKSArIHM0KCkgKyBzNCgpO1xufVxuXG52YXIgZ2VuZXJhdGVJRCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBndWlkKCk7XG59XG5cbnZhciBwb2ludGVyRXZlbnRUb1hZID0gZnVuY3Rpb24oZSkge1xuICAgIHZhciBvdXQgPSB7IHg6IDAsIHk6IDAgfTtcbiAgICBpZiAoZS50eXBlID09ICd0b3VjaHN0YXJ0JyB8fCBlLnR5cGUgPT0gJ3RvdWNobW92ZScgfHwgZS50eXBlID09ICd0b3VjaGVuZCcgfHwgZS50eXBlID09ICd0b3VjaGNhbmNlbCcpIHtcbiAgICAgICAgdmFyIHRvdWNoID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0gfHwgZS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuICAgICAgICBvdXQueCA9IHRvdWNoLnBhZ2VYO1xuICAgICAgICBvdXQueSA9IHRvdWNoLnBhZ2VZO1xuICAgIH0gZWxzZSBpZiAoZS50eXBlID09ICdtb3VzZWRvd24nIHx8IGUudHlwZSA9PSAnbW91c2V1cCcgfHwgZS50eXBlID09ICdtb3VzZW1vdmUnIHx8IGUudHlwZSA9PSAnbW91c2VvdmVyJyB8fCBlLnR5cGUgPT0gJ21vdXNlb3V0JyB8fCBlLnR5cGUgPT0gJ21vdXNlZW50ZXInIHx8IGUudHlwZSA9PSAnbW91c2VsZWF2ZScpIHtcbiAgICAgICAgb3V0LnggPSBlLnBhZ2VYO1xuICAgICAgICBvdXQueSA9IGUucGFnZVk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG59OyIsIlwidXNlIHN0cmljdFwiO1xuXG4vL2NvbXBvbmVudC13cmFwcGVyOiBub24tZnVuY3Rpb25hbFxuXG4vL0NyaWFuZG8gbmFtZXNwYWNlIHV0aWxzXG52YXIgUG1iVXRpbHMgPSBmdW5jdGlvbiAoKSB7IH1cblxuXG5QbWJVdGlscy5wcm90b3R5cGUucmVtb3ZlQWNjZW50ID0gZnVuY3Rpb24gKHdvcmQpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdmFyIG1hcCA9IHtcbiAgICAgICAgXCLDoVwiOiBcImFcIixcbiAgICAgICAgXCLDoFwiOiBcImFcIixcbiAgICAgICAgXCLDolwiOiBcImFcIixcbiAgICAgICAgXCLDo1wiOiBcImFcIixcbiAgICAgICAgXCLDpFwiOiBcImFcIixcbiAgICAgICAgXCLDgVwiOiBcIkFcIixcbiAgICAgICAgXCLDgFwiOiBcIkFcIixcbiAgICAgICAgXCLDglwiOiBcIkFcIixcbiAgICAgICAgXCLDg1wiOiBcIkFcIixcbiAgICAgICAgXCLDhFwiOiBcIkFcIixcbiAgICAgICAgXCLDqVwiOiBcImVcIixcbiAgICAgICAgXCLDqFwiOiBcImVcIixcbiAgICAgICAgXCLDqlwiOiBcImVcIixcbiAgICAgICAgXCLhur1cIjogXCJlXCIsXG4gICAgICAgIFwiw6tcIjogXCJlXCIsXG4gICAgICAgIFwiw4lcIjogXCJFXCIsXG4gICAgICAgIFwiw4hcIjogXCJFXCIsXG4gICAgICAgIFwiw4pcIjogXCJFXCIsXG4gICAgICAgIFwi4bq8XCI6IFwiRVwiLFxuICAgICAgICBcIsOLXCI6IFwiRVwiLFxuICAgICAgICBcIsOtXCI6IFwiaVwiLFxuICAgICAgICBcIsOsXCI6IFwiaVwiLFxuICAgICAgICBcIsOuXCI6IFwiaVwiLFxuICAgICAgICBcIsSpXCI6IFwiaVwiLFxuICAgICAgICBcIsOvXCI6IFwiaVwiLFxuICAgICAgICBcIsONXCI6IFwiSVwiLFxuICAgICAgICBcIsOMXCI6IFwiSVwiLFxuICAgICAgICBcIsOOXCI6IFwiSVwiLFxuICAgICAgICBcIsSoXCI6IFwiSVwiLFxuICAgICAgICBcIsOPXCI6IFwiSVwiLFxuICAgICAgICBcIsOzXCI6IFwib1wiLFxuICAgICAgICBcIsOyXCI6IFwib1wiLFxuICAgICAgICBcIsO0XCI6IFwib1wiLFxuICAgICAgICBcIsO1XCI6IFwib1wiLFxuICAgICAgICBcIsO2XCI6IFwib1wiLFxuICAgICAgICBcIsOTXCI6IFwiT1wiLFxuICAgICAgICBcIsOSXCI6IFwiT1wiLFxuICAgICAgICBcIsOUXCI6IFwiT1wiLFxuICAgICAgICBcIsOVXCI6IFwiT1wiLFxuICAgICAgICBcIsOWXCI6IFwiT1wiLFxuICAgICAgICBcIsO6XCI6IFwidVwiLFxuICAgICAgICBcIsO5XCI6IFwidVwiLFxuICAgICAgICBcIsO7XCI6IFwidVwiLFxuICAgICAgICBcIsWpXCI6IFwidVwiLFxuICAgICAgICBcIsO8XCI6IFwidVwiLFxuICAgICAgICBcIsOaXCI6IFwiVVwiLFxuICAgICAgICBcIsOZXCI6IFwiVVwiLFxuICAgICAgICBcIsObXCI6IFwiVVwiLFxuICAgICAgICBcIsWoXCI6IFwiVVwiLFxuICAgICAgICBcIsOcXCI6IFwiVVwiLFxuICAgICAgICBcIsO9XCI6IFwieVwiLFxuICAgICAgICBcIuG7s1wiOiBcInlcIixcbiAgICAgICAgXCLFt1wiOiBcInlcIixcbiAgICAgICAgXCLhu7lcIjogXCJ5XCIsXG4gICAgICAgIFwiw79cIjogXCJ5XCIsXG4gICAgICAgIFwiw51cIjogXCJZXCIsXG4gICAgICAgIFwi4buyXCI6IFwiWVwiLFxuICAgICAgICBcIsW2XCI6IFwiWVwiLFxuICAgICAgICBcIuG7uFwiOiBcIllcIixcbiAgICAgICAgXCLFuFwiOiBcIllcIixcbiAgICAgICAgXCLDsVwiOiBcIm5cIixcbiAgICAgICAgXCLDkVwiOiBcIm5cIixcbiAgICAgICAgXCLDh1wiOiBcImNcIixcbiAgICAgICAgXCLDp1wiOiBcImNcIlxuICAgIH07XG5cbiAgICBpZiAod29yZCAhPSBcIlwiKSB7XG4gICAgICAgIHJldHVybiB3b3JkLnJlcGxhY2UoL1vDoMOow6zDssO5w4DDiMOMw5LDmcOhw6nDrcOzw7rDvcOBw4nDjcOTw5rDncOiw6rDrsO0w7vDgsOKw47DlMObw6Phur3EqcWpw7HDtcOD4bq8xKjFqMORw5XDpMOrw6/DtsO8w7/DhMOLw4/DlsOcxbjDh8OnXS9nLCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgICAgIHJldHVybiBtYXBbbWF0Y2hdO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8vUEVnYSB2YXJpYXZlaXMgZGEgVVJMXG5QbWJVdGlscy5wcm90b3R5cGUuZ2V0VXJsVmFycyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdmFycyA9IG5ldyBPYmplY3QoKSxcbiAgICAgICAgaGFzaDtcbiAgICB2YXIgaGFzaGVzID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc2xpY2Uod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignPycpICsgMSkuc3BsaXQoJyYnKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhhc2hlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBoYXNoID0gaGFzaGVzW2ldLnNwbGl0KCc9Jyk7XG4gICAgICAgIHZhcnNbaGFzaFswXV0gPSBoYXNoWzFdO1xuICAgIH1cbiAgICByZXR1cm4gdmFycztcbn1cblxuLy9EZXRlcm1pbmEgc2Ugw6kgbW9kbyBhZGFwdGF0aXZvIFxuUG1iVXRpbHMucHJvdG90eXBlLnNob3dCaWdTY3JlZW4gPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgaWYgKHBhcnNlSW50KG9iai5vdXRlcldpZHRoKCkpID49IDEwMjQpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuUG1iVXRpbHMucHJvdG90eXBlLmdldENoZWNrZWRSYWRpbyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgaWYgKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuICQoXCJpbnB1dFt0eXBlPXJhZGlvXVtuYW1lPVwiICsgbmFtZSArIFwiXTpjaGVja2VkXCIpLnBhcmVudCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAkKFwiaW5wdXRbdHlwZT1yYWRpb106Y2hlY2tlZFwiKS5wYXJlbnQoKTtcbiAgICB9XG59XG5cblBtYlV0aWxzLnByb3RvdHlwZS5nZXRQaG9uZUFzT2JqZWN0ID0gZnVuY3Rpb24gKHBob25lKSB7XG5cbiAgICB2YXIgcGhvbmVPYmogPSB7XG4gICAgICAgIGRkaTogXCJcIixcbiAgICAgICAgZGRkOiBcIlwiLFxuICAgICAgICBwaG9uZTogcGhvbmVcbiAgICB9O1xuXG4gICAgcGhvbmUgPSBwaG9uZSA/IHBob25lLnJlcGxhY2UoL1xcRCsvZywgJycpIDogcGhvbmU7XG5cbiAgICBpZiAocGhvbmUgJiYgcGhvbmUubGVuZ3RoID4gMTEpIHtcbiAgICAgICAgcGhvbmVPYmouZGRpID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHsyfSkoXFxkezgsOX0pJC9nLCBcIlxcJDFcIik7XG4gICAgICAgIHBob25lT2JqLmRkZCA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7Mn0pKFxcZHs4LDl9KSQvZywgXCJcXCQyXCIpO1xuICAgICAgICBwaG9uZU9iai5waG9uZSA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7Mn0pKFxcZHs4LDl9KSQvZywgXCJcXCQzXCIpO1xuICAgIH0gZWxzZSBpZiAocGhvbmUgJiYgcGhvbmUubGVuZ3RoID4gOSkge1xuICAgICAgICBwaG9uZU9iai5kZGQgPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezgsOX0pJC9nLCBcIlxcJDFcIik7XG4gICAgICAgIHBob25lT2JqLnBob25lID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHs4LDl9KSQvZywgXCJcXCQyXCIpO1xuICAgIH1cblxuICAgIHJldHVybiBwaG9uZU9iajtcbn1cblxuUG1iVXRpbHMucHJvdG90eXBlLmZvcm1hdFBob25lID0gZnVuY3Rpb24gKHBob25lKSB7XG5cbiAgICB2YXIgcGhvbmVSZXR1cm4gPSBwaG9uZS5yZXBsYWNlKC9bXjAtOV0vZywgJycpO1xuXG4gICAgaWYgKHBob25lICYmIHBob25lLmxlbmd0aCA+IDExKSB7XG4gICAgICAgIHBob25lUmV0dXJuID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHsyfSkoXFxkezQsNX0pKFxcZHs0fSkkL2csIFwiXFwrJDEgXFwoJDIpIFxcJDMgXFwkNFwiKTtcbiAgICB9IGVsc2UgaWYgKHBob25lICYmIHBob25lLmxlbmd0aCA+IDkpIHtcbiAgICAgICAgcGhvbmVSZXR1cm4gPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezQsNX0pKFxcZHs0fSkkL2csIFwiXFwoJDEpIFxcJDIgXFwkM1wiKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHBob25lUmV0dXJuO1xufVxuXG5QbWJVdGlscy5wcm90b3R5cGUucmVtb3ZlQ3BmQ25wakZvcm1hdCA9IGZ1bmN0aW9uICh2YWxvciwgdHlwZSkge1xuXG4gICAgaWYgKHZhbG9yKSB7XG4gICAgICAgIC8vcmVtb3ZlIHBvbnRvIGUgdmlyZ3VsYVxuICAgICAgICB2YWxvciA9IHZhbG9yLnJlcGxhY2UobmV3IFJlZ0V4cCgvW15cXGRdL2cpLCBcIlwiKTtcblxuICAgICAgICBpZiAodHlwZSA9PSBcIkNOUEpcIikge1xuICAgICAgICAgICAgdmFyIGxlbiA9IDE0O1xuICAgICAgICAgICAgdmFyIHBhZCA9IFwiMDAwMDAwMDAwMDBcIjtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IFwiQ1BGXCIpIHtcbiAgICAgICAgICAgIHZhciBsZW4gPSAxMTtcbiAgICAgICAgICAgIHZhciBwYWQgPSBcIjAwMDAwMDAwMDAwXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdHJhbnNmb3JtYSBwYXJhIG51bWVyb1xuICAgICAgICB2YWxvciA9IHBhcnNlSW50KHZhbG9yKTtcblxuICAgICAgICAvL3NlIGZvciBtYWlvciBxdWUgbyB2YWxvciBkZWZpbmRvIHBhcmEgbGVuIGVsZSBjb3J0YVxuICAgICAgICBpZiAodmFsb3IubGVuZ3RoID4gbGVuKSB7XG4gICAgICAgICAgICB2YWxvciA9IHZhbG9yLnN1YnN0cmluZygwLCBsZW4pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9TZSBvY29ycmUgYWxndW0gZXJybywgZGVpeGFyIHZhemlvXG4gICAgICAgIGlmIChpc05hTih2YWxvcikpIHtcbiAgICAgICAgICAgIHZhbG9yID0gXCJcIjtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFsb3IgPSBwYWQuc3Vic3RyaW5nKDAsIHBhZC5sZW5ndGggLSB2YWxvci5sZW5ndGgpICsgdmFsb3I7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbG9yO1xufVxuXG5QbWJVdGlscy5wcm90b3R5cGUudmFsaWRhckNOUEogPSBmdW5jdGlvbiAoY25waikge1xuXG4gICAgY25waiA9IGNucGoucmVwbGFjZSgvW15cXGRdKy9nLCAnJyk7XG4gICAgXG4gICAgaWYgKGNucGogPT0gXCIwXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjAwMDAwMDAwMDAwMDAwXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjExMTExMTExMTExMTExXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjIyMjIyMjIyMjIyMjIyXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjMzMzMzMzMzMzMzMzMzXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjQ0NDQ0NDQ0NDQ0NDQ0XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjU1NTU1NTU1NTU1NTU1XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjY2NjY2NjY2NjY2NjY2XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjc3Nzc3Nzc3Nzc3Nzc3XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjg4ODg4ODg4ODg4ODg4XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjk5OTk5OTk5OTk5OTk5XCIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYSBEVnNcbiAgICB2YXIgdGFtYW5obyA9IGNucGoubGVuZ3RoIC0gMlxuICAgIHZhciBudW1lcm9zID0gY25wai5zdWJzdHJpbmcoMCwgdGFtYW5obyk7XG4gICAgdmFyIGRpZ2l0b3MgPSBjbnBqLnN1YnN0cmluZyh0YW1hbmhvKTtcbiAgICB2YXIgc29tYSA9IDA7XG4gICAgdmFyIHBvcyA9IHRhbWFuaG8gLSA3O1xuICAgIHZhciBpID0gdGFtYW5obztcblxuICAgIGZvciAoaSA9IHRhbWFuaG87IGkgPj0gMTsgaS0tKSB7XG4gICAgICAgIHNvbWEgKz0gbnVtZXJvcy5jaGFyQXQodGFtYW5obyAtIGkpICogcG9zLS07XG4gICAgICAgIGlmIChwb3MgPCAyKVxuICAgICAgICAgICAgcG9zID0gOTtcbiAgICB9XG4gICAgdmFyIHJlc3VsdGFkbyA9IHNvbWEgJSAxMSA8IDIgPyAwIDogMTEgLSBzb21hICUgMTE7XG4gICAgaWYgKHJlc3VsdGFkbyAhPSBkaWdpdG9zLmNoYXJBdCgwKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdGFtYW5obyA9IHRhbWFuaG8gKyAxO1xuICAgIG51bWVyb3MgPSBjbnBqLnN1YnN0cmluZygwLCB0YW1hbmhvKTtcbiAgICBzb21hID0gMDtcbiAgICBwb3MgPSB0YW1hbmhvIC0gNztcbiAgICBmb3IgKGkgPSB0YW1hbmhvOyBpID49IDE7IGktLSkge1xuICAgICAgICBzb21hICs9IG51bWVyb3MuY2hhckF0KHRhbWFuaG8gLSBpKSAqIHBvcy0tO1xuICAgICAgICBpZiAocG9zIDwgMilcbiAgICAgICAgICAgIHBvcyA9IDk7XG4gICAgfVxuXG4gICAgcmVzdWx0YWRvID0gc29tYSAlIDExIDwgMiA/IDAgOiAxMSAtIHNvbWEgJSAxMTtcblxuICAgIGlmIChyZXN1bHRhZG8gIT0gZGlnaXRvcy5jaGFyQXQoMSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xufVxuXG4vL3ZhbGlkYSBvIENQRiBkaWdpdGFkb1xuUG1iVXRpbHMucHJvdG90eXBlLnZhbGlkYXJDUEYgPSBmdW5jdGlvbihjcGYpIHtcblxuICAgIHZhciBleHAgPSAvXFwufFxcLS9nXG4gICAgY3BmID0gY3BmLnRvU3RyaW5nKCkucmVwbGFjZShleHAsIFwiXCIpO1xuICAgIGlmIChjcGYubGVuZ3RoIDwgMTEpIHtcbiAgICAgICAgdmFyIHBhZCA9IFwiMDAwMDAwMDAwMDBcIjtcbiAgICAgICAgY3BmID0gcGFkLnN1YnN0cmluZygwLCBwYWQubGVuZ3RoIC0gY3BmLmxlbmd0aCkgKyBjcGY7XG4gICAgfVxuXG4gICAgaWYgKGNwZiA9PSBcIjBcIiB8fFxuICAgICAgICBjcGYgPT0gXCIwMDAwMDAwMDAwMFwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjExMTExMTExMTExXCIgfHxcbiAgICAgICAgY3BmID09IFwiMjIyMjIyMjIyMjJcIiB8fFxuICAgICAgICBjcGYgPT0gXCIzMzMzMzMzMzMzM1wiIHx8XG4gICAgICAgIGNwZiA9PSBcIjQ0NDQ0NDQ0NDQ0XCIgfHxcbiAgICAgICAgY3BmID09IFwiNTU1NTU1NTU1NTVcIiB8fFxuICAgICAgICBjcGYgPT0gXCI2NjY2NjY2NjY2NlwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjc3Nzc3Nzc3Nzc3XCIgfHxcbiAgICAgICAgY3BmID09IFwiODg4ODg4ODg4ODhcIiB8fFxuICAgICAgICBjcGYgPT0gXCI5OTk5OTk5OTk5OVwiKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgc29tYTtcbiAgICB2YXIgcmVzdG87XG4gICAgc29tYSA9IDA7XG5cbiAgICBmb3IgKHZhciBpID0gMTsgaSA8PSA5OyBpKyspIHtcbiAgICAgICAgc29tYSA9IHNvbWEgKyBwYXJzZUludChjcGYuc3Vic3RyaW5nKGkgLSAxLCBpKSkgKiAoMTEgLSBpKTtcbiAgICB9XG5cbiAgICByZXN0byA9IChzb21hICogMTApICUgMTE7XG5cbiAgICBpZiAoKHJlc3RvID09IDEwKSB8fCAocmVzdG8gPT0gMTEpKSB7XG4gICAgICAgIHJlc3RvID0gMDtcbiAgICB9XG4gICAgaWYgKHJlc3RvICE9IHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoOSwgMTApKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgc29tYSA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gMTA7IGkrKykge1xuICAgICAgICBzb21hID0gc29tYSArIHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoaSAtIDEsIGkpKSAqICgxMiAtIGkpO1xuICAgIH1cbiAgICByZXN0byA9IChzb21hICogMTApICUgMTE7XG5cbiAgICBpZiAoKHJlc3RvID09IDEwKSB8fCAocmVzdG8gPT0gMTEpKSB7XG4gICAgICAgIHJlc3RvID0gMDtcbiAgICB9XG4gICAgaWYgKHJlc3RvICE9IHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoMTAsIDExKSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuUG1iVXRpbHMucHJvdG90eXBlLnZhbGlkYXJFTUFJTCA9IGZ1bmN0aW9uKGVtYWlsKSB7XG4gICAgdmFyIGVtYWlsVmFsaWRhdGlvbiA9IGVtYWlsLm1hdGNoKC9eW2EtekEtWjAtOS5fLV0rQFthLXpBLVowLTkuXy1dK1xcLlthLXpBLVowLTkuXy1dKyQvKTtcblxuICAgIGlmIChlbWFpbCA9PSBlbWFpbFZhbGlkYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIGVtYWlsVmFsaWRhdGlvbjtcbiAgICB9XG59XG5cbi8vRnVuY29lcyB1dGVpcyBkZSB1c28gZG8gSlFVRVJZXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignV2ViQ29tcG9uZW50c1JlYWR5JywgZnVuY3Rpb24gKCkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJodG1sXCIpLmNsYXNzTGlzdC5hZGQoXCJodG1sLXBhZ2UtbG9hZGVkXCIpO1xufSk7XG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAkLmZuLnNldEN1cnNvclBvc2l0aW9uID0gZnVuY3Rpb24gKHBvcykge1xuICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtKSB7XG4gICAgICAgICAgICBpZiAoZWxlbS5zZXRTZWxlY3Rpb25SYW5nZSkge1xuICAgICAgICAgICAgICAgIGVsZW0uc2V0U2VsZWN0aW9uUmFuZ2UocG9zLCBwb3MpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtLmNyZWF0ZVRleHRSYW5nZSkge1xuICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IGVsZW0uY3JlYXRlVGV4dFJhbmdlKCk7XG4gICAgICAgICAgICAgICAgcmFuZ2UuY29sbGFwc2UodHJ1ZSk7XG4gICAgICAgICAgICAgICAgcmFuZ2UubW92ZUVuZCgnY2hhcmFjdGVyJywgcG9zKTtcbiAgICAgICAgICAgICAgICByYW5nZS5tb3ZlU3RhcnQoJ2NoYXJhY3RlcicsIHBvcyk7XG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2VsZWN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgJC5mbi52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNoYW5nZSA9IG51bGw7XG4gICAgICAgIHZhciB0YWcgPSBuZXcgU3RyaW5nKCk7XG4gICAgICAgIC8vVHJhdGFtZW50b1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWcgKz0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCQodGhpcykuYXR0cihcIm9uY2hhbmdlXCIpKSB7XG4gICAgICAgICAgICBjaGFuZ2UgPSAkKHRoaXMpLmF0dHIoXCJvbmNoYW5nZVwiKTtcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQXR0cihcIm9uY2hhbmdlXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy90aXJhIG8gZm9jbyBkZSBxdWFscXVlciBlbGVtZW50b1xuICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgJCh3aW5kb3cpLmZvY3VzKCk7XG5cbiAgICAgICAgaWYgKGNoYW5nZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJvbmNoYW5nZVwiLCBjaGFuZ2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9zZSBvdXZlciB1bSBlcnJvIHZhbGlkYWNhbyBlc3RhIGluY29ycmV0YVxuICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwiZXJyb3JcIikgJiYgJCh0aGlzKS5hdHRyKFwiZXJyb3JcIikgIT0gXCJcIikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJC5mbi5zZXRGb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgJCh0aGlzKS5maW5kKFwiaW5wdXRcIikuZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJC5mbi5yZW1vdmVGb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJC5mbi5nZXRUZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdGV4dCA9IG51bGw7XG4gICAgICAgIHZhciB0YWcgPSBuZXcgU3RyaW5nKCk7XG4gICAgICAgIC8vVHJhdGFtZW50b1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWcgKz0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKFwiQUItSU5QVVRcIikgPyBcIkFCLUlOUFVUXCIgOiB0YWcudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFnc0FjZWl0YXMgPSBbXCJBQi1URVhULVJFQUQtT05MWVwiLCBcIkFCLVRFWFQtQVJFQS1VTkRFUkxJTkVcIiwgXCJBQi1TRUxFQ1QtVU5ERVJMSU5FXCIsIFwiQUItSU5QVVRcIl07XG4gICAgICAgICAgICAgICAgaWYgKHRhZ3NBY2VpdGFzLmluZGV4T2YodGFnKSA9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHZhciB0ZXh0QXJyYXkgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcmFkaW8gb2YgdGhpcykge1xuICAgICAgICAgICAgICAgIHRleHRBcnJheS5wdXNoKHJhZGlvLmdldFRleHQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dEFycmF5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGV4dCA9IHRoaXNbMF0uZ2V0VGV4dCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgIH07XG5cbiAgICAkLmZuLnNldFRleHQgPSBmdW5jdGlvbiAodGV4dCwgY2FuY2VsKSB7XG4gICAgICAgIHZhciB0YWcgPSBuZXcgU3RyaW5nKCk7XG5cbiAgICAgICAgLy9UcmF0YW1lbnRvXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRhZyArPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuICAgICAgICAgICAgaWYgKHRhZykge1xuICAgICAgICAgICAgICAgIHRhZyA9IHRhZy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGFnID09IFwiQUItVEVYVC1SRUFELU9OTFlcIikge1xuICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1EQVRFXCIpKSB7XG4gICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVUXCIpKSB7XG4gICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcgPT0gXCJBQi1URVhULUFSRUEtVU5ERVJMSU5FXCIpIHtcbiAgICAgICAgICAgIHRoaXNbMF0uc2V0VGV4dCh0ZXh0KTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItU0VMRUNUXCIpKSB7XG4gICAgICAgICAgICBpZiAoY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKFwic2VsZWN0XCIpLnZhbCh0ZXh0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKFwic2VsZWN0XCIpLnZhbCh0ZXh0KS5jaGFuZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vc2FsdmEgdmFsb3JcbiAgICAgICAgaWYgKCF0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULUNIRUNLQk9YXCIpKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJsb2FkZWQtdmFsdWVcIiwgJCh0aGlzKS5nZXRUZXh0KCkpO1xuICAgICAgICB9XG4gICAgfTtcblxuXG4gICAgLy9mdW5jYW8gcGFyYSBjb3JyaWdpciBvIGRhdGFcbiAgICAkLmZuLmdldE51bWJlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRleHQgPSBudWxsO1xuICAgICAgICB2YXIgdGFnID0gbmV3IFN0cmluZygpO1xuICAgICAgICAvL1RyYXRhbWVudG9cbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGFnICs9ICQodGhpcylbMF0ubm9kZU5hbWU7XG4gICAgICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICAgICAgdGFnID0gdGFnLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0YWcgPT0gXCJBQi1URVhULVJFQUQtT05MWVwiKSB7XG4gICAgICAgICAgICB0ZXh0ID0gdGhpc1swXS5nZXRUZXh0KCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULUNIRUNLQk9YXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gdGhpc1swXS5nZXROdW1iZXIoKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtUkFESU9cIikpIHtcbiAgICAgICAgICAgIHRleHQgPSB0aGlzWzBdLmdldE51bWJlcigpO1xuICAgICAgICAgICAgXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1TV0lUQ0hcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSB0aGlzWzBdLmdldE51bWJlcigpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1USU1FXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwiaW5wdXRcIikudmFsKCkgKyBcIjAwXCI7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULU5VTUJFUlwiKSkge1xuICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuZmluZChcImlucHV0XCIpLnZhbCgpO1xuICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShuZXcgUmVnRXhwKC9bXlxcZF0vZyksIFwiXCIpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1EQVRFXCIpKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LmlzSU9TIHx8IHdpbmRvdy5pc0FuZHJvaWQpIHtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwiaW5wdXRcIikudmFsKCk7XG4gICAgICAgICAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDgsIDEwKSArIFwiXCIgKyB0ZXh0LnN1YnN0cmluZyg1LCA3KSArIFwiXCIgKyB0ZXh0LnN1YnN0cmluZygwLCA0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuZmluZChcImlucHV0XCIpLnZhbCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVFwiKSkge1xuICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuZmluZChcImlucHV0XCIpLnZhbCgpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1URVhULUFSRUEtVU5ERVJMSU5FXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwidGV4dGFyZWFcIikudmFsKCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVNFTEVDVFwiKSkge1xuICAgICAgICAgICAgdGV4dCA9IHBhcnNlSW50KCQodGhpcykuZ2V0T2JqZWN0KCkudmFsb3IpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1RVUVTVElPTlwiKSkge1xuICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuYXR0cihcImFuc3dlclwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0ZXh0ICYmIHRhZyAhPSBcIkFCLVNFTEVDVC1VTkRFUkxJTkVcIikge1xuICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShuZXcgUmVnRXhwKC9bXlxcZFxcLF0vZyksIFwiXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfTtcblxuICAgIC8vZnVuY2FvIHBhcmEgY29ycmlnaXIgbyBkYXRhXG4gICAgJC5mbi5zZXROdW1iZXIgPSBmdW5jdGlvbiAodGV4dCwgY2FuY2VsKSB7XG4gICAgICAgIHZhciB0YWcgPSBuZXcgU3RyaW5nKCk7XG4gICAgICAgIC8vVHJhdGFtZW50b1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWcgKz0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRleHQgfHwgdGV4dCA9PSAwKSB7XG4gICAgICAgICAgICAvL05lY2Vzc2FyaW8gc2VyIHN0cmluZyBwYXJhIHJlZ2V4XG4gICAgICAgICAgICB0ZXh0ICs9IFwiXCI7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAoL1teXFxkLVxcLF0vZyksIFwiXCIpO1xuXG4gICAgICAgICAgICBpZiAodGFnID09IFwiQUItVEVYVC1SRUFELU9OTFlcIikge1xuICAgICAgICAgICAgICAgIHRoaXNbMF0uc2V0VGV4dCh0ZXh0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULUNIRUNLQk9YXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpc1swXS5zZXROdW1iZXIodGV4dCk7XG5cbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJsb2FkZWQtdmFsdWVcIiwgJCh0aGlzKS5hdHRyKFwiaXMtY2hlY2tlZFwiKSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1SQURJT1wiKSkge1xuICAgICAgICAgICAgICAgIHRoaXNbMF0uc2V0TnVtYmVyKHRleHQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtU1dJVENIXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpc1swXS5zZXROdW1iZXIodGV4dCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1EQVRFXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVRcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldE51bWJlcih0ZXh0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVNFTEVDVFwiKSkge1xuICAgICAgICAgICAgICAgIGlmIChjYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzWzBdLnNlbGVjdCkudmFsKHRleHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpc1swXS5zZWxlY3QpLnZhbCh0ZXh0KS5jaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vc2FsdmEgdmFsb3JcbiAgICAgICAgICAgIGlmICghdGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1DSEVDS0JPWFwiKSkge1xuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImxvYWRlZC12YWx1ZVwiLCAkKHRoaXMpLmdldFRleHQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJC5mbi5zZXRPbGRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS5zZXRUZXh0KCQodGhpcykuYXR0cihcImxvYWRlZC12YWx1ZVwiKSk7XG4gICAgfTtcblxuICAgICQuZm4uaXNDaGFuZ2VkID0gZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICB2YXIgbG9hZGVkVmFsdWUgPSAkKHRoaXMpLmF0dHIoXCJsb2FkZWQtdmFsdWVcIik7XG4gICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSAkKHRoaXMpLmdldFRleHQoKTtcblxuICAgICAgICBpZiAobG9hZGVkVmFsdWUgfHwgY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAobG9hZGVkVmFsdWUgIT09IGN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkLmZuLnNldE9iamVjdCA9IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgdmFyIHRhZyA9ICQodGhpcylbMF0ubm9kZU5hbWU7XG4gICAgICAgIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVNFTEVDVFwiKSkge1xuICAgICAgICAgICAgJCh0aGlzKS5maW5kKFwic2VsZWN0XCIpLnZhbCh2YWwpLmNoYW5nZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJC5mbi5nZXRPYmplY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBiZWFuID0gbmV3IE9iamVjdCgpO1xuXG4gICAgICAgIGlmICgodGhpcylbMF0pIHtcbiAgICAgICAgICAgIHZhciB0YWcgPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuXG4gICAgICAgICAgICBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1TRUxFQ1RcIikpIHtcbiAgICAgICAgICAgICAgICBiZWFuLm5vbWUgPSAkKHRoaXMpLmZpbmQoXCJzZWxlY3Qgb3B0aW9uOnNlbGVjdGVkXCIpLnRleHQoKTtcbiAgICAgICAgICAgICAgICBiZWFuLnZhbG9yID0gJCh0aGlzKS5maW5kKFwic2VsZWN0IG9wdGlvbjpzZWxlY3RlZFwiKS5hdHRyKFwidmFsdWVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYmVhbjtcbiAgICB9XG5cblxuICAgIC8vQXZpc2FyIG5vc3NvcyBjb21wb25lbnRlcyBxdWFuZG8gdGV2ZSB1bWEgYWx0ZXJhY2FvXG4gICAgdmFyIG9yaWdBcHBlbmQgPSAkLmZuLmFwcGVuZDtcbiAgICAkLmZuLmFwcGVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoXCJhYi1jb250YWluZXItY29udGVudFwiKSAmJiBhcmd1bWVudHNbMF0uaGFzQ2xhc3MoXCJhYi1ibG9ja1wiKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG9yaWdBcHBlbmQuYXBwbHkodGhpcywgYXJndW1lbnRzKS50cmlnZ2VyKFwiYXBwZW5kXCIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vZnVuw6fDo28gcGFyYSByZXRvcm5hciBzZSBvIGNhbXBvIGVzcsOhIGNvbSBlcnJvIG91IG7Do29cbiAgICAkLmZuLmhhc0Vycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwiZXJyb3JcIikpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cblxuLy9mdW7Dp8OjbyBwYXJhIGFycnVtYXIgYnVnIG5vIGlPUyA4XG5pZiAoIVN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aCkge1xuICAgIFN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aCA9IGZ1bmN0aW9uIChzZWFyY2hTdHJpbmcsIHBvc2l0aW9uKSB7XG4gICAgICAgIHBvc2l0aW9uID0gcG9zaXRpb24gfHwgMDtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhPZihzZWFyY2hTdHJpbmcsIHBvc2l0aW9uKSA9PT0gcG9zaXRpb247XG4gICAgfTtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS50b1VwcGVyT25seUZpcnN0TGV0dGVyID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzdHIgPSB0aGlzO1xuXG4gICAgdmFyIHdvcmRNYXAgPSB7XG4gICAgICAgIFwicmdcIjogXCJSR1wiLFxuICAgICAgICBcImNwZlwiOiBcIkNQRlwiLFxuICAgICAgICBcImNucGpcIjogXCJDTlBKXCIsXG4gICAgICAgIFwicm5lXCI6IFwiUk5FXCIsXG4gICAgICAgIFwiY2VwXCI6IFwiQ0VQXCIsXG4gICAgICAgIFwiY25oXCI6IFwiQ05IXCIsXG4gICAgICAgIFwicy5hLlwiOiBcIlMuQS5cIlxuICAgIH07XG5cbiAgICBpZiAoc3RyICYmIHN0ci5sZW5ndGggPT0gMCkge1xuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICB9IGVsc2UgaWYgKHN0ciAmJiBzdHIubGVuZ3RoID09IDEpIHtcbiAgICAgICAgcmV0dXJuIHN0ci50b1VwcGVyQ2FzZSgpXG4gICAgfSBlbHNlIGlmIChzdHIgJiYgc3RyLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgc3RyID0gc3RyLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgc3RyLnN1YnN0cigxKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gc3RyID0gc3RyLnJlcGxhY2UoL1xcYihyZ3xjcGZ8Y25wanxybmV8Y2VwfGNuaClcXGJ8c1xcLmFcXC4vZ2ksIGZ1bmN0aW9uICh3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4gd29yZE1hcFt3b3JkLnRvTG93ZXJDYXNlKCldO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG59XG5cblN0cmluZy5wcm90b3R5cGUudG9DYW1lbENhc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXMudG9Mb3dlckNhc2UoKTtcblxuICAgIHZhciB3b3Jkc0FycmF5ID0gW1wiZGVcIiwgXCJzZW1cIiwgXCJvXCIsIFwiZG9cIiwgXCJkYVwiXTtcblxuICAgIHZhciB3b3JkcyA9IHN0ci5zcGxpdChcIiBcIik7XG5cbiAgICB2YXIgZnVsbFN0cmluZyA9IG5ldyBTdHJpbmcoKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHdvcmRzQXJyYXkuaW5kZXhPZih3b3Jkc1tpXSkgPT0gLTEgJiYgd29yZHNbaV0ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgd29yZHNbaV0gPSB3b3Jkc1tpXS50b1VwcGVyT25seUZpcnN0TGV0dGVyKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGZ1bGxTdHJpbmcgPSB3b3Jkcy5qb2luKFwiIFwiKVxuXG4gICAgcmV0dXJuIGZ1bGxTdHJpbmc7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0UGVyY2VudCA9IGZ1bmN0aW9uKGRlY2ltYWxzLCBpbnRlZ2Vycykge1xuICAgIHZhciB0bXAgPSB0aGlzO1xuICAgIHZhciBkZWMgPSBcIjFcIjtcbiAgICB2YXIgZm9ybWF0RGVjaW1hbCA9IDA7XG4gICAgdmFyIG5lZ2F0aXZlQ2hlY2sgPSBmYWxzZTtcblxuICAgIGlmICh0bXAuc3Vic3RyaW5nKDAsIDEpID09IFwiLVwiKSB7XG4gICAgICAgIG5lZ2F0aXZlQ2hlY2sgPSB0cnVlO1xuICAgICAgICB0bXAgPSB0bXAuc3Vic3RyaW5nKDEsIHRtcC5sZW5ndGgpO1xuICAgIH07XG5cbiAgICBpZiAoZGVjaW1hbHMpIHtcbiAgICAgICAgZGVjID0gZGVjLnJwYWQoXCIwXCIsIHBhcnNlSW50KGRlY2ltYWxzKSArIDEpO1xuICAgICAgICBmb3JtYXREZWNpbWFsID0gcGFyc2VJbnQoZGVjaW1hbHMpO1xuICAgIH1cbiAgICBkZWMgPSBwYXJzZUludChkZWMpO1xuXG4gICAgaWYgKCh0bXAgJiYgcGFyc2VJbnQodG1wKSA9PSAwKSB8fCB0bXAgPT0gXCJcIiB8fCB0bXAgPT0gdW5kZWZpbmVkIHx8IGlzTmFOKHBhcnNlSW50KHRtcCkpKSB7XG4gICAgICAgIHRtcCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdG1wID0gcGFyc2VGbG9hdCh0bXApIC8gZGVjO1xuICAgIH1cblxuICAgIGlmIChuZWdhdGl2ZUNoZWNrKSB7XG4gICAgICAgIHRtcCA9IHRtcCAqIC0xO1xuICAgIH1cblxuICAgIHZhciBvcHRpb24gPSB7XG4gICAgICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogZm9ybWF0RGVjaW1hbCxcbiAgICAgICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiBmb3JtYXREZWNpbWFsXG4gICAgfTtcblxuICAgIHRtcCA9IG5ldyBJbnRsLk51bWJlckZvcm1hdCgncHQtQlInLCBvcHRpb24pLmZvcm1hdCh0bXApO1xuXG4gICAgcmV0dXJuIHRtcDtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXRDdXJyZW5jeSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdG1wID0gdGhpcztcbiAgICB2YXIgbmVnYXRpdmVDaGVjayA9IGZhbHNlO1xuXG4gICAgaWYgKHRtcC5zdWJzdHJpbmcoMCwgMSkgPT0gXCItXCIpIHtcbiAgICAgICAgbmVnYXRpdmVDaGVjayA9IHRydWU7XG4gICAgICAgIHRtcCA9IHRtcC5zdWJzdHJpbmcoMSwgdG1wLmxlbmd0aCk7XG4gICAgfTtcblxuICAgIC8vcmVtb3ZlIHplcm9zIGEgZXNxdWVyZGFcbiAgICBpZiAodG1wKSB7XG4gICAgICAgIC8vIHRtcCA9IHBhcnNlSW50KHRtcCkgKyBcIlwiO1xuICAgICAgICB0bXAgPSB0bXAucmVwbGFjZSgvXjArLywgJycpO1xuICAgIH1cblxuICAgIC8vUXVhbHF1ZXIgY29pc2EgZGlmZXJlbnRlIGRlIHVtIG51bWVybyB2YWxpZG8gcmV0b3JuYSAwLDAwXG4gICAgaWYgKCh0bXAgJiYgcGFyc2VJbnQodG1wKSA9PSAwKSB8fCB0bXAgPT0gXCJcIiB8fCB0bXAgPT0gdW5kZWZpbmVkIHx8IGlzTmFOKHBhcnNlSW50KHRtcCkpKSB7XG4gICAgICAgIHJldHVybiBcIjAsMDBcIjtcbiAgICB9XG5cbiAgICAvL1ZlcmlmaWNhIHNlIGV4aXN0ZW0gc29tZW50ZSBkZWNpbWFpcywgZSBhY3Jlc2NlbnRhIHVtIHplcm8gbmEgZnJlbnRlXG4gICAgaWYgKHRtcCAmJiB0bXAubGVuZ3RoIDw9IDIpIHtcbiAgICAgICAgdG1wID0gdG1wLmxwYWQoXCIwXCIsIDMpO1xuICAgIH1cblxuICAgIC8vc2UgbyB0YW1hbmhvIGZvclxuICAgIC8vY29sb2NhIGFzIGNhc2FzIGRlY2ltYWlzXG4gICAgdG1wID0gdG1wLnJlcGxhY2UoLyhbMC05XXsyfSkkL2csIFwiLCQxXCIpO1xuXG4gICAgLy9zZSB0aXZlciBtaWxoYXIgY29sb2NhIHBvbnRvXG4gICAgaWYgKHRtcC5sZW5ndGggPiA2KSB7XG4gICAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC9cXEIoPz0oXFxkezN9KSsoPyFcXGQpKS9nLCBcIi5cIik7XG4gICAgfVxuXG4gICAgaWYgKG5lZ2F0aXZlQ2hlY2sgPT0gdHJ1ZSkge1xuICAgICAgICB0bXAgPSBcIi1cIiArIHRtcDtcbiAgICB9XG5cbiAgICByZXR1cm4gdG1wO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdERhdGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHZhciBkaWEgPSBcIlwiO1xuICAgIHZhciBtZXMgPSBcIlwiO1xuICAgIHZhciBhbm8gPSBcIlwiO1xuICAgIHZhciBpdGVucyA9IFwiXCI7XG4gICAgdmFyIGRhdGFGb3JtYXRhZGEgPSBudWxsO1xuICAgIHZhciBzdHIgPSB0aGlzO1xuXG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgLy9vcHRpb25zLmRhdGUgIT0gXCJcIiAmJiBvcHRpb25zLmRhdGUgIT0gMCAmJiBvcHRpb25zLmRhdGUgIT0gbnVsbFxuICAgICAgICBvcHRpb25zLmRhdGUgPSBzdHI7XG5cbiAgICAgICAgc3dpdGNoIChvcHRpb25zLnNyY0Zvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSAnZGRtbXl5eXknOlxuICAgICAgICAgICAgICAgIGFubyA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoNCwgOCk7XG4gICAgICAgICAgICAgICAgbWVzID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZygyLCA0KTtcbiAgICAgICAgICAgICAgICBkaWEgPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDAsIDIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5bW1kZCc6XG4gICAgICAgICAgICAgICAgYW5vID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZygwLCA0KTtcbiAgICAgICAgICAgICAgICBtZXMgPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDQsIDYpO1xuICAgICAgICAgICAgICAgIGRpYSA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoNiwgOCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2RkLm1tLnl5eXknOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy5kYXRlLnNwbGl0KFwiLlwiKTtcbiAgICAgICAgICAgICAgICBhbm8gPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBtZXMgPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBkaWEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGQvbW0veXl5eSc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLmRhdGUuc3BsaXQoXCIvXCIpO1xuICAgICAgICAgICAgICAgIGFubyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIG1lcyA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIGRpYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5Lm1tLmRkJzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMuZGF0ZS5zcGxpdChcIi5cIik7XG4gICAgICAgICAgICAgICAgYW5vID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgbWVzID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgZGlhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2RkLW1tLXl5eXknOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy5kYXRlLnNwbGl0KFwiLVwiKTtcbiAgICAgICAgICAgICAgICBhbm8gPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBtZXMgPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBkaWEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAneXl5eS1tbS1kZCc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLmRhdGUuc3BsaXQoXCItXCIpO1xuICAgICAgICAgICAgICAgIGFubyA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIG1lcyA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIGRpYSA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5bW0nOlxuICAgICAgICAgICAgICAgIGFubyA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoMCwgNCk7XG4gICAgICAgICAgICAgICAgbWVzID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZyg0LCA2KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRhdGEgaW52w6FsaWRhXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChvcHRpb25zLnRhcmdldEZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSAnZGQvbW0veXl5eSc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGRpYSArICcvJyArIG1lcyArICcvJyArIGFubztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAneXl5eS9tbS9kZCc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGFubyArICcvJyArIG1lcyArICcvJyArIGRpYTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGQubW0ueXl5eSc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGRpYSArICcuJyArIG1lcyArICcuJyArIGFubztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAneXl5eS5tbS5kZCc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGFubyArICcuJyArIG1lcyArICcuJyArIGRpYTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGQtbW0teXl5eSc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGRpYSArICctJyArIG1lcyArICctJyArIGFubztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAneXl5eS1tbS1kZCc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGFubyArICctJyArIG1lcyArICctJyArIGRpYTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnbW0veXl5eSc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IG1lcyArICcvJyArIGFubztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnbW15eSc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IG1lcyArIFwiXCIgKyBhbm8uc3Vic3RyaW5nKDIsIDQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZG1teXl5eSc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGRpYSArIG1lcyArIGFubztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAneXl5eW1tZGQnOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBhbm8gKyBtZXMgKyBkaWE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhRm9ybWF0YWRhO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdFRpbWUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHZhciBob3JhID0gXCJcIjtcbiAgICB2YXIgbWluID0gXCJcIjtcbiAgICB2YXIgc2VnID0gXCJcIjtcbiAgICB2YXIgaXRlbnMgPSBcIlwiO1xuICAgIHZhciBob3JhRm9ybWF0YWRhID0gbnVsbDtcbiAgICB2YXIgc3RyID0gdGhpcztcblxuICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMudGltZSA9IHN0cjtcblxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMuc3JjRm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlICdoaG1tc3MnOlxuICAgICAgICAgICAgICAgIGhvcmEgPSBvcHRpb25zLnRpbWUuc3Vic3RyaW5nKDAsIDIpO1xuICAgICAgICAgICAgICAgIG1pbiA9IG9wdGlvbnMudGltZS5zdWJzdHJpbmcoMiwgNCk7XG4gICAgICAgICAgICAgICAgc2VnID0gb3B0aW9ucy50aW1lLnN1YnN0cmluZyg0LCA2KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaGg6bW06c3MnOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy50aW1lLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICAgICAgICBob3JhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgbWluID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgc2VnID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2hoLm1tLnNzJzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMudGltZS5zcGxpdChcIi5cIik7XG4gICAgICAgICAgICAgICAgaG9yYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIG1pbiA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIHNlZyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdoaC1tbS1zcyc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLnRpbWUuc3BsaXQoXCItXCIpO1xuICAgICAgICAgICAgICAgIGhvcmEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBtaW4gPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBzZWcgPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkhvcmEgaW52w6FsaWRhXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChvcHRpb25zLnRhcmdldEZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSAnaGg6bW06c3MnOlxuICAgICAgICAgICAgICAgIGhvcmFGb3JtYXRhZGEgPSBob3JhICsgJzonICsgbWluICsgJzonICsgc2VnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdoaC5tbS5zcyc6XG4gICAgICAgICAgICAgICAgaG9yYUZvcm1hdGFkYSA9IGhvcmEgKyAnLicgKyBtaW4gKyAnLicgKyBzZWc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2hoLW1tLXNzJzpcbiAgICAgICAgICAgICAgICBob3JhRm9ybWF0YWRhID0gaG9yYSArICctJyArIG1pbiArICctJyArIHNlZztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaGhtbXNzJzpcbiAgICAgICAgICAgICAgICBob3JhRm9ybWF0YWRhID0gaG9yYSArIG1pbiArIHNlZztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9cIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhvcmFGb3JtYXRhZGE7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0Q3BmID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBjcGYgPSB0aGlzLmxwYWQoXCIwXCIsIDExKTtcbiAgICByZXR1cm4gY3BmLnJlcGxhY2UoLyhcXGR7M30pKFxcZHszfSkoXFxkezN9KShcXGR7Mn0pL2csIFwiXFwkMS5cXCQyLlxcJDNcXC1cXCQ0XCIpO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdENucGogPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNwZiA9IHRoaXMubHBhZChcIjBcIiwgMTQpO1xuICAgIHJldHVybiBjcGYucmVwbGFjZSgvKFxcZHsyfSkoXFxkezN9KShcXGR7M30pKFxcZHs0fSkoXFxkezJ9KS9nLCBcIlxcJDEuXFwkMi5cXCQzXFwvXFwkNFxcLSQ1XCIpO1xufVxuXG5cblN0cmluZy5wcm90b3R5cGUuZGF0ZURpZmYgPSBmdW5jdGlvbiAoc3JjRm9ybWF0LCB0YXJnZXREYXRhLCB0eXBlKSB7XG5cbiAgICB2YXIgZGF0YUluaSA9IG5ldyBEYXRlKHRoaXMuZm9ybWF0RGF0ZSh7XG4gICAgICAgIFwic3JjRm9ybWF0XCI6IHNyY0Zvcm1hdCxcbiAgICAgICAgXCJ0YXJnZXRGb3JtYXRcIjogXCJ5eXl5L21tL2RkXCJcbiAgICB9KSk7XG4gICAgdmFyIGRhdGFGaW0gPSBuZXcgRGF0ZSh0YXJnZXREYXRhLmZvcm1hdERhdGUoe1xuICAgICAgICBcInNyY0Zvcm1hdFwiOiBzcmNGb3JtYXQsXG4gICAgICAgIFwidGFyZ2V0Rm9ybWF0XCI6IFwieXl5eS9tbS9kZFwiXG4gICAgfSkpO1xuXG4gICAgaWYgKHR5cGUgPT0gXCJkaWFcIikge1xuICAgICAgICB2YXIgZGlmRGlhcyA9IE1hdGguYWJzKGRhdGFGaW0uZ2V0VGltZSgpIC0gZGF0YUluaS5nZXRUaW1lKCkpO1xuICAgICAgICB2YXIgbnVtRGlhcyA9IE1hdGguY2VpbChkaWZEaWFzIC8gKDEwMDAgKiAzNjAwICogMjQpKTtcbiAgICAgICAgcmV0dXJuIG51bURpYXM7XG4gICAgfSBlbHNlIGlmICh0eXBlID09IFwibWVzXCIpIHtcbiAgICAgICAgdmFyIGRpZk1lc2VzID0gTWF0aC5hYnMoZGF0YUZpbS5nZXRUaW1lKCkgLSBkYXRhSW5pLmdldFRpbWUoKSk7XG4gICAgICAgIHZhciBudW1NZXNlcyA9IE1hdGguY2VpbChkaWZNZXNlcyAvICgxMDAwICogMzYwMCAqIDI0ICogMzApIC0gMSk7XG4gICAgICAgIHJldHVybiBudW1NZXNlcztcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ2FubycpIHtcbiAgICAgICAgdmFyIGRpZk1lc2VzID0gTWF0aC5hYnMoZGF0YUZpbS5nZXRUaW1lKCkgLSBkYXRhSW5pLmdldFRpbWUoKSk7XG4gICAgICAgIHZhciBudW1NZXNlcyA9IE1hdGguY2VpbChkaWZNZXNlcyAvICgxMDAwICogMzYwMCAqIDI0ICogMzApIC0gMSk7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKG51bU1lc2VzIC8gMTIpO1xuICAgIH1cbn1cblxuU3RyaW5nLnByb3RvdHlwZS5wbHVzRGF5cyA9IGZ1bmN0aW9uIChzcmNGb3JtYXQsIGRheXMpIHtcbiAgICB2YXIgZGF0YUZvcm1hdGFkYSA9IHRoaXMuZm9ybWF0RGF0ZSh7XG4gICAgICAgIFwic3JjRm9ybWF0XCI6IHNyY0Zvcm1hdCxcbiAgICAgICAgXCJ0YXJnZXRGb3JtYXRcIjogXCJ5eXl5L21tL2RkXCJcbiAgICB9KTtcbiAgICB2YXIgZGF0YUdlcmFkYSA9IG5ldyBEYXRlKGRhdGFGb3JtYXRhZGEpO1xuICAgIHZhciBkYXRhRmluYWwgPSBcIlwiO1xuICAgIGRhdGFHZXJhZGEuc2V0RGF0ZShkYXRhR2VyYWRhLmdldERhdGUoKSArIGRheXMpO1xuICAgIHZhciBtZXMgPSBuZXcgU3RyaW5nKGRhdGFHZXJhZGEuZ2V0TW9udGgoKSArIDEpLmxwYWQoJzAnLCAyKTtcbiAgICB2YXIgZGlhID0gbmV3IFN0cmluZyhkYXRhR2VyYWRhLmdldERhdGUoKSkubHBhZCgnMCcsIDIpO1xuICAgIGRhdGFGaW5hbCA9IGRpYSArICcvJyArIG1lcyArICcvJyArIGRhdGFHZXJhZGEuZ2V0RnVsbFllYXIoKTtcbiAgICByZXR1cm4gZGF0YUZpbmFsO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLm1pbnVzRGF5cyA9IGZ1bmN0aW9uIChzcmNGb3JtYXQsIGRheXMpIHtcbiAgICB2YXIgZGF0YUZvcm1hdGFkYSA9IHRoaXMuZm9ybWF0RGF0ZSh7XG4gICAgICAgIFwic3JjRm9ybWF0XCI6IHNyY0Zvcm1hdCxcbiAgICAgICAgXCJ0YXJnZXRGb3JtYXRcIjogXCJ5eXl5L21tL2RkXCJcbiAgICB9KTtcbiAgICB2YXIgZGF0YUdlcmFkYSA9IG5ldyBEYXRlKGRhdGFGb3JtYXRhZGEpO1xuICAgIHZhciBkYXRhRmluYWwgPSBcIlwiO1xuICAgIGRhdGFHZXJhZGEuc2V0RGF0ZShkYXRhR2VyYWRhLmdldERhdGUoKSAtIGRheXMpO1xuICAgIHZhciBtZXMgPSBuZXcgU3RyaW5nKGRhdGFHZXJhZGEuZ2V0TW9udGgoKSArIDEpLmxwYWQoJzAnLCAyKTtcbiAgICB2YXIgZGlhID0gbmV3IFN0cmluZyhkYXRhR2VyYWRhLmdldERhdGUoKSkubHBhZCgnMCcsIDIpO1xuICAgIGRhdGFGaW5hbCA9IGRpYSArICcvJyArIG1lcyArICcvJyArIGRhdGFHZXJhZGEuZ2V0RnVsbFllYXIoKTtcbiAgICByZXR1cm4gZGF0YUZpbmFsO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmNvbnZlcnRUb051bWJlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY29kZVN0cmluZyA9IHRoaXMuc3Vic3RyaW5nKDEsIDEyKTtcbiAgICB2YXIgbGV0dGVyID0gdGhpcy5zdWJzdHJpbmcoMCwgMSkudG9Mb3dlckNhc2UoKTtcbiAgICByZXR1cm4gbGV0dGVyLmNoYXJDb2RlQXQoMCkgLSA5NiArIGNvZGVTdHJpbmc7XG59XG5cblN0cmluZy5wcm90b3R5cGUubHBhZCA9IGZ1bmN0aW9uIChwYWRTdHJpbmcsIGxlbmd0aCkge1xuICAgIHZhciBzdHIgPSB0aGlzO1xuICAgIHdoaWxlIChzdHIubGVuZ3RoIDwgbGVuZ3RoKVxuICAgICAgICBzdHIgPSBwYWRTdHJpbmcgKyBzdHI7XG4gICAgcmV0dXJuIHN0cjtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5nZXRTaWdsYSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2lnbGEgPSBcIlwiO1xuICAgIHZhciBuYW1lID0gdGhpcztcblxuICAgIGlmIChuYW1lKSB7XG4gICAgICAgIHZhciB1c2VyTmFtZSA9IG5hbWUucmVwbGFjZShuZXcgUmVnRXhwKC9bLV0vZyksIFwiXCIpO1xuICAgICAgICB1c2VyTmFtZSA9IHVzZXJOYW1lLnJlcGxhY2UobmV3IFJlZ0V4cCgvW1xcc10rL2cpLCBcIiBcIikudHJpbSgpO1xuICAgICAgICB1c2VyTmFtZSA9IHVzZXJOYW1lLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgdmFyIGZpcnN0TmFtZSA9IHVzZXJOYW1lWzBdO1xuICAgICAgICB2YXIgbGFzdE5hbWUgPSB1c2VyTmFtZVt1c2VyTmFtZS5sZW5ndGggLSAxXTtcbiAgICAgICAgc2lnbGEgPSBmaXJzdE5hbWVbMF0gKyBsYXN0TmFtZVswXTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2lnbGE7XG59XG5cblN0cmluZy5wcm90b3R5cGUucnBhZCA9IGZ1bmN0aW9uIChwYWRTdHJpbmcsIGxlbmd0aCkge1xuICAgIHZhciBzdHIgPSB0aGlzO1xuICAgIHdoaWxlIChzdHIubGVuZ3RoIDwgbGVuZ3RoKVxuICAgICAgICBzdHIgPSBzdHIgKyBwYWRTdHJpbmc7XG4gICAgcmV0dXJuIHN0cjtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS50cmltID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL15cXHMrfFxccyskL2csIFwiXCIpO1xufVxuXG4vL3RyaW1taW5nIHNwYWNlIGZyb20gbGVmdCBzaWRlIG9mIHRoZSBzdHJpbmdcblN0cmluZy5wcm90b3R5cGUubHRyaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxccysvLCBcIlwiKTtcbn1cblxuLy90cmltbWluZyBzcGFjZSBmcm9tIHJpZ2h0IHNpZGUgb2YgdGhlIHN0cmluZ1xuU3RyaW5nLnByb3RvdHlwZS5ydHJpbSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9cXHMrJC8sIFwiXCIpO1xufSIsIlwidXNlIHN0cmljdFwiO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJChcImFiLXBhZ2VcIikuZmluZChcImFiLWJ1dHRvblwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkKFwiYWItcGFnZVwiKS5hdHRyKFwiZnVsbHNjcmVlblwiKSA9PSBcInRydWVcIil7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cihcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcIndpZHRoXCIsICQodGhpcykuYXR0cihcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cihcIm1heC13aWR0aFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJtYXgtd2lkdGhcIiwgJCh0aGlzKS5hdHRyKFwibWF4LXdpZHRoXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwibWF4LXdpZHRoXCIsIFwiMzQwcHhcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwibWF4LXdpZHRoXCIsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJ3aWR0aFwiLCAkKHRoaXMpLmF0dHIoXCJ3aWR0aFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5jbGFzcyBBYkJ1dHRvbiBleHRlbmRzIEhUTUxFbGVtZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy5zcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgIHRoaXMuaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5ibG9ja2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItYnV0dG9uXCI7XG5cbiAgICB9XG5cbiAgICBfcmVuZGVyKCkge1xuICAgICAgICAvL2NvbG9jYSBjbGFzc2VcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHRoaXMubWFpbkNsYXNzKTtcblxuICAgICAgICB2YXIgaWQgPSBnZW5lcmF0ZUlEKCk7XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBJZGVudGlmaWNhZG9yIMO6bmljbyBkbyBvYmpldG8sIGNvbSBwcmVmaXhvIFwiYnRuXCJ8IEFsZmFudW3DqXJpY28gfG7Do298IHJhbmTDtG1pY298XG4gICAgICAgICAgICBpZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ29sb2NhIG9zIGF0cmlidXRvcyBubyBvYmpldG9cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhcmd1cmEgZG8gYm90w6NvfCBBbGZhbnVtw6lyaWNvfCBuw6NvfCBhdXRvIHxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaGVpZ2h0XCIpKSB7XG4gICAgICAgIC8vICAgICAvL2Rlc2NyaXB0aW9uOiBBbHR1cmEgZG8gYm90w6NvfCBBbGZhbnVtw6lyaWNvfCBuw6NvfCBhdXRvIHxcbiAgICAgICAgLy8gICAgIHRoaXMuc3R5bGUuaGVpZ2h0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIik7XG4gICAgICAgIC8vIH1cblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJsYXN0LWJ1dHRvblwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogVWx0aW1vIGJvdMOjbyBkYSBww6FnaW5hIHwgQm9vbGVhbiB8IG7Do28gfCBmYWxzZSB8XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tbGFzdC1idXR0b25cIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL3ZlcmlmaWNhIHdpZHRoLW9uLWJpZ3NjcmVlblxuICAgICAgICBpZiAoJChcImFiLXBhZ2VcIikuYXR0cihcImZ1bGxzY3JlZW5cIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSkge1xuICAgICAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhcmd1cmEgZG8gY29tcG9uZW50ZSBlbSB0ZWxhcyBtYWlvcmVzfCAlIG91IHB4fCBuw6NvfCB8XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLm1heFdpZHRoID0gXCIzNDBweFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9DcmlhIGJvdGFvXG4gICAgICAgIHRoaXMuYnV0dG9uLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJidG5fYnV0dG9uXCIpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuYnV0dG9uKTtcblxuICAgICAgICAvLyBhZGljaW9uYSBvIHRleHRvIGluc2VyaWRvIG5vIG9iamV0byBwYXJhIG8gc3BhbiBjcmlhZG9cbiAgICAgICAgdGhpcy5zcGFuLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJidG5fc3BhblwiKTtcblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJsYWJlbFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQ29sb2NhciB1bSB0ZXh0byBubyBib3TDo298IEFsZmFudW3DqXJpY298IHNpbXwgdmF6aW98XG4gICAgICAgICAgICB0aGlzLnNwYW4uaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJsYWJlbFwiKS50b1VwcGVyT25seUZpcnN0TGV0dGVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5idXR0b24uYXBwZW5kQ2hpbGQodGhpcy5zcGFuKTtcblxuICAgICAgICAvLyBhZGljaW9uYSBhIGltYWdlbSBpbnNlcmlkYSBubyBvYmpldG8gbm8gYmFja2dyb3VuZCBkZSB1bWEgZGl2XG4gICAgICAgIHRoaXMuaW1nLnNldEF0dHJpYnV0ZShcImRpdi1pbWFnZVwiLCBcInRydWVcIik7XG4gICAgICAgIHRoaXMuaW1nLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJidG5faW1nXCIpO1xuICAgICAgICB0aGlzLmJ1dHRvbi5pbnNlcnRBZGphY2VudEVsZW1lbnQoXCJhZnRlcmJlZ2luXCIsIHRoaXMuaW1nKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaWNvblwiKSB8fCB0aGlzLmhhc0F0dHJpYnV0ZShcImljb24tY2xhc3NcIikpIHtcbiAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgdGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uXCIpICsgXCIpXCI7XG4gICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uLWNsYXNzXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuY2xhc3NMaXN0LmFkZCh0aGlzLmdldEF0dHJpYnV0ZShcImljb24tY2xhc3NcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbWcuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdmVyaWZpY2Egc2UgbyBib3TDo28gw6kgc29tZW50ZSBwYXJhIG1vc3RyYXIgbyDDrWNvbmUgZSBhZGljaW9uYSBhIGNsYXNzZVxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uLWJ1dHRvblwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFRyYXZhIG8gYm90w6NvIHBhcmEgdGVyIHNvbWVudGUgbyDDrWNvbmV8IHRydWUgb3UgZmFsc2V8IG7Do298IGZhbHNlfFxuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWltZ1wiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHZlcmlmaWNhIHNlIHRlbSBvIHRhbWFuaG8gZG8gaWNvbmUgZSBhZGljaW9uYSBubyB0YW1hbmhvIGRvIGJhY2tncm91bmRcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaWNvbi1zaXplXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBBbHRlcmEgbyB0YW1hbmhvIGRvIGljb25lfCBOw7ptZXJvIGVtIHB4fCBuw6NvfCB8XG4gICAgICAgICAgICB0aGlzLmltZy5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWNvbi1zaXplXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdmVyaWZpY2Egc2UgdGVtIG8gdGFtYW5obyBkbyBlc3Bhw6dvIGRvIMOtY29uZSBlIGRlZmluZSBhIGxhcmd1cmEgZGEgZGl2XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImljb24tc3BhY2Utd2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IEVzcGHDp2FtZW50byBkbyDDrWNvbmUgY29tIG8gdGV4dG98IE7Dum1lcm8gZW0gcHh8IG7Do298IHxcbiAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uLXNwYWNlLXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9Db2xvY2EgY29yIG5vIGJvdGFvXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInRoZW1lXCIpKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogbm9ybWFsO2xpZ2h0O2tleWJvYXJkO2tleWJvYXJkLW9rO2Rhcmstcm91bmRlZDtyZWQtcm91bmRlZDtkYXJrO3ZrXG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBBbHRlcmEgYSBjb3IgZG8gY29tcG9uZW50ZXwgW1sjVGVtYXMgfCBWZXIgdGVtYXNdXXwgbsOjbyB8IHZhemlvfFxuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLVwiICsgdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSA9PSBcImFiLWJ1dHRvbi1rZXlib2FyZFwiKSB7XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24ta2V5Ym9hcmRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tbm9ybWFsXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwicG9zaXRpb25cIikgPT0gXCJjZW50ZXJcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IGNlbnRlcjtyaWdodDtsZWZ0XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBQb3Npw6fDo28gZG8gYm90w6NvfCBDZW50ZXIsIHJpZ2h0IG91IGxlZnR8IG7Do298IGNlbnRlcnxcbiAgICAgICAgICAgIGlmIChwbWIudXRpbHMuc2hvd0JpZ1NjcmVlbih0b3AuJChcImJvZHlcIikpID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tY2VudGVyLWJpZ1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWNlbnRlclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInBvc2l0aW9uXCIpID09IFwibGVmdFwiKSB7XG4gICAgICAgICAgICAvL27Do28gZmF6IG5hZGFcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInBvc2l0aW9uXCIpID09IFwicmlnaHRcIikge1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5mbG9hdCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwicG9zaXRpb25cIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL3ZlcmlmaWNhIHNlIHRlbSBtYXggd2lkdGhcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwibWF4LXdpZHRoXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBMYXJndXJhIG3DoXhpbWEgZG8gYm90w6NvfCBOw7ptZXJvIGVtIHB4fCBuw6NvfCB8XG4gICAgICAgICAgICB0aGlzLnN0eWxlLm1heFdpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJtYXgtd2lkdGhcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJsb2NrZXIuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1ibG9ja1wiKTtcbiAgICAgICAgdGhpcy5ibG9ja2VyLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJidG5faWJsb2NrZXJcIik7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5ibG9ja2VyKTtcblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB0aGlzLmJsb2NrZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcImlzLWJsb2NrZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiB0cnVlO2ZhbHNlXG4gICAgICAgICAgICB0aGlzLmJsb2NrZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInZpc2liaWxpdHlcIikgPT0gXCJoaWRkZW5cIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IGhpZGRlbjtzaG93XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vTWVzbW8gY29tcG9ydGFtZW50byBwb3LDqW0gY29tIG91dHJvIG5vbWUgZGUgYXRyaWJ1dG8sIG5lY2Vzc8OhcmlvIGFqdXN0YXIgdG9kb3MgcHJvamV0b3MgcXVlIHVzYW0gbyBkZSBjaW1hXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInZpc2libGVcIikgPT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvL0xpbXBhIHZhcmlhdmVpc1xuICAgICAgICBpZCA9IG51bGw7XG4gICAgfVxuXG4gICAgX2FkZEV2ZW50KCkge1xuICAgICAgICB2YXIgYnV0dG9uID0gJCh0aGlzLmJ1dHRvbik7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgLy8gYWx0ZXJhIG8gw61jb25lIGRvIGJvdMOjbyBxdWFuZG8gbyBib3TDo28gw6kgYXBlcnRhZG8gZSBzZSDDqSBwYXNzYWRvIG8gYXRyaWJ1dG8gaWNvbi1hY3RpdmVcbiAgICAgICAgYnV0dG9uLm9uKFwidG91Y2hzdGFydCBtb3VzZWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcblxuICAgICAgICAgICAgLy9Qcm9pYmUgbyBjbGlxdWUgZW0gZG9pcyBib3TDtWVzIGFvIG1lc21vIHRlbXBvXG4gICAgICAgICAgICBpZiAoZSAmJiBlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vdGlyYSBvIGZvY28gZGUgcXVhbHF1ZXIgZWxlbWVudG9cbiAgICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgICAgICAgICAgJCh3aW5kb3cpLmZvY3VzKCk7XG5cbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSA9PSBcImZhbHNlXCIgfHwgIV90aGlzLmhhc0F0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgLy9zZSB0aXZlciBlc3BlY2lmaWNhZG8gaWNvbi1hY3RpdmUgYWRpY2lvbmEgbm8gbHVnYXIgZG8gbm9ybWFsIHF1YW5kbyBvIGV2ZW50byBpbmljaWFcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwiaWNvbi1hY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQ2FtaW5obyBkbyDDrWNvbmUgcXVlIGFwYXJlY2Vyw6EgcXVhbmRvIG8gYm90w6NvIGZvciBhdGl2YWRvLiB8IEFsZmFudW3DqXJpY298IG7Do298IHZhemlvfFxuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwiaWNvbi1hY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmltZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIF90aGlzLmdldEF0dHJpYnV0ZShcImljb24tYWN0aXZlXCIpICsgXCIpXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gc2UgdGl2ZXIgdGVtYSBhZGljaW9uYSBvIHRlbWEgbm8gb2JqZXRvXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcInRoZW1lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tXCIgKyBfdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSArIFwiLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLW5vcm1hbC1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFsdGVyYSBvIMOtY29uZSBkbyBib3TDo28gcXVhbmRvIG8gYm90w6NvIMOpIHNvbHRvIGUgc2Ugw6kgcGFzc2FkbyBvIGF0cmlidXRvIGljb24tYWN0aXZlXG4gICAgICAgIGJ1dHRvbi5vbihcIm1vdXNldXAgdG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgLy90aXJhIG8gZm9jbyBkZSBxdWFscXVlciBlbGVtZW50b1xuICAgICAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgICAgICAgICAkKHdpbmRvdykuZm9jdXMoKTtcblxuICAgICAgICAgICAgaWYgKF90aGlzLmdldEF0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpID09IFwiZmFsc2VcIiB8fCAhX3RoaXMuaGFzQXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICAvL3JldG9ybmEgbyBpY29uZSBwYXJhIG8gbm9ybWFsIHF1YW5kbyBvIGV2ZW50byB0ZXJtaW5hXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcImljb24tYWN0aXZlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbWcuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBfdGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uXCIpICsgXCIpXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9yZXRpcmEgbyB0ZW1hIGFkaWNpb25hZG9cbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwidGhlbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1cIiArIF90aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpICsgXCItYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tbm9ybWFsLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vYcOnw6NvIHF1YW5kbyBvIG1vdXNlIG91IG8gdG91Y2ggZGVpeGFyIGEgw6FyZWEgZG8gb2JqZXRvIGJvdMOjb1xuICAgICAgICBidXR0b24ub24oXCJtb3VzZWxlYXZlIHRvdWNobGVhdmVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgaWYgKF90aGlzLmdldEF0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpID09IFwiZmFsc2VcIiB8fCAhX3RoaXMuaGFzQXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICAvL3JldG9ybmEgbyBpY29uZSBwYXJhIG8gbm9ybWFsIHF1YW5kbyBvIGV2ZW50byB0ZXJtaW5hXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcImljb24tYWN0aXZlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbWcuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBpY29uQWN0aXZlICsgXCIpXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9yZXRpcmEgbyB0ZW1hIGFkaWNpb25hZG9cbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwidGhlbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1cIiArIF90aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpICsgXCItYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tbm9ybWFsLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQodGhpcy5ibG9ja2VyKS5vbihcInRhcFwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcblxuXG4gICAgfVxuXG4gICAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5jbGFzc0xpc3QuY29udGFpbnModGhpcy5tYWluQ2xhc3MpKSB7XG4gICAgICAgICAgICAvKnRoaXMuc2hhZG93RG9tID0gdGhpcy5hdHRhY2hTaGFkb3coeyBtb2RlOiAnb3BlbicgfSk7ICovXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2FkZEV2ZW50KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcImlzLWRpc2FibGVkXCIsIFwibGFiZWxcIiwgXCJ0aGVtZVwiLCBcImljb25cIiwgXCJpY29uLWNsYXNzXCIsIFwid2lkdGhcIiwgXCJpY29uLWJ1dHRvblwiLCBcImljb24tc2l6ZVwiLCBcImljb24tc3BhY2Utd2lkdGhcIiwgXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiLCBcInBvc2l0aW9uXCIsIFwid2lkdGgtb24tYmlnc2NyZWVuXCIsIFwiaWRcIiwgXCJtYXgtd2lkdGhcIiwgXCJpcy1ibG9ja2VkXCJdO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcblxuICAgICAgICBzd2l0Y2ggKGF0dHJOYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwiaXMtZGlzYWJsZWRcIjpcbiAgICAgICAgICAgICAgICAvL1F1YW5kbyBpcy1kaXNhYmxlID0gdHJ1ZSwgZGVzYWJpbGl0YSBvIGJvdMOjb1xuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ibG9ja2VyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy9TZSBvIG5vdm8gdmFsb3IgbsOjbyBoYWJpbGl0YXIgbyBkaXNhYmxlLCBlbGUgcmV0aXJhIGFzIGNsYXNzZXMgZGUgYWN0aXZlIGUgcmVtb3ZlIG8gZGlzYWJsZSBkbyBib3TDo29cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwidGhlbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1cIiArIHRoaXMuZ2V0QXR0cmlidXRlKFwidGhlbWVcIikgKyBcIi1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tbm9ybWFsLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJsb2NrZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwibGFiZWxcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW4uaW5uZXJUZXh0ID0gbmV3VmFsLnRvVXBwZXJPbmx5Rmlyc3RMZXR0ZXIoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcInRoZW1lXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLVwiICsgb2xkVmFsKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tbm9ybWFsXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1cIiArIG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpY29uXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBuZXdWYWwgKyBcIilcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImljb24tY2xhc3NcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5jbGFzc0xpc3QuYWRkKG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ3aWR0aFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpY29uLWJ1dHRvblwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWltZ1wiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24taW1nXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImljb24tc2l6ZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLmJhY2tncm91bmRTaXplID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaWNvbi1zcGFjZS13aWR0aFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLndpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwidmlzaWJpbGl0eVwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJzaG93XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJ0YWJsZVwiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsID09IFwiaGlkZGVuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwidmlzaWJsZVwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJ0YWJsZVwiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsID09IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJwb3NpdGlvblwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJjZW50ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAocG1iLnV0aWxzLnNob3dCaWdTY3JlZW4odG9wLiQoXCJib2R5XCIpKSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tY2VudGVyLWJpZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1jZW50ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5mbG9hdCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIjpcbiAgICAgICAgICAgICAgICBpZiAocG1iLnV0aWxzLnNob3dCaWdTY3JlZW4odG9wLiQoXCJib2R5XCIpKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImlkXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJidG5faW1nXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiYnRuX2J1dHRvblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW4uc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJidG5fc3BhblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2NrZXIuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJidG5faWJsb2NrZXJcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJtYXgtd2lkdGhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLm1heFdpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaXMtYmxvY2tlZFwiOlxuICAgICAgICAgICAgICAgIC8vVHJhdGEgYSBhbHRlcmHDp8OjbyBkbyBhdHJpYnV0byBpcy1kaXNhYmxlXG4gICAgICAgICAgICAgICAgLy9RdWFuZG8gaXMtZGlzYWJsZSA9IHRydWUsIGRlc2FiaWxpdGEgbyBib3TDo29cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU2UgbyBub3ZvIHZhbG9yIG7Do28gaGFiaWxpdGFyIG8gZGlzYWJsZSwgZWxlIHJldGlyYSBhcyBjbGFzc2VzIGRlIGFjdGl2ZSBlIHJlbW92ZSBvIGRpc2FibGUgZG8gYm90w6NvXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInRoZW1lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tXCIgKyB0aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpICsgXCItYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLW5vcm1hbC1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ibG9ja2VyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoXCJhYi1idXR0b25cIiwgQWJCdXR0b24pOyIsIlwidXNlIHN0cmljdFwiO1xuXG4kLmZuLmluY3JlbWVudFJlcXVlc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGN1cnIgPSAwO1xuICAgIGlmICh0aGlzLmF0dHIoXCJjdXJyZW50LXJlcXVlc3RcIikpIHtcbiAgICAgICAgY3VyciA9IHBhcnNlSW50KHRoaXMuYXR0cihcImN1cnJlbnQtcmVxdWVzdFwiKSk7XG4gICAgfVxuXG4gICAgY3VycisrO1xuICAgIHRoaXMuYXR0cihcImN1cnJlbnQtcmVxdWVzdFwiLCBjdXJyKTtcbn1cblxuJC5mbi5yZXNldFJlcXVlc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yZW1vdmVBdHRyKFwiY3VycmVudC1yZXF1ZXN0XCIpO1xufVxuXG5jbGFzcyBBYlBhZ2UgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmh0bWxPYmogPSAkKFwiaHRtbCxib2R5XCIpWzBdO1xuXG4gICAgICAgIC8vcGFnZUxvYWRlclxuICAgICAgICB0aGlzLnBhZ2VMb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy53cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5sb2FkQmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5iYXJSYW5nZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMubG9hZFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItcGFnZVwiO1xuICAgIH1cblxuICAgIF9yZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCh0aGlzLm1haW5DbGFzcyk7XG5cbiAgICAgICAgLy9DcmlhIHVtIGlkXG4gICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQXRyaWJ1dG8gcGFyYSBpZGVudGlmaWNhciBvIG9iamV0b3wgQWxmYW51bcOpcmljb3wgbsOjb3wgdmF6aW98XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGdlbmVyYXRlSUQoKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBwYXJhbWV0cm9zXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcImZ1bGxzY3JlZW5cIikgIT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogVXNhIG8gdGFtYW5obyB0b3RhbCBkYSB0ZWxhIHwgdHJ1ZSBvdSBmYWxzZSB8IG7Do28gfCB0cnVlIHxcbiAgICAgICAgICAgIHRoaXMuaHRtbE9iai5zdHlsZS5tYXJnaW4gPSBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5odG1sT2JqLnN0eWxlLnBhZGRpbmcgPSBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5odG1sT2JqLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgICAgICAgICB0aGlzLmh0bWxPYmouc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cbiAgICAgICAgICAgIHRoaXMuc3R5bGUudG9wID0gXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUubGVmdCA9IFwiMHB4XCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmJvdHRvbSA9IFwiMHB4XCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLnJpZ2h0ID0gXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLnBvc2l0aW9uID0gXCJmaXhlZFwiO1xuICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwicGFnZS0tbGltaXRlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbG9yIHBhZHJhb1xuICAgICAgICB0aGlzLnN0eWxlLnpJbmRleCA9IFwiMFwiO1xuXG4gICAgICAgIC8vc2UgZXhpc3RpciB1bSBtYXgtcmVxdWVzdCwgY29uc3RydWlyIG8gc2lzdGVtYSBkZSBsb2FkXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heC1yZXF1ZXN0XCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBNw6F4aW1vIGRlIHJlcXVlc3RzIHF1ZSB0ZXLDoSBuYSBww6FnaW5hIHBhcmEgbyBsb2FkZXIgfCBOdW3DqXJpY28gfCBuw6NvIHwgMCB8XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVMb2FkZXIoKTtcbiAgICAgICAgfSBlbHNle1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImh0bWxcIikuY2xhc3NMaXN0LmFkZChcImh0bWwtcGFnZS1sb2FkZWRcIik7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMubWFpbkNsYXNzKSkge1xuICAgICAgICAgICAgLyp0aGlzLnNoYWRvd0RvbSA9IHRoaXMuYXR0YWNoU2hhZG93KHtcbiAgICAgICAgICAgICAgICBtb2RlOiAnb3BlbidcbiAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcImxvYWRlci12aXNpYmlsaXR5XCIsIFwiY3VycmVudC1yZXF1ZXN0XCJdO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcbiAgICAgICAgaWYgKGF0dHJOYW1lID09IFwibG9hZGVyLXZpc2liaWxpdHlcIikge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbCAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICQodGhpcy5sb2dvKS5mYWRlT3V0KDEwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCh0aGlzLnBhZ2VMb2FkKS5mYWRlT3V0KDEwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBhZ2VMb2FkLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlTG9hZGVyKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQodGhpcy5wYWdlTG9hZCkuZmFkZUluKDEwMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIGlmIChhdHRyTmFtZSA9PSBcImN1cnJlbnQtcmVxdWVzdFwiKSB7XG4gICAgICAgICAgICB2YXIgcmVxQXR1YWwgPSBwYXJzZUludChuZXdWYWwpO1xuICAgICAgICAgICAgdmFyIHJlcU1heCA9IHBhcnNlSW50KHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXJlcXVlc3RcIikpO1xuICAgICAgICAgICAgdmFyIHRvdGFsID0gKCgxMDAgLyByZXFNYXgpICogcmVxQXR1YWwpO1xuXG4gICAgICAgICAgICB0aGlzLmJhclJhbmdlLnN0eWxlLndpZHRoID0gdG90YWwgKyBcIiVcIjtcblxuICAgICAgICAgICAgaWYgKHRvdGFsID49IDEwMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwibG9hZGVyLXZpc2liaWxpdHlcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5jbGFzc0xpc3QuYWRkKFwiaHRtbC1wYWdlLWxvYWRlZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxQXR1YWwgPSBudWxsO1xuICAgICAgICAgICAgcmVxTWF4ID0gbnVsbDtcbiAgICAgICAgICAgIHRvdGFsID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9jcmVhdGVMb2FkZXIoKSB7XG5cbiAgICAgICAgdGhpcy5wYWdlTG9hZC5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXJcIik7XG4gICAgICAgIHRoaXMucGFnZUxvYWQuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1wYWdlLWxvYWRlclwiKTtcbiAgICAgICAgdGhpcy5wYWdlTG9hZC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMucGFnZUxvYWQpO1xuXG4gICAgICAgIHRoaXMud3JhcHBlci5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItd3JhcHBlclwiKTtcbiAgICAgICAgdGhpcy5wYWdlTG9hZC5hcHBlbmRDaGlsZCh0aGlzLndyYXBwZXIpO1xuXG4gICAgICAgIHRoaXMubG9hZEJhci5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItcGF0aFwiKTtcbiAgICAgICAgdGhpcy53cmFwcGVyLmFwcGVuZENoaWxkKHRoaXMubG9hZEJhcik7XG5cbiAgICAgICAgdGhpcy5iYXJSYW5nZS5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItcmFuZ2VcIik7XG4gICAgICAgIHRoaXMuYmFyUmFuZ2Uuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1wYWdlLWxvYWRlci1yYW5nZVwiKTtcbiAgICAgICAgdGhpcy5sb2FkQmFyLmFwcGVuZENoaWxkKHRoaXMuYmFyUmFuZ2UpO1xuXG4gICAgICAgIHRoaXMubG9hZFRleHQuY2xhc3NMaXN0LmFkZChcImFiLXBhZ2UtbG9hZGVyLXRleHRcIik7XG4gICAgICAgIHRoaXMubG9hZFRleHQuaW5uZXJUZXh0ID0gXCJjYXJyZWdhbmRvLi4uXCI7XG4gICAgICAgIHRoaXMud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmxvYWRUZXh0KTtcbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ2FiLXBhZ2UnLCBBYlBhZ2UpOyJdfQ==
