"use strict";

//Verfica Sistema Operacional
window.isIOS = (/iPad|iPhone|iPod/.test(navigator.platform) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) && !window.MSStream;
window.isAndroid = /(android)/i.test(navigator.userAgent);
window.isDesktop = !window.isIOS && !window.isAndroid;

(function(w, $, undefined) {

    w.tapHandling = false;
    w.tappy = true;

    var tap = function($els) {
        return $els.each(function() {

            var $el = $(this),
                resetTimer,
                startY,
                startX,
                cancel,
                scrollTolerance = 10;

            function trigger(e) {
                $(e.target).trigger("tap", [e, $(e.target).attr("href")]);
            }

            function getCoords(e) {
                var ev = e.originalEvent || e,
                    touches = ev.touches || ev.targetTouches;

                if (touches) {
                    return [touches[0].pageX, touches[0].pageY];
                } else {
                    return null;
                }
            }

            function start(e) {
                if (e.touches && e.touches.length > 1 || e.targetTouches && e.targetTouches.length > 1) {
                    return false;
                }

                var coords = getCoords(e);
                startX = coords[0];
                startY = coords[1];
            }

            // any touchscroll that results in > tolerance should cancel the tap
            function move(e) {
                if (!cancel) {
                    var coords = getCoords(e);
                    if (coords && (Math.abs(startY - coords[1]) > scrollTolerance || Math.abs(startX - coords[0]) > scrollTolerance)) {
                        cancel = true;
                    }
                }
            }

            function end(e) {
                clearTimeout(resetTimer);
                resetTimer = setTimeout(function() {
                    w.tapHandling = false;
                    cancel = false;
                }, 1000);

                // make sure no modifiers are present. thx http://www.jacklmoore.com/notes/click-events/
                if ((e.which && e.which > 1) || e.shiftKey || e.altKey || e.metaKey || e.ctrlKey) {
                    return;
                }

                e.preventDefault();

                // this part prevents a double callback from touch and mouse on the same tap

                // if a scroll happened between touchstart and touchend
                if (cancel || w.tapHandling && w.tapHandling !== e.type) {
                    cancel = false;
                    return;
                }

                w.tapHandling = e.type;
                trigger(e);
            }

            $el
                .bind("touchstart.tappy MSPointerDown.tappy", start)
                .bind("touchmove.tappy MSPointerMove.tappy", move)
                .bind("touchend.tappy MSPointerUp.tappy", end)
                .bind("click.tappy", end);
        });
    };

    var untap = function($els) {
        return $els.unbind(".tappy");
    };

    // use special events api
    if ($.event && $.event.special) {
        $.event.special.tap = {
            add: function(handleObj) {
                tap($(this));
            },
            remove: function(handleObj) {
                untap($(this));
            }
        };
    } else {
        // monkeybind
        var oldBind = $.fn.bind,
            oldUnbind = $.fn.unbind;
        $.fn.bind = function(evt) {
            if (/(^| )tap( |$)/.test(evt)) {
                tap(this);
            }
            return oldBind.apply(this, arguments);
        };
        $.fn.unbind = function(evt) {
            if (/(^| )tap( |$)/.test(evt)) {
                untap(this);
            }
            return oldUnbind.apply(this, arguments);
        };
    }

}(this, jQuery));


// ARRUMA ERRO NO IE9 ONDE NAO EXISTE WINDOW.CONSOLE
if (!window.console) {
    var console = {
        log: function() {},
        warn: function() {},
        error: function() {},
        time: function() {},
        timeEnd: function() {}
    }
}

/* ARRUMA INPUT NO IOS QUE NAO FUNCIONA DIREITO */
/*$(document).ready(function() {
    if (window.isIOS) {
        $(document).ready(function() {
            document.addEventListener('keydown', function(e) {
                window.focus();
                $(':focus').focus();
            });
        });
    }

});*/

var getXY = function(event) {
    var x = null;
    var y = null;

    if (event.originalEvent != null && event.originalEvent.touches != null) {
        var touch = event.originalEvent.touches[0] || event.originalEvent.changedTouches[0];
        x = parseFloat(touch.pageX);
        y = parseFloat(touch.pageY);
    } else {
        x = parseFloat(event.pageX);
        y = parseFloat(event.pageY);
    }

    var pos = new Object();
    pos.x = x;
    pos.y = y;

    return pos;
}

var support3d = function() {
    var ret = false;
    var supports3DTransforms = document.body.style['webkitPerspective'] !== undefined || document.body.style['MozPerspective'] !== undefined;
    if (supports3DTransforms) {
        ret = true;
    }
    return ret;
}

var getTransform = function(el) {
    var prop = "";

    if (el.css('-webkit-transform') != undefined) {
        prop = el.css('-webkit-transform');
    } else if (el.css('transform') != undefined) {
        prop = el.css('transform');
    } else if (el.css('-moz-transform') != undefined) {
        prop = el.css('-moz-transform');
    } else if (el.css('-ms-transform') != undefined) {
        prop = el.css('-ms-transform');
    } else {
        return [0, 0, 0];
    }

    var results = prop.match(/matrix(?:(3d)\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))(?:, (-{0,1}\d+)), -{0,1}\d+\)|\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))\))/);

    if (!results)
        return [0, 0, 0];
    if (results[1] == '3d')
        return results.slice(2, 5);

    results.push(0);
    return results.slice(5, 8);
}

var goToNextTabindex = function(event, obj, command) {
    var key = event.keyCode ? event.keyCode : event.which;

    if (key == 13 || key == 9) {
        var ficar = true;
        var ret = true;
        var tabindex = obj.attr('tabindex');

        if (key == 13 && obj[0].nodeName == "TEXTAREA") {
            return;
        }

        do {
            //Verifica o tabindex
            var gotoTabindex = obj.attr('goto-tab-index');
            var stopTabindex = obj.attr('stop-tab-index');

            //Vai opara
            if (tabindex && stopTabindex != "true") {
                tabindex = parseInt(tabindex);

                //avanca o tabindex
                if (gotoTabindex) {
                    tabindex = gotoTabindex;
                } else {
                    tabindex++;
                }

                //se Existir o elemento foca nele
                var nextObj = $('[tab-index=' + tabindex + ']');

                //Verifica se encontrou um objeto
                if (nextObj.length > 0 && nextObj.attr("is-disabled") != "true") {
                    ficar = false;                    

                    if (nextObj[0].nodeName == "ABNER-SELECT-UNDERLINE") {
                        nextObj.find("select").trigger("focus");
                    } else {
                        nextObj.find("[div-focus=true]").trigger(command);
                    };
                } else {
                    if (nextObj.length > 0) {
                        //verifica o proximo objeto
                        obj = nextObj;
                    } else {
                        ficar = false;
                    }
                }

                //removido para funcionar o enter
                //return false;
            } else {
                if (stopTabindex == "true") {
                    ficar = false;
                    ret = false;
                } else {
                    ficar = false;
                    ret = true;
                }

            }
        }
        while (ficar);

        //Se for tab deixar false
        if (key == 9) {
            ret = false;
        }

        //rodar saida
        return ret;
    }

}

var randomNumber = function() {
    //var random_integer = Math.random()*101|0;    
    return Math.random().toString(36).substr(2, 10);
}

var guid = function() {
    function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    }
    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
}

var generateID = function() {
    return guid();
}

var pointerEventToXY = function(e) {
    var out = { x: 0, y: 0 };
    if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {
        var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
        out.x = touch.pageX;
        out.y = touch.pageY;
    } else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {
        out.x = e.pageX;
        out.y = e.pageY;
    }
    return out;
};
"use strict";

//component-wrapper: non-functional

//Criando namespace utils
var PmbUtils = function () { }


PmbUtils.prototype.removeAccent = function (word) {
    var _this = this;

    var map = {
        "á": "a",
        "à": "a",
        "â": "a",
        "ã": "a",
        "ä": "a",
        "Á": "A",
        "À": "A",
        "Â": "A",
        "Ã": "A",
        "Ä": "A",
        "é": "e",
        "è": "e",
        "ê": "e",
        "ẽ": "e",
        "ë": "e",
        "É": "E",
        "È": "E",
        "Ê": "E",
        "Ẽ": "E",
        "Ë": "E",
        "í": "i",
        "ì": "i",
        "î": "i",
        "ĩ": "i",
        "ï": "i",
        "Í": "I",
        "Ì": "I",
        "Î": "I",
        "Ĩ": "I",
        "Ï": "I",
        "ó": "o",
        "ò": "o",
        "ô": "o",
        "õ": "o",
        "ö": "o",
        "Ó": "O",
        "Ò": "O",
        "Ô": "O",
        "Õ": "O",
        "Ö": "O",
        "ú": "u",
        "ù": "u",
        "û": "u",
        "ũ": "u",
        "ü": "u",
        "Ú": "U",
        "Ù": "U",
        "Û": "U",
        "Ũ": "U",
        "Ü": "U",
        "ý": "y",
        "ỳ": "y",
        "ŷ": "y",
        "ỹ": "y",
        "ÿ": "y",
        "Ý": "Y",
        "Ỳ": "Y",
        "Ŷ": "Y",
        "Ỹ": "Y",
        "Ÿ": "Y",
        "ñ": "n",
        "Ñ": "n",
        "Ç": "c",
        "ç": "c"
    };

    if (word != "") {
        return word.replace(/[àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãẽĩũñõÃẼĨŨÑÕäëïöüÿÄËÏÖÜŸÇç]/g, function (match) {
            return map[match];
        });
    } else {
        return null;
    }
}

//PEga variaveis da URL
PmbUtils.prototype.getUrlVars = function () {
    var vars = new Object(),
        hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars[hash[0]] = hash[1];
    }
    return vars;
}

//Determina se é modo adaptativo 
PmbUtils.prototype.showBigScreen = function (obj) {
    if (parseInt(obj.outerWidth()) >= 1024) {
        return true;
    } else {
        return false;
    }
}

PmbUtils.prototype.getCheckedRadio = function (name) {
    if (name) {
        return $("input[type=radio][name=" + name + "]:checked").parent();
    } else {
        return $("input[type=radio]:checked").parent();
    }
}

PmbUtils.prototype.getPhoneAsObject = function (phone) {

    var phoneObj = {
        ddi: "",
        ddd: "",
        phone: phone
    };

    phone = phone ? phone.replace(/\D+/g, '') : phone;

    if (phone && phone.length > 11) {
        phoneObj.ddi = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$1");
        phoneObj.ddd = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$2");
        phoneObj.phone = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$3");
    } else if (phone && phone.length > 9) {
        phoneObj.ddd = phone.replace(/^(\d{2})(\d{8,9})$/g, "\$1");
        phoneObj.phone = phone.replace(/^(\d{2})(\d{8,9})$/g, "\$2");
    }

    return phoneObj;
}

PmbUtils.prototype.formatPhone = function (phone) {

    var phoneReturn = phone.replace(/[^0-9]/g, '');

    if (phone && phone.length > 11) {
        phoneReturn = phone.replace(/^(\d{2})(\d{2})(\d{4,5})(\d{4})$/g, "\+$1 \($2) \$3 \$4");
    } else if (phone && phone.length > 9) {
        phoneReturn = phone.replace(/^(\d{2})(\d{4,5})(\d{4})$/g, "\($1) \$2 \$3");
    };

    return phoneReturn;
}

PmbUtils.prototype.removeCpfCnpjFormat = function (valor, type) {

    if (valor) {
        //remove ponto e virgula
        valor = valor.replace(new RegExp(/[^\d]/g), "");

        if (type == "CNPJ") {
            var len = 14;
            var pad = "00000000000";
        } else if (type == "CPF") {
            var len = 11;
            var pad = "00000000000";
        } else {
            return "";
        }

        //transforma para numero
        valor = parseInt(valor);

        //se for maior que o valor defindo para len ele corta
        if (valor.length > len) {
            valor = valor.substring(0, len);
        }

        //Se ocorre algum erro, deixar vazio
        if (isNaN(valor)) {
            valor = "";

        } else {
            valor = pad.substring(0, pad.length - valor.length) + valor;
        }
    }
    return valor;
}

PmbUtils.prototype.validarCNPJ = function (cnpj) {

    cnpj = cnpj.replace(/[^\d]+/g, '');
    
    if (cnpj == "0" ||
        cnpj == "00000000000000" ||
        cnpj == "11111111111111" ||
        cnpj == "22222222222222" ||
        cnpj == "33333333333333" ||
        cnpj == "44444444444444" ||
        cnpj == "55555555555555" ||
        cnpj == "66666666666666" ||
        cnpj == "77777777777777" ||
        cnpj == "88888888888888" ||
        cnpj == "99999999999999") {
        return false;
    }

    // Valida DVs
    var tamanho = cnpj.length - 2
    var numeros = cnpj.substring(0, tamanho);
    var digitos = cnpj.substring(tamanho);
    var soma = 0;
    var pos = tamanho - 7;
    var i = tamanho;

    for (i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2)
            pos = 9;
    }
    var resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
    if (resultado != digitos.charAt(0)) {
        return false;
    }

    tamanho = tamanho + 1;
    numeros = cnpj.substring(0, tamanho);
    soma = 0;
    pos = tamanho - 7;
    for (i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2)
            pos = 9;
    }

    resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;

    if (resultado != digitos.charAt(1)) {
        return false;
    }

    return true;
}

//valida o CPF digitado
PmbUtils.prototype.validarCPF = function(cpf) {

    var exp = /\.|\-/g
    cpf = cpf.toString().replace(exp, "");
    if (cpf.length < 11) {
        var pad = "00000000000";
        cpf = pad.substring(0, pad.length - cpf.length) + cpf;
    }

    if (cpf == "0" ||
        cpf == "00000000000" ||
        cpf == "11111111111" ||
        cpf == "22222222222" ||
        cpf == "33333333333" ||
        cpf == "44444444444" ||
        cpf == "55555555555" ||
        cpf == "66666666666" ||
        cpf == "77777777777" ||
        cpf == "88888888888" ||
        cpf == "99999999999") {
        return false;
    }

    var soma;
    var resto;
    soma = 0;

    for (var i = 1; i <= 9; i++) {
        soma = soma + parseInt(cpf.substring(i - 1, i)) * (11 - i);
    }

    resto = (soma * 10) % 11;

    if ((resto == 10) || (resto == 11)) {
        resto = 0;
    }
    if (resto != parseInt(cpf.substring(9, 10))) {
        return false;
    }

    soma = 0;
    for (var i = 1; i <= 10; i++) {
        soma = soma + parseInt(cpf.substring(i - 1, i)) * (12 - i);
    }
    resto = (soma * 10) % 11;

    if ((resto == 10) || (resto == 11)) {
        resto = 0;
    }
    if (resto != parseInt(cpf.substring(10, 11))) {
        return false;
    }
    return true;
}

PmbUtils.prototype.validarEMAIL = function(email) {
    var emailValidation = email.match(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+$/);

    if (email == emailValidation) {
        return emailValidation;
    }
}

//Funcoes uteis de uso do JQUERY
window.addEventListener('WebComponentsReady', function () {
    document.querySelector("html").classList.add("html-page-loaded");
});

$(document).ready(function () {
    $.fn.setCursorPosition = function (pos) {
        this.each(function (index, elem) {
            if (elem.setSelectionRange) {
                elem.setSelectionRange(pos, pos);
            } else if (elem.createTextRange) {
                var range = elem.createTextRange();
                range.collapse(true);
                range.moveEnd('character', pos);
                range.moveStart('character', pos);
                range.select();
            }
        });
        return this;
    };

    $.fn.validate = function () {
        var change = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if ($(this).attr("onchange")) {
            change = $(this).attr("onchange");
            $(this).removeAttr("onchange");
        }

        //tira o foco de qualquer elemento
        document.activeElement.blur();
        $(window).focus();

        if (change != null) {
            $(this).attr("onchange", change);
        }

        //se ouver um erro validacao esta incorreta
        if ($(this).attr("error") && $(this).attr("error") != "") {
            return false;
        } else {
            return true;
        }
    };

    $.fn.setFocus = function () {
        if ($(this).length > 0) {
            $(this).find("input").focus();
        } else {
            return null;
        }
    }

    $.fn.removeFocus = function () {
        if (document.activeElement) {
            document.activeElement.blur();
        }
    }

    $.fn.getText = function () {
        var text = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase().startsWith("AB-INPUT") ? "AB-INPUT" : tag.toUpperCase();
                var tagsAceitas = ["AB-TEXT-READ-ONLY", "AB-TEXT-AREA-UNDERLINE", "AB-SELECT-UNDERLINE", "AB-INPUT"];
                if (tagsAceitas.indexOf(tag) == -1) {
                    return null;
                }
            }
        } else {
            return null;
        }

        if ($(this).length > 1) {
            var textArray = new Array();
            for (const radio of this) {
                textArray.push(radio.getText());
            }
            text = textArray;
        } else {
            text = this[0].getText();
        };

        return text;
    };

    $.fn.setText = function (text, cancel) {
        var tag = new String();

        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (tag == "AB-TEXT-READ-ONLY") {
            this[0].setText(text);

        } else if (tag.startsWith("AB-INPUT-DATE")) {
            this[0].setText(text);

        } else if (tag.startsWith("AB-INPUT")) {
            this[0].setText(text);

        } else if (tag == "AB-TEXT-AREA-UNDERLINE") {
            this[0].setText(text);

        } else if (tag.startsWith("AB-SELECT")) {
            if (cancel) {
                $(this).find("select").val(text);
            } else {
                $(this).find("select").val(text).change();
            }
        }

        //salva valor
        if (!tag.startsWith("AB-INPUT-CHECKBOX")) {
            $(this).attr("loaded-value", $(this).getText());
        }
    };


    //funcao para corrigir o data
    $.fn.getNumber = function () {
        var text = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (tag == "AB-TEXT-READ-ONLY") {
            text = this[0].getText();

        } else if (tag.startsWith("AB-INPUT-CHECKBOX")) {
            text = this[0].getNumber();

        } else if (tag.startsWith("AB-INPUT-RADIO")) {
            text = this[0].getNumber();
            
        } else if (tag.startsWith("AB-INPUT-SWITCH")) {
            text = this[0].getNumber();

        } else if (tag.startsWith("AB-INPUT-TIME")) {
            text = $(this).find("input").val() + "00";

        } else if (tag.startsWith("AB-INPUT-NUMBER")) {
            text = $(this).find("input").val();
            text = text.replace(new RegExp(/[^\d]/g), "");

        } else if (tag.startsWith("AB-INPUT-DATE")) {
            if (window.isIOS || window.isAndroid) {
                text = $(this).find("input").val();
                text = text.substring(8, 10) + "" + text.substring(5, 7) + "" + text.substring(0, 4);
            } else {
                text = $(this).find("input").val();
            }

        } else if (tag.startsWith("AB-INPUT")) {
            text = $(this).find("input").val();

        } else if (tag.startsWith("AB-TEXT-AREA-UNDERLINE")) {
            text = $(this).find("textarea").val();

        } else if (tag.startsWith("AB-SELECT")) {
            text = parseInt($(this).getObject().valor);

        } else if (tag.startsWith("AB-QUESTION")) {
            text = $(this).attr("answer");
        }

        if (text && tag != "AB-SELECT-UNDERLINE") {
            text = text.replace(new RegExp(/[^\d\,]/g), "");
        }

        return text;
    };

    //funcao para corrigir o data
    $.fn.setNumber = function (text, cancel) {
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (text || text == 0) {
            //Necessario ser string para regex
            text += "";
            text = text.replace(new RegExp(/[^\d-\,]/g), "");

            if (tag == "AB-TEXT-READ-ONLY") {
                this[0].setText(text);

            } else if (tag.startsWith("AB-INPUT-CHECKBOX")) {
                this[0].setNumber(text);

                $(this).attr("loaded-value", $(this).attr("is-checked"));

            } else if (tag.startsWith("AB-INPUT-RADIO")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-INPUT-SWITCH")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-INPUT-DATE")) {
                this[0].setText(text);

            } else if (tag.startsWith("AB-INPUT")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-SELECT")) {
                if (cancel) {
                    $(this[0].select).val(text);
                } else {
                    $(this[0].select).val(text).change();
                }
            }

            //salva valor
            if (!tag.startsWith("AB-INPUT-CHECKBOX")) {
                $(this).attr("loaded-value", $(this).getText());
            }
        }
    };

    $.fn.setOldValue = function () {
        $(this).setText($(this).attr("loaded-value"));
    };

    $.fn.isChanged = function (val) {
        var loadedValue = $(this).attr("loaded-value");
        var currentValue = $(this).getText();

        if (loadedValue || currentValue) {
            if (loadedValue !== currentValue) {
                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    $.fn.setObject = function (val) {
        var tag = $(this)[0].nodeName;
        if (tag.startsWith("AB-SELECT")) {
            $(this).find("select").val(val).change();
        }
    }

    $.fn.getObject = function () {
        var bean = new Object();

        if ((this)[0]) {
            var tag = $(this)[0].nodeName;

            if (tag.startsWith("AB-SELECT")) {
                bean.nome = $(this).find("select option:selected").text();
                bean.valor = $(this).find("select option:selected").attr("value");
            }
        }

        return bean;
    }


    //Avisar nossos componentes quando teve uma alteracao
    var origAppend = $.fn.append;
    $.fn.append = function () {
        if ($(this).hasClass("ab-container-content") && arguments[0].hasClass("ab-block")) {
            return false;
        } else {
            return origAppend.apply(this, arguments).trigger("append");
        }
    };

    //função para retornar se o campo esrá com erro ou não
    $.fn.hasError = function () {
        if ($(this).attr("error")) {
            return true;
        } else {
            return false;
        }
    }
});


//função para arrumar bug no iOS 8
if (!String.prototype.startsWith) {
    String.prototype.startsWith = function (searchString, position) {
        position = position || 0;
        return this.indexOf(searchString, position) === position;
    };
}

String.prototype.toUpperOnlyFirstLetter = function () {
    var str = this;

    var wordMap = {
        "rg": "RG",
        "cpf": "CPF",
        "cnpj": "CNPJ",
        "rne": "RNE",
        "cep": "CEP",
        "cnh": "CNH",
        "s.a.": "S.A."
    };

    if (str && str.length == 0) {
        return "";
    } else if (str && str.length == 1) {
        return str.toUpperCase()
    } else if (str && str.length > 1) {
        str = str.substr(0, 1).toUpperCase() + str.substr(1).toLowerCase();
        return str = str.replace(/\b(rg|cpf|cnpj|rne|cep|cnh)\b|s\.a\./gi, function (word) {
            return wordMap[word.toLowerCase()];
        });
    } else {
        return "";
    }
}

String.prototype.toCamelCase = function () {
    var str = this.toLowerCase();

    var wordsArray = ["de", "sem", "o", "do", "da"];

    var words = str.split(" ");

    var fullString = new String();

    for (var i = 0; i < words.length; i++) {
        if (wordsArray.indexOf(words[i]) == -1 && words[i].length > 1) {
            words[i] = words[i].toUpperOnlyFirstLetter();
        };
    };

    fullString = words.join(" ")

    return fullString;
}

String.prototype.formatPercent = function(decimals, integers) {
    var tmp = this;
    var dec = "1";
    var formatDecimal = 0;
    var negativeCheck = false;

    if (tmp.substring(0, 1) == "-") {
        negativeCheck = true;
        tmp = tmp.substring(1, tmp.length);
    };

    if (decimals) {
        dec = dec.rpad("0", parseInt(decimals) + 1);
        formatDecimal = parseInt(decimals);
    }
    dec = parseInt(dec);

    if ((tmp && parseInt(tmp) == 0) || tmp == "" || tmp == undefined || isNaN(parseInt(tmp))) {
        tmp = 0;
    } else {
        tmp = parseFloat(tmp) / dec;
    }

    if (negativeCheck) {
        tmp = tmp * -1;
    }

    var option = {
        minimumFractionDigits: formatDecimal,
        maximumFractionDigits: formatDecimal
    };

    tmp = new Intl.NumberFormat('pt-BR', option).format(tmp);

    return tmp;
}

String.prototype.formatCurrency = function () {
    var tmp = this;
    var negativeCheck = false;

    if (tmp.substring(0, 1) == "-") {
        negativeCheck = true;
        tmp = tmp.substring(1, tmp.length);
    };

    //remove zeros a esquerda
    if (tmp) {
        // tmp = parseInt(tmp) + "";
        tmp = tmp.replace(/^0+/, '');
    }

    //Qualquer coisa diferente de um numero valido retorna 0,00
    if ((tmp && parseInt(tmp) == 0) || tmp == "" || tmp == undefined || isNaN(parseInt(tmp))) {
        return "0,00";
    }

    //Verifica se existem somente decimais, e acrescenta um zero na frente
    if (tmp && tmp.length <= 2) {
        tmp = tmp.lpad("0", 3);
    }

    //se o tamanho for
    //coloca as casas decimais
    tmp = tmp.replace(/([0-9]{2})$/g, ",$1");

    //se tiver milhar coloca ponto
    if (tmp.length > 6) {
        tmp = tmp.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    if (negativeCheck == true) {
        tmp = "-" + tmp;
    }

    return tmp;
}

String.prototype.formatDate = function (options) {
    var dia = "";
    var mes = "";
    var ano = "";
    var itens = "";
    var dataFormatada = null;
    var str = this;

    if (options) {
        //options.date != "" && options.date != 0 && options.date != null
        options.date = str;

        switch (options.srcFormat) {
            case 'ddmmyyyy':
                ano = options.date.substring(4, 8);
                mes = options.date.substring(2, 4);
                dia = options.date.substring(0, 2);
                break;

            case 'yyyymmdd':
                ano = options.date.substring(0, 4);
                mes = options.date.substring(4, 6);
                dia = options.date.substring(6, 8);
                break;

            case 'dd.mm.yyyy':
                itens = options.date.split(".");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'dd/mm/yyyy':
                itens = options.date.split("/");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'yyyy.mm.dd':
                itens = options.date.split(".");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'dd-mm-yyyy':
                itens = options.date.split("-");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'yyyy-mm-dd':
                itens = options.date.split("-");
                ano = itens[0];
                mes = itens[1];
                dia = itens[2];
                break;

            case 'yyyymm':
                ano = options.date.substring(0, 4);
                mes = options.date.substring(4, 6);
                break;

            default:
                console.log("Data inválida");
        }

        switch (options.targetFormat) {
            case 'dd/mm/yyyy':
                dataFormatada = dia + '/' + mes + '/' + ano;
                break;

            case 'yyyy/mm/dd':
                dataFormatada = ano + '/' + mes + '/' + dia;
                break;

            case 'dd.mm.yyyy':
                dataFormatada = dia + '.' + mes + '.' + ano;
                break;

            case 'yyyy.mm.dd':
                dataFormatada = ano + '.' + mes + '.' + dia;
                break;

            case 'dd-mm-yyyy':
                dataFormatada = dia + '-' + mes + '-' + ano;
                break;

            case 'yyyy-mm-dd':
                dataFormatada = ano + '-' + mes + '-' + dia;
                break;

            case 'mm/yyyy':
                dataFormatada = mes + '/' + ano;
                break;

            case 'mmyy':
                dataFormatada = mes + "" + ano.substring(2, 4);
                break;

            case 'ddmmyyyy':
                dataFormatada = dia + mes + ano;
                break;

            case 'yyyymmdd':
                dataFormatada = ano + mes + dia;
                break;

            default:
                console.log("erro");
        }
    }
    return dataFormatada;
}

String.prototype.formatTime = function (options) {
    var hora = "";
    var min = "";
    var seg = "";
    var itens = "";
    var horaFormatada = null;
    var str = this;

    if (options) {
        options.time = str;

        switch (options.srcFormat) {
            case 'hhmmss':
                hora = options.time.substring(0, 2);
                min = options.time.substring(2, 4);
                seg = options.time.substring(4, 6);
                break;

            case 'hh:mm:ss':
                itens = options.time.split(":");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            case 'hh.mm.ss':
                itens = options.time.split(".");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            case 'hh-mm-ss':
                itens = options.time.split("-");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            default:
                console.log("Hora inválida");
        }

        switch (options.targetFormat) {
            case 'hh:mm:ss':
                horaFormatada = hora + ':' + min + ':' + seg;
                break;

            case 'hh.mm.ss':
                horaFormatada = hora + '.' + min + '.' + seg;
                break;

            case 'hh-mm-ss':
                horaFormatada = hora + '-' + min + '-' + seg;
                break;

            case 'hhmmss':
                horaFormatada = hora + min + seg;
                break;

            default:
                console.log("erro");
        }
    }
    return horaFormatada;
}

String.prototype.formatCpf = function () {
    var cpf = this.lpad("0", 11);
    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/g, "\$1.\$2.\$3\-\$4");
}

String.prototype.formatCnpj = function () {
    var cpf = this.lpad("0", 14);
    return cpf.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g, "\$1.\$2.\$3\/\$4\-$5");
}


String.prototype.dateDiff = function (srcFormat, targetData, type) {

    var dataIni = new Date(this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    }));
    var dataFim = new Date(targetData.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    }));

    if (type == "dia") {
        var difDias = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numDias = Math.ceil(difDias / (1000 * 3600 * 24));
        return numDias;
    } else if (type == "mes") {
        var difMeses = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numMeses = Math.ceil(difMeses / (1000 * 3600 * 24 * 30) - 1);
        return numMeses;
    } else if (type == 'ano') {
        var difMeses = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numMeses = Math.ceil(difMeses / (1000 * 3600 * 24 * 30) - 1);
        return Math.floor(numMeses / 12);
    }
}

String.prototype.plusDays = function (srcFormat, days) {
    var dataFormatada = this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    });
    var dataGerada = new Date(dataFormatada);
    var dataFinal = "";
    dataGerada.setDate(dataGerada.getDate() + days);
    var mes = new String(dataGerada.getMonth() + 1).lpad('0', 2);
    var dia = new String(dataGerada.getDate()).lpad('0', 2);
    dataFinal = dia + '/' + mes + '/' + dataGerada.getFullYear();
    return dataFinal;
}

String.prototype.minusDays = function (srcFormat, days) {
    var dataFormatada = this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    });
    var dataGerada = new Date(dataFormatada);
    var dataFinal = "";
    dataGerada.setDate(dataGerada.getDate() - days);
    var mes = new String(dataGerada.getMonth() + 1).lpad('0', 2);
    var dia = new String(dataGerada.getDate()).lpad('0', 2);
    dataFinal = dia + '/' + mes + '/' + dataGerada.getFullYear();
    return dataFinal;
}

String.prototype.convertToNumber = function () {
    var codeString = this.substring(1, 12);
    var letter = this.substring(0, 1).toLowerCase();
    return letter.charCodeAt(0) - 96 + codeString;
}

String.prototype.lpad = function (padString, length) {
    var str = this;
    while (str.length < length)
        str = padString + str;
    return str;
}

String.prototype.getSigla = function () {
    var sigla = "";
    var name = this;

    if (name) {
        var userName = name.replace(new RegExp(/[-]/g), "");
        userName = userName.replace(new RegExp(/[\s]+/g), " ").trim();
        userName = userName.split(" ");
        var firstName = userName[0];
        var lastName = userName[userName.length - 1];
        sigla = firstName[0] + lastName[0];
    }

    return sigla;
}

String.prototype.rpad = function (padString, length) {
    var str = this;
    while (str.length < length)
        str = str + padString;
    return str;
}

String.prototype.trim = function () {
    return this.replace(/^\s+|\s+$/g, "");
}

//trimming space from left side of the string
String.prototype.ltrim = function () {
    return this.replace(/^\s+/, "");
}

//trimming space from right side of the string
String.prototype.rtrim = function () {
    return this.replace(/\s+$/, "");
}
"use strict";

$.fn.incrementRequest = function () {
    var curr = 0;
    if (this.attr("current-request")) {
        curr = parseInt(this.attr("current-request"));
    }

    curr++;
    this.attr("current-request", curr);
}

$.fn.resetRequest = function () {
    this.removeAttr("current-request");
}

class AbPage extends HTMLElement {

    constructor() {
        super();

        this.htmlObj = $("html,body")[0];

        //pageLoader
        this.pageLoad = document.createElement("div");
        this.wrapper = document.createElement("div");
        this.loadBar = document.createElement("div");
        this.barRange = document.createElement("div");
        this.loadText = document.createElement("p");

        this.mainClass = "ab-page";
    }

    _render() {
        this.classList.add(this.mainClass);

        //Cria um id
        if (!this.hasAttribute("id")) {
            //description: Atributo para identificar o objeto| Alfanumérico| não| vazio|
            this.setAttribute("id", generateID());
        }

        // parametros
        if (this.getAttribute("fullscreen") != "false") {
            //values: true;false
            //description: Usa o tamanho total da tela | true ou false | não | true |
            this.htmlObj.style.margin = "0px";
            this.htmlObj.style.padding = "0px";
            this.htmlObj.style.width = "100%";
            this.htmlObj.style.height = "100%";

            this.style.top = "0px";
            this.style.left = "0px";
            this.style.bottom = "0px";
            this.style.right = "0px";
            this.style.height = "100%";
            this.style.width = "100%";
            this.style.position = "fixed";
        }

        // Valor padrao
        this.style.zIndex = "0";

        //se existir um max-request, construir o sistema de load
        if (this.hasAttribute("max-request")) {
            //description: Máximo de requests que terá na página para o loader | Numérico | não | 0 |
            this._createLoader();
        }

    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["loader-visibility", "current-request"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        if (attrName == "loader-visibility") {
            if (newVal != "true") {
                $(this.logo).fadeOut(100, function () {
                    this.remove();
                });

                $(this.pageLoad).fadeOut(100, function () {
                    this.remove();
                });
            } else if (this.pageLoad.length == 0) {
                this._createLoader();
            } else {
                $(this.pageLoad).fadeIn(100);
            }

        } else if (attrName == "current-request") {
            var reqAtual = parseInt(newVal);
            var reqMax = parseInt(this.getAttribute("max-request"));
            var total = ((100 / reqMax) * reqAtual);

            this.barRange.style.width = total + "%";

            if (total >= 100) {
                this.setAttribute("loader-visibility", "false");
                document.querySelector("html").classList.add("html-page-loaded");
            }

            reqAtual = null;
            reqMax = null;
            total = null;
        }
    }

    _createLoader() {

        this.pageLoad.classList.add("ab-page-loader");
        this.pageLoad.setAttribute("id", "ab-page-loader");
        this.pageLoad.style.display = "block";
        this.appendChild(this.pageLoad);

        this.wrapper.classList.add("ab-page-loader-wrapper");
        this.pageLoad.appendChild(this.wrapper);

        this.loadBar.classList.add("ab-page-loader-path");
        this.wrapper.appendChild(this.loadBar);

        this.barRange.classList.add("ab-page-loader-range");
        this.barRange.setAttribute("id", "ab-page-loader-range");
        this.loadBar.appendChild(this.barRange);

        this.loadText.classList.add("ab-page-loader-text");
        this.loadText.innerText = "Aguarde";
        this.wrapper.appendChild(this.loadText);
    }
}
customElements.define('ab-page', AbPage);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFiLXN1cHBvcnQvanMvYWItZml4LmpzIiwiYWItc3VwcG9ydC9qcy9hYi11dGlsLmpzIiwiYWItcGFnZS9qcy9hYi1wYWdlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0VEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IndlYmNvbXAuYWJuZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vVmVyZmljYSBTaXN0ZW1hIE9wZXJhY2lvbmFsXG53aW5kb3cuaXNJT1MgPSAoL2lQYWR8aVBob25lfGlQb2QvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSB8fCAobmF2aWdhdG9yLnBsYXRmb3JtID09PSAnTWFjSW50ZWwnICYmIG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyA+IDEpKSAmJiAhd2luZG93Lk1TU3RyZWFtO1xud2luZG93LmlzQW5kcm9pZCA9IC8oYW5kcm9pZCkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xud2luZG93LmlzRGVza3RvcCA9ICF3aW5kb3cuaXNJT1MgJiYgIXdpbmRvdy5pc0FuZHJvaWQ7XG5cbihmdW5jdGlvbih3LCAkLCB1bmRlZmluZWQpIHtcblxuICAgIHcudGFwSGFuZGxpbmcgPSBmYWxzZTtcbiAgICB3LnRhcHB5ID0gdHJ1ZTtcblxuICAgIHZhciB0YXAgPSBmdW5jdGlvbigkZWxzKSB7XG4gICAgICAgIHJldHVybiAkZWxzLmVhY2goZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgIHJlc2V0VGltZXIsXG4gICAgICAgICAgICAgICAgc3RhcnRZLFxuICAgICAgICAgICAgICAgIHN0YXJ0WCxcbiAgICAgICAgICAgICAgICBjYW5jZWwsXG4gICAgICAgICAgICAgICAgc2Nyb2xsVG9sZXJhbmNlID0gMTA7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRyaWdnZXIoZSkge1xuICAgICAgICAgICAgICAgICQoZS50YXJnZXQpLnRyaWdnZXIoXCJ0YXBcIiwgW2UsICQoZS50YXJnZXQpLmF0dHIoXCJocmVmXCIpXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENvb3JkcyhlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV2ID0gZS5vcmlnaW5hbEV2ZW50IHx8IGUsXG4gICAgICAgICAgICAgICAgICAgIHRvdWNoZXMgPSBldi50b3VjaGVzIHx8IGV2LnRhcmdldFRvdWNoZXM7XG5cbiAgICAgICAgICAgICAgICBpZiAodG91Y2hlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3RvdWNoZXNbMF0ucGFnZVgsIHRvdWNoZXNbMF0ucGFnZVldO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gc3RhcnQoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLnRvdWNoZXMgJiYgZS50b3VjaGVzLmxlbmd0aCA+IDEgfHwgZS50YXJnZXRUb3VjaGVzICYmIGUudGFyZ2V0VG91Y2hlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgY29vcmRzID0gZ2V0Q29vcmRzKGUpO1xuICAgICAgICAgICAgICAgIHN0YXJ0WCA9IGNvb3Jkc1swXTtcbiAgICAgICAgICAgICAgICBzdGFydFkgPSBjb29yZHNbMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGFueSB0b3VjaHNjcm9sbCB0aGF0IHJlc3VsdHMgaW4gPiB0b2xlcmFuY2Ugc2hvdWxkIGNhbmNlbCB0aGUgdGFwXG4gICAgICAgICAgICBmdW5jdGlvbiBtb3ZlKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29vcmRzID0gZ2V0Q29vcmRzKGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29vcmRzICYmIChNYXRoLmFicyhzdGFydFkgLSBjb29yZHNbMV0pID4gc2Nyb2xsVG9sZXJhbmNlIHx8IE1hdGguYWJzKHN0YXJ0WCAtIGNvb3Jkc1swXSkgPiBzY3JvbGxUb2xlcmFuY2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlbmQoZSkge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChyZXNldFRpbWVyKTtcbiAgICAgICAgICAgICAgICByZXNldFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdy50YXBIYW5kbGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcblxuICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBubyBtb2RpZmllcnMgYXJlIHByZXNlbnQuIHRoeCBodHRwOi8vd3d3LmphY2tsbW9vcmUuY29tL25vdGVzL2NsaWNrLWV2ZW50cy9cbiAgICAgICAgICAgICAgICBpZiAoKGUud2hpY2ggJiYgZS53aGljaCA+IDEpIHx8IGUuc2hpZnRLZXkgfHwgZS5hbHRLZXkgfHwgZS5tZXRhS2V5IHx8IGUuY3RybEtleSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgLy8gdGhpcyBwYXJ0IHByZXZlbnRzIGEgZG91YmxlIGNhbGxiYWNrIGZyb20gdG91Y2ggYW5kIG1vdXNlIG9uIHRoZSBzYW1lIHRhcFxuXG4gICAgICAgICAgICAgICAgLy8gaWYgYSBzY3JvbGwgaGFwcGVuZWQgYmV0d2VlbiB0b3VjaHN0YXJ0IGFuZCB0b3VjaGVuZFxuICAgICAgICAgICAgICAgIGlmIChjYW5jZWwgfHwgdy50YXBIYW5kbGluZyAmJiB3LnRhcEhhbmRsaW5nICE9PSBlLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3LnRhcEhhbmRsaW5nID0gZS50eXBlO1xuICAgICAgICAgICAgICAgIHRyaWdnZXIoZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRlbFxuICAgICAgICAgICAgICAgIC5iaW5kKFwidG91Y2hzdGFydC50YXBweSBNU1BvaW50ZXJEb3duLnRhcHB5XCIsIHN0YXJ0KVxuICAgICAgICAgICAgICAgIC5iaW5kKFwidG91Y2htb3ZlLnRhcHB5IE1TUG9pbnRlck1vdmUudGFwcHlcIiwgbW92ZSlcbiAgICAgICAgICAgICAgICAuYmluZChcInRvdWNoZW5kLnRhcHB5IE1TUG9pbnRlclVwLnRhcHB5XCIsIGVuZClcbiAgICAgICAgICAgICAgICAuYmluZChcImNsaWNrLnRhcHB5XCIsIGVuZCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgdW50YXAgPSBmdW5jdGlvbigkZWxzKSB7XG4gICAgICAgIHJldHVybiAkZWxzLnVuYmluZChcIi50YXBweVwiKTtcbiAgICB9O1xuXG4gICAgLy8gdXNlIHNwZWNpYWwgZXZlbnRzIGFwaVxuICAgIGlmICgkLmV2ZW50ICYmICQuZXZlbnQuc3BlY2lhbCkge1xuICAgICAgICAkLmV2ZW50LnNwZWNpYWwudGFwID0ge1xuICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihoYW5kbGVPYmopIHtcbiAgICAgICAgICAgICAgICB0YXAoJCh0aGlzKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihoYW5kbGVPYmopIHtcbiAgICAgICAgICAgICAgICB1bnRhcCgkKHRoaXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBtb25rZXliaW5kXG4gICAgICAgIHZhciBvbGRCaW5kID0gJC5mbi5iaW5kLFxuICAgICAgICAgICAgb2xkVW5iaW5kID0gJC5mbi51bmJpbmQ7XG4gICAgICAgICQuZm4uYmluZCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgaWYgKC8oXnwgKXRhcCggfCQpLy50ZXN0KGV2dCkpIHtcbiAgICAgICAgICAgICAgICB0YXAodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2xkQmluZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9O1xuICAgICAgICAkLmZuLnVuYmluZCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgaWYgKC8oXnwgKXRhcCggfCQpLy50ZXN0KGV2dCkpIHtcbiAgICAgICAgICAgICAgICB1bnRhcCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvbGRVbmJpbmQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbn0odGhpcywgalF1ZXJ5KSk7XG5cblxuLy8gQVJSVU1BIEVSUk8gTk8gSUU5IE9OREUgTkFPIEVYSVNURSBXSU5ET1cuQ09OU09MRVxuaWYgKCF3aW5kb3cuY29uc29sZSkge1xuICAgIHZhciBjb25zb2xlID0ge1xuICAgICAgICBsb2c6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgIHdhcm46IGZ1bmN0aW9uKCkge30sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICB0aW1lOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICB0aW1lRW5kOiBmdW5jdGlvbigpIHt9XG4gICAgfVxufVxuXG4vKiBBUlJVTUEgSU5QVVQgTk8gSU9TIFFVRSBOQU8gRlVOQ0lPTkEgRElSRUlUTyAqL1xuLyokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICBpZiAod2luZG93LmlzSU9TKSB7XG4gICAgICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAkKCc6Zm9jdXMnKS5mb2N1cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSk7Ki9cblxudmFyIGdldFhZID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgeCA9IG51bGw7XG4gICAgdmFyIHkgPSBudWxsO1xuXG4gICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQgIT0gbnVsbCAmJiBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXMgIT0gbnVsbCkge1xuICAgICAgICB2YXIgdG91Y2ggPSBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0gfHwgZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXTtcbiAgICAgICAgeCA9IHBhcnNlRmxvYXQodG91Y2gucGFnZVgpO1xuICAgICAgICB5ID0gcGFyc2VGbG9hdCh0b3VjaC5wYWdlWSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgeCA9IHBhcnNlRmxvYXQoZXZlbnQucGFnZVgpO1xuICAgICAgICB5ID0gcGFyc2VGbG9hdChldmVudC5wYWdlWSk7XG4gICAgfVxuXG4gICAgdmFyIHBvcyA9IG5ldyBPYmplY3QoKTtcbiAgICBwb3MueCA9IHg7XG4gICAgcG9zLnkgPSB5O1xuXG4gICAgcmV0dXJuIHBvcztcbn1cblxudmFyIHN1cHBvcnQzZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciByZXQgPSBmYWxzZTtcbiAgICB2YXIgc3VwcG9ydHMzRFRyYW5zZm9ybXMgPSBkb2N1bWVudC5ib2R5LnN0eWxlWyd3ZWJraXRQZXJzcGVjdGl2ZSddICE9PSB1bmRlZmluZWQgfHwgZG9jdW1lbnQuYm9keS5zdHlsZVsnTW96UGVyc3BlY3RpdmUnXSAhPT0gdW5kZWZpbmVkO1xuICAgIGlmIChzdXBwb3J0czNEVHJhbnNmb3Jtcykge1xuICAgICAgICByZXQgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuXG52YXIgZ2V0VHJhbnNmb3JtID0gZnVuY3Rpb24oZWwpIHtcbiAgICB2YXIgcHJvcCA9IFwiXCI7XG5cbiAgICBpZiAoZWwuY3NzKCctd2Via2l0LXRyYW5zZm9ybScpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICBwcm9wID0gZWwuY3NzKCctd2Via2l0LXRyYW5zZm9ybScpO1xuICAgIH0gZWxzZSBpZiAoZWwuY3NzKCd0cmFuc2Zvcm0nKSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcCA9IGVsLmNzcygndHJhbnNmb3JtJyk7XG4gICAgfSBlbHNlIGlmIChlbC5jc3MoJy1tb3otdHJhbnNmb3JtJykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHByb3AgPSBlbC5jc3MoJy1tb3otdHJhbnNmb3JtJyk7XG4gICAgfSBlbHNlIGlmIChlbC5jc3MoJy1tcy10cmFuc2Zvcm0nKSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcCA9IGVsLmNzcygnLW1zLXRyYW5zZm9ybScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbMCwgMCwgMF07XG4gICAgfVxuXG4gICAgdmFyIHJlc3VsdHMgPSBwcm9wLm1hdGNoKC9tYXRyaXgoPzooM2QpXFwoLXswLDF9XFxkKyg/OiwgLXswLDF9XFxkKykqKD86LCAoLXswLDF9XFxkKykpKD86LCAoLXswLDF9XFxkKykpKD86LCAoLXswLDF9XFxkKykpLCAtezAsMX1cXGQrXFwpfFxcKC17MCwxfVxcZCsoPzosIC17MCwxfVxcZCspKig/OiwgKC17MCwxfVxcZCspKSg/OiwgKC17MCwxfVxcZCspKVxcKSkvKTtcblxuICAgIGlmICghcmVzdWx0cylcbiAgICAgICAgcmV0dXJuIFswLCAwLCAwXTtcbiAgICBpZiAocmVzdWx0c1sxXSA9PSAnM2QnKVxuICAgICAgICByZXR1cm4gcmVzdWx0cy5zbGljZSgyLCA1KTtcblxuICAgIHJlc3VsdHMucHVzaCgwKTtcbiAgICByZXR1cm4gcmVzdWx0cy5zbGljZSg1LCA4KTtcbn1cblxudmFyIGdvVG9OZXh0VGFiaW5kZXggPSBmdW5jdGlvbihldmVudCwgb2JqLCBjb21tYW5kKSB7XG4gICAgdmFyIGtleSA9IGV2ZW50LmtleUNvZGUgPyBldmVudC5rZXlDb2RlIDogZXZlbnQud2hpY2g7XG5cbiAgICBpZiAoa2V5ID09IDEzIHx8IGtleSA9PSA5KSB7XG4gICAgICAgIHZhciBmaWNhciA9IHRydWU7XG4gICAgICAgIHZhciByZXQgPSB0cnVlO1xuICAgICAgICB2YXIgdGFiaW5kZXggPSBvYmouYXR0cigndGFiaW5kZXgnKTtcblxuICAgICAgICBpZiAoa2V5ID09IDEzICYmIG9ialswXS5ub2RlTmFtZSA9PSBcIlRFWFRBUkVBXCIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIC8vVmVyaWZpY2EgbyB0YWJpbmRleFxuICAgICAgICAgICAgdmFyIGdvdG9UYWJpbmRleCA9IG9iai5hdHRyKCdnb3RvLXRhYi1pbmRleCcpO1xuICAgICAgICAgICAgdmFyIHN0b3BUYWJpbmRleCA9IG9iai5hdHRyKCdzdG9wLXRhYi1pbmRleCcpO1xuXG4gICAgICAgICAgICAvL1ZhaSBvcGFyYVxuICAgICAgICAgICAgaWYgKHRhYmluZGV4ICYmIHN0b3BUYWJpbmRleCAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgIHRhYmluZGV4ID0gcGFyc2VJbnQodGFiaW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgLy9hdmFuY2EgbyB0YWJpbmRleFxuICAgICAgICAgICAgICAgIGlmIChnb3RvVGFiaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiaW5kZXggPSBnb3RvVGFiaW5kZXg7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiaW5kZXgrKztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL3NlIEV4aXN0aXIgbyBlbGVtZW50byBmb2NhIG5lbGVcbiAgICAgICAgICAgICAgICB2YXIgbmV4dE9iaiA9ICQoJ1t0YWItaW5kZXg9JyArIHRhYmluZGV4ICsgJ10nKTtcblxuICAgICAgICAgICAgICAgIC8vVmVyaWZpY2Egc2UgZW5jb250cm91IHVtIG9iamV0b1xuICAgICAgICAgICAgICAgIGlmIChuZXh0T2JqLmxlbmd0aCA+IDAgJiYgbmV4dE9iai5hdHRyKFwiaXMtZGlzYWJsZWRcIikgIT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmljYXIgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0T2JqWzBdLm5vZGVOYW1lID09IFwiQUJORVItU0VMRUNULVVOREVSTElORVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0T2JqLmZpbmQoXCJzZWxlY3RcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dE9iai5maW5kKFwiW2Rpdi1mb2N1cz10cnVlXVwiKS50cmlnZ2VyKGNvbW1hbmQpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0T2JqLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmVyaWZpY2EgbyBwcm94aW1vIG9iamV0b1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqID0gbmV4dE9iajtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpY2FyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL3JlbW92aWRvIHBhcmEgZnVuY2lvbmFyIG8gZW50ZXJcbiAgICAgICAgICAgICAgICAvL3JldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0b3BUYWJpbmRleCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICBmaWNhciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWNhciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdoaWxlIChmaWNhcik7XG5cbiAgICAgICAgLy9TZSBmb3IgdGFiIGRlaXhhciBmYWxzZVxuICAgICAgICBpZiAoa2V5ID09IDkpIHtcbiAgICAgICAgICAgIHJldCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9yb2RhciBzYWlkYVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cblxufVxuXG52YXIgcmFuZG9tTnVtYmVyID0gZnVuY3Rpb24oKSB7XG4gICAgLy92YXIgcmFuZG9tX2ludGVnZXIgPSBNYXRoLnJhbmRvbSgpKjEwMXwwOyAgICBcbiAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDEwKTtcbn1cblxudmFyIGd1aWQgPSBmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBzNCgpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApXG4gICAgICAgICAgICAudG9TdHJpbmcoMTYpXG4gICAgICAgICAgICAuc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICByZXR1cm4gczQoKSArIHM0KCkgKyAnLScgKyBzNCgpICsgJy0nICsgczQoKSArICctJyArXG4gICAgICAgIHM0KCkgKyAnLScgKyBzNCgpICsgczQoKSArIHM0KCk7XG59XG5cbnZhciBnZW5lcmF0ZUlEID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGd1aWQoKTtcbn1cblxudmFyIHBvaW50ZXJFdmVudFRvWFkgPSBmdW5jdGlvbihlKSB7XG4gICAgdmFyIG91dCA9IHsgeDogMCwgeTogMCB9O1xuICAgIGlmIChlLnR5cGUgPT0gJ3RvdWNoc3RhcnQnIHx8IGUudHlwZSA9PSAndG91Y2htb3ZlJyB8fCBlLnR5cGUgPT0gJ3RvdWNoZW5kJyB8fCBlLnR5cGUgPT0gJ3RvdWNoY2FuY2VsJykge1xuICAgICAgICB2YXIgdG91Y2ggPSBlLm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXSB8fCBlLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF07XG4gICAgICAgIG91dC54ID0gdG91Y2gucGFnZVg7XG4gICAgICAgIG91dC55ID0gdG91Y2gucGFnZVk7XG4gICAgfSBlbHNlIGlmIChlLnR5cGUgPT0gJ21vdXNlZG93bicgfHwgZS50eXBlID09ICdtb3VzZXVwJyB8fCBlLnR5cGUgPT0gJ21vdXNlbW92ZScgfHwgZS50eXBlID09ICdtb3VzZW92ZXInIHx8IGUudHlwZSA9PSAnbW91c2VvdXQnIHx8IGUudHlwZSA9PSAnbW91c2VlbnRlcicgfHwgZS50eXBlID09ICdtb3VzZWxlYXZlJykge1xuICAgICAgICBvdXQueCA9IGUucGFnZVg7XG4gICAgICAgIG91dC55ID0gZS5wYWdlWTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vY29tcG9uZW50LXdyYXBwZXI6IG5vbi1mdW5jdGlvbmFsXG5cbi8vQ3JpYW5kbyBuYW1lc3BhY2UgdXRpbHNcbnZhciBQbWJVdGlscyA9IGZ1bmN0aW9uICgpIHsgfVxuXG5cblBtYlV0aWxzLnByb3RvdHlwZS5yZW1vdmVBY2NlbnQgPSBmdW5jdGlvbiAod29yZCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgbWFwID0ge1xuICAgICAgICBcIsOhXCI6IFwiYVwiLFxuICAgICAgICBcIsOgXCI6IFwiYVwiLFxuICAgICAgICBcIsOiXCI6IFwiYVwiLFxuICAgICAgICBcIsOjXCI6IFwiYVwiLFxuICAgICAgICBcIsOkXCI6IFwiYVwiLFxuICAgICAgICBcIsOBXCI6IFwiQVwiLFxuICAgICAgICBcIsOAXCI6IFwiQVwiLFxuICAgICAgICBcIsOCXCI6IFwiQVwiLFxuICAgICAgICBcIsODXCI6IFwiQVwiLFxuICAgICAgICBcIsOEXCI6IFwiQVwiLFxuICAgICAgICBcIsOpXCI6IFwiZVwiLFxuICAgICAgICBcIsOoXCI6IFwiZVwiLFxuICAgICAgICBcIsOqXCI6IFwiZVwiLFxuICAgICAgICBcIuG6vVwiOiBcImVcIixcbiAgICAgICAgXCLDq1wiOiBcImVcIixcbiAgICAgICAgXCLDiVwiOiBcIkVcIixcbiAgICAgICAgXCLDiFwiOiBcIkVcIixcbiAgICAgICAgXCLDilwiOiBcIkVcIixcbiAgICAgICAgXCLhurxcIjogXCJFXCIsXG4gICAgICAgIFwiw4tcIjogXCJFXCIsXG4gICAgICAgIFwiw61cIjogXCJpXCIsXG4gICAgICAgIFwiw6xcIjogXCJpXCIsXG4gICAgICAgIFwiw65cIjogXCJpXCIsXG4gICAgICAgIFwixKlcIjogXCJpXCIsXG4gICAgICAgIFwiw69cIjogXCJpXCIsXG4gICAgICAgIFwiw41cIjogXCJJXCIsXG4gICAgICAgIFwiw4xcIjogXCJJXCIsXG4gICAgICAgIFwiw45cIjogXCJJXCIsXG4gICAgICAgIFwixKhcIjogXCJJXCIsXG4gICAgICAgIFwiw49cIjogXCJJXCIsXG4gICAgICAgIFwiw7NcIjogXCJvXCIsXG4gICAgICAgIFwiw7JcIjogXCJvXCIsXG4gICAgICAgIFwiw7RcIjogXCJvXCIsXG4gICAgICAgIFwiw7VcIjogXCJvXCIsXG4gICAgICAgIFwiw7ZcIjogXCJvXCIsXG4gICAgICAgIFwiw5NcIjogXCJPXCIsXG4gICAgICAgIFwiw5JcIjogXCJPXCIsXG4gICAgICAgIFwiw5RcIjogXCJPXCIsXG4gICAgICAgIFwiw5VcIjogXCJPXCIsXG4gICAgICAgIFwiw5ZcIjogXCJPXCIsXG4gICAgICAgIFwiw7pcIjogXCJ1XCIsXG4gICAgICAgIFwiw7lcIjogXCJ1XCIsXG4gICAgICAgIFwiw7tcIjogXCJ1XCIsXG4gICAgICAgIFwixalcIjogXCJ1XCIsXG4gICAgICAgIFwiw7xcIjogXCJ1XCIsXG4gICAgICAgIFwiw5pcIjogXCJVXCIsXG4gICAgICAgIFwiw5lcIjogXCJVXCIsXG4gICAgICAgIFwiw5tcIjogXCJVXCIsXG4gICAgICAgIFwixahcIjogXCJVXCIsXG4gICAgICAgIFwiw5xcIjogXCJVXCIsXG4gICAgICAgIFwiw71cIjogXCJ5XCIsXG4gICAgICAgIFwi4buzXCI6IFwieVwiLFxuICAgICAgICBcIsW3XCI6IFwieVwiLFxuICAgICAgICBcIuG7uVwiOiBcInlcIixcbiAgICAgICAgXCLDv1wiOiBcInlcIixcbiAgICAgICAgXCLDnVwiOiBcIllcIixcbiAgICAgICAgXCLhu7JcIjogXCJZXCIsXG4gICAgICAgIFwixbZcIjogXCJZXCIsXG4gICAgICAgIFwi4bu4XCI6IFwiWVwiLFxuICAgICAgICBcIsW4XCI6IFwiWVwiLFxuICAgICAgICBcIsOxXCI6IFwiblwiLFxuICAgICAgICBcIsORXCI6IFwiblwiLFxuICAgICAgICBcIsOHXCI6IFwiY1wiLFxuICAgICAgICBcIsOnXCI6IFwiY1wiXG4gICAgfTtcblxuICAgIGlmICh3b3JkICE9IFwiXCIpIHtcbiAgICAgICAgcmV0dXJuIHdvcmQucmVwbGFjZSgvW8Ogw6jDrMOyw7nDgMOIw4zDksOZw6HDqcOtw7PDusO9w4HDicONw5PDmsOdw6LDqsOuw7TDu8OCw4rDjsOUw5vDo+G6vcSpxanDscO1w4PhurzEqMWow5HDlcOkw6vDr8O2w7zDv8OEw4vDj8OWw5zFuMOHw6ddL2csIGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICAgICAgcmV0dXJuIG1hcFttYXRjaF07XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuLy9QRWdhIHZhcmlhdmVpcyBkYSBVUkxcblBtYlV0aWxzLnByb3RvdHlwZS5nZXRVcmxWYXJzID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB2YXJzID0gbmV3IE9iamVjdCgpLFxuICAgICAgICBoYXNoO1xuICAgIHZhciBoYXNoZXMgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zbGljZSh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCc/JykgKyAxKS5zcGxpdCgnJicpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFzaGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGhhc2ggPSBoYXNoZXNbaV0uc3BsaXQoJz0nKTtcbiAgICAgICAgdmFyc1toYXNoWzBdXSA9IGhhc2hbMV07XG4gICAgfVxuICAgIHJldHVybiB2YXJzO1xufVxuXG4vL0RldGVybWluYSBzZSDDqSBtb2RvIGFkYXB0YXRpdm8gXG5QbWJVdGlscy5wcm90b3R5cGUuc2hvd0JpZ1NjcmVlbiA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICBpZiAocGFyc2VJbnQob2JqLm91dGVyV2lkdGgoKSkgPj0gMTAyNCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG5QbWJVdGlscy5wcm90b3R5cGUuZ2V0Q2hlY2tlZFJhZGlvID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICBpZiAobmFtZSkge1xuICAgICAgICByZXR1cm4gJChcImlucHV0W3R5cGU9cmFkaW9dW25hbWU9XCIgKyBuYW1lICsgXCJdOmNoZWNrZWRcIikucGFyZW50KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICQoXCJpbnB1dFt0eXBlPXJhZGlvXTpjaGVja2VkXCIpLnBhcmVudCgpO1xuICAgIH1cbn1cblxuUG1iVXRpbHMucHJvdG90eXBlLmdldFBob25lQXNPYmplY3QgPSBmdW5jdGlvbiAocGhvbmUpIHtcblxuICAgIHZhciBwaG9uZU9iaiA9IHtcbiAgICAgICAgZGRpOiBcIlwiLFxuICAgICAgICBkZGQ6IFwiXCIsXG4gICAgICAgIHBob25lOiBwaG9uZVxuICAgIH07XG5cbiAgICBwaG9uZSA9IHBob25lID8gcGhvbmUucmVwbGFjZSgvXFxEKy9nLCAnJykgOiBwaG9uZTtcblxuICAgIGlmIChwaG9uZSAmJiBwaG9uZS5sZW5ndGggPiAxMSkge1xuICAgICAgICBwaG9uZU9iai5kZGkgPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezJ9KShcXGR7OCw5fSkkL2csIFwiXFwkMVwiKTtcbiAgICAgICAgcGhvbmVPYmouZGRkID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHsyfSkoXFxkezgsOX0pJC9nLCBcIlxcJDJcIik7XG4gICAgICAgIHBob25lT2JqLnBob25lID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHsyfSkoXFxkezgsOX0pJC9nLCBcIlxcJDNcIik7XG4gICAgfSBlbHNlIGlmIChwaG9uZSAmJiBwaG9uZS5sZW5ndGggPiA5KSB7XG4gICAgICAgIHBob25lT2JqLmRkZCA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7OCw5fSkkL2csIFwiXFwkMVwiKTtcbiAgICAgICAgcGhvbmVPYmoucGhvbmUgPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezgsOX0pJC9nLCBcIlxcJDJcIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBob25lT2JqO1xufVxuXG5QbWJVdGlscy5wcm90b3R5cGUuZm9ybWF0UGhvbmUgPSBmdW5jdGlvbiAocGhvbmUpIHtcblxuICAgIHZhciBwaG9uZVJldHVybiA9IHBob25lLnJlcGxhY2UoL1teMC05XS9nLCAnJyk7XG5cbiAgICBpZiAocGhvbmUgJiYgcGhvbmUubGVuZ3RoID4gMTEpIHtcbiAgICAgICAgcGhvbmVSZXR1cm4gPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezJ9KShcXGR7NCw1fSkoXFxkezR9KSQvZywgXCJcXCskMSBcXCgkMikgXFwkMyBcXCQ0XCIpO1xuICAgIH0gZWxzZSBpZiAocGhvbmUgJiYgcGhvbmUubGVuZ3RoID4gOSkge1xuICAgICAgICBwaG9uZVJldHVybiA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7NCw1fSkoXFxkezR9KSQvZywgXCJcXCgkMSkgXFwkMiBcXCQzXCIpO1xuICAgIH07XG5cbiAgICByZXR1cm4gcGhvbmVSZXR1cm47XG59XG5cblBtYlV0aWxzLnByb3RvdHlwZS5yZW1vdmVDcGZDbnBqRm9ybWF0ID0gZnVuY3Rpb24gKHZhbG9yLCB0eXBlKSB7XG5cbiAgICBpZiAodmFsb3IpIHtcbiAgICAgICAgLy9yZW1vdmUgcG9udG8gZSB2aXJndWxhXG4gICAgICAgIHZhbG9yID0gdmFsb3IucmVwbGFjZShuZXcgUmVnRXhwKC9bXlxcZF0vZyksIFwiXCIpO1xuXG4gICAgICAgIGlmICh0eXBlID09IFwiQ05QSlwiKSB7XG4gICAgICAgICAgICB2YXIgbGVuID0gMTQ7XG4gICAgICAgICAgICB2YXIgcGFkID0gXCIwMDAwMDAwMDAwMFwiO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJDUEZcIikge1xuICAgICAgICAgICAgdmFyIGxlbiA9IDExO1xuICAgICAgICAgICAgdmFyIHBhZCA9IFwiMDAwMDAwMDAwMDBcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy90cmFuc2Zvcm1hIHBhcmEgbnVtZXJvXG4gICAgICAgIHZhbG9yID0gcGFyc2VJbnQodmFsb3IpO1xuXG4gICAgICAgIC8vc2UgZm9yIG1haW9yIHF1ZSBvIHZhbG9yIGRlZmluZG8gcGFyYSBsZW4gZWxlIGNvcnRhXG4gICAgICAgIGlmICh2YWxvci5sZW5ndGggPiBsZW4pIHtcbiAgICAgICAgICAgIHZhbG9yID0gdmFsb3Iuc3Vic3RyaW5nKDAsIGxlbik7XG4gICAgICAgIH1cblxuICAgICAgICAvL1NlIG9jb3JyZSBhbGd1bSBlcnJvLCBkZWl4YXIgdmF6aW9cbiAgICAgICAgaWYgKGlzTmFOKHZhbG9yKSkge1xuICAgICAgICAgICAgdmFsb3IgPSBcIlwiO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWxvciA9IHBhZC5zdWJzdHJpbmcoMCwgcGFkLmxlbmd0aCAtIHZhbG9yLmxlbmd0aCkgKyB2YWxvcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFsb3I7XG59XG5cblBtYlV0aWxzLnByb3RvdHlwZS52YWxpZGFyQ05QSiA9IGZ1bmN0aW9uIChjbnBqKSB7XG5cbiAgICBjbnBqID0gY25wai5yZXBsYWNlKC9bXlxcZF0rL2csICcnKTtcbiAgICBcbiAgICBpZiAoY25waiA9PSBcIjBcIiB8fFxuICAgICAgICBjbnBqID09IFwiMDAwMDAwMDAwMDAwMDBcIiB8fFxuICAgICAgICBjbnBqID09IFwiMTExMTExMTExMTExMTFcIiB8fFxuICAgICAgICBjbnBqID09IFwiMjIyMjIyMjIyMjIyMjJcIiB8fFxuICAgICAgICBjbnBqID09IFwiMzMzMzMzMzMzMzMzMzNcIiB8fFxuICAgICAgICBjbnBqID09IFwiNDQ0NDQ0NDQ0NDQ0NDRcIiB8fFxuICAgICAgICBjbnBqID09IFwiNTU1NTU1NTU1NTU1NTVcIiB8fFxuICAgICAgICBjbnBqID09IFwiNjY2NjY2NjY2NjY2NjZcIiB8fFxuICAgICAgICBjbnBqID09IFwiNzc3Nzc3Nzc3Nzc3NzdcIiB8fFxuICAgICAgICBjbnBqID09IFwiODg4ODg4ODg4ODg4ODhcIiB8fFxuICAgICAgICBjbnBqID09IFwiOTk5OTk5OTk5OTk5OTlcIikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhIERWc1xuICAgIHZhciB0YW1hbmhvID0gY25wai5sZW5ndGggLSAyXG4gICAgdmFyIG51bWVyb3MgPSBjbnBqLnN1YnN0cmluZygwLCB0YW1hbmhvKTtcbiAgICB2YXIgZGlnaXRvcyA9IGNucGouc3Vic3RyaW5nKHRhbWFuaG8pO1xuICAgIHZhciBzb21hID0gMDtcbiAgICB2YXIgcG9zID0gdGFtYW5obyAtIDc7XG4gICAgdmFyIGkgPSB0YW1hbmhvO1xuXG4gICAgZm9yIChpID0gdGFtYW5obzsgaSA+PSAxOyBpLS0pIHtcbiAgICAgICAgc29tYSArPSBudW1lcm9zLmNoYXJBdCh0YW1hbmhvIC0gaSkgKiBwb3MtLTtcbiAgICAgICAgaWYgKHBvcyA8IDIpXG4gICAgICAgICAgICBwb3MgPSA5O1xuICAgIH1cbiAgICB2YXIgcmVzdWx0YWRvID0gc29tYSAlIDExIDwgMiA/IDAgOiAxMSAtIHNvbWEgJSAxMTtcbiAgICBpZiAocmVzdWx0YWRvICE9IGRpZ2l0b3MuY2hhckF0KDApKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB0YW1hbmhvID0gdGFtYW5obyArIDE7XG4gICAgbnVtZXJvcyA9IGNucGouc3Vic3RyaW5nKDAsIHRhbWFuaG8pO1xuICAgIHNvbWEgPSAwO1xuICAgIHBvcyA9IHRhbWFuaG8gLSA3O1xuICAgIGZvciAoaSA9IHRhbWFuaG87IGkgPj0gMTsgaS0tKSB7XG4gICAgICAgIHNvbWEgKz0gbnVtZXJvcy5jaGFyQXQodGFtYW5obyAtIGkpICogcG9zLS07XG4gICAgICAgIGlmIChwb3MgPCAyKVxuICAgICAgICAgICAgcG9zID0gOTtcbiAgICB9XG5cbiAgICByZXN1bHRhZG8gPSBzb21hICUgMTEgPCAyID8gMCA6IDExIC0gc29tYSAlIDExO1xuXG4gICAgaWYgKHJlc3VsdGFkbyAhPSBkaWdpdG9zLmNoYXJBdCgxKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59XG5cbi8vdmFsaWRhIG8gQ1BGIGRpZ2l0YWRvXG5QbWJVdGlscy5wcm90b3R5cGUudmFsaWRhckNQRiA9IGZ1bmN0aW9uKGNwZikge1xuXG4gICAgdmFyIGV4cCA9IC9cXC58XFwtL2dcbiAgICBjcGYgPSBjcGYudG9TdHJpbmcoKS5yZXBsYWNlKGV4cCwgXCJcIik7XG4gICAgaWYgKGNwZi5sZW5ndGggPCAxMSkge1xuICAgICAgICB2YXIgcGFkID0gXCIwMDAwMDAwMDAwMFwiO1xuICAgICAgICBjcGYgPSBwYWQuc3Vic3RyaW5nKDAsIHBhZC5sZW5ndGggLSBjcGYubGVuZ3RoKSArIGNwZjtcbiAgICB9XG5cbiAgICBpZiAoY3BmID09IFwiMFwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjAwMDAwMDAwMDAwXCIgfHxcbiAgICAgICAgY3BmID09IFwiMTExMTExMTExMTFcIiB8fFxuICAgICAgICBjcGYgPT0gXCIyMjIyMjIyMjIyMlwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjMzMzMzMzMzMzMzXCIgfHxcbiAgICAgICAgY3BmID09IFwiNDQ0NDQ0NDQ0NDRcIiB8fFxuICAgICAgICBjcGYgPT0gXCI1NTU1NTU1NTU1NVwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjY2NjY2NjY2NjY2XCIgfHxcbiAgICAgICAgY3BmID09IFwiNzc3Nzc3Nzc3NzdcIiB8fFxuICAgICAgICBjcGYgPT0gXCI4ODg4ODg4ODg4OFwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjk5OTk5OTk5OTk5XCIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHZhciBzb21hO1xuICAgIHZhciByZXN0bztcbiAgICBzb21hID0gMDtcblxuICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IDk7IGkrKykge1xuICAgICAgICBzb21hID0gc29tYSArIHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoaSAtIDEsIGkpKSAqICgxMSAtIGkpO1xuICAgIH1cblxuICAgIHJlc3RvID0gKHNvbWEgKiAxMCkgJSAxMTtcblxuICAgIGlmICgocmVzdG8gPT0gMTApIHx8IChyZXN0byA9PSAxMSkpIHtcbiAgICAgICAgcmVzdG8gPSAwO1xuICAgIH1cbiAgICBpZiAocmVzdG8gIT0gcGFyc2VJbnQoY3BmLnN1YnN0cmluZyg5LCAxMCkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBzb21hID0gMDtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8PSAxMDsgaSsrKSB7XG4gICAgICAgIHNvbWEgPSBzb21hICsgcGFyc2VJbnQoY3BmLnN1YnN0cmluZyhpIC0gMSwgaSkpICogKDEyIC0gaSk7XG4gICAgfVxuICAgIHJlc3RvID0gKHNvbWEgKiAxMCkgJSAxMTtcblxuICAgIGlmICgocmVzdG8gPT0gMTApIHx8IChyZXN0byA9PSAxMSkpIHtcbiAgICAgICAgcmVzdG8gPSAwO1xuICAgIH1cbiAgICBpZiAocmVzdG8gIT0gcGFyc2VJbnQoY3BmLnN1YnN0cmluZygxMCwgMTEpKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuXG5QbWJVdGlscy5wcm90b3R5cGUudmFsaWRhckVNQUlMID0gZnVuY3Rpb24oZW1haWwpIHtcbiAgICB2YXIgZW1haWxWYWxpZGF0aW9uID0gZW1haWwubWF0Y2goL15bYS16QS1aMC05Ll8tXStAW2EtekEtWjAtOS5fLV0rXFwuW2EtekEtWjAtOS5fLV0rJC8pO1xuXG4gICAgaWYgKGVtYWlsID09IGVtYWlsVmFsaWRhdGlvbikge1xuICAgICAgICByZXR1cm4gZW1haWxWYWxpZGF0aW9uO1xuICAgIH1cbn1cblxuLy9GdW5jb2VzIHV0ZWlzIGRlIHVzbyBkbyBKUVVFUllcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdXZWJDb21wb25lbnRzUmVhZHknLCBmdW5jdGlvbiAoKSB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImh0bWxcIikuY2xhc3NMaXN0LmFkZChcImh0bWwtcGFnZS1sb2FkZWRcIik7XG59KTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICQuZm4uc2V0Q3Vyc29yUG9zaXRpb24gPSBmdW5jdGlvbiAocG9zKSB7XG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW0pIHtcbiAgICAgICAgICAgIGlmIChlbGVtLnNldFNlbGVjdGlvblJhbmdlKSB7XG4gICAgICAgICAgICAgICAgZWxlbS5zZXRTZWxlY3Rpb25SYW5nZShwb3MsIHBvcyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0uY3JlYXRlVGV4dFJhbmdlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gZWxlbS5jcmVhdGVUZXh0UmFuZ2UoKTtcbiAgICAgICAgICAgICAgICByYW5nZS5jb2xsYXBzZSh0cnVlKTtcbiAgICAgICAgICAgICAgICByYW5nZS5tb3ZlRW5kKCdjaGFyYWN0ZXInLCBwb3MpO1xuICAgICAgICAgICAgICAgIHJhbmdlLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgcG9zKTtcbiAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICAkLmZuLnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY2hhbmdlID0gbnVsbDtcbiAgICAgICAgdmFyIHRhZyA9IG5ldyBTdHJpbmcoKTtcbiAgICAgICAgLy9UcmF0YW1lbnRvXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRhZyArPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuICAgICAgICAgICAgaWYgKHRhZykge1xuICAgICAgICAgICAgICAgIHRhZyA9IHRhZy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwib25jaGFuZ2VcIikpIHtcbiAgICAgICAgICAgIGNoYW5nZSA9ICQodGhpcykuYXR0cihcIm9uY2hhbmdlXCIpO1xuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVBdHRyKFwib25jaGFuZ2VcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL3RpcmEgbyBmb2NvIGRlIHF1YWxxdWVyIGVsZW1lbnRvXG4gICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgICAgICAkKHdpbmRvdykuZm9jdXMoKTtcblxuICAgICAgICBpZiAoY2hhbmdlICE9IG51bGwpIHtcbiAgICAgICAgICAgICQodGhpcykuYXR0cihcIm9uY2hhbmdlXCIsIGNoYW5nZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL3NlIG91dmVyIHVtIGVycm8gdmFsaWRhY2FvIGVzdGEgaW5jb3JyZXRhXG4gICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJlcnJvclwiKSAmJiAkKHRoaXMpLmF0dHIoXCJlcnJvclwiKSAhPSBcIlwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkLmZuLnNldEZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJpbnB1dFwiKS5mb2N1cygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkLmZuLnJlbW92ZUZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkLmZuLmdldFRleHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gbnVsbDtcbiAgICAgICAgdmFyIHRhZyA9IG5ldyBTdHJpbmcoKTtcbiAgICAgICAgLy9UcmF0YW1lbnRvXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRhZyArPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuICAgICAgICAgICAgaWYgKHRhZykge1xuICAgICAgICAgICAgICAgIHRhZyA9IHRhZy50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVFwiKSA/IFwiQUItSU5QVVRcIiA6IHRhZy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHZhciB0YWdzQWNlaXRhcyA9IFtcIkFCLVRFWFQtUkVBRC1PTkxZXCIsIFwiQUItVEVYVC1BUkVBLVVOREVSTElORVwiLCBcIkFCLVNFTEVDVC1VTkRFUkxJTkVcIiwgXCJBQi1JTlBVVFwiXTtcbiAgICAgICAgICAgICAgICBpZiAodGFnc0FjZWl0YXMuaW5kZXhPZih0YWcpID09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdmFyIHRleHRBcnJheSA9IG5ldyBBcnJheSgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCByYWRpbyBvZiB0aGlzKSB7XG4gICAgICAgICAgICAgICAgdGV4dEFycmF5LnB1c2gocmFkaW8uZ2V0VGV4dCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRleHQgPSB0ZXh0QXJyYXk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0ZXh0ID0gdGhpc1swXS5nZXRUZXh0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfTtcblxuICAgICQuZm4uc2V0VGV4dCA9IGZ1bmN0aW9uICh0ZXh0LCBjYW5jZWwpIHtcbiAgICAgICAgdmFyIHRhZyA9IG5ldyBTdHJpbmcoKTtcblxuICAgICAgICAvL1RyYXRhbWVudG9cbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGFnICs9ICQodGhpcylbMF0ubm9kZU5hbWU7XG4gICAgICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICAgICAgdGFnID0gdGFnLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0YWcgPT0gXCJBQi1URVhULVJFQUQtT05MWVwiKSB7XG4gICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULURBVEVcIikpIHtcbiAgICAgICAgICAgIHRoaXNbMF0uc2V0VGV4dCh0ZXh0KTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVRcIikpIHtcbiAgICAgICAgICAgIHRoaXNbMF0uc2V0VGV4dCh0ZXh0KTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZyA9PSBcIkFCLVRFWFQtQVJFQS1VTkRFUkxJTkVcIikge1xuICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1TRUxFQ1RcIikpIHtcbiAgICAgICAgICAgIGlmIChjYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJzZWxlY3RcIikudmFsKHRleHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJzZWxlY3RcIikudmFsKHRleHQpLmNoYW5nZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9zYWx2YSB2YWxvclxuICAgICAgICBpZiAoIXRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtQ0hFQ0tCT1hcIikpIHtcbiAgICAgICAgICAgICQodGhpcykuYXR0cihcImxvYWRlZC12YWx1ZVwiLCAkKHRoaXMpLmdldFRleHQoKSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvL2Z1bmNhbyBwYXJhIGNvcnJpZ2lyIG8gZGF0YVxuICAgICQuZm4uZ2V0TnVtYmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdGV4dCA9IG51bGw7XG4gICAgICAgIHZhciB0YWcgPSBuZXcgU3RyaW5nKCk7XG4gICAgICAgIC8vVHJhdGFtZW50b1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWcgKz0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRhZyA9PSBcIkFCLVRFWFQtUkVBRC1PTkxZXCIpIHtcbiAgICAgICAgICAgIHRleHQgPSB0aGlzWzBdLmdldFRleHQoKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtQ0hFQ0tCT1hcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSB0aGlzWzBdLmdldE51bWJlcigpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1SQURJT1wiKSkge1xuICAgICAgICAgICAgdGV4dCA9IHRoaXNbMF0uZ2V0TnVtYmVyKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULVNXSVRDSFwiKSkge1xuICAgICAgICAgICAgdGV4dCA9IHRoaXNbMF0uZ2V0TnVtYmVyKCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULVRJTUVcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJpbnB1dFwiKS52YWwoKSArIFwiMDBcIjtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtTlVNQkVSXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwiaW5wdXRcIikudmFsKCk7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAoL1teXFxkXS9nKSwgXCJcIik7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULURBVEVcIikpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuaXNJT1MgfHwgd2luZG93LmlzQW5kcm9pZCkge1xuICAgICAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoOCwgMTApICsgXCJcIiArIHRleHQuc3Vic3RyaW5nKDUsIDcpICsgXCJcIiArIHRleHQuc3Vic3RyaW5nKDAsIDQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwiaW5wdXRcIikudmFsKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVUXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwiaW5wdXRcIikudmFsKCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVRFWFQtQVJFQS1VTkRFUkxJTkVcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJ0ZXh0YXJlYVwiKS52YWwoKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItU0VMRUNUXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gcGFyc2VJbnQoJCh0aGlzKS5nZXRPYmplY3QoKS52YWxvcik7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVFVRVNUSU9OXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5hdHRyKFwiYW5zd2VyXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRleHQgJiYgdGFnICE9IFwiQUItU0VMRUNULVVOREVSTElORVwiKSB7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAoL1teXFxkXFwsXS9nKSwgXCJcIik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICB9O1xuXG4gICAgLy9mdW5jYW8gcGFyYSBjb3JyaWdpciBvIGRhdGFcbiAgICAkLmZuLnNldE51bWJlciA9IGZ1bmN0aW9uICh0ZXh0LCBjYW5jZWwpIHtcbiAgICAgICAgdmFyIHRhZyA9IG5ldyBTdHJpbmcoKTtcbiAgICAgICAgLy9UcmF0YW1lbnRvXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRhZyArPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuICAgICAgICAgICAgaWYgKHRhZykge1xuICAgICAgICAgICAgICAgIHRhZyA9IHRhZy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGV4dCB8fCB0ZXh0ID09IDApIHtcbiAgICAgICAgICAgIC8vTmVjZXNzYXJpbyBzZXIgc3RyaW5nIHBhcmEgcmVnZXhcbiAgICAgICAgICAgIHRleHQgKz0gXCJcIjtcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobmV3IFJlZ0V4cCgvW15cXGQtXFwsXS9nKSwgXCJcIik7XG5cbiAgICAgICAgICAgIGlmICh0YWcgPT0gXCJBQi1URVhULVJFQUQtT05MWVwiKSB7XG4gICAgICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtQ0hFQ0tCT1hcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldE51bWJlcih0ZXh0KTtcblxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImxvYWRlZC12YWx1ZVwiLCAkKHRoaXMpLmF0dHIoXCJpcy1jaGVja2VkXCIpKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULVJBRElPXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpc1swXS5zZXROdW1iZXIodGV4dCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1TV0lUQ0hcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldE51bWJlcih0ZXh0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULURBVEVcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXNbMF0uc2V0TnVtYmVyKHRleHQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItU0VMRUNUXCIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXNbMF0uc2VsZWN0KS52YWwodGV4dCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzWzBdLnNlbGVjdCkudmFsKHRleHQpLmNoYW5nZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9zYWx2YSB2YWxvclxuICAgICAgICAgICAgaWYgKCF0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULUNIRUNLQk9YXCIpKSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwibG9hZGVkLXZhbHVlXCIsICQodGhpcykuZ2V0VGV4dCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkLmZuLnNldE9sZFZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnNldFRleHQoJCh0aGlzKS5hdHRyKFwibG9hZGVkLXZhbHVlXCIpKTtcbiAgICB9O1xuXG4gICAgJC5mbi5pc0NoYW5nZWQgPSBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgIHZhciBsb2FkZWRWYWx1ZSA9ICQodGhpcykuYXR0cihcImxvYWRlZC12YWx1ZVwiKTtcbiAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9ICQodGhpcykuZ2V0VGV4dCgpO1xuXG4gICAgICAgIGlmIChsb2FkZWRWYWx1ZSB8fCBjdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChsb2FkZWRWYWx1ZSAhPT0gY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZm4uc2V0T2JqZWN0ID0gZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICB2YXIgdGFnID0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItU0VMRUNUXCIpKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJzZWxlY3RcIikudmFsKHZhbCkuY2hhbmdlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkLmZuLmdldE9iamVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGJlYW4gPSBuZXcgT2JqZWN0KCk7XG5cbiAgICAgICAgaWYgKCh0aGlzKVswXSkge1xuICAgICAgICAgICAgdmFyIHRhZyA9ICQodGhpcylbMF0ubm9kZU5hbWU7XG5cbiAgICAgICAgICAgIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVNFTEVDVFwiKSkge1xuICAgICAgICAgICAgICAgIGJlYW4ubm9tZSA9ICQodGhpcykuZmluZChcInNlbGVjdCBvcHRpb246c2VsZWN0ZWRcIikudGV4dCgpO1xuICAgICAgICAgICAgICAgIGJlYW4udmFsb3IgPSAkKHRoaXMpLmZpbmQoXCJzZWxlY3Qgb3B0aW9uOnNlbGVjdGVkXCIpLmF0dHIoXCJ2YWx1ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBiZWFuO1xuICAgIH1cblxuXG4gICAgLy9BdmlzYXIgbm9zc29zIGNvbXBvbmVudGVzIHF1YW5kbyB0ZXZlIHVtYSBhbHRlcmFjYW9cbiAgICB2YXIgb3JpZ0FwcGVuZCA9ICQuZm4uYXBwZW5kO1xuICAgICQuZm4uYXBwZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcyhcImFiLWNvbnRhaW5lci1jb250ZW50XCIpICYmIGFyZ3VtZW50c1swXS5oYXNDbGFzcyhcImFiLWJsb2NrXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gb3JpZ0FwcGVuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLnRyaWdnZXIoXCJhcHBlbmRcIik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy9mdW7Dp8OjbyBwYXJhIHJldG9ybmFyIHNlIG8gY2FtcG8gZXNyw6EgY29tIGVycm8gb3UgbsOjb1xuICAgICQuZm4uaGFzRXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJlcnJvclwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuXG4vL2Z1bsOnw6NvIHBhcmEgYXJydW1hciBidWcgbm8gaU9TIDhcbmlmICghU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoKSB7XG4gICAgU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoID0gZnVuY3Rpb24gKHNlYXJjaFN0cmluZywgcG9zaXRpb24pIHtcbiAgICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbiB8fCAwO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleE9mKHNlYXJjaFN0cmluZywgcG9zaXRpb24pID09PSBwb3NpdGlvbjtcbiAgICB9O1xufVxuXG5TdHJpbmcucHJvdG90eXBlLnRvVXBwZXJPbmx5Rmlyc3RMZXR0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG5cbiAgICB2YXIgd29yZE1hcCA9IHtcbiAgICAgICAgXCJyZ1wiOiBcIlJHXCIsXG4gICAgICAgIFwiY3BmXCI6IFwiQ1BGXCIsXG4gICAgICAgIFwiY25walwiOiBcIkNOUEpcIixcbiAgICAgICAgXCJybmVcIjogXCJSTkVcIixcbiAgICAgICAgXCJjZXBcIjogXCJDRVBcIixcbiAgICAgICAgXCJjbmhcIjogXCJDTkhcIixcbiAgICAgICAgXCJzLmEuXCI6IFwiUy5BLlwiXG4gICAgfTtcblxuICAgIGlmIChzdHIgJiYgc3RyLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH0gZWxzZSBpZiAoc3RyICYmIHN0ci5sZW5ndGggPT0gMSkge1xuICAgICAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKClcbiAgICB9IGVsc2UgaWYgKHN0ciAmJiBzdHIubGVuZ3RoID4gMSkge1xuICAgICAgICBzdHIgPSBzdHIuc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBzdHIuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiBzdHIgPSBzdHIucmVwbGFjZSgvXFxiKHJnfGNwZnxjbnBqfHJuZXxjZXB8Y25oKVxcYnxzXFwuYVxcLi9naSwgZnVuY3Rpb24gKHdvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB3b3JkTWFwW3dvcmQudG9Mb3dlckNhc2UoKV07XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbn1cblxuU3RyaW5nLnByb3RvdHlwZS50b0NhbWVsQ2FzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc3RyID0gdGhpcy50b0xvd2VyQ2FzZSgpO1xuXG4gICAgdmFyIHdvcmRzQXJyYXkgPSBbXCJkZVwiLCBcInNlbVwiLCBcIm9cIiwgXCJkb1wiLCBcImRhXCJdO1xuXG4gICAgdmFyIHdvcmRzID0gc3RyLnNwbGl0KFwiIFwiKTtcblxuICAgIHZhciBmdWxsU3RyaW5nID0gbmV3IFN0cmluZygpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAod29yZHNBcnJheS5pbmRleE9mKHdvcmRzW2ldKSA9PSAtMSAmJiB3b3Jkc1tpXS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB3b3Jkc1tpXSA9IHdvcmRzW2ldLnRvVXBwZXJPbmx5Rmlyc3RMZXR0ZXIoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgZnVsbFN0cmluZyA9IHdvcmRzLmpvaW4oXCIgXCIpXG5cbiAgICByZXR1cm4gZnVsbFN0cmluZztcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXRQZXJjZW50ID0gZnVuY3Rpb24oZGVjaW1hbHMsIGludGVnZXJzKSB7XG4gICAgdmFyIHRtcCA9IHRoaXM7XG4gICAgdmFyIGRlYyA9IFwiMVwiO1xuICAgIHZhciBmb3JtYXREZWNpbWFsID0gMDtcbiAgICB2YXIgbmVnYXRpdmVDaGVjayA9IGZhbHNlO1xuXG4gICAgaWYgKHRtcC5zdWJzdHJpbmcoMCwgMSkgPT0gXCItXCIpIHtcbiAgICAgICAgbmVnYXRpdmVDaGVjayA9IHRydWU7XG4gICAgICAgIHRtcCA9IHRtcC5zdWJzdHJpbmcoMSwgdG1wLmxlbmd0aCk7XG4gICAgfTtcblxuICAgIGlmIChkZWNpbWFscykge1xuICAgICAgICBkZWMgPSBkZWMucnBhZChcIjBcIiwgcGFyc2VJbnQoZGVjaW1hbHMpICsgMSk7XG4gICAgICAgIGZvcm1hdERlY2ltYWwgPSBwYXJzZUludChkZWNpbWFscyk7XG4gICAgfVxuICAgIGRlYyA9IHBhcnNlSW50KGRlYyk7XG5cbiAgICBpZiAoKHRtcCAmJiBwYXJzZUludCh0bXApID09IDApIHx8IHRtcCA9PSBcIlwiIHx8IHRtcCA9PSB1bmRlZmluZWQgfHwgaXNOYU4ocGFyc2VJbnQodG1wKSkpIHtcbiAgICAgICAgdG1wID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0bXAgPSBwYXJzZUZsb2F0KHRtcCkgLyBkZWM7XG4gICAgfVxuXG4gICAgaWYgKG5lZ2F0aXZlQ2hlY2spIHtcbiAgICAgICAgdG1wID0gdG1wICogLTE7XG4gICAgfVxuXG4gICAgdmFyIG9wdGlvbiA9IHtcbiAgICAgICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiBmb3JtYXREZWNpbWFsLFxuICAgICAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IGZvcm1hdERlY2ltYWxcbiAgICB9O1xuXG4gICAgdG1wID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KCdwdC1CUicsIG9wdGlvbikuZm9ybWF0KHRtcCk7XG5cbiAgICByZXR1cm4gdG1wO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdEN1cnJlbmN5ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0bXAgPSB0aGlzO1xuICAgIHZhciBuZWdhdGl2ZUNoZWNrID0gZmFsc2U7XG5cbiAgICBpZiAodG1wLnN1YnN0cmluZygwLCAxKSA9PSBcIi1cIikge1xuICAgICAgICBuZWdhdGl2ZUNoZWNrID0gdHJ1ZTtcbiAgICAgICAgdG1wID0gdG1wLnN1YnN0cmluZygxLCB0bXAubGVuZ3RoKTtcbiAgICB9O1xuXG4gICAgLy9yZW1vdmUgemVyb3MgYSBlc3F1ZXJkYVxuICAgIGlmICh0bXApIHtcbiAgICAgICAgLy8gdG1wID0gcGFyc2VJbnQodG1wKSArIFwiXCI7XG4gICAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC9eMCsvLCAnJyk7XG4gICAgfVxuXG4gICAgLy9RdWFscXVlciBjb2lzYSBkaWZlcmVudGUgZGUgdW0gbnVtZXJvIHZhbGlkbyByZXRvcm5hIDAsMDBcbiAgICBpZiAoKHRtcCAmJiBwYXJzZUludCh0bXApID09IDApIHx8IHRtcCA9PSBcIlwiIHx8IHRtcCA9PSB1bmRlZmluZWQgfHwgaXNOYU4ocGFyc2VJbnQodG1wKSkpIHtcbiAgICAgICAgcmV0dXJuIFwiMCwwMFwiO1xuICAgIH1cblxuICAgIC8vVmVyaWZpY2Egc2UgZXhpc3RlbSBzb21lbnRlIGRlY2ltYWlzLCBlIGFjcmVzY2VudGEgdW0gemVybyBuYSBmcmVudGVcbiAgICBpZiAodG1wICYmIHRtcC5sZW5ndGggPD0gMikge1xuICAgICAgICB0bXAgPSB0bXAubHBhZChcIjBcIiwgMyk7XG4gICAgfVxuXG4gICAgLy9zZSBvIHRhbWFuaG8gZm9yXG4gICAgLy9jb2xvY2EgYXMgY2FzYXMgZGVjaW1haXNcbiAgICB0bXAgPSB0bXAucmVwbGFjZSgvKFswLTldezJ9KSQvZywgXCIsJDFcIik7XG5cbiAgICAvL3NlIHRpdmVyIG1pbGhhciBjb2xvY2EgcG9udG9cbiAgICBpZiAodG1wLmxlbmd0aCA+IDYpIHtcbiAgICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL1xcQig/PShcXGR7M30pKyg/IVxcZCkpL2csIFwiLlwiKTtcbiAgICB9XG5cbiAgICBpZiAobmVnYXRpdmVDaGVjayA9PSB0cnVlKSB7XG4gICAgICAgIHRtcCA9IFwiLVwiICsgdG1wO1xuICAgIH1cblxuICAgIHJldHVybiB0bXA7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0RGF0ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdmFyIGRpYSA9IFwiXCI7XG4gICAgdmFyIG1lcyA9IFwiXCI7XG4gICAgdmFyIGFubyA9IFwiXCI7XG4gICAgdmFyIGl0ZW5zID0gXCJcIjtcbiAgICB2YXIgZGF0YUZvcm1hdGFkYSA9IG51bGw7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG5cbiAgICBpZiAob3B0aW9ucykge1xuICAgICAgICAvL29wdGlvbnMuZGF0ZSAhPSBcIlwiICYmIG9wdGlvbnMuZGF0ZSAhPSAwICYmIG9wdGlvbnMuZGF0ZSAhPSBudWxsXG4gICAgICAgIG9wdGlvbnMuZGF0ZSA9IHN0cjtcblxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMuc3JjRm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlICdkZG1teXl5eSc6XG4gICAgICAgICAgICAgICAgYW5vID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZyg0LCA4KTtcbiAgICAgICAgICAgICAgICBtZXMgPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDIsIDQpO1xuICAgICAgICAgICAgICAgIGRpYSA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoMCwgMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXltbWRkJzpcbiAgICAgICAgICAgICAgICBhbm8gPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDAsIDQpO1xuICAgICAgICAgICAgICAgIG1lcyA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoNCwgNik7XG4gICAgICAgICAgICAgICAgZGlhID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZyg2LCA4KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGQubW0ueXl5eSc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLmRhdGUuc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgICAgIGFubyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIG1lcyA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIGRpYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZC9tbS95eXl5JzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMuZGF0ZS5zcGxpdChcIi9cIik7XG4gICAgICAgICAgICAgICAgYW5vID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgbWVzID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgZGlhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXkubW0uZGQnOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy5kYXRlLnNwbGl0KFwiLlwiKTtcbiAgICAgICAgICAgICAgICBhbm8gPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBtZXMgPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBkaWEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGQtbW0teXl5eSc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLmRhdGUuc3BsaXQoXCItXCIpO1xuICAgICAgICAgICAgICAgIGFubyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIG1lcyA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIGRpYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5LW1tLWRkJzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMuZGF0ZS5zcGxpdChcIi1cIik7XG4gICAgICAgICAgICAgICAgYW5vID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgbWVzID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgZGlhID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXltbSc6XG4gICAgICAgICAgICAgICAgYW5vID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZygwLCA0KTtcbiAgICAgICAgICAgICAgICBtZXMgPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDQsIDYpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGF0YSBpbnbDoWxpZGFcIik7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMudGFyZ2V0Rm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlICdkZC9tbS95eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gZGlhICsgJy8nICsgbWVzICsgJy8nICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5L21tL2RkJzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gYW5vICsgJy8nICsgbWVzICsgJy8nICsgZGlhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZC5tbS55eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gZGlhICsgJy4nICsgbWVzICsgJy4nICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5Lm1tLmRkJzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gYW5vICsgJy4nICsgbWVzICsgJy4nICsgZGlhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZC1tbS15eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gZGlhICsgJy0nICsgbWVzICsgJy0nICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5LW1tLWRkJzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gYW5vICsgJy0nICsgbWVzICsgJy0nICsgZGlhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdtbS95eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gbWVzICsgJy8nICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdtbXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gbWVzICsgXCJcIiArIGFuby5zdWJzdHJpbmcoMiwgNCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2RkbW15eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gZGlhICsgbWVzICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5bW1kZCc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGFubyArIG1lcyArIGRpYTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9cIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGFGb3JtYXRhZGE7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0VGltZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdmFyIGhvcmEgPSBcIlwiO1xuICAgIHZhciBtaW4gPSBcIlwiO1xuICAgIHZhciBzZWcgPSBcIlwiO1xuICAgIHZhciBpdGVucyA9IFwiXCI7XG4gICAgdmFyIGhvcmFGb3JtYXRhZGEgPSBudWxsO1xuICAgIHZhciBzdHIgPSB0aGlzO1xuXG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucy50aW1lID0gc3RyO1xuXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5zcmNGb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgJ2hobW1zcyc6XG4gICAgICAgICAgICAgICAgaG9yYSA9IG9wdGlvbnMudGltZS5zdWJzdHJpbmcoMCwgMik7XG4gICAgICAgICAgICAgICAgbWluID0gb3B0aW9ucy50aW1lLnN1YnN0cmluZygyLCA0KTtcbiAgICAgICAgICAgICAgICBzZWcgPSBvcHRpb25zLnRpbWUuc3Vic3RyaW5nKDQsIDYpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdoaDptbTpzcyc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLnRpbWUuc3BsaXQoXCI6XCIpO1xuICAgICAgICAgICAgICAgIGhvcmEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBtaW4gPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBzZWcgPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaGgubW0uc3MnOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy50aW1lLnNwbGl0KFwiLlwiKTtcbiAgICAgICAgICAgICAgICBob3JhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgbWluID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgc2VnID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2hoLW1tLXNzJzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMudGltZS5zcGxpdChcIi1cIik7XG4gICAgICAgICAgICAgICAgaG9yYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIG1pbiA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIHNlZyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSG9yYSBpbnbDoWxpZGFcIik7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMudGFyZ2V0Rm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlICdoaDptbTpzcyc6XG4gICAgICAgICAgICAgICAgaG9yYUZvcm1hdGFkYSA9IGhvcmEgKyAnOicgKyBtaW4gKyAnOicgKyBzZWc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2hoLm1tLnNzJzpcbiAgICAgICAgICAgICAgICBob3JhRm9ybWF0YWRhID0gaG9yYSArICcuJyArIG1pbiArICcuJyArIHNlZztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaGgtbW0tc3MnOlxuICAgICAgICAgICAgICAgIGhvcmFGb3JtYXRhZGEgPSBob3JhICsgJy0nICsgbWluICsgJy0nICsgc2VnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdoaG1tc3MnOlxuICAgICAgICAgICAgICAgIGhvcmFGb3JtYXRhZGEgPSBob3JhICsgbWluICsgc2VnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb1wiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaG9yYUZvcm1hdGFkYTtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXRDcGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNwZiA9IHRoaXMubHBhZChcIjBcIiwgMTEpO1xuICAgIHJldHVybiBjcGYucmVwbGFjZSgvKFxcZHszfSkoXFxkezN9KShcXGR7M30pKFxcZHsyfSkvZywgXCJcXCQxLlxcJDIuXFwkM1xcLVxcJDRcIik7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0Q25waiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY3BmID0gdGhpcy5scGFkKFwiMFwiLCAxNCk7XG4gICAgcmV0dXJuIGNwZi5yZXBsYWNlKC8oXFxkezJ9KShcXGR7M30pKFxcZHszfSkoXFxkezR9KShcXGR7Mn0pL2csIFwiXFwkMS5cXCQyLlxcJDNcXC9cXCQ0XFwtJDVcIik7XG59XG5cblxuU3RyaW5nLnByb3RvdHlwZS5kYXRlRGlmZiA9IGZ1bmN0aW9uIChzcmNGb3JtYXQsIHRhcmdldERhdGEsIHR5cGUpIHtcblxuICAgIHZhciBkYXRhSW5pID0gbmV3IERhdGUodGhpcy5mb3JtYXREYXRlKHtcbiAgICAgICAgXCJzcmNGb3JtYXRcIjogc3JjRm9ybWF0LFxuICAgICAgICBcInRhcmdldEZvcm1hdFwiOiBcInl5eXkvbW0vZGRcIlxuICAgIH0pKTtcbiAgICB2YXIgZGF0YUZpbSA9IG5ldyBEYXRlKHRhcmdldERhdGEuZm9ybWF0RGF0ZSh7XG4gICAgICAgIFwic3JjRm9ybWF0XCI6IHNyY0Zvcm1hdCxcbiAgICAgICAgXCJ0YXJnZXRGb3JtYXRcIjogXCJ5eXl5L21tL2RkXCJcbiAgICB9KSk7XG5cbiAgICBpZiAodHlwZSA9PSBcImRpYVwiKSB7XG4gICAgICAgIHZhciBkaWZEaWFzID0gTWF0aC5hYnMoZGF0YUZpbS5nZXRUaW1lKCkgLSBkYXRhSW5pLmdldFRpbWUoKSk7XG4gICAgICAgIHZhciBudW1EaWFzID0gTWF0aC5jZWlsKGRpZkRpYXMgLyAoMTAwMCAqIDM2MDAgKiAyNCkpO1xuICAgICAgICByZXR1cm4gbnVtRGlhcztcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJtZXNcIikge1xuICAgICAgICB2YXIgZGlmTWVzZXMgPSBNYXRoLmFicyhkYXRhRmltLmdldFRpbWUoKSAtIGRhdGFJbmkuZ2V0VGltZSgpKTtcbiAgICAgICAgdmFyIG51bU1lc2VzID0gTWF0aC5jZWlsKGRpZk1lc2VzIC8gKDEwMDAgKiAzNjAwICogMjQgKiAzMCkgLSAxKTtcbiAgICAgICAgcmV0dXJuIG51bU1lc2VzO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnYW5vJykge1xuICAgICAgICB2YXIgZGlmTWVzZXMgPSBNYXRoLmFicyhkYXRhRmltLmdldFRpbWUoKSAtIGRhdGFJbmkuZ2V0VGltZSgpKTtcbiAgICAgICAgdmFyIG51bU1lc2VzID0gTWF0aC5jZWlsKGRpZk1lc2VzIC8gKDEwMDAgKiAzNjAwICogMjQgKiAzMCkgLSAxKTtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IobnVtTWVzZXMgLyAxMik7XG4gICAgfVxufVxuXG5TdHJpbmcucHJvdG90eXBlLnBsdXNEYXlzID0gZnVuY3Rpb24gKHNyY0Zvcm1hdCwgZGF5cykge1xuICAgIHZhciBkYXRhRm9ybWF0YWRhID0gdGhpcy5mb3JtYXREYXRlKHtcbiAgICAgICAgXCJzcmNGb3JtYXRcIjogc3JjRm9ybWF0LFxuICAgICAgICBcInRhcmdldEZvcm1hdFwiOiBcInl5eXkvbW0vZGRcIlxuICAgIH0pO1xuICAgIHZhciBkYXRhR2VyYWRhID0gbmV3IERhdGUoZGF0YUZvcm1hdGFkYSk7XG4gICAgdmFyIGRhdGFGaW5hbCA9IFwiXCI7XG4gICAgZGF0YUdlcmFkYS5zZXREYXRlKGRhdGFHZXJhZGEuZ2V0RGF0ZSgpICsgZGF5cyk7XG4gICAgdmFyIG1lcyA9IG5ldyBTdHJpbmcoZGF0YUdlcmFkYS5nZXRNb250aCgpICsgMSkubHBhZCgnMCcsIDIpO1xuICAgIHZhciBkaWEgPSBuZXcgU3RyaW5nKGRhdGFHZXJhZGEuZ2V0RGF0ZSgpKS5scGFkKCcwJywgMik7XG4gICAgZGF0YUZpbmFsID0gZGlhICsgJy8nICsgbWVzICsgJy8nICsgZGF0YUdlcmFkYS5nZXRGdWxsWWVhcigpO1xuICAgIHJldHVybiBkYXRhRmluYWw7XG59XG5cblN0cmluZy5wcm90b3R5cGUubWludXNEYXlzID0gZnVuY3Rpb24gKHNyY0Zvcm1hdCwgZGF5cykge1xuICAgIHZhciBkYXRhRm9ybWF0YWRhID0gdGhpcy5mb3JtYXREYXRlKHtcbiAgICAgICAgXCJzcmNGb3JtYXRcIjogc3JjRm9ybWF0LFxuICAgICAgICBcInRhcmdldEZvcm1hdFwiOiBcInl5eXkvbW0vZGRcIlxuICAgIH0pO1xuICAgIHZhciBkYXRhR2VyYWRhID0gbmV3IERhdGUoZGF0YUZvcm1hdGFkYSk7XG4gICAgdmFyIGRhdGFGaW5hbCA9IFwiXCI7XG4gICAgZGF0YUdlcmFkYS5zZXREYXRlKGRhdGFHZXJhZGEuZ2V0RGF0ZSgpIC0gZGF5cyk7XG4gICAgdmFyIG1lcyA9IG5ldyBTdHJpbmcoZGF0YUdlcmFkYS5nZXRNb250aCgpICsgMSkubHBhZCgnMCcsIDIpO1xuICAgIHZhciBkaWEgPSBuZXcgU3RyaW5nKGRhdGFHZXJhZGEuZ2V0RGF0ZSgpKS5scGFkKCcwJywgMik7XG4gICAgZGF0YUZpbmFsID0gZGlhICsgJy8nICsgbWVzICsgJy8nICsgZGF0YUdlcmFkYS5nZXRGdWxsWWVhcigpO1xuICAgIHJldHVybiBkYXRhRmluYWw7XG59XG5cblN0cmluZy5wcm90b3R5cGUuY29udmVydFRvTnVtYmVyID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBjb2RlU3RyaW5nID0gdGhpcy5zdWJzdHJpbmcoMSwgMTIpO1xuICAgIHZhciBsZXR0ZXIgPSB0aGlzLnN1YnN0cmluZygwLCAxKS50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiBsZXR0ZXIuY2hhckNvZGVBdCgwKSAtIDk2ICsgY29kZVN0cmluZztcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5scGFkID0gZnVuY3Rpb24gKHBhZFN0cmluZywgbGVuZ3RoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG4gICAgd2hpbGUgKHN0ci5sZW5ndGggPCBsZW5ndGgpXG4gICAgICAgIHN0ciA9IHBhZFN0cmluZyArIHN0cjtcbiAgICByZXR1cm4gc3RyO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmdldFNpZ2xhID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzaWdsYSA9IFwiXCI7XG4gICAgdmFyIG5hbWUgPSB0aGlzO1xuXG4gICAgaWYgKG5hbWUpIHtcbiAgICAgICAgdmFyIHVzZXJOYW1lID0gbmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAoL1stXS9nKSwgXCJcIik7XG4gICAgICAgIHVzZXJOYW1lID0gdXNlck5hbWUucmVwbGFjZShuZXcgUmVnRXhwKC9bXFxzXSsvZyksIFwiIFwiKS50cmltKCk7XG4gICAgICAgIHVzZXJOYW1lID0gdXNlck5hbWUuc3BsaXQoXCIgXCIpO1xuICAgICAgICB2YXIgZmlyc3ROYW1lID0gdXNlck5hbWVbMF07XG4gICAgICAgIHZhciBsYXN0TmFtZSA9IHVzZXJOYW1lW3VzZXJOYW1lLmxlbmd0aCAtIDFdO1xuICAgICAgICBzaWdsYSA9IGZpcnN0TmFtZVswXSArIGxhc3ROYW1lWzBdO1xuICAgIH1cblxuICAgIHJldHVybiBzaWdsYTtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5ycGFkID0gZnVuY3Rpb24gKHBhZFN0cmluZywgbGVuZ3RoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG4gICAgd2hpbGUgKHN0ci5sZW5ndGggPCBsZW5ndGgpXG4gICAgICAgIHN0ciA9IHN0ciArIHBhZFN0cmluZztcbiAgICByZXR1cm4gc3RyO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLnRyaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIik7XG59XG5cbi8vdHJpbW1pbmcgc3BhY2UgZnJvbSBsZWZ0IHNpZGUgb2YgdGhlIHN0cmluZ1xuU3RyaW5nLnByb3RvdHlwZS5sdHJpbSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9eXFxzKy8sIFwiXCIpO1xufVxuXG4vL3RyaW1taW5nIHNwYWNlIGZyb20gcmlnaHQgc2lkZSBvZiB0aGUgc3RyaW5nXG5TdHJpbmcucHJvdG90eXBlLnJ0cmltID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL1xccyskLywgXCJcIik7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbiQuZm4uaW5jcmVtZW50UmVxdWVzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY3VyciA9IDA7XG4gICAgaWYgKHRoaXMuYXR0cihcImN1cnJlbnQtcmVxdWVzdFwiKSkge1xuICAgICAgICBjdXJyID0gcGFyc2VJbnQodGhpcy5hdHRyKFwiY3VycmVudC1yZXF1ZXN0XCIpKTtcbiAgICB9XG5cbiAgICBjdXJyKys7XG4gICAgdGhpcy5hdHRyKFwiY3VycmVudC1yZXF1ZXN0XCIsIGN1cnIpO1xufVxuXG4kLmZuLnJlc2V0UmVxdWVzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnJlbW92ZUF0dHIoXCJjdXJyZW50LXJlcXVlc3RcIik7XG59XG5cbmNsYXNzIEFiUGFnZSBleHRlbmRzIEhUTUxFbGVtZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuaHRtbE9iaiA9ICQoXCJodG1sLGJvZHlcIilbMF07XG5cbiAgICAgICAgLy9wYWdlTG9hZGVyXG4gICAgICAgIHRoaXMucGFnZUxvYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB0aGlzLndyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB0aGlzLmxvYWRCYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB0aGlzLmJhclJhbmdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5sb2FkVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuXG4gICAgICAgIHRoaXMubWFpbkNsYXNzID0gXCJhYi1wYWdlXCI7XG4gICAgfVxuXG4gICAgX3JlbmRlcigpIHtcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHRoaXMubWFpbkNsYXNzKTtcblxuICAgICAgICAvL0NyaWEgdW0gaWRcbiAgICAgICAgaWYgKCF0aGlzLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBBdHJpYnV0byBwYXJhIGlkZW50aWZpY2FyIG8gb2JqZXRvfCBBbGZhbnVtw6lyaWNvfCBuw6NvfCB2YXppb3xcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwiaWRcIiwgZ2VuZXJhdGVJRCgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHBhcmFtZXRyb3NcbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiZnVsbHNjcmVlblwiKSAhPSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiB0cnVlO2ZhbHNlXG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBVc2EgbyB0YW1hbmhvIHRvdGFsIGRhIHRlbGEgfCB0cnVlIG91IGZhbHNlIHwgbsOjbyB8IHRydWUgfFxuICAgICAgICAgICAgdGhpcy5odG1sT2JqLnN0eWxlLm1hcmdpbiA9IFwiMHB4XCI7XG4gICAgICAgICAgICB0aGlzLmh0bWxPYmouc3R5bGUucGFkZGluZyA9IFwiMHB4XCI7XG4gICAgICAgICAgICB0aGlzLmh0bWxPYmouc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICAgICAgICAgIHRoaXMuaHRtbE9iai5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblxuICAgICAgICAgICAgdGhpcy5zdHlsZS50b3AgPSBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5sZWZ0ID0gXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuYm90dG9tID0gXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUucmlnaHQgPSBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUucG9zaXRpb24gPSBcImZpeGVkXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxvciBwYWRyYW9cbiAgICAgICAgdGhpcy5zdHlsZS56SW5kZXggPSBcIjBcIjtcblxuICAgICAgICAvL3NlIGV4aXN0aXIgdW0gbWF4LXJlcXVlc3QsIGNvbnN0cnVpciBvIHNpc3RlbWEgZGUgbG9hZFxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJtYXgtcmVxdWVzdFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTcOheGltbyBkZSByZXF1ZXN0cyBxdWUgdGVyw6EgbmEgcMOhZ2luYSBwYXJhIG8gbG9hZGVyIHwgTnVtw6lyaWNvIHwgbsOjbyB8IDAgfFxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlTG9hZGVyKCk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMubWFpbkNsYXNzKSkge1xuICAgICAgICAgICAgLyp0aGlzLnNoYWRvd0RvbSA9IHRoaXMuYXR0YWNoU2hhZG93KHtcbiAgICAgICAgICAgICAgICBtb2RlOiAnb3BlbidcbiAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcImxvYWRlci12aXNpYmlsaXR5XCIsIFwiY3VycmVudC1yZXF1ZXN0XCJdO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcbiAgICAgICAgaWYgKGF0dHJOYW1lID09IFwibG9hZGVyLXZpc2liaWxpdHlcIikge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbCAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICQodGhpcy5sb2dvKS5mYWRlT3V0KDEwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCh0aGlzLnBhZ2VMb2FkKS5mYWRlT3V0KDEwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBhZ2VMb2FkLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlTG9hZGVyKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQodGhpcy5wYWdlTG9hZCkuZmFkZUluKDEwMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIGlmIChhdHRyTmFtZSA9PSBcImN1cnJlbnQtcmVxdWVzdFwiKSB7XG4gICAgICAgICAgICB2YXIgcmVxQXR1YWwgPSBwYXJzZUludChuZXdWYWwpO1xuICAgICAgICAgICAgdmFyIHJlcU1heCA9IHBhcnNlSW50KHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXJlcXVlc3RcIikpO1xuICAgICAgICAgICAgdmFyIHRvdGFsID0gKCgxMDAgLyByZXFNYXgpICogcmVxQXR1YWwpO1xuXG4gICAgICAgICAgICB0aGlzLmJhclJhbmdlLnN0eWxlLndpZHRoID0gdG90YWwgKyBcIiVcIjtcblxuICAgICAgICAgICAgaWYgKHRvdGFsID49IDEwMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwibG9hZGVyLXZpc2liaWxpdHlcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5jbGFzc0xpc3QuYWRkKFwiaHRtbC1wYWdlLWxvYWRlZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxQXR1YWwgPSBudWxsO1xuICAgICAgICAgICAgcmVxTWF4ID0gbnVsbDtcbiAgICAgICAgICAgIHRvdGFsID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9jcmVhdGVMb2FkZXIoKSB7XG5cbiAgICAgICAgdGhpcy5wYWdlTG9hZC5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXJcIik7XG4gICAgICAgIHRoaXMucGFnZUxvYWQuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1wYWdlLWxvYWRlclwiKTtcbiAgICAgICAgdGhpcy5wYWdlTG9hZC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMucGFnZUxvYWQpO1xuXG4gICAgICAgIHRoaXMud3JhcHBlci5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItd3JhcHBlclwiKTtcbiAgICAgICAgdGhpcy5wYWdlTG9hZC5hcHBlbmRDaGlsZCh0aGlzLndyYXBwZXIpO1xuXG4gICAgICAgIHRoaXMubG9hZEJhci5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItcGF0aFwiKTtcbiAgICAgICAgdGhpcy53cmFwcGVyLmFwcGVuZENoaWxkKHRoaXMubG9hZEJhcik7XG5cbiAgICAgICAgdGhpcy5iYXJSYW5nZS5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItcmFuZ2VcIik7XG4gICAgICAgIHRoaXMuYmFyUmFuZ2Uuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1wYWdlLWxvYWRlci1yYW5nZVwiKTtcbiAgICAgICAgdGhpcy5sb2FkQmFyLmFwcGVuZENoaWxkKHRoaXMuYmFyUmFuZ2UpO1xuXG4gICAgICAgIHRoaXMubG9hZFRleHQuY2xhc3NMaXN0LmFkZChcImFiLXBhZ2UtbG9hZGVyLXRleHRcIik7XG4gICAgICAgIHRoaXMubG9hZFRleHQuaW5uZXJUZXh0ID0gXCJBZ3VhcmRlXCI7XG4gICAgICAgIHRoaXMud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmxvYWRUZXh0KTtcbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ2FiLXBhZ2UnLCBBYlBhZ2UpOyJdfQ==
