"use strict";

//Verfica Sistema Operacional
window.isIOS = (/iPad|iPhone|iPod/.test(navigator.platform) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) && !window.MSStream;
window.isAndroid = /(android)/i.test(navigator.userAgent);
window.isDesktop = !window.isIOS && !window.isAndroid;

(function(w, $, undefined) {

    w.tapHandling = false;
    w.tappy = true;

    var tap = function($els) {
        return $els.each(function() {

            var $el = $(this),
                resetTimer,
                startY,
                startX,
                cancel,
                scrollTolerance = 10;

            function trigger(e) {
                $(e.target).trigger("tap", [e, $(e.target).attr("href")]);
            }

            function getCoords(e) {
                var ev = e.originalEvent || e,
                    touches = ev.touches || ev.targetTouches;

                if (touches) {
                    return [touches[0].pageX, touches[0].pageY];
                } else {
                    return null;
                }
            }

            function start(e) {
                if (e.touches && e.touches.length > 1 || e.targetTouches && e.targetTouches.length > 1) {
                    return false;
                }

                var coords = getCoords(e);
                startX = coords[0];
                startY = coords[1];
            }

            // any touchscroll that results in > tolerance should cancel the tap
            function move(e) {
                if (!cancel) {
                    var coords = getCoords(e);
                    if (coords && (Math.abs(startY - coords[1]) > scrollTolerance || Math.abs(startX - coords[0]) > scrollTolerance)) {
                        cancel = true;
                    }
                }
            }

            function end(e) {
                clearTimeout(resetTimer);
                resetTimer = setTimeout(function() {
                    w.tapHandling = false;
                    cancel = false;
                }, 1000);

                // make sure no modifiers are present. thx http://www.jacklmoore.com/notes/click-events/
                if ((e.which && e.which > 1) || e.shiftKey || e.altKey || e.metaKey || e.ctrlKey) {
                    return;
                }

                e.preventDefault();

                // this part prevents a double callback from touch and mouse on the same tap

                // if a scroll happened between touchstart and touchend
                if (cancel || w.tapHandling && w.tapHandling !== e.type) {
                    cancel = false;
                    return;
                }

                w.tapHandling = e.type;
                trigger(e);
            }

            $el
                .bind("touchstart.tappy MSPointerDown.tappy", start)
                .bind("touchmove.tappy MSPointerMove.tappy", move)
                .bind("touchend.tappy MSPointerUp.tappy", end)
                .bind("click.tappy", end);
        });
    };

    var untap = function($els) {
        return $els.unbind(".tappy");
    };

    // use special events api
    if ($.event && $.event.special) {
        $.event.special.tap = {
            add: function(handleObj) {
                tap($(this));
            },
            remove: function(handleObj) {
                untap($(this));
            }
        };
    } else {
        // monkeybind
        var oldBind = $.fn.bind,
            oldUnbind = $.fn.unbind;
        $.fn.bind = function(evt) {
            if (/(^| )tap( |$)/.test(evt)) {
                tap(this);
            }
            return oldBind.apply(this, arguments);
        };
        $.fn.unbind = function(evt) {
            if (/(^| )tap( |$)/.test(evt)) {
                untap(this);
            }
            return oldUnbind.apply(this, arguments);
        };
    }

}(this, jQuery));


// ARRUMA ERRO NO IE9 ONDE NAO EXISTE WINDOW.CONSOLE
if (!window.console) {
    var console = {
        log: function() {},
        warn: function() {},
        error: function() {},
        time: function() {},
        timeEnd: function() {}
    }
}

/* ARRUMA INPUT NO IOS QUE NAO FUNCIONA DIREITO */
/*$(document).ready(function() {
    if (window.isIOS) {
        $(document).ready(function() {
            document.addEventListener('keydown', function(e) {
                window.focus();
                $(':focus').focus();
            });
        });
    }

});*/

var getXY = function(event) {
    var x = null;
    var y = null;

    if (event.originalEvent != null && event.originalEvent.touches != null) {
        var touch = event.originalEvent.touches[0] || event.originalEvent.changedTouches[0];
        x = parseFloat(touch.pageX);
        y = parseFloat(touch.pageY);
    } else {
        x = parseFloat(event.pageX);
        y = parseFloat(event.pageY);
    }

    var pos = new Object();
    pos.x = x;
    pos.y = y;

    return pos;
}

var support3d = function() {
    var ret = false;
    var supports3DTransforms = document.body.style['webkitPerspective'] !== undefined || document.body.style['MozPerspective'] !== undefined;
    if (supports3DTransforms) {
        ret = true;
    }
    return ret;
}

var getTransform = function(el) {
    var prop = "";

    if (el.css('-webkit-transform') != undefined) {
        prop = el.css('-webkit-transform');
    } else if (el.css('transform') != undefined) {
        prop = el.css('transform');
    } else if (el.css('-moz-transform') != undefined) {
        prop = el.css('-moz-transform');
    } else if (el.css('-ms-transform') != undefined) {
        prop = el.css('-ms-transform');
    } else {
        return [0, 0, 0];
    }

    var results = prop.match(/matrix(?:(3d)\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))(?:, (-{0,1}\d+)), -{0,1}\d+\)|\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))\))/);

    if (!results)
        return [0, 0, 0];
    if (results[1] == '3d')
        return results.slice(2, 5);

    results.push(0);
    return results.slice(5, 8);
}

var goToNextTabindex = function(event, obj, command) {
    var key = event.keyCode ? event.keyCode : event.which;

    if (key == 13 || key == 9) {
        var ficar = true;
        var ret = true;
        var tabindex = obj.attr('tabindex');

        if (key == 13 && obj[0].nodeName == "TEXTAREA") {
            return;
        }

        do {
            //Verifica o tabindex
            var gotoTabindex = obj.attr('goto-tab-index');
            var stopTabindex = obj.attr('stop-tab-index');

            //Vai opara
            if (tabindex && stopTabindex != "true") {
                tabindex = parseInt(tabindex);

                //avanca o tabindex
                if (gotoTabindex) {
                    tabindex = gotoTabindex;
                } else {
                    tabindex++;
                }

                //se Existir o elemento foca nele
                var nextObj = $('[tab-index=' + tabindex + ']');

                //Verifica se encontrou um objeto
                if (nextObj.length > 0 && nextObj.attr("is-disabled") != "true") {
                    ficar = false;                    

                    if (nextObj[0].nodeName == "ABNER-SELECT-UNDERLINE") {
                        nextObj.find("select").trigger("focus");
                    } else {
                        nextObj.find("[div-focus=true]").trigger(command);
                    };
                } else {
                    if (nextObj.length > 0) {
                        //verifica o proximo objeto
                        obj = nextObj;
                    } else {
                        ficar = false;
                    }
                }

                //removido para funcionar o enter
                //return false;
            } else {
                if (stopTabindex == "true") {
                    ficar = false;
                    ret = false;
                } else {
                    ficar = false;
                    ret = true;
                }

            }
        }
        while (ficar);

        //Se for tab deixar false
        if (key == 9) {
            ret = false;
        }

        //rodar saida
        return ret;
    }

}

var randomNumber = function() {
    //var random_integer = Math.random()*101|0;    
    return Math.random().toString(36).substr(2, 10);
}

var guid = function() {
    function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    }
    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
}

var generateID = function() {
    return guid();
}

var pointerEventToXY = function(e) {
    var out = { x: 0, y: 0 };
    if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {
        var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
        out.x = touch.pageX;
        out.y = touch.pageY;
    } else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {
        out.x = e.pageX;
        out.y = e.pageY;
    }
    return out;
};
"use strict";

//component-wrapper: non-functional

//Criando namespace utils
var PmbUtils = function () { }


PmbUtils.prototype.removeAccent = function (word) {
    var _this = this;

    var map = {
        "á": "a",
        "à": "a",
        "â": "a",
        "ã": "a",
        "ä": "a",
        "Á": "A",
        "À": "A",
        "Â": "A",
        "Ã": "A",
        "Ä": "A",
        "é": "e",
        "è": "e",
        "ê": "e",
        "ẽ": "e",
        "ë": "e",
        "É": "E",
        "È": "E",
        "Ê": "E",
        "Ẽ": "E",
        "Ë": "E",
        "í": "i",
        "ì": "i",
        "î": "i",
        "ĩ": "i",
        "ï": "i",
        "Í": "I",
        "Ì": "I",
        "Î": "I",
        "Ĩ": "I",
        "Ï": "I",
        "ó": "o",
        "ò": "o",
        "ô": "o",
        "õ": "o",
        "ö": "o",
        "Ó": "O",
        "Ò": "O",
        "Ô": "O",
        "Õ": "O",
        "Ö": "O",
        "ú": "u",
        "ù": "u",
        "û": "u",
        "ũ": "u",
        "ü": "u",
        "Ú": "U",
        "Ù": "U",
        "Û": "U",
        "Ũ": "U",
        "Ü": "U",
        "ý": "y",
        "ỳ": "y",
        "ŷ": "y",
        "ỹ": "y",
        "ÿ": "y",
        "Ý": "Y",
        "Ỳ": "Y",
        "Ŷ": "Y",
        "Ỹ": "Y",
        "Ÿ": "Y",
        "ñ": "n",
        "Ñ": "n",
        "Ç": "c",
        "ç": "c"
    };

    if (word != "") {
        return word.replace(/[àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãẽĩũñõÃẼĨŨÑÕäëïöüÿÄËÏÖÜŸÇç]/g, function (match) {
            return map[match];
        });
    } else {
        return null;
    }
}

//PEga variaveis da URL
PmbUtils.prototype.getUrlVars = function () {
    var vars = new Object(),
        hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars[hash[0]] = hash[1];
    }
    return vars;
}

//Determina se é modo adaptativo 
PmbUtils.prototype.showBigScreen = function (obj) {
    if (parseInt(obj.outerWidth()) >= 1024) {
        return true;
    } else {
        return false;
    }
}

PmbUtils.prototype.getCheckedRadio = function (name) {
    if (name) {
        return $("input[type=radio][name=" + name + "]:checked").parent();
    } else {
        return $("input[type=radio]:checked").parent();
    }
}

PmbUtils.prototype.getPhoneAsObject = function (phone) {

    var phoneObj = {
        ddi: "",
        ddd: "",
        phone: phone
    };

    phone = phone ? phone.replace(/\D+/g, '') : phone;

    if (phone && phone.length > 11) {
        phoneObj.ddi = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$1");
        phoneObj.ddd = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$2");
        phoneObj.phone = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$3");
    } else if (phone && phone.length > 9) {
        phoneObj.ddd = phone.replace(/^(\d{2})(\d{8,9})$/g, "\$1");
        phoneObj.phone = phone.replace(/^(\d{2})(\d{8,9})$/g, "\$2");
    }

    return phoneObj;
}

PmbUtils.prototype.formatPhone = function (phone) {

    var phoneReturn = phone.replace(/[^0-9]/g, '');

    if (phone && phone.length > 11) {
        phoneReturn = phone.replace(/^(\d{2})(\d{2})(\d{4,5})(\d{4})$/g, "\+$1 \($2) \$3 \$4");
    } else if (phone && phone.length > 9) {
        phoneReturn = phone.replace(/^(\d{2})(\d{4,5})(\d{4})$/g, "\($1) \$2 \$3");
    };

    return phoneReturn;
}

PmbUtils.prototype.removeCpfCnpjFormat = function (valor, type) {

    if (valor) {
        //remove ponto e virgula
        valor = valor.replace(new RegExp(/[^\d]/g), "");

        if (type == "CNPJ") {
            var len = 14;
            var pad = "00000000000";
        } else if (type == "CPF") {
            var len = 11;
            var pad = "00000000000";
        } else {
            return "";
        }

        //transforma para numero
        valor = parseInt(valor);

        //se for maior que o valor defindo para len ele corta
        if (valor.length > len) {
            valor = valor.substring(0, len);
        }

        //Se ocorre algum erro, deixar vazio
        if (isNaN(valor)) {
            valor = "";

        } else {
            valor = pad.substring(0, pad.length - valor.length) + valor;
        }
    }
    return valor;
}

PmbUtils.prototype.validarCNPJ = function (cnpj) {

    cnpj = cnpj.replace(/[^\d]+/g, '');
    
    if (cnpj == "0" ||
        cnpj == "00000000000000" ||
        cnpj == "11111111111111" ||
        cnpj == "22222222222222" ||
        cnpj == "33333333333333" ||
        cnpj == "44444444444444" ||
        cnpj == "55555555555555" ||
        cnpj == "66666666666666" ||
        cnpj == "77777777777777" ||
        cnpj == "88888888888888" ||
        cnpj == "99999999999999") {
        return false;
    }

    // Valida DVs
    var tamanho = cnpj.length - 2
    var numeros = cnpj.substring(0, tamanho);
    var digitos = cnpj.substring(tamanho);
    var soma = 0;
    var pos = tamanho - 7;
    var i = tamanho;

    for (i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2)
            pos = 9;
    }
    var resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
    if (resultado != digitos.charAt(0)) {
        return false;
    }

    tamanho = tamanho + 1;
    numeros = cnpj.substring(0, tamanho);
    soma = 0;
    pos = tamanho - 7;
    for (i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2)
            pos = 9;
    }

    resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;

    if (resultado != digitos.charAt(1)) {
        return false;
    }

    return true;
}

//valida o CPF digitado
PmbUtils.prototype.validarCPF = function(cpf) {

    var exp = /\.|\-/g
    cpf = cpf.toString().replace(exp, "");
    if (cpf.length < 11) {
        var pad = "00000000000";
        cpf = pad.substring(0, pad.length - cpf.length) + cpf;
    }

    if (cpf == "0" ||
        cpf == "00000000000" ||
        cpf == "11111111111" ||
        cpf == "22222222222" ||
        cpf == "33333333333" ||
        cpf == "44444444444" ||
        cpf == "55555555555" ||
        cpf == "66666666666" ||
        cpf == "77777777777" ||
        cpf == "88888888888" ||
        cpf == "99999999999") {
        return false;
    }

    var soma;
    var resto;
    soma = 0;

    for (var i = 1; i <= 9; i++) {
        soma = soma + parseInt(cpf.substring(i - 1, i)) * (11 - i);
    }

    resto = (soma * 10) % 11;

    if ((resto == 10) || (resto == 11)) {
        resto = 0;
    }
    if (resto != parseInt(cpf.substring(9, 10))) {
        return false;
    }

    soma = 0;
    for (var i = 1; i <= 10; i++) {
        soma = soma + parseInt(cpf.substring(i - 1, i)) * (12 - i);
    }
    resto = (soma * 10) % 11;

    if ((resto == 10) || (resto == 11)) {
        resto = 0;
    }
    if (resto != parseInt(cpf.substring(10, 11))) {
        return false;
    }
    return true;
}

PmbUtils.prototype.validarEMAIL = function(email) {
    var emailValidation = email.match(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+$/);

    if (email == emailValidation) {
        return emailValidation;
    }
}

//Funcoes uteis de uso do JQUERY
window.addEventListener('WebComponentsReady', function () {
    document.querySelector("html").classList.add("html-page-loaded");
});

$(document).ready(function () {
    $.fn.setCursorPosition = function (pos) {
        this.each(function (index, elem) {
            if (elem.setSelectionRange) {
                elem.setSelectionRange(pos, pos);
            } else if (elem.createTextRange) {
                var range = elem.createTextRange();
                range.collapse(true);
                range.moveEnd('character', pos);
                range.moveStart('character', pos);
                range.select();
            }
        });
        return this;
    };

    $.fn.validate = function () {
        var change = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if ($(this).attr("onchange")) {
            change = $(this).attr("onchange");
            $(this).removeAttr("onchange");
        }

        //tira o foco de qualquer elemento
        document.activeElement.blur();
        $(window).focus();

        if (change != null) {
            $(this).attr("onchange", change);
        }

        //se ouver um erro validacao esta incorreta
        if ($(this).attr("error") && $(this).attr("error") != "") {
            return false;
        } else {
            return true;
        }
    };

    $.fn.setFocus = function () {
        if ($(this).length > 0) {
            $(this).find("input").focus();
        } else {
            return null;
        }
    }

    $.fn.removeFocus = function () {
        if (document.activeElement) {
            document.activeElement.blur();
        }
    }

    $.fn.getText = function () {
        var text = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase().startsWith("AB-INPUT") ? "AB-INPUT" : tag.toUpperCase();
                var tagsAceitas = ["AB-TEXT-READ-ONLY", "AB-TEXT-AREA-UNDERLINE", "AB-SELECT-UNDERLINE", "AB-INPUT"];
                if (tagsAceitas.indexOf(tag) == -1) {
                    return null;
                }
            }
        } else {
            return null;
        }

        if ($(this).length > 1) {
            var textArray = new Array();
            for (const radio of this) {
                textArray.push(radio.getText());
            }
            text = textArray;
        } else {
            text = this[0].getText();
        };

        return text;
    };

    $.fn.setText = function (text, cancel) {
        var tag = new String();

        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (tag == "AB-TEXT-READ-ONLY") {
            this[0].setText(text);

        } else if (tag.startsWith("AB-INPUT-DATE")) {
            this[0].setText(text);

        } else if (tag.startsWith("AB-INPUT")) {
            this[0].setText(text);

        } else if (tag == "AB-TEXT-AREA-UNDERLINE") {
            this[0].setText(text);

        } else if (tag.startsWith("AB-SELECT")) {
            if (cancel) {
                $(this).find("select").val(text);
            } else {
                $(this).find("select").val(text).change();
            }
        }

        //salva valor
        if (!tag.startsWith("AB-INPUT-CHECKBOX")) {
            $(this).attr("loaded-value", $(this).getText());
        }
    };


    //funcao para corrigir o data
    $.fn.getNumber = function () {
        var text = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (tag == "AB-TEXT-READ-ONLY") {
            text = this[0].getText();

        } else if (tag.startsWith("AB-INPUT-CHECKBOX")) {
            text = this[0].getNumber();

        } else if (tag.startsWith("AB-INPUT-RADIO")) {
            text = this[0].getNumber();
            
        } else if (tag.startsWith("AB-INPUT-SWITCH")) {
            text = this[0].getNumber();

        } else if (tag.startsWith("AB-INPUT-TIME")) {
            text = $(this).find("input").val() + "00";

        } else if (tag.startsWith("AB-INPUT-NUMBER")) {
            text = $(this).find("input").val();
            text = text.replace(new RegExp(/[^\d]/g), "");

        } else if (tag.startsWith("AB-INPUT-DATE")) {
            if (window.isIOS || window.isAndroid) {
                text = $(this).find("input").val();
                text = text.substring(8, 10) + "" + text.substring(5, 7) + "" + text.substring(0, 4);
            } else {
                text = $(this).find("input").val();
            }

        } else if (tag.startsWith("AB-INPUT")) {
            text = $(this).find("input").val();

        } else if (tag.startsWith("AB-TEXT-AREA-UNDERLINE")) {
            text = $(this).find("textarea").val();

        } else if (tag.startsWith("AB-SELECT")) {
            text = parseInt($(this).getObject().valor);

        } else if (tag.startsWith("AB-QUESTION")) {
            text = $(this).attr("answer");
        }

        if (text && tag != "AB-SELECT-UNDERLINE") {
            text = text.replace(new RegExp(/[^\d\,]/g), "");
        }

        return text;
    };

    //funcao para corrigir o data
    $.fn.setNumber = function (text, cancel) {
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (text || text == 0) {
            //Necessario ser string para regex
            text += "";
            text = text.replace(new RegExp(/[^\d-\,]/g), "");

            if (tag == "AB-TEXT-READ-ONLY") {
                this[0].setText(text);

            } else if (tag.startsWith("AB-INPUT-CHECKBOX")) {
                this[0].setNumber(text);

                $(this).attr("loaded-value", $(this).attr("is-checked"));

            } else if (tag.startsWith("AB-INPUT-RADIO")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-INPUT-SWITCH")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-INPUT-DATE")) {
                this[0].setText(text);

            } else if (tag.startsWith("AB-INPUT")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-SELECT")) {
                if (cancel) {
                    $(this[0].select).val(text);
                } else {
                    $(this[0].select).val(text).change();
                }
            }

            //salva valor
            if (!tag.startsWith("AB-INPUT-CHECKBOX")) {
                $(this).attr("loaded-value", $(this).getText());
            }
        }
    };

    $.fn.setOldValue = function () {
        $(this).setText($(this).attr("loaded-value"));
    };

    $.fn.isChanged = function (val) {
        var loadedValue = $(this).attr("loaded-value");
        var currentValue = $(this).getText();

        if (loadedValue || currentValue) {
            if (loadedValue !== currentValue) {
                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    $.fn.setObject = function (val) {
        var tag = $(this)[0].nodeName;
        if (tag.startsWith("AB-SELECT")) {
            $(this).find("select").val(val).change();
        }
    }

    $.fn.getObject = function () {
        var bean = new Object();

        if ((this)[0]) {
            var tag = $(this)[0].nodeName;

            if (tag.startsWith("AB-SELECT")) {
                bean.nome = $(this).find("select option:selected").text();
                bean.valor = $(this).find("select option:selected").attr("value");
            }
        }

        return bean;
    }


    //Avisar nossos componentes quando teve uma alteracao
    var origAppend = $.fn.append;
    $.fn.append = function () {
        if ($(this).hasClass("ab-container-content") && arguments[0].hasClass("ab-block")) {
            return false;
        } else {
            return origAppend.apply(this, arguments).trigger("append");
        }
    };

    //função para retornar se o campo esrá com erro ou não
    $.fn.hasError = function () {
        if ($(this).attr("error")) {
            return true;
        } else {
            return false;
        }
    }
});


//função para arrumar bug no iOS 8
if (!String.prototype.startsWith) {
    String.prototype.startsWith = function (searchString, position) {
        position = position || 0;
        return this.indexOf(searchString, position) === position;
    };
}

String.prototype.toUpperOnlyFirstLetter = function () {
    var str = this;

    var wordMap = {
        "rg": "RG",
        "cpf": "CPF",
        "cnpj": "CNPJ",
        "rne": "RNE",
        "cep": "CEP",
        "cnh": "CNH",
        "s.a.": "S.A."
    };

    if (str && str.length == 0) {
        return "";
    } else if (str && str.length == 1) {
        return str.toUpperCase()
    } else if (str && str.length > 1) {
        str = str.substr(0, 1).toUpperCase() + str.substr(1).toLowerCase();
        return str = str.replace(/\b(rg|cpf|cnpj|rne|cep|cnh)\b|s\.a\./gi, function (word) {
            return wordMap[word.toLowerCase()];
        });
    } else {
        return "";
    }
}

String.prototype.toCamelCase = function () {
    var str = this.toLowerCase();

    var wordsArray = ["de", "sem", "o", "do", "da"];

    var words = str.split(" ");

    var fullString = new String();

    for (var i = 0; i < words.length; i++) {
        if (wordsArray.indexOf(words[i]) == -1 && words[i].length > 1) {
            words[i] = words[i].toUpperOnlyFirstLetter();
        };
    };

    fullString = words.join(" ")

    return fullString;
}

String.prototype.formatPercent = function(decimals, integers) {
    var tmp = this;
    var dec = "1";
    var formatDecimal = 0;
    var negativeCheck = false;

    if (tmp.substring(0, 1) == "-") {
        negativeCheck = true;
        tmp = tmp.substring(1, tmp.length);
    };

    if (decimals) {
        dec = dec.rpad("0", parseInt(decimals) + 1);
        formatDecimal = parseInt(decimals);
    }
    dec = parseInt(dec);

    if ((tmp && parseInt(tmp) == 0) || tmp == "" || tmp == undefined || isNaN(parseInt(tmp))) {
        tmp = 0;
    } else {
        tmp = parseFloat(tmp) / dec;
    }

    if (negativeCheck) {
        tmp = tmp * -1;
    }

    var option = {
        minimumFractionDigits: formatDecimal,
        maximumFractionDigits: formatDecimal
    };

    tmp = new Intl.NumberFormat('pt-BR', option).format(tmp);

    return tmp;
}

String.prototype.formatCurrency = function () {
    var tmp = this;
    var negativeCheck = false;

    if (tmp.substring(0, 1) == "-") {
        negativeCheck = true;
        tmp = tmp.substring(1, tmp.length);
    };

    //remove zeros a esquerda
    if (tmp) {
        // tmp = parseInt(tmp) + "";
        tmp = tmp.replace(/^0+/, '');
    }

    //Qualquer coisa diferente de um numero valido retorna 0,00
    if ((tmp && parseInt(tmp) == 0) || tmp == "" || tmp == undefined || isNaN(parseInt(tmp))) {
        return "0,00";
    }

    //Verifica se existem somente decimais, e acrescenta um zero na frente
    if (tmp && tmp.length <= 2) {
        tmp = tmp.lpad("0", 3);
    }

    //se o tamanho for
    //coloca as casas decimais
    tmp = tmp.replace(/([0-9]{2})$/g, ",$1");

    //se tiver milhar coloca ponto
    if (tmp.length > 6) {
        tmp = tmp.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    if (negativeCheck == true) {
        tmp = "-" + tmp;
    }

    return tmp;
}

String.prototype.formatDate = function (options) {
    var dia = "";
    var mes = "";
    var ano = "";
    var itens = "";
    var dataFormatada = null;
    var str = this;

    if (options) {
        //options.date != "" && options.date != 0 && options.date != null
        options.date = str;

        switch (options.srcFormat) {
            case 'ddmmyyyy':
                ano = options.date.substring(4, 8);
                mes = options.date.substring(2, 4);
                dia = options.date.substring(0, 2);
                break;

            case 'yyyymmdd':
                ano = options.date.substring(0, 4);
                mes = options.date.substring(4, 6);
                dia = options.date.substring(6, 8);
                break;

            case 'dd.mm.yyyy':
                itens = options.date.split(".");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'dd/mm/yyyy':
                itens = options.date.split("/");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'yyyy.mm.dd':
                itens = options.date.split(".");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'dd-mm-yyyy':
                itens = options.date.split("-");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'yyyy-mm-dd':
                itens = options.date.split("-");
                ano = itens[0];
                mes = itens[1];
                dia = itens[2];
                break;

            case 'yyyymm':
                ano = options.date.substring(0, 4);
                mes = options.date.substring(4, 6);
                break;

            default:
                console.log("Data inválida");
        }

        switch (options.targetFormat) {
            case 'dd/mm/yyyy':
                dataFormatada = dia + '/' + mes + '/' + ano;
                break;

            case 'yyyy/mm/dd':
                dataFormatada = ano + '/' + mes + '/' + dia;
                break;

            case 'dd.mm.yyyy':
                dataFormatada = dia + '.' + mes + '.' + ano;
                break;

            case 'yyyy.mm.dd':
                dataFormatada = ano + '.' + mes + '.' + dia;
                break;

            case 'dd-mm-yyyy':
                dataFormatada = dia + '-' + mes + '-' + ano;
                break;

            case 'yyyy-mm-dd':
                dataFormatada = ano + '-' + mes + '-' + dia;
                break;

            case 'mm/yyyy':
                dataFormatada = mes + '/' + ano;
                break;

            case 'mmyy':
                dataFormatada = mes + "" + ano.substring(2, 4);
                break;

            case 'ddmmyyyy':
                dataFormatada = dia + mes + ano;
                break;

            case 'yyyymmdd':
                dataFormatada = ano + mes + dia;
                break;

            default:
                console.log("erro");
        }
    }
    return dataFormatada;
}

String.prototype.formatTime = function (options) {
    var hora = "";
    var min = "";
    var seg = "";
    var itens = "";
    var horaFormatada = null;
    var str = this;

    if (options) {
        options.time = str;

        switch (options.srcFormat) {
            case 'hhmmss':
                hora = options.time.substring(0, 2);
                min = options.time.substring(2, 4);
                seg = options.time.substring(4, 6);
                break;

            case 'hh:mm:ss':
                itens = options.time.split(":");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            case 'hh.mm.ss':
                itens = options.time.split(".");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            case 'hh-mm-ss':
                itens = options.time.split("-");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            default:
                console.log("Hora inválida");
        }

        switch (options.targetFormat) {
            case 'hh:mm:ss':
                horaFormatada = hora + ':' + min + ':' + seg;
                break;

            case 'hh.mm.ss':
                horaFormatada = hora + '.' + min + '.' + seg;
                break;

            case 'hh-mm-ss':
                horaFormatada = hora + '-' + min + '-' + seg;
                break;

            case 'hhmmss':
                horaFormatada = hora + min + seg;
                break;

            default:
                console.log("erro");
        }
    }
    return horaFormatada;
}

String.prototype.formatCpf = function () {
    var cpf = this.lpad("0", 11);
    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/g, "\$1.\$2.\$3\-\$4");
}

String.prototype.formatCnpj = function () {
    var cpf = this.lpad("0", 14);
    return cpf.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g, "\$1.\$2.\$3\/\$4\-$5");
}


String.prototype.dateDiff = function (srcFormat, targetData, type) {

    var dataIni = new Date(this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    }));
    var dataFim = new Date(targetData.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    }));

    if (type == "dia") {
        var difDias = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numDias = Math.ceil(difDias / (1000 * 3600 * 24));
        return numDias;
    } else if (type == "mes") {
        var difMeses = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numMeses = Math.ceil(difMeses / (1000 * 3600 * 24 * 30) - 1);
        return numMeses;
    } else if (type == 'ano') {
        var difMeses = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numMeses = Math.ceil(difMeses / (1000 * 3600 * 24 * 30) - 1);
        return Math.floor(numMeses / 12);
    }
}

String.prototype.plusDays = function (srcFormat, days) {
    var dataFormatada = this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    });
    var dataGerada = new Date(dataFormatada);
    var dataFinal = "";
    dataGerada.setDate(dataGerada.getDate() + days);
    var mes = new String(dataGerada.getMonth() + 1).lpad('0', 2);
    var dia = new String(dataGerada.getDate()).lpad('0', 2);
    dataFinal = dia + '/' + mes + '/' + dataGerada.getFullYear();
    return dataFinal;
}

String.prototype.minusDays = function (srcFormat, days) {
    var dataFormatada = this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    });
    var dataGerada = new Date(dataFormatada);
    var dataFinal = "";
    dataGerada.setDate(dataGerada.getDate() - days);
    var mes = new String(dataGerada.getMonth() + 1).lpad('0', 2);
    var dia = new String(dataGerada.getDate()).lpad('0', 2);
    dataFinal = dia + '/' + mes + '/' + dataGerada.getFullYear();
    return dataFinal;
}

String.prototype.convertToNumber = function () {
    var codeString = this.substring(1, 12);
    var letter = this.substring(0, 1).toLowerCase();
    return letter.charCodeAt(0) - 96 + codeString;
}

String.prototype.lpad = function (padString, length) {
    var str = this;
    while (str.length < length)
        str = padString + str;
    return str;
}

String.prototype.getSigla = function () {
    var sigla = "";
    var name = this;

    if (name) {
        var userName = name.replace(new RegExp(/[-]/g), "");
        userName = userName.replace(new RegExp(/[\s]+/g), " ").trim();
        userName = userName.split(" ");
        var firstName = userName[0];
        var lastName = userName[userName.length - 1];
        sigla = firstName[0] + lastName[0];
    }

    return sigla;
}

String.prototype.rpad = function (padString, length) {
    var str = this;
    while (str.length < length)
        str = str + padString;
    return str;
}

String.prototype.trim = function () {
    return this.replace(/^\s+|\s+$/g, "");
}

//trimming space from left side of the string
String.prototype.ltrim = function () {
    return this.replace(/^\s+/, "");
}

//trimming space from right side of the string
String.prototype.rtrim = function () {
    return this.replace(/\s+$/, "");
}
"use strict";

$(document).ready(function () {
    $(window).on("resize", function () {
        $("ab-page").find("ab-button").each(function () {
            $(this).css("max-width", "100%");
            if ($(this).attr("width")) {
                $(this).css("width", $(this).attr("width"));
            }
        });
    });
});

class AbButton extends HTMLElement {

    constructor() {
        super();

        this.button = document.createElement("button");
        this.span = document.createElement("span");
        this.img = document.createElement("div");
        this.blocker = document.createElement("div");

        this.mainClass = "ab-button";

    }

    _render() {
        //coloca classe
        this.classList.add(this.mainClass);

        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificador único do objeto, com prefixo "btn"| Alfanumérico |não| randômico|
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        //Coloca os atributos no objeto
        if (this.hasAttribute("width")) {
            //description: Largura do botão| Alfanumérico| não| auto |
            this.style.width = this.getAttribute("width");
        }

        // if (this.hasAttribute("height")) {
        //     //description: Altura do botão| Alfanumérico| não| auto |
        //     this.style.height = this.getAttribute("height");
        // }

        if (this.getAttribute("last-button") == "true") {
            //description: Ultimo botão da página | Boolean | não | false |
            this.classList.add("ab-button-last-button");
        }

        //verifica width-on-bigscreen
        if ($("ab-page").attr("fullscreen") == "true") {
            if (this.hasAttribute("width-on-bigscreen")) {
                //description: Largura do componente em telas maiores| % ou px| não| |
                this.style.width = this.getAttribute("width-on-bigscreen");
            } else {
                this.style.maxWidth = "340px";
            }
        }

        //Cria botao
        this.button.setAttribute("id", id + "btn_button");
        this.appendChild(this.button);

        // adiciona o texto inserido no objeto para o span criado
        this.span.setAttribute("id", id + "btn_span");

        if (this.hasAttribute("label")) {
            //description: Colocar um texto no botão| Alfanumérico| sim| vazio|
            this.span.innerText = this.getAttribute("label").toUpperOnlyFirstLetter();
        }
        this.button.appendChild(this.span);

        // adiciona a imagem inserida no objeto no background de uma div
        this.img.setAttribute("div-image", "true");
        this.img.setAttribute("id", id + "btn_img");
        this.button.insertAdjacentElement("afterbegin", this.img);
        if (this.hasAttribute("icon") || this.hasAttribute("icon-class")) {
            this.img.style.backgroundImage = "url(" + this.getAttribute("icon") + ")";
            if (this.hasAttribute("icon-class")) {
                this.img.classList.add(this.getAttribute("icon-class"));
            }
        } else {
            this.img.style.display = "none";
        }

        // verifica se o botão é somente para mostrar o ícone e adiciona a classe
        if (this.getAttribute("icon-button") == "true") {
            //values: true;false
            //description: Trava o botão para ter somente o ícone| true ou false| não| false|
            this.classList.add("ab-button-img");
        }

        // verifica se tem o tamanho do icone e adiciona no tamanho do background
        if (this.hasAttribute("icon-size")) {
            //description: Altera o tamanho do icone| Número em px| não| |
            this.img.style.backgroundSize = this.getAttribute("icon-size");
        }

        // verifica se tem o tamanho do espaço do ícone e define a largura da div
        if (this.hasAttribute("icon-space-width")) {
            //description: Espaçamento do ícone com o texto| Número em px| não| |
            this.img.style.width = this.getAttribute("icon-space-width");
        }

        //Coloca cor no botao
        if (this.hasAttribute("theme")) {
            //values: normal;light;keyboard;keyboard-ok;dark-rounded;red-rounded;dark;vk
            //description: Altera a cor do componente| [[#Temas | Ver temas]]| não | vazio|
            this.classList.add("ab-button-" + this.getAttribute("theme"));
        } else if (this.getAttribute("theme") == "ab-button-keyboard") {
            this.classList.add("ab-button-keyboard");
        } else {
            this.classList.add("ab-button-normal");
        }

        if (this.getAttribute("position") == "center") {
            //values: center;right;left
            //description: Posição do botão| Center, right ou left| não| center|
            if (pmb.utils.showBigScreen(top.$("body")) == true) {
                this.classList.add("ab-button-center-big");
            } else {
                this.classList.add("ab-button-center");
            }
        } else if (this.getAttribute("position") == "left") {
            //não faz nada
        } else if (this.getAttribute("position") == "right") {
            this.style.float = this.getAttribute("position");
        }

        //verifica se tem max width
        if (this.hasAttribute("max-width")) {
            //description: Largura máxima do botão| Número em px| não| |
            this.style.maxWidth = this.getAttribute("max-width");
        }

        this.blocker.classList.add("ab-button-block");
        this.blocker.setAttribute("id", id + "btn_iblocker");
        this.appendChild(this.blocker);

        if (this.getAttribute("is-disabled") == "true") {
            //values: true;false
            this.button.setAttribute("disabled", "disabled");
            this.blocker.style.display = "block";
        }

        if (this.getAttribute("is-blocked") == "true") {
            //values: true;false
            this.blocker.style.display = "block";
        }

        if (this.getAttribute("visibility") == "hidden") {
            //values: hidden;show
            this.style.display = "none";
        }

        //Mesmo comportamento porém com outro nome de atributo, necessário ajustar todos projetos que usam o de cima
        if (this.getAttribute("visible") == "false") {
            //values: true;false
            this.style.display = "none";
        }

        //Limpa variaveis
        id = null;
    }

    _addEvent() {
        var button = $(this.button);
        var _this = this;

        // altera o ícone do botão quando o botão é apertado e se é passado o atributo icon-active
        button.on("touchstart mousedown", function (e) {

            //Proibe o clique em dois botões ao mesmo tempo
            if (e && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length > 1) {
                return;
            };

            //tira o foco de qualquer elemento
            document.activeElement.blur();
            $(window).focus();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //se tiver especificado icon-active adiciona no lugar do normal quando o evento inicia
                if (_this.hasAttribute("icon-active")) {
                    //description: Caminho do ícone que aparecerá quando o botão for ativado. | Alfanumérico| não| vazio|
                    if (_this.hasAttribute("icon-active")) {
                        _this.img.style.backgroundImage = "url(" + _this.getAttribute("icon-active") + ")";
                    }
                }
                // se tiver tema adiciona o tema no objeto
                if (_this.hasAttribute("theme")) {
                    _this.classList.add("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.add("ab-button-normal-active");
                };
            };
        });

        // altera o ícone do botão quando o botão é solto e se é passado o atributo icon-active
        button.on("mouseup touchend", function (e) {
            e.preventDefault();

            //tira o foco de qualquer elemento
            document.activeElement.blur();
            $(window).focus();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //retorna o icone para o normal quando o evento termina
                if (_this.hasAttribute("icon-active")) {
                    if (_this.hasAttribute("icon")) {
                        _this.img.style.backgroundImage = "url(" + _this.getAttribute("icon") + ")";
                    }
                }
                //retira o tema adicionado
                if (_this.hasAttribute("theme")) {
                    _this.classList.remove("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.remove("ab-button-normal-active");
                }
            }
        });

        //ação quando o mouse ou o touch deixar a área do objeto botão
        button.on("mouseleave touchleave", function (e) {
            e.preventDefault();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //retorna o icone para o normal quando o evento termina
                if (_this.hasAttribute("icon-active")) {
                    if (_this.hasAttribute("icon")) {
                        _this.img.style.backgroundImage = "url(" + iconActive + ")";
                    }
                }
                //retira o tema adicionado
                if (_this.hasAttribute("theme")) {
                    _this.classList.remove("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.remove("ab-button-normal-active");
                }
            }
        });

        $(this.blocker).on("tap", function (e) {
            e.preventDefault();
            e.stopPropagation();

            return false;
        });


    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({ mode: 'open' }); */
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return ["is-disabled", "label", "theme", "icon", "icon-class", "width", "icon-button", "icon-size", "icon-space-width", "visibility", "visible", "position", "width-on-bigscreen", "id", "max-width", "is-blocked"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "is-disabled":
                //Quando is-disable = true, desabilita o botão
                if (newVal == "true") {
                    this.button.setAttribute("disabled", "disabled");
                    this.blocker.style.display = "block";
                } else {
                    //Se o novo valor não habilitar o disable, ele retira as classes de active e remove o disable do botão
                    if (this.hasAttribute("theme")) {
                        this.classList.remove("ab-button-" + this.getAttribute("theme") + "-active");
                    } else {
                        this.classList.remove("ab-button-normal-active");
                    }

                    this.button.removeAttribute("disabled");
                    this.blocker.style.display = "none";
                }

                break;

            case "label":
                this.span.innerText = newVal.toUpperOnlyFirstLetter();
                break;

            case "theme":
                this.classList.remove("ab-button-" + oldVal);
                this.classList.remove("ab-button-normal");
                this.classList.add("ab-button-" + newVal);
                break;

            case "icon":
                this.img.style.display = "inline-block";
                this.img.style.backgroundImage = "url(" + newVal + ")";
                break;

            case "icon-class":
                this.img.style.display = "inline-block";
                this.img.classList.add(newVal);
                break;

            case "width":
                this.style.width = newVal;
                break;

            case "icon-button":
                if (newVal == "true") {
                    this.classList.add("ab-button-img");
                } else {
                    this.classList.remove("ab-button-img");
                }
                break;

            case "icon-size":
                this.img.style.backgroundSize = newVal;
                break;

            case "icon-space-width":
                this.img.style.width = newVal;
                break;

            case "visibility":
                if (newVal == "show") {
                    this.style.display = "table";
                } else if (newVal == "hidden") {
                    this.style.display = "none";
                }
                break;

            case "visible":
                if (newVal == "true") {
                    this.style.display = "table";
                } else if (newVal == "false") {
                    this.style.display = "none";
                }
                break;

            case "position":
                if (newVal == "center") {
                    if (pmb.utils.showBigScreen(top.$("body")) == true) {
                        this.classList.add("ab-button-center-big");
                    } else {
                        this.classList.add("ab-button-center");
                    }
                } else if (newVal == "right") {
                    this.style.float = newVal;
                }
                break;

            case "width-on-bigscreen":
                if (pmb.utils.showBigScreen(top.$("body"))) {
                    this.style.width = newVal;
                }
                break;

            case "id":
                this.img.setAttribute("id", newVal + "btn_img");
                this.button.setAttribute("id", newVal + "btn_button");
                this.span.setAttribute("id", newVal + "btn_span");
                this.blocker.setAttribute("id", newVal + "btn_iblocker");
                break;

            case "max-width":
                this.style.maxWidth = newVal;
                break;

            case "is-blocked":
                //Trata a alteração do atributo is-disable
                //Quando is-disable = true, desabilita o botão
                if (newVal == "true") {
                    this.blocker.style.display = "block";
                } else {
                    //Se o novo valor não habilitar o disable, ele retira as classes de active e remove o disable do botão
                    if (this.hasAttribute("theme")) {
                        this.classList.remove("ab-button-" + this.getAttribute("theme") + "-active");
                    } else {
                        this.classList.remove("ab-button-normal-active");
                    }
                    this.blocker.style.display = "none";
                }
                break;

            default:
                break;
        }
    }
}
customElements.define("ab-button", AbButton);
"use strict";

$(document).ready(function () {
    $(window).on("resize", function () {
        $("ab-page").find("ab-box").each(function () {
            if ($(this).attr("width")) {
                $(this).css("width", $(this).attr("width"));
            } else {
                $(this).css("width", "100%");
            };
        });
    });
});

class AbBox extends HTMLElement {

    constructor() {
        super();

        this.boxHeader = document.createElement("header");
        this.boxHeaderText = document.createElement("p");
        this.divFooter = document.createElement("footer");

        this.mainClass = "ab-box";
        
    }

    _render() {
        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificador único do objeto, com prefixo "box" | Alfanumérico | Não | Normal |
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        $(this).addClass("ab-box");

       // style.innerText = " .ab-box[status='analise'] { --border-status: 8px solid var(--box-status-analise); } .ab-box[status='ativo'] { --border-status: 8px solid var(--box-status-ativo); } .ab-box[status='inativo'] { --border-status: 8px solid var(--box-status-inativo); } .ab-box[status='cancelado'] { --border-status: 8px solid var(--box-status-cancelado); } :host(.ab-box) { box-sizing: border-box; display: inline-block; overflow: hidden; float: left; margin: 8px; width: -webkit-calc(100% - 16px); width: -moz-calc(100% - 16px); width: -o-calc(100% - 16px); width: calc(100% - 16px); border-radius: 5px; border-left: var(--border-status); box-shadow: var(--shadow-lv2); } .ab-box-content { box-sizing: border-box; padding: 8px; display: var(--boxDisp); justify-content: space-between; align-items: center; background-color: var(--bg-components); height: initial; overflow: hidden; float: var(--boxFloat); width: 100%; position: relative; } :host(.ab-box-expandable) .ab-box-content { padding: 8px; } .ab-box-footer { float: left; height: 40px; width: 100%; background-size: 20px; background-repeat: no-repeat; background-position: center; bottom: 0px; left: 8px; background-color: var(--bg-components); cursor: pointer; } :host(.ab-box-closed) :host(.ab-box-opened) .ab-box-content { max-height: 9000% !important; } :host(.ab-box-opened) .ab-box-form .ab-box-content { max-height: 100px } .ab-box-content::slotted(label) { font-size: 13px; font-family: 'ablinkmedium'; line-height: 18px; color: var(--cor-pri-text); display: block; width: 100%; padding: 8px; box-sizing: border-box; float: left; } .ab-box-title { box-sizing: border-box; display: inline-block; background-color: var(--bg-components); height: 50px; float: left; width: 100%; } .ab-box-title-text { line-height: 50px; box-sizing: border-box; font-size: 16px; font-family: 'ablinksemiboldregular'; font-weight: normal; color: var(--cor-titulo); float: left; padding-left: 8px; margin: 0px; } .ab-box-div-buttons { float: left; display: table; width: 100%; table-layout: fixed; vertical-align: top; background-color: var(--bg-components); margin-top: -5px; padding: 0px 16px 16px 16px; box-sizing: border-box; z-index: 1; position: relative; } br { line-height: 20px; }";

        if (this.getAttribute("theme") == 'flex'){
            $(this).addClass("ab-box__flex");            
        } else if (this.getAttribute("theme") == 'ativo'){
            $(this).addClass("ab-box__ativo");            
        } else if (this.getAttribute("theme") == 'inativo'){
            $(this).addClass("ab-box__inativo");
        } else if (this.getAttribute("theme") == 'dark'){
            $(this).addClass("ab-box__dark");
        }



        //Classe base
        this.classList.add(this.mainClass);

        //Coloca titulo
        this.boxHeader.setAttribute("id", id + "_div_title");
        this.boxHeader.classList.add("ab-box-title");


        this.boxHeader.appendChild(this.boxHeaderText);
        this.boxHeaderText.setAttribute("id", id + "_div_text");
        this.boxHeaderText.classList.add("ab-box-title-text");

        if (this.hasAttribute("title")) {
            //description: Coloca um título | Alfanumérico | não |não|
            this.boxHeaderText.innerText = this.getAttribute("title");
        } else {
            this.boxHeader.style.display = "none";
        }


        if (this.hasAttribute("max-width")) {
            //description: Define o tamanho máximo | Tamanho em pixel | não |100%|
            this.style.maxWidth = this.getAttribute("max-width");
        }

        if (this.hasAttribute("width")) {
            //description: Ativa ou desativa o max-width | true ou false| não|false|
            this.style.width = this.getAttribute("max-width");
        }

        //div para fazer a seta que expande o box
        this.divFooter.setAttribute("id", id + "_footer");
        this.divFooter.classList.add("ab-box-footer");

        //verifica se existe a altura inicial, considerado para expandir
        if (this.hasAttribute("initial-height")) {
            //description: Define a altura inicial do componente quando precisa ser expandido| 100px, 200px, 300px| não|não|

            //adicionando classes para considerar o footer
            this.classList.add("ab-box-expandable");

            if (!this.hasAttribute("is-opened")) {
                this.classList.add("ab-box-closed");
            }
        } else {
            this.divFooter.style.display = "none";
        }

        if (this.getAttribute("visibility") == "hidden") {
            //values: hidden
            //description: Se o parâmetro estiver presente com o valor "hidden", esconde o objeto | hidden | não| não|
            this.style.display = "none";
        }

        if (this.hasAttribute("width-on-bigscreen")) {
            //description: Define uma largura para quando estiver em tela grande (tablets, pc) | Numérico | não| não|
            if ($("ab-page").attr("fullscreen") == "true"){
                this.style.width = this.getAttribute("width-on-bigscreen");
            }
        }

        if (this.hasAttribute("status")) {
            this.boxHeader.setAttribute("status", this.getAttribute("status"));
            this.divFooter.setAttribute("status", this.getAttribute("status"));
        }

        //for legacy substituir todos os h1 dos box por h3
        for (const element of this.children) {
            if (element.tagName == "H1") {
                element.outerHTML = element.outerHTML.replace(/h1/g,"h3");
            }            
        }
    }

    _addEvent() {
        var _this = this;

        $(this.divFooter).on("tap", function (e) {
            e.preventDefault();
            e.stopPropagation();

            if (_this.getAttribute("is-opened") == "true") {
                //values: true;false
                //description: Se possuir initial-height, inicia aberto ou fechado | true ou false | não | false|
                _this.setAttribute("is-opened", "false");
            } else {
                _this.setAttribute("is-opened", "true");
            }
        });

    }


    connectedCallback() {
        if (!this.classList.contains("ab-box")) {
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return ["is-opened", "max-width", "title", "theme", "initial-height", "id", "visibility", "width-on-bigscreen", "status"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        switch (attrName) {
            case "is-opened":
                if (newVal == "true") {
                    this.classList.add("ab-box-opened");
                    this.classList.remove("ab-box-closed");
                } else if (newVal == "false") {
                    this.classList.add("ab-box-closed");
                    this.classList.remove("ab-box-opened");
                }
                break;
    
            case "max-width":
                if (newVal) {
                    this.style.maxWidth = newVal;
                } else {
                    this.style.maxWidth = "";
                }
                break;
    
            case "title":
    
                if (newVal) {
                    this.boxHeader.style.display = "block";
                    this.boxHeaderText.innerText = newVal;
                } else {
                    this.boxHeader.style.display = "none";
                    this.boxHeaderText.innerText = "";
                }
                break;
    
            case "theme":
                if (newVal) {
                    this.boxHeader.classList.add("ab-box-title-" + newVal);
                    this.divFooter.classList.add("ab-box-footer-" + newVal);
                } else {
                    this.boxHeader.classList.remove("ab-box-title-" + oldVal);
                    this.divFooter.classList.remove("ab-box-footer-" + newVal);
                }
                break;
    
            case "initial-height":
                //adiciona a altura inicial na altura do objeto
                //seta Max height
                if (newVal) {
                    this.classList.add("ab-box-expandable");
                    this.divFooter.style.display = "block";
                } else {
                    this.classList.remove("ab-box-expandable");
                    this.divFooter.style.display = "none";
                }
    
                //Box aberto ou fechado
                if (this.getAttribute("is-opened") == "false" || !this.hasAttribute("is-opened")) {
                    this.classList.add("ab-box-closed");
                } else {
                    this.classList.remove("ab-box-closed");
                }
                break;
    
            case "id":
                //muda ids
                this.boxHeader.setAttribute("id", newVal + "_div_title");
                this.boxHeaderText.setAttribute("id", newVal + "_div_text");
                this.divFooter.setAttribute("id", newVal + "_footer");
                break;
    
            case "visibility":
                if (newVal == "show") {
                    this.style.display = "inline-block";
                } else if (newVal == "hidden") {
                    this.style.display = "none";
                }
                break;
    
            case "width-on-bigscreen":
                if ($("ab-page").attr("fullscreen") == "true"){
                    this.style.width = newVal;
                }
                break;

            case "status":
                this.boxHeader.setAttribute("status", newVal);
                this.divFooter.setAttribute("status", newVal);
                break;
        
            default:
                break;
        }
    }


}
customElements.define('ab-box', AbBox);
"use strict";

$(document).ready(function () {
    $(window).on("resize", function () {
        $("ab-page").find("ab-checkbox").each(function () {
            if ($(this).attr("width-on-bigscreen")) {
                if ($(this).attr("width")) {
                    $(this).css("width", $(this).attr("width"));
                } else {
                    $(this).css("width", "100%");
                }
            }
        });
    });
});

class AbCheckbox extends HTMLElement {

    constructor() {
        super();

        this.checkspace = document.createElement("div");
        this.spanLabel = document.createElement("span");
        this.spanSubtitle = document.createElement("span");

        this.mainClass = "ab-checkbox";

        this._addEvent();
    }

    _render() {
        //coloca classe
        this.classList.add(this.mainClass);

        //Cria um id
        let id = generateID();
        if (this.hasAttribute("id")) {
            //description: Define se a checkbox já estará selecionada| Boolean | não| false|
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        //armazena o conteúdo passado no html
        let conteudo = this.innerHTML;
        this.innerHTML = "";

        //Coloca os atributos no objeto
        if (this.hasAttribute("width")) {
            //description: Largura do componente (afeta somente o espaço que terá para text, não altera o tamanho da checkbox)| % ou px| não| 100%|
            this.style.width = this.getAttribute("width");
            this.style.maxWidth = this.getAttribute("width");
        }

        //Obrigatorio checagem abaixo do width
        if (this.hasAttribute("width-on-bigscreen")) {
            //description: Define a largura do compenente em telas maiores (afeta somente o espaço que terá para text, não altera o tamanho da checkbox)| % ou px| não| |
            if (pmb.utils.showBigScreen(top.$("body"))) {
                this.style.width = this.getAttribute("width-on-bigscreen");
            }
        }

        //Cria check
        this.checkspace.classList.add("ab-checkbox-checkspace");
        this.checkspace.setAttribute("id", id + "chk_checkbox");
        this.appendChild(this.checkspace);

        //insere o conteúdo no objeto
        this.spanLabel.classList.add("ab-checkbox-title");
        this.spanLabel.setAttribute("content-area", "true")
        this.spanLabel.setAttribute("id", id + "chk_label");
        if (conteudo) {
            this.spanLabel.innerHTML = conteudo;
        } else {
            if (this.hasAttribute("label")) {
                //description: Label do componente |  | não | |
                this.spanLabel.innerText = this.getAttribute("label");
            }
        }
        this.appendChild(this.spanLabel);

        this.spanSubtitle.classList.add("ab-checkbox-subtitle");
        this.spanSubtitle.setAttribute("id", id + "chk_subtitle");
        this.spanSubtitle.innerText = this.getAttribute("subtitle");
        this.appendChild(this.spanSubtitle);

        //Define se deverá ser alinhado a direita
        if (this.getAttribute("position") == "right") {
            //values: left;right
            //description: Define para onde estará posicionado o checkbox| Posição | não| left|
            this.style.float = this.getAttribute("position");
            this.style.paddingRight = "15px";
        }

        if (this.getAttribute("is-disabled") == "true") {
            //values: true;false
            //description: Define se a checkbox estará desativada| Boolean | não| false|
            this.checkspace.setAttribute("disabled", "disabled");
            this.classList.add("ab-checkbox-disabled");
        }

        //verifica se tem max width
        if (this.hasAttribute("max-width")) {
            //description: Largura máxima do componente | % ou px | não | |
            this.style.maxWidth = this.getAttribute("max-width");
        }

        if (this.hasAttribute("subtitle")) {
            //description: Subtitulo do componente |  | não | |
            this.spanSubtitle.innerText = this.getAttribute("subtitle");
        }

        //Limpa variaveis
        id = null;
        conteudo = null;
    }

    _addEvent() {
        let _this = this;
        $(this).on("tap", function (e) {
            e.preventDefault();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                if (_this.getAttribute("is-checked") == "true") {
                    _this.setAttribute("is-checked", "false");
                } else {
                    _this.setAttribute("is-checked", "true");
                }
            }

            //Chama a funcao
            if (_this.hasAttribute("onvalidate")) {
                let fn = window[_this.getAttribute("onvalidate")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                } else {
                    fn = new Function(_this.getAttribute("onvalidate"));
                    fn.call($(_this));
                }
            }
        });
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({ mode: 'open' }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["is-disabled", "is-checked", "width", "width-on-bigscreen", "id", "subtitle", "label"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "is-disabled":
                if (newVal == "true") {
                    this.checkspace.setAttribute("disabled", "disabled");
                    this.classList.add("ab-checkbox-disabled");
                } else {
                    this.checkspace.removeAttribute("disabled");
                    this.classList.remove("ab-checkbox-disabled");
                }
                break;

            case "is-checked":
                //Quando is-disable = true, desabilita o botão
                if (newVal == "true") {
                    this.classList.remove("ab-checkbox-checkspace-middle");
                    this.classList.add("ab-checkbox-checkspace-checked");
                } else if (newVal == "neutral") {
                    this.classList.remove("ab-checkbox-checkspace-checked");
                    this.classList.add("ab-checkbox-checkspace-middle");
                } else {
                    this.classList.remove("ab-checkbox-checkspace-middle");
                    this.classList.remove("ab-checkbox-checkspace-checked");
                }

                if (this.getAttribute("cancel-callback") != "true") {
                    if (this.hasAttribute("onchange")) {
                        let fn = window[this.getAttribute("onchange")];
                        if (typeof fn === 'function') {
                            fn.call($(this));
                        }
                    }
                }
                break;

            case "width":
                this.style.width = newVal;
                break;

            case "width-on-bigscreen":
                if (pmb.utils.showBigScreen(top.$("body"))) {
                    this.style.width = newVal;
                }
                break;

            case "id":
                this.checkspace.setAttribute("id", newVal + "chk_checkbox");
                this.spanLabel.setAttribute("id", newVal + "chk_label");
                this.spanSubtitle.setAttribute("id", newVal + "chk_subtitle");
                break;

            case "subtitle":
                this.spanSubtitle.innerText = newVal;
                break;

            case "label":
                this.spanLabel.innerHTML = newVal;
                break;

            default:
                break;
        }
    }

    setText(text) {
        this.spanLabel.innerHTML = text;
    }

    getText() {
        return this.spanLabel.innerText;
    }

    setNumber(text) {
        if (text == 1 || text == true) {
            this.setAttribute("is-checked", "true");
        } else {
            this.setAttribute("is-checked", "false");
        }
    }

    getNumber() {
        if (this.getAttribute("is-checked") == "true") {
            return "1";
        } else if ($(this).attr("is-checked") == "false") {
            return "0";
        }
    }
}
customElements.define("ab-checkbox", AbCheckbox);
"use strict";

$.fn.incrementRequest = function () {
    var curr = 0;
    if (this.attr("current-request")) {
        curr = parseInt(this.attr("current-request"));
    }

    curr++;
    this.attr("current-request", curr);
}

$.fn.resetRequest = function () {
    this.removeAttr("current-request");
}

class AbPage extends HTMLElement {

    constructor() {
        super();

        this.htmlObj = $("html,body")[0];

        //pageLoader
        this.pageLoad = document.createElement("div");
        this.wrapper = document.createElement("div");
        this.loadBar = document.createElement("div");
        this.barRange = document.createElement("div");
        this.loadText = document.createElement("p");

        this.mainClass = "ab-page";
    }

    _render() {
        this.classList.add(this.mainClass);

        //Cria um id
        if (!this.hasAttribute("id")) {
            //description: Atributo para identificar o objeto| Alfanumérico| não| vazio|
            this.setAttribute("id", generateID());
        }

        // parametros
        if (this.getAttribute("fullscreen") != "false") {
            //values: true;false
            //description: Usa o tamanho total da tela | true ou false | não | true |
            this.htmlObj.style.margin = "0px";
            this.htmlObj.style.padding = "0px";
            this.htmlObj.style.width = "100%";
            this.htmlObj.style.height = "100%";

            this.style.top = "0px";
            this.style.left = "0px";
            this.style.bottom = "0px";
            this.style.right = "0px";
            this.style.height = "100%";
            this.style.width = "100%";
            this.style.position = "fixed";
        } else{
            $(this).addClass("page--limited");
        }

        // Valor padrao
        this.style.zIndex = "0";

        //se existir um max-request, construir o sistema de load
        if (this.hasAttribute("max-request")) {
            //description: Máximo de requests que terá na página para o loader | Numérico | não | 0 |
            this._createLoader();
        } else{
            document.querySelector("html").classList.add("html-page-loaded");
        }

    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["loader-visibility", "current-request"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        if (attrName == "loader-visibility") {
            if (newVal != "true") {
                $(this.logo).fadeOut(100, function () {
                    this.remove();
                });

                $(this.pageLoad).fadeOut(100, function () {
                    this.remove();
                });
            } else if (this.pageLoad.length == 0) {
                this._createLoader();
            } else {
                $(this.pageLoad).fadeIn(100);
            }

        } else if (attrName == "current-request") {
            var reqAtual = parseInt(newVal);
            var reqMax = parseInt(this.getAttribute("max-request"));
            var total = ((100 / reqMax) * reqAtual);

            this.barRange.style.width = total + "%";

            if (total >= 100) {
                this.setAttribute("loader-visibility", "false");
                document.querySelector("html").classList.add("html-page-loaded");
            }

            reqAtual = null;
            reqMax = null;
            total = null;
        }
    }

    _createLoader() {

        this.pageLoad.classList.add("ab-page-loader");
        this.pageLoad.setAttribute("id", "ab-page-loader");
        this.pageLoad.style.display = "block";
        this.appendChild(this.pageLoad);

        this.wrapper.classList.add("ab-page-loader-wrapper");
        this.pageLoad.appendChild(this.wrapper);

        this.loadBar.classList.add("ab-page-loader-path");
        this.wrapper.appendChild(this.loadBar);

        this.barRange.classList.add("ab-page-loader-range");
        this.barRange.setAttribute("id", "ab-page-loader-range");
        this.loadBar.appendChild(this.barRange);

        this.loadText.classList.add("ab-page-loader-text");
        this.loadText.innerText = "carregando...";
        this.wrapper.appendChild(this.loadText);
    }
}
customElements.define('ab-page', AbPage);
"use strict";

$(document).ready(function () {
    $(window).on("resize", function () {
        $("ab-page").find("ab-text-read-only").each(function () {
            if ($(this).attr("width-on-bigscreen")) {
                if ($("ab-page").attr("fullscreen") == "true"){
                    $(this).css("width", $(this).attr("width-on-bigscreen"));
                    $(this).addClass("bradesco-text-read-only-bigscreen");
                } else {
                    $(this).removeClass("bradesco-text-read-only-bigscreen")
                    if ($(this).attr("width")) {
                        $(this).css("width", $(this).attr("width"));
                    } else {
                        $(this).css("width", "100%");
                    }
                }
            }
        });
    });
});


class AbTextReadOnly extends HTMLElement {

    constructor() {
        super();

        this.label = document.createElement("legend");
        this.text = document.createElement("p");

        this.mainClass = "ab-text-read-only";
    }

    _render() {
        //Cria um id
        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificação do componente. Atributo obrigatório para interagir com o objeto | Alfanumérico | sim | vazio |
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        };

        var contentHtml = this.innerHTML ;
        this.innerHTML = "";

        //coloca classe
        this.classList.add(this.mainClass);

        //width
        if (this.hasAttribute("width")) {
            //description: Define a largura do componente| % ou px| não| |
            this.style.width = this.getAttribute("width");
        };

        //verifica width-on-bigscreen
        if (this.hasAttribute("width-on-bigscreen")) {
            //description: Define a largura do componente em telas maiores| % ou px| não| |
            if (pmb.utils.showBigScreen(top.$("body"))) {
                this.classList.add("ab-text-read-only-bigscreen")
                this.style.width = this.getAttribute("width-on-bigscreen");
            } else {
                this.classList.remove("ab-text-read-only-bigscreen")
            }
        };

        //Coloca Label
        this.label.setAttribute("id", id + "label");

        if (this.hasAttribute("label")) {
            //description: Colocar uma descrição que represente o valor que será colocado no input da página | Alfanumérico | não | vazio |
            this.label.innerText = this.getAttribute("label");
        }
        this.appendChild(this.label);

        //Coloca Input
        this.text.classList.add("ab-paragrafo-medio");
        this.text.setAttribute("id", id + "text");
        if (contentHtml.length > 0) {
            this.text.innerHTML = contentHtml;
        }
        this.appendChild(this.text);

        //visible
        if (this.getAttribute("visible") == "false") {
            //values: true;false
            //description: Define se o componente estará visível | Boolean | não| true |
            this.style.display = "none";
        };

        //limpa variaveis
        id = null;
        contentHtml = null;
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["label", "id", "width", "width-on-bigscreen", "visible"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "label":
                this.label.innerText = newVal;
                break;
    
            case "id":
                this.label.setAttribute("id", newVal + "label");
                this.text.setAttribute("id", newVal + "text");
                break;
    
            case "width":
                this.style.width = newVal;
                break;
    
            case "width-on-bigscreen":
                if ($("ab-page").attr("fullscreen") == "true"){
                    this.style.width = this.getAttribute("width-on-bigscreen");
                }
                break;
    
            case "visible":
                if (newVal == "true") {
                    this.style.display = "inline-block";
                } else if (newVal == "false") {
                    this.style.display = "none";
                }
                break;
        
            default:
                break;
        }
    }

    setText(text) {
        this.text.innerHTML = text;
    }

    getText() {
        return this.text.innerText;
    }

    getText() {
        return this.text.innerText;
    }

    setHtml() {

    }
}
customElements.define('ab-text-read-only', AbTextReadOnly);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFiLXN1cHBvcnQvanMvYWItZml4LmpzIiwiYWItc3VwcG9ydC9qcy9hYi11dGlsLmpzIiwiYWItYnV0dG9uL2pzL2FiLWJ1dHRvbi5qcyIsImFiLWJveC9qcy9hYi1ib3guanMiLCJhYi1jaGVja2JveC9qcy9hYi1jaGVja2JveC5qcyIsImFiLXBhZ2UvanMvYWItcGFnZS5qcyIsImFiLXRleHQtcmVhZC1vbmx5L2pzL2FiLXRleHQtcmVhZC1vbmx5LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0VEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDelBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDblBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoid2ViY29tcC5hYm5lci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLy9WZXJmaWNhIFNpc3RlbWEgT3BlcmFjaW9uYWxcbndpbmRvdy5pc0lPUyA9ICgvaVBhZHxpUGhvbmV8aVBvZC8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pIHx8IChuYXZpZ2F0b3IucGxhdGZvcm0gPT09ICdNYWNJbnRlbCcgJiYgbmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzID4gMSkpICYmICF3aW5kb3cuTVNTdHJlYW07XG53aW5kb3cuaXNBbmRyb2lkID0gLyhhbmRyb2lkKS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XG53aW5kb3cuaXNEZXNrdG9wID0gIXdpbmRvdy5pc0lPUyAmJiAhd2luZG93LmlzQW5kcm9pZDtcblxuKGZ1bmN0aW9uKHcsICQsIHVuZGVmaW5lZCkge1xuXG4gICAgdy50YXBIYW5kbGluZyA9IGZhbHNlO1xuICAgIHcudGFwcHkgPSB0cnVlO1xuXG4gICAgdmFyIHRhcCA9IGZ1bmN0aW9uKCRlbHMpIHtcbiAgICAgICAgcmV0dXJuICRlbHMuZWFjaChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICRlbCA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgcmVzZXRUaW1lcixcbiAgICAgICAgICAgICAgICBzdGFydFksXG4gICAgICAgICAgICAgICAgc3RhcnRYLFxuICAgICAgICAgICAgICAgIGNhbmNlbCxcbiAgICAgICAgICAgICAgICBzY3JvbGxUb2xlcmFuY2UgPSAxMDtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdHJpZ2dlcihlKSB7XG4gICAgICAgICAgICAgICAgJChlLnRhcmdldCkudHJpZ2dlcihcInRhcFwiLCBbZSwgJChlLnRhcmdldCkuYXR0cihcImhyZWZcIildKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q29vcmRzKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXYgPSBlLm9yaWdpbmFsRXZlbnQgfHwgZSxcbiAgICAgICAgICAgICAgICAgICAgdG91Y2hlcyA9IGV2LnRvdWNoZXMgfHwgZXYudGFyZ2V0VG91Y2hlcztcblxuICAgICAgICAgICAgICAgIGlmICh0b3VjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbdG91Y2hlc1swXS5wYWdlWCwgdG91Y2hlc1swXS5wYWdlWV07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBzdGFydChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUudG91Y2hlcyAmJiBlLnRvdWNoZXMubGVuZ3RoID4gMSB8fCBlLnRhcmdldFRvdWNoZXMgJiYgZS50YXJnZXRUb3VjaGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBjb29yZHMgPSBnZXRDb29yZHMoZSk7XG4gICAgICAgICAgICAgICAgc3RhcnRYID0gY29vcmRzWzBdO1xuICAgICAgICAgICAgICAgIHN0YXJ0WSA9IGNvb3Jkc1sxXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYW55IHRvdWNoc2Nyb2xsIHRoYXQgcmVzdWx0cyBpbiA+IHRvbGVyYW5jZSBzaG91bGQgY2FuY2VsIHRoZSB0YXBcbiAgICAgICAgICAgIGZ1bmN0aW9uIG1vdmUoZSkge1xuICAgICAgICAgICAgICAgIGlmICghY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb29yZHMgPSBnZXRDb29yZHMoZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb29yZHMgJiYgKE1hdGguYWJzKHN0YXJ0WSAtIGNvb3Jkc1sxXSkgPiBzY3JvbGxUb2xlcmFuY2UgfHwgTWF0aC5hYnMoc3RhcnRYIC0gY29vcmRzWzBdKSA+IHNjcm9sbFRvbGVyYW5jZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVuZChlKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHJlc2V0VGltZXIpO1xuICAgICAgICAgICAgICAgIHJlc2V0VGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB3LnRhcEhhbmRsaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuXG4gICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG5vIG1vZGlmaWVycyBhcmUgcHJlc2VudC4gdGh4IGh0dHA6Ly93d3cuamFja2xtb29yZS5jb20vbm90ZXMvY2xpY2stZXZlbnRzL1xuICAgICAgICAgICAgICAgIGlmICgoZS53aGljaCAmJiBlLndoaWNoID4gMSkgfHwgZS5zaGlmdEtleSB8fCBlLmFsdEtleSB8fCBlLm1ldGFLZXkgfHwgZS5jdHJsS2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAvLyB0aGlzIHBhcnQgcHJldmVudHMgYSBkb3VibGUgY2FsbGJhY2sgZnJvbSB0b3VjaCBhbmQgbW91c2Ugb24gdGhlIHNhbWUgdGFwXG5cbiAgICAgICAgICAgICAgICAvLyBpZiBhIHNjcm9sbCBoYXBwZW5lZCBiZXR3ZWVuIHRvdWNoc3RhcnQgYW5kIHRvdWNoZW5kXG4gICAgICAgICAgICAgICAgaWYgKGNhbmNlbCB8fCB3LnRhcEhhbmRsaW5nICYmIHcudGFwSGFuZGxpbmcgIT09IGUudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHcudGFwSGFuZGxpbmcgPSBlLnR5cGU7XG4gICAgICAgICAgICAgICAgdHJpZ2dlcihlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJGVsXG4gICAgICAgICAgICAgICAgLmJpbmQoXCJ0b3VjaHN0YXJ0LnRhcHB5IE1TUG9pbnRlckRvd24udGFwcHlcIiwgc3RhcnQpXG4gICAgICAgICAgICAgICAgLmJpbmQoXCJ0b3VjaG1vdmUudGFwcHkgTVNQb2ludGVyTW92ZS50YXBweVwiLCBtb3ZlKVxuICAgICAgICAgICAgICAgIC5iaW5kKFwidG91Y2hlbmQudGFwcHkgTVNQb2ludGVyVXAudGFwcHlcIiwgZW5kKVxuICAgICAgICAgICAgICAgIC5iaW5kKFwiY2xpY2sudGFwcHlcIiwgZW5kKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciB1bnRhcCA9IGZ1bmN0aW9uKCRlbHMpIHtcbiAgICAgICAgcmV0dXJuICRlbHMudW5iaW5kKFwiLnRhcHB5XCIpO1xuICAgIH07XG5cbiAgICAvLyB1c2Ugc3BlY2lhbCBldmVudHMgYXBpXG4gICAgaWYgKCQuZXZlbnQgJiYgJC5ldmVudC5zcGVjaWFsKSB7XG4gICAgICAgICQuZXZlbnQuc3BlY2lhbC50YXAgPSB7XG4gICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGhhbmRsZU9iaikge1xuICAgICAgICAgICAgICAgIHRhcCgkKHRoaXMpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKGhhbmRsZU9iaikge1xuICAgICAgICAgICAgICAgIHVudGFwKCQodGhpcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG1vbmtleWJpbmRcbiAgICAgICAgdmFyIG9sZEJpbmQgPSAkLmZuLmJpbmQsXG4gICAgICAgICAgICBvbGRVbmJpbmQgPSAkLmZuLnVuYmluZDtcbiAgICAgICAgJC5mbi5iaW5kID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICBpZiAoLyhefCApdGFwKCB8JCkvLnRlc3QoZXZ0KSkge1xuICAgICAgICAgICAgICAgIHRhcCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvbGRCaW5kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH07XG4gICAgICAgICQuZm4udW5iaW5kID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICBpZiAoLyhefCApdGFwKCB8JCkvLnRlc3QoZXZ0KSkge1xuICAgICAgICAgICAgICAgIHVudGFwKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG9sZFVuYmluZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9O1xuICAgIH1cblxufSh0aGlzLCBqUXVlcnkpKTtcblxuXG4vLyBBUlJVTUEgRVJSTyBOTyBJRTkgT05ERSBOQU8gRVhJU1RFIFdJTkRPVy5DT05TT0xFXG5pZiAoIXdpbmRvdy5jb25zb2xlKSB7XG4gICAgdmFyIGNvbnNvbGUgPSB7XG4gICAgICAgIGxvZzogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgd2FybjogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgIHRpbWU6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgIHRpbWVFbmQ6IGZ1bmN0aW9uKCkge31cbiAgICB9XG59XG5cbi8qIEFSUlVNQSBJTlBVVCBOTyBJT1MgUVVFIE5BTyBGVU5DSU9OQSBESVJFSVRPICovXG4vKiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIGlmICh3aW5kb3cuaXNJT1MpIHtcbiAgICAgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpO1xuICAgICAgICAgICAgICAgICQoJzpmb2N1cycpLmZvY3VzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59KTsqL1xuXG52YXIgZ2V0WFkgPSBmdW5jdGlvbihldmVudCkge1xuICAgIHZhciB4ID0gbnVsbDtcbiAgICB2YXIgeSA9IG51bGw7XG5cbiAgICBpZiAoZXZlbnQub3JpZ2luYWxFdmVudCAhPSBudWxsICYmIGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlcyAhPSBudWxsKSB7XG4gICAgICAgIHZhciB0b3VjaCA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXSB8fCBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuICAgICAgICB4ID0gcGFyc2VGbG9hdCh0b3VjaC5wYWdlWCk7XG4gICAgICAgIHkgPSBwYXJzZUZsb2F0KHRvdWNoLnBhZ2VZKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB4ID0gcGFyc2VGbG9hdChldmVudC5wYWdlWCk7XG4gICAgICAgIHkgPSBwYXJzZUZsb2F0KGV2ZW50LnBhZ2VZKTtcbiAgICB9XG5cbiAgICB2YXIgcG9zID0gbmV3IE9iamVjdCgpO1xuICAgIHBvcy54ID0geDtcbiAgICBwb3MueSA9IHk7XG5cbiAgICByZXR1cm4gcG9zO1xufVxuXG52YXIgc3VwcG9ydDNkID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJldCA9IGZhbHNlO1xuICAgIHZhciBzdXBwb3J0czNEVHJhbnNmb3JtcyA9IGRvY3VtZW50LmJvZHkuc3R5bGVbJ3dlYmtpdFBlcnNwZWN0aXZlJ10gIT09IHVuZGVmaW5lZCB8fCBkb2N1bWVudC5ib2R5LnN0eWxlWydNb3pQZXJzcGVjdGl2ZSddICE9PSB1bmRlZmluZWQ7XG4gICAgaWYgKHN1cHBvcnRzM0RUcmFuc2Zvcm1zKSB7XG4gICAgICAgIHJldCA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5cbnZhciBnZXRUcmFuc2Zvcm0gPSBmdW5jdGlvbihlbCkge1xuICAgIHZhciBwcm9wID0gXCJcIjtcblxuICAgIGlmIChlbC5jc3MoJy13ZWJraXQtdHJhbnNmb3JtJykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHByb3AgPSBlbC5jc3MoJy13ZWJraXQtdHJhbnNmb3JtJyk7XG4gICAgfSBlbHNlIGlmIChlbC5jc3MoJ3RyYW5zZm9ybScpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICBwcm9wID0gZWwuY3NzKCd0cmFuc2Zvcm0nKTtcbiAgICB9IGVsc2UgaWYgKGVsLmNzcygnLW1vei10cmFuc2Zvcm0nKSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcCA9IGVsLmNzcygnLW1vei10cmFuc2Zvcm0nKTtcbiAgICB9IGVsc2UgaWYgKGVsLmNzcygnLW1zLXRyYW5zZm9ybScpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICBwcm9wID0gZWwuY3NzKCctbXMtdHJhbnNmb3JtJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFswLCAwLCAwXTtcbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0cyA9IHByb3AubWF0Y2goL21hdHJpeCg/OigzZClcXCgtezAsMX1cXGQrKD86LCAtezAsMX1cXGQrKSooPzosICgtezAsMX1cXGQrKSkoPzosICgtezAsMX1cXGQrKSkoPzosICgtezAsMX1cXGQrKSksIC17MCwxfVxcZCtcXCl8XFwoLXswLDF9XFxkKyg/OiwgLXswLDF9XFxkKykqKD86LCAoLXswLDF9XFxkKykpKD86LCAoLXswLDF9XFxkKykpXFwpKS8pO1xuXG4gICAgaWYgKCFyZXN1bHRzKVxuICAgICAgICByZXR1cm4gWzAsIDAsIDBdO1xuICAgIGlmIChyZXN1bHRzWzFdID09ICczZCcpXG4gICAgICAgIHJldHVybiByZXN1bHRzLnNsaWNlKDIsIDUpO1xuXG4gICAgcmVzdWx0cy5wdXNoKDApO1xuICAgIHJldHVybiByZXN1bHRzLnNsaWNlKDUsIDgpO1xufVxuXG52YXIgZ29Ub05leHRUYWJpbmRleCA9IGZ1bmN0aW9uKGV2ZW50LCBvYmosIGNvbW1hbmQpIHtcbiAgICB2YXIga2V5ID0gZXZlbnQua2V5Q29kZSA/IGV2ZW50LmtleUNvZGUgOiBldmVudC53aGljaDtcblxuICAgIGlmIChrZXkgPT0gMTMgfHwga2V5ID09IDkpIHtcbiAgICAgICAgdmFyIGZpY2FyID0gdHJ1ZTtcbiAgICAgICAgdmFyIHJldCA9IHRydWU7XG4gICAgICAgIHZhciB0YWJpbmRleCA9IG9iai5hdHRyKCd0YWJpbmRleCcpO1xuXG4gICAgICAgIGlmIChrZXkgPT0gMTMgJiYgb2JqWzBdLm5vZGVOYW1lID09IFwiVEVYVEFSRUFcIikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgLy9WZXJpZmljYSBvIHRhYmluZGV4XG4gICAgICAgICAgICB2YXIgZ290b1RhYmluZGV4ID0gb2JqLmF0dHIoJ2dvdG8tdGFiLWluZGV4Jyk7XG4gICAgICAgICAgICB2YXIgc3RvcFRhYmluZGV4ID0gb2JqLmF0dHIoJ3N0b3AtdGFiLWluZGV4Jyk7XG5cbiAgICAgICAgICAgIC8vVmFpIG9wYXJhXG4gICAgICAgICAgICBpZiAodGFiaW5kZXggJiYgc3RvcFRhYmluZGV4ICE9IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgdGFiaW5kZXggPSBwYXJzZUludCh0YWJpbmRleCk7XG5cbiAgICAgICAgICAgICAgICAvL2F2YW5jYSBvIHRhYmluZGV4XG4gICAgICAgICAgICAgICAgaWYgKGdvdG9UYWJpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICB0YWJpbmRleCA9IGdvdG9UYWJpbmRleDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0YWJpbmRleCsrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vc2UgRXhpc3RpciBvIGVsZW1lbnRvIGZvY2EgbmVsZVxuICAgICAgICAgICAgICAgIHZhciBuZXh0T2JqID0gJCgnW3RhYi1pbmRleD0nICsgdGFiaW5kZXggKyAnXScpO1xuXG4gICAgICAgICAgICAgICAgLy9WZXJpZmljYSBzZSBlbmNvbnRyb3UgdW0gb2JqZXRvXG4gICAgICAgICAgICAgICAgaWYgKG5leHRPYmoubGVuZ3RoID4gMCAmJiBuZXh0T2JqLmF0dHIoXCJpcy1kaXNhYmxlZFwiKSAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICBmaWNhciA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRPYmpbMF0ubm9kZU5hbWUgPT0gXCJBQk5FUi1TRUxFQ1QtVU5ERVJMSU5FXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRPYmouZmluZChcInNlbGVjdFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0T2JqLmZpbmQoXCJbZGl2LWZvY3VzPXRydWVdXCIpLnRyaWdnZXIoY29tbWFuZCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRPYmoubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy92ZXJpZmljYSBvIHByb3hpbW8gb2JqZXRvXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSBuZXh0T2JqO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmljYXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vcmVtb3ZpZG8gcGFyYSBmdW5jaW9uYXIgbyBlbnRlclxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RvcFRhYmluZGV4ID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpY2FyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpY2FyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKGZpY2FyKTtcblxuICAgICAgICAvL1NlIGZvciB0YWIgZGVpeGFyIGZhbHNlXG4gICAgICAgIGlmIChrZXkgPT0gOSkge1xuICAgICAgICAgICAgcmV0ID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvL3JvZGFyIHNhaWRhXG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuXG59XG5cbnZhciByYW5kb21OdW1iZXIgPSBmdW5jdGlvbigpIHtcbiAgICAvL3ZhciByYW5kb21faW50ZWdlciA9IE1hdGgucmFuZG9tKCkqMTAxfDA7ICAgIFxuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgMTApO1xufVxuXG52YXIgZ3VpZCA9IGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIHM0KCkge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMClcbiAgICAgICAgICAgIC50b1N0cmluZygxNilcbiAgICAgICAgICAgIC5zdWJzdHJpbmcoMSk7XG4gICAgfVxuICAgIHJldHVybiBzNCgpICsgczQoKSArICctJyArIHM0KCkgKyAnLScgKyBzNCgpICsgJy0nICtcbiAgICAgICAgczQoKSArICctJyArIHM0KCkgKyBzNCgpICsgczQoKTtcbn1cblxudmFyIGdlbmVyYXRlSUQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZ3VpZCgpO1xufVxuXG52YXIgcG9pbnRlckV2ZW50VG9YWSA9IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgb3V0ID0geyB4OiAwLCB5OiAwIH07XG4gICAgaWYgKGUudHlwZSA9PSAndG91Y2hzdGFydCcgfHwgZS50eXBlID09ICd0b3VjaG1vdmUnIHx8IGUudHlwZSA9PSAndG91Y2hlbmQnIHx8IGUudHlwZSA9PSAndG91Y2hjYW5jZWwnKSB7XG4gICAgICAgIHZhciB0b3VjaCA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdIHx8IGUub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXTtcbiAgICAgICAgb3V0LnggPSB0b3VjaC5wYWdlWDtcbiAgICAgICAgb3V0LnkgPSB0b3VjaC5wYWdlWTtcbiAgICB9IGVsc2UgaWYgKGUudHlwZSA9PSAnbW91c2Vkb3duJyB8fCBlLnR5cGUgPT0gJ21vdXNldXAnIHx8IGUudHlwZSA9PSAnbW91c2Vtb3ZlJyB8fCBlLnR5cGUgPT0gJ21vdXNlb3ZlcicgfHwgZS50eXBlID09ICdtb3VzZW91dCcgfHwgZS50eXBlID09ICdtb3VzZWVudGVyJyB8fCBlLnR5cGUgPT0gJ21vdXNlbGVhdmUnKSB7XG4gICAgICAgIG91dC54ID0gZS5wYWdlWDtcbiAgICAgICAgb3V0LnkgPSBlLnBhZ2VZO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuLy9jb21wb25lbnQtd3JhcHBlcjogbm9uLWZ1bmN0aW9uYWxcblxuLy9DcmlhbmRvIG5hbWVzcGFjZSB1dGlsc1xudmFyIFBtYlV0aWxzID0gZnVuY3Rpb24gKCkgeyB9XG5cblxuUG1iVXRpbHMucHJvdG90eXBlLnJlbW92ZUFjY2VudCA9IGZ1bmN0aW9uICh3b3JkKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHZhciBtYXAgPSB7XG4gICAgICAgIFwiw6FcIjogXCJhXCIsXG4gICAgICAgIFwiw6BcIjogXCJhXCIsXG4gICAgICAgIFwiw6JcIjogXCJhXCIsXG4gICAgICAgIFwiw6NcIjogXCJhXCIsXG4gICAgICAgIFwiw6RcIjogXCJhXCIsXG4gICAgICAgIFwiw4FcIjogXCJBXCIsXG4gICAgICAgIFwiw4BcIjogXCJBXCIsXG4gICAgICAgIFwiw4JcIjogXCJBXCIsXG4gICAgICAgIFwiw4NcIjogXCJBXCIsXG4gICAgICAgIFwiw4RcIjogXCJBXCIsXG4gICAgICAgIFwiw6lcIjogXCJlXCIsXG4gICAgICAgIFwiw6hcIjogXCJlXCIsXG4gICAgICAgIFwiw6pcIjogXCJlXCIsXG4gICAgICAgIFwi4bq9XCI6IFwiZVwiLFxuICAgICAgICBcIsOrXCI6IFwiZVwiLFxuICAgICAgICBcIsOJXCI6IFwiRVwiLFxuICAgICAgICBcIsOIXCI6IFwiRVwiLFxuICAgICAgICBcIsOKXCI6IFwiRVwiLFxuICAgICAgICBcIuG6vFwiOiBcIkVcIixcbiAgICAgICAgXCLDi1wiOiBcIkVcIixcbiAgICAgICAgXCLDrVwiOiBcImlcIixcbiAgICAgICAgXCLDrFwiOiBcImlcIixcbiAgICAgICAgXCLDrlwiOiBcImlcIixcbiAgICAgICAgXCLEqVwiOiBcImlcIixcbiAgICAgICAgXCLDr1wiOiBcImlcIixcbiAgICAgICAgXCLDjVwiOiBcIklcIixcbiAgICAgICAgXCLDjFwiOiBcIklcIixcbiAgICAgICAgXCLDjlwiOiBcIklcIixcbiAgICAgICAgXCLEqFwiOiBcIklcIixcbiAgICAgICAgXCLDj1wiOiBcIklcIixcbiAgICAgICAgXCLDs1wiOiBcIm9cIixcbiAgICAgICAgXCLDslwiOiBcIm9cIixcbiAgICAgICAgXCLDtFwiOiBcIm9cIixcbiAgICAgICAgXCLDtVwiOiBcIm9cIixcbiAgICAgICAgXCLDtlwiOiBcIm9cIixcbiAgICAgICAgXCLDk1wiOiBcIk9cIixcbiAgICAgICAgXCLDklwiOiBcIk9cIixcbiAgICAgICAgXCLDlFwiOiBcIk9cIixcbiAgICAgICAgXCLDlVwiOiBcIk9cIixcbiAgICAgICAgXCLDllwiOiBcIk9cIixcbiAgICAgICAgXCLDulwiOiBcInVcIixcbiAgICAgICAgXCLDuVwiOiBcInVcIixcbiAgICAgICAgXCLDu1wiOiBcInVcIixcbiAgICAgICAgXCLFqVwiOiBcInVcIixcbiAgICAgICAgXCLDvFwiOiBcInVcIixcbiAgICAgICAgXCLDmlwiOiBcIlVcIixcbiAgICAgICAgXCLDmVwiOiBcIlVcIixcbiAgICAgICAgXCLDm1wiOiBcIlVcIixcbiAgICAgICAgXCLFqFwiOiBcIlVcIixcbiAgICAgICAgXCLDnFwiOiBcIlVcIixcbiAgICAgICAgXCLDvVwiOiBcInlcIixcbiAgICAgICAgXCLhu7NcIjogXCJ5XCIsXG4gICAgICAgIFwixbdcIjogXCJ5XCIsXG4gICAgICAgIFwi4bu5XCI6IFwieVwiLFxuICAgICAgICBcIsO/XCI6IFwieVwiLFxuICAgICAgICBcIsOdXCI6IFwiWVwiLFxuICAgICAgICBcIuG7slwiOiBcIllcIixcbiAgICAgICAgXCLFtlwiOiBcIllcIixcbiAgICAgICAgXCLhu7hcIjogXCJZXCIsXG4gICAgICAgIFwixbhcIjogXCJZXCIsXG4gICAgICAgIFwiw7FcIjogXCJuXCIsXG4gICAgICAgIFwiw5FcIjogXCJuXCIsXG4gICAgICAgIFwiw4dcIjogXCJjXCIsXG4gICAgICAgIFwiw6dcIjogXCJjXCJcbiAgICB9O1xuXG4gICAgaWYgKHdvcmQgIT0gXCJcIikge1xuICAgICAgICByZXR1cm4gd29yZC5yZXBsYWNlKC9bw6DDqMOsw7LDucOAw4jDjMOSw5nDocOpw63Ds8O6w73DgcOJw43Dk8Oaw53DosOqw67DtMO7w4LDisOOw5TDm8Oj4bq9xKnFqcOxw7XDg+G6vMSoxajDkcOVw6TDq8Ovw7bDvMO/w4TDi8OPw5bDnMW4w4fDp10vZywgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICAgICAgICByZXR1cm4gbWFwW21hdGNoXTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vL1BFZ2EgdmFyaWF2ZWlzIGRhIFVSTFxuUG1iVXRpbHMucHJvdG90eXBlLmdldFVybFZhcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHZhcnMgPSBuZXcgT2JqZWN0KCksXG4gICAgICAgIGhhc2g7XG4gICAgdmFyIGhhc2hlcyA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNsaWNlKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJz8nKSArIDEpLnNwbGl0KCcmJyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoYXNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaGFzaCA9IGhhc2hlc1tpXS5zcGxpdCgnPScpO1xuICAgICAgICB2YXJzW2hhc2hbMF1dID0gaGFzaFsxXTtcbiAgICB9XG4gICAgcmV0dXJuIHZhcnM7XG59XG5cbi8vRGV0ZXJtaW5hIHNlIMOpIG1vZG8gYWRhcHRhdGl2byBcblBtYlV0aWxzLnByb3RvdHlwZS5zaG93QmlnU2NyZWVuID0gZnVuY3Rpb24gKG9iaikge1xuICAgIGlmIChwYXJzZUludChvYmoub3V0ZXJXaWR0aCgpKSA+PSAxMDI0KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5cblBtYlV0aWxzLnByb3RvdHlwZS5nZXRDaGVja2VkUmFkaW8gPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIGlmIChuYW1lKSB7XG4gICAgICAgIHJldHVybiAkKFwiaW5wdXRbdHlwZT1yYWRpb11bbmFtZT1cIiArIG5hbWUgKyBcIl06Y2hlY2tlZFwiKS5wYXJlbnQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJChcImlucHV0W3R5cGU9cmFkaW9dOmNoZWNrZWRcIikucGFyZW50KCk7XG4gICAgfVxufVxuXG5QbWJVdGlscy5wcm90b3R5cGUuZ2V0UGhvbmVBc09iamVjdCA9IGZ1bmN0aW9uIChwaG9uZSkge1xuXG4gICAgdmFyIHBob25lT2JqID0ge1xuICAgICAgICBkZGk6IFwiXCIsXG4gICAgICAgIGRkZDogXCJcIixcbiAgICAgICAgcGhvbmU6IHBob25lXG4gICAgfTtcblxuICAgIHBob25lID0gcGhvbmUgPyBwaG9uZS5yZXBsYWNlKC9cXEQrL2csICcnKSA6IHBob25lO1xuXG4gICAgaWYgKHBob25lICYmIHBob25lLmxlbmd0aCA+IDExKSB7XG4gICAgICAgIHBob25lT2JqLmRkaSA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7Mn0pKFxcZHs4LDl9KSQvZywgXCJcXCQxXCIpO1xuICAgICAgICBwaG9uZU9iai5kZGQgPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezJ9KShcXGR7OCw5fSkkL2csIFwiXFwkMlwiKTtcbiAgICAgICAgcGhvbmVPYmoucGhvbmUgPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezJ9KShcXGR7OCw5fSkkL2csIFwiXFwkM1wiKTtcbiAgICB9IGVsc2UgaWYgKHBob25lICYmIHBob25lLmxlbmd0aCA+IDkpIHtcbiAgICAgICAgcGhvbmVPYmouZGRkID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHs4LDl9KSQvZywgXCJcXCQxXCIpO1xuICAgICAgICBwaG9uZU9iai5waG9uZSA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7OCw5fSkkL2csIFwiXFwkMlwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcGhvbmVPYmo7XG59XG5cblBtYlV0aWxzLnByb3RvdHlwZS5mb3JtYXRQaG9uZSA9IGZ1bmN0aW9uIChwaG9uZSkge1xuXG4gICAgdmFyIHBob25lUmV0dXJuID0gcGhvbmUucmVwbGFjZSgvW14wLTldL2csICcnKTtcblxuICAgIGlmIChwaG9uZSAmJiBwaG9uZS5sZW5ndGggPiAxMSkge1xuICAgICAgICBwaG9uZVJldHVybiA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7Mn0pKFxcZHs0LDV9KShcXGR7NH0pJC9nLCBcIlxcKyQxIFxcKCQyKSBcXCQzIFxcJDRcIik7XG4gICAgfSBlbHNlIGlmIChwaG9uZSAmJiBwaG9uZS5sZW5ndGggPiA5KSB7XG4gICAgICAgIHBob25lUmV0dXJuID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHs0LDV9KShcXGR7NH0pJC9nLCBcIlxcKCQxKSBcXCQyIFxcJDNcIik7XG4gICAgfTtcblxuICAgIHJldHVybiBwaG9uZVJldHVybjtcbn1cblxuUG1iVXRpbHMucHJvdG90eXBlLnJlbW92ZUNwZkNucGpGb3JtYXQgPSBmdW5jdGlvbiAodmFsb3IsIHR5cGUpIHtcblxuICAgIGlmICh2YWxvcikge1xuICAgICAgICAvL3JlbW92ZSBwb250byBlIHZpcmd1bGFcbiAgICAgICAgdmFsb3IgPSB2YWxvci5yZXBsYWNlKG5ldyBSZWdFeHAoL1teXFxkXS9nKSwgXCJcIik7XG5cbiAgICAgICAgaWYgKHR5cGUgPT0gXCJDTlBKXCIpIHtcbiAgICAgICAgICAgIHZhciBsZW4gPSAxNDtcbiAgICAgICAgICAgIHZhciBwYWQgPSBcIjAwMDAwMDAwMDAwXCI7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcIkNQRlwiKSB7XG4gICAgICAgICAgICB2YXIgbGVuID0gMTE7XG4gICAgICAgICAgICB2YXIgcGFkID0gXCIwMDAwMDAwMDAwMFwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvL3RyYW5zZm9ybWEgcGFyYSBudW1lcm9cbiAgICAgICAgdmFsb3IgPSBwYXJzZUludCh2YWxvcik7XG5cbiAgICAgICAgLy9zZSBmb3IgbWFpb3IgcXVlIG8gdmFsb3IgZGVmaW5kbyBwYXJhIGxlbiBlbGUgY29ydGFcbiAgICAgICAgaWYgKHZhbG9yLmxlbmd0aCA+IGxlbikge1xuICAgICAgICAgICAgdmFsb3IgPSB2YWxvci5zdWJzdHJpbmcoMCwgbGVuKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vU2Ugb2NvcnJlIGFsZ3VtIGVycm8sIGRlaXhhciB2YXppb1xuICAgICAgICBpZiAoaXNOYU4odmFsb3IpKSB7XG4gICAgICAgICAgICB2YWxvciA9IFwiXCI7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbG9yID0gcGFkLnN1YnN0cmluZygwLCBwYWQubGVuZ3RoIC0gdmFsb3IubGVuZ3RoKSArIHZhbG9yO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWxvcjtcbn1cblxuUG1iVXRpbHMucHJvdG90eXBlLnZhbGlkYXJDTlBKID0gZnVuY3Rpb24gKGNucGopIHtcblxuICAgIGNucGogPSBjbnBqLnJlcGxhY2UoL1teXFxkXSsvZywgJycpO1xuICAgIFxuICAgIGlmIChjbnBqID09IFwiMFwiIHx8XG4gICAgICAgIGNucGogPT0gXCIwMDAwMDAwMDAwMDAwMFwiIHx8XG4gICAgICAgIGNucGogPT0gXCIxMTExMTExMTExMTExMVwiIHx8XG4gICAgICAgIGNucGogPT0gXCIyMjIyMjIyMjIyMjIyMlwiIHx8XG4gICAgICAgIGNucGogPT0gXCIzMzMzMzMzMzMzMzMzM1wiIHx8XG4gICAgICAgIGNucGogPT0gXCI0NDQ0NDQ0NDQ0NDQ0NFwiIHx8XG4gICAgICAgIGNucGogPT0gXCI1NTU1NTU1NTU1NTU1NVwiIHx8XG4gICAgICAgIGNucGogPT0gXCI2NjY2NjY2NjY2NjY2NlwiIHx8XG4gICAgICAgIGNucGogPT0gXCI3Nzc3Nzc3Nzc3Nzc3N1wiIHx8XG4gICAgICAgIGNucGogPT0gXCI4ODg4ODg4ODg4ODg4OFwiIHx8XG4gICAgICAgIGNucGogPT0gXCI5OTk5OTk5OTk5OTk5OVwiKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGEgRFZzXG4gICAgdmFyIHRhbWFuaG8gPSBjbnBqLmxlbmd0aCAtIDJcbiAgICB2YXIgbnVtZXJvcyA9IGNucGouc3Vic3RyaW5nKDAsIHRhbWFuaG8pO1xuICAgIHZhciBkaWdpdG9zID0gY25wai5zdWJzdHJpbmcodGFtYW5obyk7XG4gICAgdmFyIHNvbWEgPSAwO1xuICAgIHZhciBwb3MgPSB0YW1hbmhvIC0gNztcbiAgICB2YXIgaSA9IHRhbWFuaG87XG5cbiAgICBmb3IgKGkgPSB0YW1hbmhvOyBpID49IDE7IGktLSkge1xuICAgICAgICBzb21hICs9IG51bWVyb3MuY2hhckF0KHRhbWFuaG8gLSBpKSAqIHBvcy0tO1xuICAgICAgICBpZiAocG9zIDwgMilcbiAgICAgICAgICAgIHBvcyA9IDk7XG4gICAgfVxuICAgIHZhciByZXN1bHRhZG8gPSBzb21hICUgMTEgPCAyID8gMCA6IDExIC0gc29tYSAlIDExO1xuICAgIGlmIChyZXN1bHRhZG8gIT0gZGlnaXRvcy5jaGFyQXQoMCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRhbWFuaG8gPSB0YW1hbmhvICsgMTtcbiAgICBudW1lcm9zID0gY25wai5zdWJzdHJpbmcoMCwgdGFtYW5obyk7XG4gICAgc29tYSA9IDA7XG4gICAgcG9zID0gdGFtYW5obyAtIDc7XG4gICAgZm9yIChpID0gdGFtYW5obzsgaSA+PSAxOyBpLS0pIHtcbiAgICAgICAgc29tYSArPSBudW1lcm9zLmNoYXJBdCh0YW1hbmhvIC0gaSkgKiBwb3MtLTtcbiAgICAgICAgaWYgKHBvcyA8IDIpXG4gICAgICAgICAgICBwb3MgPSA5O1xuICAgIH1cblxuICAgIHJlc3VsdGFkbyA9IHNvbWEgJSAxMSA8IDIgPyAwIDogMTEgLSBzb21hICUgMTE7XG5cbiAgICBpZiAocmVzdWx0YWRvICE9IGRpZ2l0b3MuY2hhckF0KDEpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuLy92YWxpZGEgbyBDUEYgZGlnaXRhZG9cblBtYlV0aWxzLnByb3RvdHlwZS52YWxpZGFyQ1BGID0gZnVuY3Rpb24oY3BmKSB7XG5cbiAgICB2YXIgZXhwID0gL1xcLnxcXC0vZ1xuICAgIGNwZiA9IGNwZi50b1N0cmluZygpLnJlcGxhY2UoZXhwLCBcIlwiKTtcbiAgICBpZiAoY3BmLmxlbmd0aCA8IDExKSB7XG4gICAgICAgIHZhciBwYWQgPSBcIjAwMDAwMDAwMDAwXCI7XG4gICAgICAgIGNwZiA9IHBhZC5zdWJzdHJpbmcoMCwgcGFkLmxlbmd0aCAtIGNwZi5sZW5ndGgpICsgY3BmO1xuICAgIH1cblxuICAgIGlmIChjcGYgPT0gXCIwXCIgfHxcbiAgICAgICAgY3BmID09IFwiMDAwMDAwMDAwMDBcIiB8fFxuICAgICAgICBjcGYgPT0gXCIxMTExMTExMTExMVwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjIyMjIyMjIyMjIyXCIgfHxcbiAgICAgICAgY3BmID09IFwiMzMzMzMzMzMzMzNcIiB8fFxuICAgICAgICBjcGYgPT0gXCI0NDQ0NDQ0NDQ0NFwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjU1NTU1NTU1NTU1XCIgfHxcbiAgICAgICAgY3BmID09IFwiNjY2NjY2NjY2NjZcIiB8fFxuICAgICAgICBjcGYgPT0gXCI3Nzc3Nzc3Nzc3N1wiIHx8XG4gICAgICAgIGNwZiA9PSBcIjg4ODg4ODg4ODg4XCIgfHxcbiAgICAgICAgY3BmID09IFwiOTk5OTk5OTk5OTlcIikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHNvbWE7XG4gICAgdmFyIHJlc3RvO1xuICAgIHNvbWEgPSAwO1xuXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gOTsgaSsrKSB7XG4gICAgICAgIHNvbWEgPSBzb21hICsgcGFyc2VJbnQoY3BmLnN1YnN0cmluZyhpIC0gMSwgaSkpICogKDExIC0gaSk7XG4gICAgfVxuXG4gICAgcmVzdG8gPSAoc29tYSAqIDEwKSAlIDExO1xuXG4gICAgaWYgKChyZXN0byA9PSAxMCkgfHwgKHJlc3RvID09IDExKSkge1xuICAgICAgICByZXN0byA9IDA7XG4gICAgfVxuICAgIGlmIChyZXN0byAhPSBwYXJzZUludChjcGYuc3Vic3RyaW5nKDksIDEwKSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHNvbWEgPSAwO1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IDEwOyBpKyspIHtcbiAgICAgICAgc29tYSA9IHNvbWEgKyBwYXJzZUludChjcGYuc3Vic3RyaW5nKGkgLSAxLCBpKSkgKiAoMTIgLSBpKTtcbiAgICB9XG4gICAgcmVzdG8gPSAoc29tYSAqIDEwKSAlIDExO1xuXG4gICAgaWYgKChyZXN0byA9PSAxMCkgfHwgKHJlc3RvID09IDExKSkge1xuICAgICAgICByZXN0byA9IDA7XG4gICAgfVxuICAgIGlmIChyZXN0byAhPSBwYXJzZUludChjcGYuc3Vic3RyaW5nKDEwLCAxMSkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cblBtYlV0aWxzLnByb3RvdHlwZS52YWxpZGFyRU1BSUwgPSBmdW5jdGlvbihlbWFpbCkge1xuICAgIHZhciBlbWFpbFZhbGlkYXRpb24gPSBlbWFpbC5tYXRjaCgvXlthLXpBLVowLTkuXy1dK0BbYS16QS1aMC05Ll8tXStcXC5bYS16QS1aMC05Ll8tXSskLyk7XG5cbiAgICBpZiAoZW1haWwgPT0gZW1haWxWYWxpZGF0aW9uKSB7XG4gICAgICAgIHJldHVybiBlbWFpbFZhbGlkYXRpb247XG4gICAgfVxufVxuXG4vL0Z1bmNvZXMgdXRlaXMgZGUgdXNvIGRvIEpRVUVSWVxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ1dlYkNvbXBvbmVudHNSZWFkeScsIGZ1bmN0aW9uICgpIHtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5jbGFzc0xpc3QuYWRkKFwiaHRtbC1wYWdlLWxvYWRlZFwiKTtcbn0pO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJC5mbi5zZXRDdXJzb3JQb3NpdGlvbiA9IGZ1bmN0aW9uIChwb3MpIHtcbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbSkge1xuICAgICAgICAgICAgaWYgKGVsZW0uc2V0U2VsZWN0aW9uUmFuZ2UpIHtcbiAgICAgICAgICAgICAgICBlbGVtLnNldFNlbGVjdGlvblJhbmdlKHBvcywgcG9zKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbS5jcmVhdGVUZXh0UmFuZ2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBlbGVtLmNyZWF0ZVRleHRSYW5nZSgpO1xuICAgICAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKHRydWUpO1xuICAgICAgICAgICAgICAgIHJhbmdlLm1vdmVFbmQoJ2NoYXJhY3RlcicsIHBvcyk7XG4gICAgICAgICAgICAgICAgcmFuZ2UubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBwb3MpO1xuICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgICQuZm4udmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjaGFuZ2UgPSBudWxsO1xuICAgICAgICB2YXIgdGFnID0gbmV3IFN0cmluZygpO1xuICAgICAgICAvL1RyYXRhbWVudG9cbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGFnICs9ICQodGhpcylbMF0ubm9kZU5hbWU7XG4gICAgICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICAgICAgdGFnID0gdGFnLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJvbmNoYW5nZVwiKSkge1xuICAgICAgICAgICAgY2hhbmdlID0gJCh0aGlzKS5hdHRyKFwib25jaGFuZ2VcIik7XG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoXCJvbmNoYW5nZVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdGlyYSBvIGZvY28gZGUgcXVhbHF1ZXIgZWxlbWVudG9cbiAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgICAgICQod2luZG93KS5mb2N1cygpO1xuXG4gICAgICAgIGlmIChjaGFuZ2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwib25jaGFuZ2VcIiwgY2hhbmdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vc2Ugb3V2ZXIgdW0gZXJybyB2YWxpZGFjYW8gZXN0YSBpbmNvcnJldGFcbiAgICAgICAgaWYgKCQodGhpcykuYXR0cihcImVycm9yXCIpICYmICQodGhpcykuYXR0cihcImVycm9yXCIpICE9IFwiXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuZm4uc2V0Rm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICQodGhpcykuZmluZChcImlucHV0XCIpLmZvY3VzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZm4ucmVtb3ZlRm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZm4uZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRleHQgPSBudWxsO1xuICAgICAgICB2YXIgdGFnID0gbmV3IFN0cmluZygpO1xuICAgICAgICAvL1RyYXRhbWVudG9cbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGFnICs9ICQodGhpcylbMF0ubm9kZU5hbWU7XG4gICAgICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICAgICAgdGFnID0gdGFnLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aChcIkFCLUlOUFVUXCIpID8gXCJBQi1JTlBVVFwiIDogdGFnLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdmFyIHRhZ3NBY2VpdGFzID0gW1wiQUItVEVYVC1SRUFELU9OTFlcIiwgXCJBQi1URVhULUFSRUEtVU5ERVJMSU5FXCIsIFwiQUItU0VMRUNULVVOREVSTElORVwiLCBcIkFCLUlOUFVUXCJdO1xuICAgICAgICAgICAgICAgIGlmICh0YWdzQWNlaXRhcy5pbmRleE9mKHRhZykgPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB2YXIgdGV4dEFycmF5ID0gbmV3IEFycmF5KCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJhZGlvIG9mIHRoaXMpIHtcbiAgICAgICAgICAgICAgICB0ZXh0QXJyYXkucHVzaChyYWRpby5nZXRUZXh0KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGV4dCA9IHRleHRBcnJheTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRleHQgPSB0aGlzWzBdLmdldFRleHQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICB9O1xuXG4gICAgJC5mbi5zZXRUZXh0ID0gZnVuY3Rpb24gKHRleHQsIGNhbmNlbCkge1xuICAgICAgICB2YXIgdGFnID0gbmV3IFN0cmluZygpO1xuXG4gICAgICAgIC8vVHJhdGFtZW50b1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWcgKz0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRhZyA9PSBcIkFCLVRFWFQtUkVBRC1PTkxZXCIpIHtcbiAgICAgICAgICAgIHRoaXNbMF0uc2V0VGV4dCh0ZXh0KTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtREFURVwiKSkge1xuICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVFwiKSkge1xuICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnID09IFwiQUItVEVYVC1BUkVBLVVOREVSTElORVwiKSB7XG4gICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVNFTEVDVFwiKSkge1xuICAgICAgICAgICAgaWYgKGNhbmNlbCkge1xuICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcInNlbGVjdFwiKS52YWwodGV4dCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcInNlbGVjdFwiKS52YWwodGV4dCkuY2hhbmdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL3NhbHZhIHZhbG9yXG4gICAgICAgIGlmICghdGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1DSEVDS0JPWFwiKSkge1xuICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwibG9hZGVkLXZhbHVlXCIsICQodGhpcykuZ2V0VGV4dCgpKTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8vZnVuY2FvIHBhcmEgY29ycmlnaXIgbyBkYXRhXG4gICAgJC5mbi5nZXROdW1iZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gbnVsbDtcbiAgICAgICAgdmFyIHRhZyA9IG5ldyBTdHJpbmcoKTtcbiAgICAgICAgLy9UcmF0YW1lbnRvXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRhZyArPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuICAgICAgICAgICAgaWYgKHRhZykge1xuICAgICAgICAgICAgICAgIHRhZyA9IHRhZy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGFnID09IFwiQUItVEVYVC1SRUFELU9OTFlcIikge1xuICAgICAgICAgICAgdGV4dCA9IHRoaXNbMF0uZ2V0VGV4dCgpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1DSEVDS0JPWFwiKSkge1xuICAgICAgICAgICAgdGV4dCA9IHRoaXNbMF0uZ2V0TnVtYmVyKCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULVJBRElPXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gdGhpc1swXS5nZXROdW1iZXIoKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtU1dJVENIXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gdGhpc1swXS5nZXROdW1iZXIoKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtVElNRVwiKSkge1xuICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuZmluZChcImlucHV0XCIpLnZhbCgpICsgXCIwMFwiO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1OVU1CRVJcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobmV3IFJlZ0V4cCgvW15cXGRdL2cpLCBcIlwiKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtREFURVwiKSkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5pc0lPUyB8fCB3aW5kb3cuaXNBbmRyb2lkKSB7XG4gICAgICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuZmluZChcImlucHV0XCIpLnZhbCgpO1xuICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cmluZyg4LCAxMCkgKyBcIlwiICsgdGV4dC5zdWJzdHJpbmcoNSwgNykgKyBcIlwiICsgdGV4dC5zdWJzdHJpbmcoMCwgNCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVRcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJpbnB1dFwiKS52YWwoKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItVEVYVC1BUkVBLVVOREVSTElORVwiKSkge1xuICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuZmluZChcInRleHRhcmVhXCIpLnZhbCgpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1TRUxFQ1RcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSBwYXJzZUludCgkKHRoaXMpLmdldE9iamVjdCgpLnZhbG9yKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItUVVFU1RJT05cIikpIHtcbiAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmF0dHIoXCJhbnN3ZXJcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGV4dCAmJiB0YWcgIT0gXCJBQi1TRUxFQ1QtVU5ERVJMSU5FXCIpIHtcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobmV3IFJlZ0V4cCgvW15cXGRcXCxdL2cpLCBcIlwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgIH07XG5cbiAgICAvL2Z1bmNhbyBwYXJhIGNvcnJpZ2lyIG8gZGF0YVxuICAgICQuZm4uc2V0TnVtYmVyID0gZnVuY3Rpb24gKHRleHQsIGNhbmNlbCkge1xuICAgICAgICB2YXIgdGFnID0gbmV3IFN0cmluZygpO1xuICAgICAgICAvL1RyYXRhbWVudG9cbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGFnICs9ICQodGhpcylbMF0ubm9kZU5hbWU7XG4gICAgICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICAgICAgdGFnID0gdGFnLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0ZXh0IHx8IHRleHQgPT0gMCkge1xuICAgICAgICAgICAgLy9OZWNlc3NhcmlvIHNlciBzdHJpbmcgcGFyYSByZWdleFxuICAgICAgICAgICAgdGV4dCArPSBcIlwiO1xuICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShuZXcgUmVnRXhwKC9bXlxcZC1cXCxdL2cpLCBcIlwiKTtcblxuICAgICAgICAgICAgaWYgKHRhZyA9PSBcIkFCLVRFWFQtUkVBRC1PTkxZXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1DSEVDS0JPWFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXNbMF0uc2V0TnVtYmVyKHRleHQpO1xuXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwibG9hZGVkLXZhbHVlXCIsICQodGhpcykuYXR0cihcImlzLWNoZWNrZWRcIikpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtUkFESU9cIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldE51bWJlcih0ZXh0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULVNXSVRDSFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXNbMF0uc2V0TnVtYmVyKHRleHQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtREFURVwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXNbMF0uc2V0VGV4dCh0ZXh0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVUXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpc1swXS5zZXROdW1iZXIodGV4dCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1TRUxFQ1RcIikpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpc1swXS5zZWxlY3QpLnZhbCh0ZXh0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXNbMF0uc2VsZWN0KS52YWwodGV4dCkuY2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL3NhbHZhIHZhbG9yXG4gICAgICAgICAgICBpZiAoIXRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtQ0hFQ0tCT1hcIikpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJsb2FkZWQtdmFsdWVcIiwgJCh0aGlzKS5nZXRUZXh0KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuZm4uc2V0T2xkVmFsdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykuc2V0VGV4dCgkKHRoaXMpLmF0dHIoXCJsb2FkZWQtdmFsdWVcIikpO1xuICAgIH07XG5cbiAgICAkLmZuLmlzQ2hhbmdlZCA9IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgdmFyIGxvYWRlZFZhbHVlID0gJCh0aGlzKS5hdHRyKFwibG9hZGVkLXZhbHVlXCIpO1xuICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gJCh0aGlzKS5nZXRUZXh0KCk7XG5cbiAgICAgICAgaWYgKGxvYWRlZFZhbHVlIHx8IGN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGxvYWRlZFZhbHVlICE9PSBjdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJC5mbi5zZXRPYmplY3QgPSBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgIHZhciB0YWcgPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuICAgICAgICBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1TRUxFQ1RcIikpIHtcbiAgICAgICAgICAgICQodGhpcykuZmluZChcInNlbGVjdFwiKS52YWwodmFsKS5jaGFuZ2UoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZm4uZ2V0T2JqZWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYmVhbiA9IG5ldyBPYmplY3QoKTtcblxuICAgICAgICBpZiAoKHRoaXMpWzBdKSB7XG4gICAgICAgICAgICB2YXIgdGFnID0gJCh0aGlzKVswXS5ub2RlTmFtZTtcblxuICAgICAgICAgICAgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItU0VMRUNUXCIpKSB7XG4gICAgICAgICAgICAgICAgYmVhbi5ub21lID0gJCh0aGlzKS5maW5kKFwic2VsZWN0IG9wdGlvbjpzZWxlY3RlZFwiKS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgYmVhbi52YWxvciA9ICQodGhpcykuZmluZChcInNlbGVjdCBvcHRpb246c2VsZWN0ZWRcIikuYXR0cihcInZhbHVlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGJlYW47XG4gICAgfVxuXG5cbiAgICAvL0F2aXNhciBub3Nzb3MgY29tcG9uZW50ZXMgcXVhbmRvIHRldmUgdW1hIGFsdGVyYWNhb1xuICAgIHZhciBvcmlnQXBwZW5kID0gJC5mbi5hcHBlbmQ7XG4gICAgJC5mbi5hcHBlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKFwiYWItY29udGFpbmVyLWNvbnRlbnRcIikgJiYgYXJndW1lbnRzWzBdLmhhc0NsYXNzKFwiYWItYmxvY2tcIikpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBvcmlnQXBwZW5kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykudHJpZ2dlcihcImFwcGVuZFwiKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvL2Z1bsOnw6NvIHBhcmEgcmV0b3JuYXIgc2UgbyBjYW1wbyBlc3LDoSBjb20gZXJybyBvdSBuw6NvXG4gICAgJC5mbi5oYXNFcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCQodGhpcykuYXR0cihcImVycm9yXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5cbi8vZnVuw6fDo28gcGFyYSBhcnJ1bWFyIGJ1ZyBubyBpT1MgOFxuaWYgKCFTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGgpIHtcbiAgICBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGggPSBmdW5jdGlvbiAoc2VhcmNoU3RyaW5nLCBwb3NpdGlvbikge1xuICAgICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uIHx8IDA7XG4gICAgICAgIHJldHVybiB0aGlzLmluZGV4T2Yoc2VhcmNoU3RyaW5nLCBwb3NpdGlvbikgPT09IHBvc2l0aW9uO1xuICAgIH07XG59XG5cblN0cmluZy5wcm90b3R5cGUudG9VcHBlck9ubHlGaXJzdExldHRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc3RyID0gdGhpcztcblxuICAgIHZhciB3b3JkTWFwID0ge1xuICAgICAgICBcInJnXCI6IFwiUkdcIixcbiAgICAgICAgXCJjcGZcIjogXCJDUEZcIixcbiAgICAgICAgXCJjbnBqXCI6IFwiQ05QSlwiLFxuICAgICAgICBcInJuZVwiOiBcIlJORVwiLFxuICAgICAgICBcImNlcFwiOiBcIkNFUFwiLFxuICAgICAgICBcImNuaFwiOiBcIkNOSFwiLFxuICAgICAgICBcInMuYS5cIjogXCJTLkEuXCJcbiAgICB9O1xuXG4gICAgaWYgKHN0ciAmJiBzdHIubGVuZ3RoID09IDApIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSBlbHNlIGlmIChzdHIgJiYgc3RyLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgIHJldHVybiBzdHIudG9VcHBlckNhc2UoKVxuICAgIH0gZWxzZSBpZiAoc3RyICYmIHN0ci5sZW5ndGggPiAxKSB7XG4gICAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKSArIHN0ci5zdWJzdHIoMSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgcmV0dXJuIHN0ciA9IHN0ci5yZXBsYWNlKC9cXGIocmd8Y3BmfGNucGp8cm5lfGNlcHxjbmgpXFxifHNcXC5hXFwuL2dpLCBmdW5jdGlvbiAod29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHdvcmRNYXBbd29yZC50b0xvd2VyQ2FzZSgpXTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxufVxuXG5TdHJpbmcucHJvdG90eXBlLnRvQ2FtZWxDYXNlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzdHIgPSB0aGlzLnRvTG93ZXJDYXNlKCk7XG5cbiAgICB2YXIgd29yZHNBcnJheSA9IFtcImRlXCIsIFwic2VtXCIsIFwib1wiLCBcImRvXCIsIFwiZGFcIl07XG5cbiAgICB2YXIgd29yZHMgPSBzdHIuc3BsaXQoXCIgXCIpO1xuXG4gICAgdmFyIGZ1bGxTdHJpbmcgPSBuZXcgU3RyaW5nKCk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmICh3b3Jkc0FycmF5LmluZGV4T2Yod29yZHNbaV0pID09IC0xICYmIHdvcmRzW2ldLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHdvcmRzW2ldID0gd29yZHNbaV0udG9VcHBlck9ubHlGaXJzdExldHRlcigpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBmdWxsU3RyaW5nID0gd29yZHMuam9pbihcIiBcIilcblxuICAgIHJldHVybiBmdWxsU3RyaW5nO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdFBlcmNlbnQgPSBmdW5jdGlvbihkZWNpbWFscywgaW50ZWdlcnMpIHtcbiAgICB2YXIgdG1wID0gdGhpcztcbiAgICB2YXIgZGVjID0gXCIxXCI7XG4gICAgdmFyIGZvcm1hdERlY2ltYWwgPSAwO1xuICAgIHZhciBuZWdhdGl2ZUNoZWNrID0gZmFsc2U7XG5cbiAgICBpZiAodG1wLnN1YnN0cmluZygwLCAxKSA9PSBcIi1cIikge1xuICAgICAgICBuZWdhdGl2ZUNoZWNrID0gdHJ1ZTtcbiAgICAgICAgdG1wID0gdG1wLnN1YnN0cmluZygxLCB0bXAubGVuZ3RoKTtcbiAgICB9O1xuXG4gICAgaWYgKGRlY2ltYWxzKSB7XG4gICAgICAgIGRlYyA9IGRlYy5ycGFkKFwiMFwiLCBwYXJzZUludChkZWNpbWFscykgKyAxKTtcbiAgICAgICAgZm9ybWF0RGVjaW1hbCA9IHBhcnNlSW50KGRlY2ltYWxzKTtcbiAgICB9XG4gICAgZGVjID0gcGFyc2VJbnQoZGVjKTtcblxuICAgIGlmICgodG1wICYmIHBhcnNlSW50KHRtcCkgPT0gMCkgfHwgdG1wID09IFwiXCIgfHwgdG1wID09IHVuZGVmaW5lZCB8fCBpc05hTihwYXJzZUludCh0bXApKSkge1xuICAgICAgICB0bXAgPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRtcCA9IHBhcnNlRmxvYXQodG1wKSAvIGRlYztcbiAgICB9XG5cbiAgICBpZiAobmVnYXRpdmVDaGVjaykge1xuICAgICAgICB0bXAgPSB0bXAgKiAtMTtcbiAgICB9XG5cbiAgICB2YXIgb3B0aW9uID0ge1xuICAgICAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IGZvcm1hdERlY2ltYWwsXG4gICAgICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogZm9ybWF0RGVjaW1hbFxuICAgIH07XG5cbiAgICB0bXAgPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoJ3B0LUJSJywgb3B0aW9uKS5mb3JtYXQodG1wKTtcblxuICAgIHJldHVybiB0bXA7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0Q3VycmVuY3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRtcCA9IHRoaXM7XG4gICAgdmFyIG5lZ2F0aXZlQ2hlY2sgPSBmYWxzZTtcblxuICAgIGlmICh0bXAuc3Vic3RyaW5nKDAsIDEpID09IFwiLVwiKSB7XG4gICAgICAgIG5lZ2F0aXZlQ2hlY2sgPSB0cnVlO1xuICAgICAgICB0bXAgPSB0bXAuc3Vic3RyaW5nKDEsIHRtcC5sZW5ndGgpO1xuICAgIH07XG5cbiAgICAvL3JlbW92ZSB6ZXJvcyBhIGVzcXVlcmRhXG4gICAgaWYgKHRtcCkge1xuICAgICAgICAvLyB0bXAgPSBwYXJzZUludCh0bXApICsgXCJcIjtcbiAgICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL14wKy8sICcnKTtcbiAgICB9XG5cbiAgICAvL1F1YWxxdWVyIGNvaXNhIGRpZmVyZW50ZSBkZSB1bSBudW1lcm8gdmFsaWRvIHJldG9ybmEgMCwwMFxuICAgIGlmICgodG1wICYmIHBhcnNlSW50KHRtcCkgPT0gMCkgfHwgdG1wID09IFwiXCIgfHwgdG1wID09IHVuZGVmaW5lZCB8fCBpc05hTihwYXJzZUludCh0bXApKSkge1xuICAgICAgICByZXR1cm4gXCIwLDAwXCI7XG4gICAgfVxuXG4gICAgLy9WZXJpZmljYSBzZSBleGlzdGVtIHNvbWVudGUgZGVjaW1haXMsIGUgYWNyZXNjZW50YSB1bSB6ZXJvIG5hIGZyZW50ZVxuICAgIGlmICh0bXAgJiYgdG1wLmxlbmd0aCA8PSAyKSB7XG4gICAgICAgIHRtcCA9IHRtcC5scGFkKFwiMFwiLCAzKTtcbiAgICB9XG5cbiAgICAvL3NlIG8gdGFtYW5obyBmb3JcbiAgICAvL2NvbG9jYSBhcyBjYXNhcyBkZWNpbWFpc1xuICAgIHRtcCA9IHRtcC5yZXBsYWNlKC8oWzAtOV17Mn0pJC9nLCBcIiwkMVwiKTtcblxuICAgIC8vc2UgdGl2ZXIgbWlsaGFyIGNvbG9jYSBwb250b1xuICAgIGlmICh0bXAubGVuZ3RoID4gNikge1xuICAgICAgICB0bXAgPSB0bXAucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgXCIuXCIpO1xuICAgIH1cblxuICAgIGlmIChuZWdhdGl2ZUNoZWNrID09IHRydWUpIHtcbiAgICAgICAgdG1wID0gXCItXCIgKyB0bXA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRtcDtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXREYXRlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB2YXIgZGlhID0gXCJcIjtcbiAgICB2YXIgbWVzID0gXCJcIjtcbiAgICB2YXIgYW5vID0gXCJcIjtcbiAgICB2YXIgaXRlbnMgPSBcIlwiO1xuICAgIHZhciBkYXRhRm9ybWF0YWRhID0gbnVsbDtcbiAgICB2YXIgc3RyID0gdGhpcztcblxuICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgIC8vb3B0aW9ucy5kYXRlICE9IFwiXCIgJiYgb3B0aW9ucy5kYXRlICE9IDAgJiYgb3B0aW9ucy5kYXRlICE9IG51bGxcbiAgICAgICAgb3B0aW9ucy5kYXRlID0gc3RyO1xuXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5zcmNGb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgJ2RkbW15eXl5JzpcbiAgICAgICAgICAgICAgICBhbm8gPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDQsIDgpO1xuICAgICAgICAgICAgICAgIG1lcyA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoMiwgNCk7XG4gICAgICAgICAgICAgICAgZGlhID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZygwLCAyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAneXl5eW1tZGQnOlxuICAgICAgICAgICAgICAgIGFubyA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoMCwgNCk7XG4gICAgICAgICAgICAgICAgbWVzID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZyg0LCA2KTtcbiAgICAgICAgICAgICAgICBkaWEgPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDYsIDgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZC5tbS55eXl5JzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMuZGF0ZS5zcGxpdChcIi5cIik7XG4gICAgICAgICAgICAgICAgYW5vID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgbWVzID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgZGlhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2RkL21tL3l5eXknOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy5kYXRlLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgICAgICAgICBhbm8gPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBtZXMgPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBkaWEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAneXl5eS5tbS5kZCc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLmRhdGUuc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgICAgIGFubyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIG1lcyA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIGRpYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZC1tbS15eXl5JzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMuZGF0ZS5zcGxpdChcIi1cIik7XG4gICAgICAgICAgICAgICAgYW5vID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgbWVzID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgZGlhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXktbW0tZGQnOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy5kYXRlLnNwbGl0KFwiLVwiKTtcbiAgICAgICAgICAgICAgICBhbm8gPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBtZXMgPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBkaWEgPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAneXl5eW1tJzpcbiAgICAgICAgICAgICAgICBhbm8gPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDAsIDQpO1xuICAgICAgICAgICAgICAgIG1lcyA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoNCwgNik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJEYXRhIGludsOhbGlkYVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy50YXJnZXRGb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgJ2RkL21tL3l5eXknOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBkaWEgKyAnLycgKyBtZXMgKyAnLycgKyBhbm87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXkvbW0vZGQnOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBhbm8gKyAnLycgKyBtZXMgKyAnLycgKyBkaWE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2RkLm1tLnl5eXknOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBkaWEgKyAnLicgKyBtZXMgKyAnLicgKyBhbm87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXkubW0uZGQnOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBhbm8gKyAnLicgKyBtZXMgKyAnLicgKyBkaWE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2RkLW1tLXl5eXknOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBkaWEgKyAnLScgKyBtZXMgKyAnLScgKyBhbm87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXktbW0tZGQnOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBhbm8gKyAnLScgKyBtZXMgKyAnLScgKyBkaWE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ21tL3l5eXknOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBtZXMgKyAnLycgKyBhbm87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ21teXknOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBtZXMgKyBcIlwiICsgYW5vLnN1YnN0cmluZygyLCA0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGRtbXl5eXknOlxuICAgICAgICAgICAgICAgIGRhdGFGb3JtYXRhZGEgPSBkaWEgKyBtZXMgKyBhbm87XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXltbWRkJzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gYW5vICsgbWVzICsgZGlhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb1wiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGF0YUZvcm1hdGFkYTtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXRUaW1lID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB2YXIgaG9yYSA9IFwiXCI7XG4gICAgdmFyIG1pbiA9IFwiXCI7XG4gICAgdmFyIHNlZyA9IFwiXCI7XG4gICAgdmFyIGl0ZW5zID0gXCJcIjtcbiAgICB2YXIgaG9yYUZvcm1hdGFkYSA9IG51bGw7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG5cbiAgICBpZiAob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zLnRpbWUgPSBzdHI7XG5cbiAgICAgICAgc3dpdGNoIChvcHRpb25zLnNyY0Zvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSAnaGhtbXNzJzpcbiAgICAgICAgICAgICAgICBob3JhID0gb3B0aW9ucy50aW1lLnN1YnN0cmluZygwLCAyKTtcbiAgICAgICAgICAgICAgICBtaW4gPSBvcHRpb25zLnRpbWUuc3Vic3RyaW5nKDIsIDQpO1xuICAgICAgICAgICAgICAgIHNlZyA9IG9wdGlvbnMudGltZS5zdWJzdHJpbmcoNCwgNik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2hoOm1tOnNzJzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMudGltZS5zcGxpdChcIjpcIik7XG4gICAgICAgICAgICAgICAgaG9yYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIG1pbiA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIHNlZyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdoaC5tbS5zcyc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLnRpbWUuc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgICAgIGhvcmEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBtaW4gPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBzZWcgPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaGgtbW0tc3MnOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy50aW1lLnNwbGl0KFwiLVwiKTtcbiAgICAgICAgICAgICAgICBob3JhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgbWluID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgc2VnID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJIb3JhIGludsOhbGlkYVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy50YXJnZXRGb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgJ2hoOm1tOnNzJzpcbiAgICAgICAgICAgICAgICBob3JhRm9ybWF0YWRhID0gaG9yYSArICc6JyArIG1pbiArICc6JyArIHNlZztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaGgubW0uc3MnOlxuICAgICAgICAgICAgICAgIGhvcmFGb3JtYXRhZGEgPSBob3JhICsgJy4nICsgbWluICsgJy4nICsgc2VnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdoaC1tbS1zcyc6XG4gICAgICAgICAgICAgICAgaG9yYUZvcm1hdGFkYSA9IGhvcmEgKyAnLScgKyBtaW4gKyAnLScgKyBzZWc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2hobW1zcyc6XG4gICAgICAgICAgICAgICAgaG9yYUZvcm1hdGFkYSA9IGhvcmEgKyBtaW4gKyBzZWc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBob3JhRm9ybWF0YWRhO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdENwZiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY3BmID0gdGhpcy5scGFkKFwiMFwiLCAxMSk7XG4gICAgcmV0dXJuIGNwZi5yZXBsYWNlKC8oXFxkezN9KShcXGR7M30pKFxcZHszfSkoXFxkezJ9KS9nLCBcIlxcJDEuXFwkMi5cXCQzXFwtXFwkNFwiKTtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXRDbnBqID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBjcGYgPSB0aGlzLmxwYWQoXCIwXCIsIDE0KTtcbiAgICByZXR1cm4gY3BmLnJlcGxhY2UoLyhcXGR7Mn0pKFxcZHszfSkoXFxkezN9KShcXGR7NH0pKFxcZHsyfSkvZywgXCJcXCQxLlxcJDIuXFwkM1xcL1xcJDRcXC0kNVwiKTtcbn1cblxuXG5TdHJpbmcucHJvdG90eXBlLmRhdGVEaWZmID0gZnVuY3Rpb24gKHNyY0Zvcm1hdCwgdGFyZ2V0RGF0YSwgdHlwZSkge1xuXG4gICAgdmFyIGRhdGFJbmkgPSBuZXcgRGF0ZSh0aGlzLmZvcm1hdERhdGUoe1xuICAgICAgICBcInNyY0Zvcm1hdFwiOiBzcmNGb3JtYXQsXG4gICAgICAgIFwidGFyZ2V0Rm9ybWF0XCI6IFwieXl5eS9tbS9kZFwiXG4gICAgfSkpO1xuICAgIHZhciBkYXRhRmltID0gbmV3IERhdGUodGFyZ2V0RGF0YS5mb3JtYXREYXRlKHtcbiAgICAgICAgXCJzcmNGb3JtYXRcIjogc3JjRm9ybWF0LFxuICAgICAgICBcInRhcmdldEZvcm1hdFwiOiBcInl5eXkvbW0vZGRcIlxuICAgIH0pKTtcblxuICAgIGlmICh0eXBlID09IFwiZGlhXCIpIHtcbiAgICAgICAgdmFyIGRpZkRpYXMgPSBNYXRoLmFicyhkYXRhRmltLmdldFRpbWUoKSAtIGRhdGFJbmkuZ2V0VGltZSgpKTtcbiAgICAgICAgdmFyIG51bURpYXMgPSBNYXRoLmNlaWwoZGlmRGlhcyAvICgxMDAwICogMzYwMCAqIDI0KSk7XG4gICAgICAgIHJldHVybiBudW1EaWFzO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcIm1lc1wiKSB7XG4gICAgICAgIHZhciBkaWZNZXNlcyA9IE1hdGguYWJzKGRhdGFGaW0uZ2V0VGltZSgpIC0gZGF0YUluaS5nZXRUaW1lKCkpO1xuICAgICAgICB2YXIgbnVtTWVzZXMgPSBNYXRoLmNlaWwoZGlmTWVzZXMgLyAoMTAwMCAqIDM2MDAgKiAyNCAqIDMwKSAtIDEpO1xuICAgICAgICByZXR1cm4gbnVtTWVzZXM7XG4gICAgfSBlbHNlIGlmICh0eXBlID09ICdhbm8nKSB7XG4gICAgICAgIHZhciBkaWZNZXNlcyA9IE1hdGguYWJzKGRhdGFGaW0uZ2V0VGltZSgpIC0gZGF0YUluaS5nZXRUaW1lKCkpO1xuICAgICAgICB2YXIgbnVtTWVzZXMgPSBNYXRoLmNlaWwoZGlmTWVzZXMgLyAoMTAwMCAqIDM2MDAgKiAyNCAqIDMwKSAtIDEpO1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihudW1NZXNlcyAvIDEyKTtcbiAgICB9XG59XG5cblN0cmluZy5wcm90b3R5cGUucGx1c0RheXMgPSBmdW5jdGlvbiAoc3JjRm9ybWF0LCBkYXlzKSB7XG4gICAgdmFyIGRhdGFGb3JtYXRhZGEgPSB0aGlzLmZvcm1hdERhdGUoe1xuICAgICAgICBcInNyY0Zvcm1hdFwiOiBzcmNGb3JtYXQsXG4gICAgICAgIFwidGFyZ2V0Rm9ybWF0XCI6IFwieXl5eS9tbS9kZFwiXG4gICAgfSk7XG4gICAgdmFyIGRhdGFHZXJhZGEgPSBuZXcgRGF0ZShkYXRhRm9ybWF0YWRhKTtcbiAgICB2YXIgZGF0YUZpbmFsID0gXCJcIjtcbiAgICBkYXRhR2VyYWRhLnNldERhdGUoZGF0YUdlcmFkYS5nZXREYXRlKCkgKyBkYXlzKTtcbiAgICB2YXIgbWVzID0gbmV3IFN0cmluZyhkYXRhR2VyYWRhLmdldE1vbnRoKCkgKyAxKS5scGFkKCcwJywgMik7XG4gICAgdmFyIGRpYSA9IG5ldyBTdHJpbmcoZGF0YUdlcmFkYS5nZXREYXRlKCkpLmxwYWQoJzAnLCAyKTtcbiAgICBkYXRhRmluYWwgPSBkaWEgKyAnLycgKyBtZXMgKyAnLycgKyBkYXRhR2VyYWRhLmdldEZ1bGxZZWFyKCk7XG4gICAgcmV0dXJuIGRhdGFGaW5hbDtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5taW51c0RheXMgPSBmdW5jdGlvbiAoc3JjRm9ybWF0LCBkYXlzKSB7XG4gICAgdmFyIGRhdGFGb3JtYXRhZGEgPSB0aGlzLmZvcm1hdERhdGUoe1xuICAgICAgICBcInNyY0Zvcm1hdFwiOiBzcmNGb3JtYXQsXG4gICAgICAgIFwidGFyZ2V0Rm9ybWF0XCI6IFwieXl5eS9tbS9kZFwiXG4gICAgfSk7XG4gICAgdmFyIGRhdGFHZXJhZGEgPSBuZXcgRGF0ZShkYXRhRm9ybWF0YWRhKTtcbiAgICB2YXIgZGF0YUZpbmFsID0gXCJcIjtcbiAgICBkYXRhR2VyYWRhLnNldERhdGUoZGF0YUdlcmFkYS5nZXREYXRlKCkgLSBkYXlzKTtcbiAgICB2YXIgbWVzID0gbmV3IFN0cmluZyhkYXRhR2VyYWRhLmdldE1vbnRoKCkgKyAxKS5scGFkKCcwJywgMik7XG4gICAgdmFyIGRpYSA9IG5ldyBTdHJpbmcoZGF0YUdlcmFkYS5nZXREYXRlKCkpLmxwYWQoJzAnLCAyKTtcbiAgICBkYXRhRmluYWwgPSBkaWEgKyAnLycgKyBtZXMgKyAnLycgKyBkYXRhR2VyYWRhLmdldEZ1bGxZZWFyKCk7XG4gICAgcmV0dXJuIGRhdGFGaW5hbDtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5jb252ZXJ0VG9OdW1iZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNvZGVTdHJpbmcgPSB0aGlzLnN1YnN0cmluZygxLCAxMik7XG4gICAgdmFyIGxldHRlciA9IHRoaXMuc3Vic3RyaW5nKDAsIDEpLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIGxldHRlci5jaGFyQ29kZUF0KDApIC0gOTYgKyBjb2RlU3RyaW5nO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmxwYWQgPSBmdW5jdGlvbiAocGFkU3RyaW5nLCBsZW5ndGgpIHtcbiAgICB2YXIgc3RyID0gdGhpcztcbiAgICB3aGlsZSAoc3RyLmxlbmd0aCA8IGxlbmd0aClcbiAgICAgICAgc3RyID0gcGFkU3RyaW5nICsgc3RyO1xuICAgIHJldHVybiBzdHI7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZ2V0U2lnbGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNpZ2xhID0gXCJcIjtcbiAgICB2YXIgbmFtZSA9IHRoaXM7XG5cbiAgICBpZiAobmFtZSkge1xuICAgICAgICB2YXIgdXNlck5hbWUgPSBuYW1lLnJlcGxhY2UobmV3IFJlZ0V4cCgvWy1dL2cpLCBcIlwiKTtcbiAgICAgICAgdXNlck5hbWUgPSB1c2VyTmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAoL1tcXHNdKy9nKSwgXCIgXCIpLnRyaW0oKTtcbiAgICAgICAgdXNlck5hbWUgPSB1c2VyTmFtZS5zcGxpdChcIiBcIik7XG4gICAgICAgIHZhciBmaXJzdE5hbWUgPSB1c2VyTmFtZVswXTtcbiAgICAgICAgdmFyIGxhc3ROYW1lID0gdXNlck5hbWVbdXNlck5hbWUubGVuZ3RoIC0gMV07XG4gICAgICAgIHNpZ2xhID0gZmlyc3ROYW1lWzBdICsgbGFzdE5hbWVbMF07XG4gICAgfVxuXG4gICAgcmV0dXJuIHNpZ2xhO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLnJwYWQgPSBmdW5jdGlvbiAocGFkU3RyaW5nLCBsZW5ndGgpIHtcbiAgICB2YXIgc3RyID0gdGhpcztcbiAgICB3aGlsZSAoc3RyLmxlbmd0aCA8IGxlbmd0aClcbiAgICAgICAgc3RyID0gc3RyICsgcGFkU3RyaW5nO1xuICAgIHJldHVybiBzdHI7XG59XG5cblN0cmluZy5wcm90b3R5cGUudHJpbSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCBcIlwiKTtcbn1cblxuLy90cmltbWluZyBzcGFjZSBmcm9tIGxlZnQgc2lkZSBvZiB0aGUgc3RyaW5nXG5TdHJpbmcucHJvdG90eXBlLmx0cmltID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL15cXHMrLywgXCJcIik7XG59XG5cbi8vdHJpbW1pbmcgc3BhY2UgZnJvbSByaWdodCBzaWRlIG9mIHRoZSBzdHJpbmdcblN0cmluZy5wcm90b3R5cGUucnRyaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXFxzKyQvLCBcIlwiKTtcbn0iLCJcInVzZSBzdHJpY3RcIjtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICQod2luZG93KS5vbihcInJlc2l6ZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQoXCJhYi1wYWdlXCIpLmZpbmQoXCJhYi1idXR0b25cIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmNzcyhcIm1heC13aWR0aFwiLCBcIjEwMCVcIik7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcIndpZHRoXCIsICQodGhpcykuYXR0cihcIndpZHRoXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuY2xhc3MgQWJCdXR0b24gZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICAgIHRoaXMuc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICB0aGlzLmltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuYmxvY2tlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICAgICAgdGhpcy5tYWluQ2xhc3MgPSBcImFiLWJ1dHRvblwiO1xuXG4gICAgfVxuXG4gICAgX3JlbmRlcigpIHtcbiAgICAgICAgLy9jb2xvY2EgY2xhc3NlXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCh0aGlzLm1haW5DbGFzcyk7XG5cbiAgICAgICAgdmFyIGlkID0gZ2VuZXJhdGVJRCgpO1xuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogSWRlbnRpZmljYWRvciDDum5pY28gZG8gb2JqZXRvLCBjb20gcHJlZml4byBcImJ0blwifCBBbGZhbnVtw6lyaWNvIHxuw6NvfCByYW5kw7RtaWNvfFxuICAgICAgICAgICAgaWQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL0NvbG9jYSBvcyBhdHJpYnV0b3Mgbm8gb2JqZXRvXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIndpZHRoXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBMYXJndXJhIGRvIGJvdMOjb3wgQWxmYW51bcOpcmljb3wgbsOjb3wgYXV0byB8XG4gICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImhlaWdodFwiKSkge1xuICAgICAgICAvLyAgICAgLy9kZXNjcmlwdGlvbjogQWx0dXJhIGRvIGJvdMOjb3wgQWxmYW51bcOpcmljb3wgbsOjb3wgYXV0byB8XG4gICAgICAgIC8vICAgICB0aGlzLnN0eWxlLmhlaWdodCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIpO1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwibGFzdC1idXR0b25cIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFVsdGltbyBib3TDo28gZGEgcMOhZ2luYSB8IEJvb2xlYW4gfCBuw6NvIHwgZmFsc2UgfFxuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWxhc3QtYnV0dG9uXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy92ZXJpZmljYSB3aWR0aC1vbi1iaWdzY3JlZW5cbiAgICAgICAgaWYgKCQoXCJhYi1wYWdlXCIpLmF0dHIoXCJmdWxsc2NyZWVuXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIikpIHtcbiAgICAgICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBMYXJndXJhIGRvIGNvbXBvbmVudGUgZW0gdGVsYXMgbWFpb3Jlc3wgJSBvdSBweHwgbsOjb3wgfFxuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IFwiMzQwcHhcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ3JpYSBib3Rhb1xuICAgICAgICB0aGlzLmJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwiYnRuX2J1dHRvblwiKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmJ1dHRvbik7XG5cbiAgICAgICAgLy8gYWRpY2lvbmEgbyB0ZXh0byBpbnNlcmlkbyBubyBvYmpldG8gcGFyYSBvIHNwYW4gY3JpYWRvXG4gICAgICAgIHRoaXMuc3Bhbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwiYnRuX3NwYW5cIik7XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwibGFiZWxcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IENvbG9jYXIgdW0gdGV4dG8gbm8gYm90w6NvfCBBbGZhbnVtw6lyaWNvfCBzaW18IHZhemlvfFxuICAgICAgICAgICAgdGhpcy5zcGFuLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibGFiZWxcIikudG9VcHBlck9ubHlGaXJzdExldHRlcigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYnV0dG9uLmFwcGVuZENoaWxkKHRoaXMuc3Bhbik7XG5cbiAgICAgICAgLy8gYWRpY2lvbmEgYSBpbWFnZW0gaW5zZXJpZGEgbm8gb2JqZXRvIG5vIGJhY2tncm91bmQgZGUgdW1hIGRpdlxuICAgICAgICB0aGlzLmltZy5zZXRBdHRyaWJ1dGUoXCJkaXYtaW1hZ2VcIiwgXCJ0cnVlXCIpO1xuICAgICAgICB0aGlzLmltZy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwiYnRuX2ltZ1wiKTtcbiAgICAgICAgdGhpcy5idXR0b24uaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFwiYWZ0ZXJiZWdpblwiLCB0aGlzLmltZyk7XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImljb25cIikgfHwgdGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uLWNsYXNzXCIpKSB7XG4gICAgICAgICAgICB0aGlzLmltZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIHRoaXMuZ2V0QXR0cmlidXRlKFwiaWNvblwiKSArIFwiKVwiO1xuICAgICAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaWNvbi1jbGFzc1wiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaW1nLmNsYXNzTGlzdC5hZGQodGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uLWNsYXNzXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHZlcmlmaWNhIHNlIG8gYm90w6NvIMOpIHNvbWVudGUgcGFyYSBtb3N0cmFyIG8gw61jb25lIGUgYWRpY2lvbmEgYSBjbGFzc2VcbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiaWNvbi1idXR0b25cIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiB0cnVlO2ZhbHNlXG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBUcmF2YSBvIGJvdMOjbyBwYXJhIHRlciBzb21lbnRlIG8gw61jb25lfCB0cnVlIG91IGZhbHNlfCBuw6NvfCBmYWxzZXxcbiAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1pbWdcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB2ZXJpZmljYSBzZSB0ZW0gbyB0YW1hbmhvIGRvIGljb25lIGUgYWRpY2lvbmEgbm8gdGFtYW5obyBkbyBiYWNrZ3JvdW5kXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImljb24tc2l6ZVwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQWx0ZXJhIG8gdGFtYW5obyBkbyBpY29uZXwgTsO6bWVybyBlbSBweHwgbsOjb3wgfFxuICAgICAgICAgICAgdGhpcy5pbWcuc3R5bGUuYmFja2dyb3VuZFNpemUgPSB0aGlzLmdldEF0dHJpYnV0ZShcImljb24tc2l6ZVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHZlcmlmaWNhIHNlIHRlbSBvIHRhbWFuaG8gZG8gZXNwYcOnbyBkbyDDrWNvbmUgZSBkZWZpbmUgYSBsYXJndXJhIGRhIGRpdlxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uLXNwYWNlLXdpZHRoXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBFc3Bhw6dhbWVudG8gZG8gw61jb25lIGNvbSBvIHRleHRvfCBOw7ptZXJvIGVtIHB4fCBuw6NvfCB8XG4gICAgICAgICAgICB0aGlzLmltZy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWNvbi1zcGFjZS13aWR0aFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ29sb2NhIGNvciBubyBib3Rhb1xuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ0aGVtZVwiKSkge1xuICAgICAgICAgICAgLy92YWx1ZXM6IG5vcm1hbDtsaWdodDtrZXlib2FyZDtrZXlib2FyZC1vaztkYXJrLXJvdW5kZWQ7cmVkLXJvdW5kZWQ7ZGFyazt2a1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQWx0ZXJhIGEgY29yIGRvIGNvbXBvbmVudGV8IFtbI1RlbWFzIHwgVmVyIHRlbWFzXV18IG7Do28gfCB2YXppb3xcbiAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1cIiArIHRoaXMuZ2V0QXR0cmlidXRlKFwidGhlbWVcIikpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwidGhlbWVcIikgPT0gXCJhYi1idXR0b24ta2V5Ym9hcmRcIikge1xuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWtleWJvYXJkXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLW5vcm1hbFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInBvc2l0aW9uXCIpID09IFwiY2VudGVyXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiBjZW50ZXI7cmlnaHQ7bGVmdFxuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogUG9zacOnw6NvIGRvIGJvdMOjb3wgQ2VudGVyLCByaWdodCBvdSBsZWZ0fCBuw6NvfCBjZW50ZXJ8XG4gICAgICAgICAgICBpZiAocG1iLnV0aWxzLnNob3dCaWdTY3JlZW4odG9wLiQoXCJib2R5XCIpKSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWNlbnRlci1iaWdcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1jZW50ZXJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJwb3NpdGlvblwiKSA9PSBcImxlZnRcIikge1xuICAgICAgICAgICAgLy9uw6NvIGZheiBuYWRhXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJwb3NpdGlvblwiKSA9PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuZmxvYXQgPSB0aGlzLmdldEF0dHJpYnV0ZShcInBvc2l0aW9uXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy92ZXJpZmljYSBzZSB0ZW0gbWF4IHdpZHRoXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heC13aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTGFyZ3VyYSBtw6F4aW1hIGRvIGJvdMOjb3wgTsO6bWVybyBlbSBweHwgbsOjb3wgfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ibG9ja2VyLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tYmxvY2tcIik7XG4gICAgICAgIHRoaXMuYmxvY2tlci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwiYnRuX2libG9ja2VyXCIpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuYmxvY2tlcik7XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiB0cnVlO2ZhbHNlXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgdGhpcy5ibG9ja2VyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1ibG9ja2VkXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgdGhpcy5ibG9ja2VyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmlsaXR5XCIpID09IFwiaGlkZGVuXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiBoaWRkZW47c2hvd1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvL01lc21vIGNvbXBvcnRhbWVudG8gcG9yw6ltIGNvbSBvdXRybyBub21lIGRlIGF0cmlidXRvLCBuZWNlc3PDoXJpbyBhanVzdGFyIHRvZG9zIHByb2pldG9zIHF1ZSB1c2FtIG8gZGUgY2ltYVxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmxlXCIpID09IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9MaW1wYSB2YXJpYXZlaXNcbiAgICAgICAgaWQgPSBudWxsO1xuICAgIH1cblxuICAgIF9hZGRFdmVudCgpIHtcbiAgICAgICAgdmFyIGJ1dHRvbiA9ICQodGhpcy5idXR0b24pO1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIC8vIGFsdGVyYSBvIMOtY29uZSBkbyBib3TDo28gcXVhbmRvIG8gYm90w6NvIMOpIGFwZXJ0YWRvIGUgc2Ugw6kgcGFzc2FkbyBvIGF0cmlidXRvIGljb24tYWN0aXZlXG4gICAgICAgIGJ1dHRvbi5vbihcInRvdWNoc3RhcnQgbW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgICAgICAgIC8vUHJvaWJlIG8gY2xpcXVlIGVtIGRvaXMgYm90w7VlcyBhbyBtZXNtbyB0ZW1wb1xuICAgICAgICAgICAgaWYgKGUgJiYgZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC50b3VjaGVzICYmIGUub3JpZ2luYWxFdmVudC50b3VjaGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvL3RpcmEgbyBmb2NvIGRlIHF1YWxxdWVyIGVsZW1lbnRvXG4gICAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgICAgICQod2luZG93KS5mb2N1cygpO1xuXG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikgPT0gXCJmYWxzZVwiIHx8ICFfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSkge1xuICAgICAgICAgICAgICAgIC8vc2UgdGl2ZXIgZXNwZWNpZmljYWRvIGljb24tYWN0aXZlIGFkaWNpb25hIG5vIGx1Z2FyIGRvIG5vcm1hbCBxdWFuZG8gbyBldmVudG8gaW5pY2lhXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcImljb24tYWN0aXZlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IENhbWluaG8gZG8gw61jb25lIHF1ZSBhcGFyZWNlcsOhIHF1YW5kbyBvIGJvdMOjbyBmb3IgYXRpdmFkby4gfCBBbGZhbnVtw6lyaWNvfCBuw6NvfCB2YXppb3xcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcImljb24tYWN0aXZlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbWcuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBfdGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uLWFjdGl2ZVwiKSArIFwiKVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHNlIHRpdmVyIHRlbWEgYWRpY2lvbmEgbyB0ZW1hIG5vIG9iamV0b1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJ0aGVtZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLVwiICsgX3RoaXMuZ2V0QXR0cmlidXRlKFwidGhlbWVcIikgKyBcIi1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1ub3JtYWwtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhbHRlcmEgbyDDrWNvbmUgZG8gYm90w6NvIHF1YW5kbyBvIGJvdMOjbyDDqSBzb2x0byBlIHNlIMOpIHBhc3NhZG8gbyBhdHJpYnV0byBpY29uLWFjdGl2ZVxuICAgICAgICBidXR0b24ub24oXCJtb3VzZXVwIHRvdWNoZW5kXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIC8vdGlyYSBvIGZvY28gZGUgcXVhbHF1ZXIgZWxlbWVudG9cbiAgICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgICAgICAgICAgJCh3aW5kb3cpLmZvY3VzKCk7XG5cbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSA9PSBcImZhbHNlXCIgfHwgIV90aGlzLmhhc0F0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgLy9yZXRvcm5hIG8gaWNvbmUgcGFyYSBvIG5vcm1hbCBxdWFuZG8gbyBldmVudG8gdGVybWluYVxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uLWFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwiaWNvblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgX3RoaXMuZ2V0QXR0cmlidXRlKFwiaWNvblwiKSArIFwiKVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vcmV0aXJhIG8gdGVtYSBhZGljaW9uYWRvXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcInRoZW1lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tXCIgKyBfdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSArIFwiLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLW5vcm1hbC1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL2HDp8OjbyBxdWFuZG8gbyBtb3VzZSBvdSBvIHRvdWNoIGRlaXhhciBhIMOhcmVhIGRvIG9iamV0byBib3TDo29cbiAgICAgICAgYnV0dG9uLm9uKFwibW91c2VsZWF2ZSB0b3VjaGxlYXZlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSA9PSBcImZhbHNlXCIgfHwgIV90aGlzLmhhc0F0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgLy9yZXRvcm5hIG8gaWNvbmUgcGFyYSBvIG5vcm1hbCBxdWFuZG8gbyBldmVudG8gdGVybWluYVxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uLWFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwiaWNvblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgaWNvbkFjdGl2ZSArIFwiKVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vcmV0aXJhIG8gdGVtYSBhZGljaW9uYWRvXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcInRoZW1lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tXCIgKyBfdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSArIFwiLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLW5vcm1hbC1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkKHRoaXMuYmxvY2tlcikub24oXCJ0YXBcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSk7XG5cblxuICAgIH1cblxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMubWFpbkNsYXNzKSkge1xuICAgICAgICAgICAgLyp0aGlzLnNoYWRvd0RvbSA9IHRoaXMuYXR0YWNoU2hhZG93KHsgbW9kZTogJ29wZW4nIH0pOyAqL1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgICAgICAgICB0aGlzLl9hZGRFdmVudCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBvYnNlcnZlZEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXCJpcy1kaXNhYmxlZFwiLCBcImxhYmVsXCIsIFwidGhlbWVcIiwgXCJpY29uXCIsIFwiaWNvbi1jbGFzc1wiLCBcIndpZHRoXCIsIFwiaWNvbi1idXR0b25cIiwgXCJpY29uLXNpemVcIiwgXCJpY29uLXNwYWNlLXdpZHRoXCIsIFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIiwgXCJwb3NpdGlvblwiLCBcIndpZHRoLW9uLWJpZ3NjcmVlblwiLCBcImlkXCIsIFwibWF4LXdpZHRoXCIsIFwiaXMtYmxvY2tlZFwiXTtcbiAgICB9XG5cbiAgICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2soYXR0ck5hbWUsIG9sZFZhbCwgbmV3VmFsKSB7XG5cbiAgICAgICAgc3dpdGNoIChhdHRyTmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcImlzLWRpc2FibGVkXCI6XG4gICAgICAgICAgICAgICAgLy9RdWFuZG8gaXMtZGlzYWJsZSA9IHRydWUsIGRlc2FiaWxpdGEgbyBib3TDo29cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU2UgbyBub3ZvIHZhbG9yIG7Do28gaGFiaWxpdGFyIG8gZGlzYWJsZSwgZWxlIHJldGlyYSBhcyBjbGFzc2VzIGRlIGFjdGl2ZSBlIHJlbW92ZSBvIGRpc2FibGUgZG8gYm90w6NvXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInRoZW1lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tXCIgKyB0aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpICsgXCItYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLW5vcm1hbC1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ibG9ja2VyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImxhYmVsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuLmlubmVyVGV4dCA9IG5ld1ZhbC50b1VwcGVyT25seUZpcnN0TGV0dGVyKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ0aGVtZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1cIiArIG9sZFZhbCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLW5vcm1hbFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tXCIgKyBuZXdWYWwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaWNvblwiOlxuICAgICAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgICAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgbmV3VmFsICsgXCIpXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpY29uLWNsYXNzXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuY2xhc3NMaXN0LmFkZChuZXdWYWwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwid2lkdGhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaWNvbi1idXR0b25cIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1pbWdcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLWltZ1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpY29uLXNpemVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImljb24tc3BhY2Utd2lkdGhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcInZpc2liaWxpdHlcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwic2hvd1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwidGFibGVcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PSBcImhpZGRlblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcInZpc2libGVcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwidGFibGVcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwicG9zaXRpb25cIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwiY2VudGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBtYi51dGlscy5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWNlbnRlci1iaWdcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tY2VudGVyXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT0gXCJyaWdodFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZmxvYXQgPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwid2lkdGgtb24tYmlnc2NyZWVuXCI6XG4gICAgICAgICAgICAgICAgaWYgKHBtYi51dGlscy5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpZFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuaW1nLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiYnRuX2ltZ1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcImJ0bl9idXR0b25cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiYnRuX3NwYW5cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5ibG9ja2VyLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiYnRuX2libG9ja2VyXCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwibWF4LXdpZHRoXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImlzLWJsb2NrZWRcIjpcbiAgICAgICAgICAgICAgICAvL1RyYXRhIGEgYWx0ZXJhw6fDo28gZG8gYXRyaWJ1dG8gaXMtZGlzYWJsZVxuICAgICAgICAgICAgICAgIC8vUXVhbmRvIGlzLWRpc2FibGUgPSB0cnVlLCBkZXNhYmlsaXRhIG8gYm90w6NvXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJsb2NrZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL1NlIG8gbm92byB2YWxvciBuw6NvIGhhYmlsaXRhciBvIGRpc2FibGUsIGVsZSByZXRpcmEgYXMgY2xhc3NlcyBkZSBhY3RpdmUgZSByZW1vdmUgbyBkaXNhYmxlIGRvIGJvdMOjb1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ0aGVtZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLVwiICsgdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSArIFwiLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1ub3JtYWwtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxufVxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKFwiYWItYnV0dG9uXCIsIEFiQnV0dG9uKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICQod2luZG93KS5vbihcInJlc2l6ZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQoXCJhYi1wYWdlXCIpLmZpbmQoXCJhYi1ib3hcIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcIndpZHRoXCIsICQodGhpcykuYXR0cihcIndpZHRoXCIpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJ3aWR0aFwiLCBcIjEwMCVcIik7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5jbGFzcyBBYkJveCBleHRlbmRzIEhUTUxFbGVtZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuYm94SGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImhlYWRlclwiKTtcbiAgICAgICAgdGhpcy5ib3hIZWFkZXJUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgICAgIHRoaXMuZGl2Rm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImZvb3RlclwiKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItYm94XCI7XG4gICAgICAgIFxuICAgIH1cblxuICAgIF9yZW5kZXIoKSB7XG4gICAgICAgIHZhciBpZCA9IGdlbmVyYXRlSUQoKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaWRcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IElkZW50aWZpY2Fkb3Igw7puaWNvIGRvIG9iamV0bywgY29tIHByZWZpeG8gXCJib3hcIiB8IEFsZmFudW3DqXJpY28gfCBOw6NvIHwgTm9ybWFsIHxcbiAgICAgICAgICAgIGlkID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcImFiLWJveFwiKTtcblxuICAgICAgIC8vIHN0eWxlLmlubmVyVGV4dCA9IFwiIC5hYi1ib3hbc3RhdHVzPSdhbmFsaXNlJ10geyAtLWJvcmRlci1zdGF0dXM6IDhweCBzb2xpZCB2YXIoLS1ib3gtc3RhdHVzLWFuYWxpc2UpOyB9IC5hYi1ib3hbc3RhdHVzPSdhdGl2byddIHsgLS1ib3JkZXItc3RhdHVzOiA4cHggc29saWQgdmFyKC0tYm94LXN0YXR1cy1hdGl2byk7IH0gLmFiLWJveFtzdGF0dXM9J2luYXRpdm8nXSB7IC0tYm9yZGVyLXN0YXR1czogOHB4IHNvbGlkIHZhcigtLWJveC1zdGF0dXMtaW5hdGl2byk7IH0gLmFiLWJveFtzdGF0dXM9J2NhbmNlbGFkbyddIHsgLS1ib3JkZXItc3RhdHVzOiA4cHggc29saWQgdmFyKC0tYm94LXN0YXR1cy1jYW5jZWxhZG8pOyB9IDpob3N0KC5hYi1ib3gpIHsgYm94LXNpemluZzogYm9yZGVyLWJveDsgZGlzcGxheTogaW5saW5lLWJsb2NrOyBvdmVyZmxvdzogaGlkZGVuOyBmbG9hdDogbGVmdDsgbWFyZ2luOiA4cHg7IHdpZHRoOiAtd2Via2l0LWNhbGMoMTAwJSAtIDE2cHgpOyB3aWR0aDogLW1vei1jYWxjKDEwMCUgLSAxNnB4KTsgd2lkdGg6IC1vLWNhbGMoMTAwJSAtIDE2cHgpOyB3aWR0aDogY2FsYygxMDAlIC0gMTZweCk7IGJvcmRlci1yYWRpdXM6IDVweDsgYm9yZGVyLWxlZnQ6IHZhcigtLWJvcmRlci1zdGF0dXMpOyBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctbHYyKTsgfSAuYWItYm94LWNvbnRlbnQgeyBib3gtc2l6aW5nOiBib3JkZXItYm94OyBwYWRkaW5nOiA4cHg7IGRpc3BsYXk6IHZhcigtLWJveERpc3ApOyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJnLWNvbXBvbmVudHMpOyBoZWlnaHQ6IGluaXRpYWw7IG92ZXJmbG93OiBoaWRkZW47IGZsb2F0OiB2YXIoLS1ib3hGbG9hdCk7IHdpZHRoOiAxMDAlOyBwb3NpdGlvbjogcmVsYXRpdmU7IH0gOmhvc3QoLmFiLWJveC1leHBhbmRhYmxlKSAuYWItYm94LWNvbnRlbnQgeyBwYWRkaW5nOiA4cHg7IH0gLmFiLWJveC1mb290ZXIgeyBmbG9hdDogbGVmdDsgaGVpZ2h0OiA0MHB4OyB3aWR0aDogMTAwJTsgYmFja2dyb3VuZC1zaXplOiAyMHB4OyBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7IGJvdHRvbTogMHB4OyBsZWZ0OiA4cHg7IGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJnLWNvbXBvbmVudHMpOyBjdXJzb3I6IHBvaW50ZXI7IH0gOmhvc3QoLmFiLWJveC1jbG9zZWQpIDpob3N0KC5hYi1ib3gtb3BlbmVkKSAuYWItYm94LWNvbnRlbnQgeyBtYXgtaGVpZ2h0OiA5MDAwJSAhaW1wb3J0YW50OyB9IDpob3N0KC5hYi1ib3gtb3BlbmVkKSAuYWItYm94LWZvcm0gLmFiLWJveC1jb250ZW50IHsgbWF4LWhlaWdodDogMTAwcHggfSAuYWItYm94LWNvbnRlbnQ6OnNsb3R0ZWQobGFiZWwpIHsgZm9udC1zaXplOiAxM3B4OyBmb250LWZhbWlseTogJ2FibGlua21lZGl1bSc7IGxpbmUtaGVpZ2h0OiAxOHB4OyBjb2xvcjogdmFyKC0tY29yLXByaS10ZXh0KTsgZGlzcGxheTogYmxvY2s7IHdpZHRoOiAxMDAlOyBwYWRkaW5nOiA4cHg7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZsb2F0OiBsZWZ0OyB9IC5hYi1ib3gtdGl0bGUgeyBib3gtc2l6aW5nOiBib3JkZXItYm94OyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJnLWNvbXBvbmVudHMpOyBoZWlnaHQ6IDUwcHg7IGZsb2F0OiBsZWZ0OyB3aWR0aDogMTAwJTsgfSAuYWItYm94LXRpdGxlLXRleHQgeyBsaW5lLWhlaWdodDogNTBweDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAxNnB4OyBmb250LWZhbWlseTogJ2FibGlua3NlbWlib2xkcmVndWxhcic7IGZvbnQtd2VpZ2h0OiBub3JtYWw7IGNvbG9yOiB2YXIoLS1jb3ItdGl0dWxvKTsgZmxvYXQ6IGxlZnQ7IHBhZGRpbmctbGVmdDogOHB4OyBtYXJnaW46IDBweDsgfSAuYWItYm94LWRpdi1idXR0b25zIHsgZmxvYXQ6IGxlZnQ7IGRpc3BsYXk6IHRhYmxlOyB3aWR0aDogMTAwJTsgdGFibGUtbGF5b3V0OiBmaXhlZDsgdmVydGljYWwtYWxpZ246IHRvcDsgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmctY29tcG9uZW50cyk7IG1hcmdpbi10b3A6IC01cHg7IHBhZGRpbmc6IDBweCAxNnB4IDE2cHggMTZweDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgei1pbmRleDogMTsgcG9zaXRpb246IHJlbGF0aXZlOyB9IGJyIHsgbGluZS1oZWlnaHQ6IDIwcHg7IH1cIjtcblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSA9PSAnZmxleCcpe1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcImFiLWJveF9fZmxleFwiKTsgICAgICAgICAgICBcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpID09ICdhdGl2bycpe1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcImFiLWJveF9fYXRpdm9cIik7ICAgICAgICAgICAgXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSA9PSAnaW5hdGl2bycpe1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcImFiLWJveF9faW5hdGl2b1wiKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpID09ICdkYXJrJyl7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiYWItYm94X19kYXJrXCIpO1xuICAgICAgICB9XG5cblxuXG4gICAgICAgIC8vQ2xhc3NlIGJhc2VcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHRoaXMubWFpbkNsYXNzKTtcblxuICAgICAgICAvL0NvbG9jYSB0aXR1bG9cbiAgICAgICAgdGhpcy5ib3hIZWFkZXIuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcIl9kaXZfdGl0bGVcIik7XG4gICAgICAgIHRoaXMuYm94SGVhZGVyLmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtdGl0bGVcIik7XG5cblxuICAgICAgICB0aGlzLmJveEhlYWRlci5hcHBlbmRDaGlsZCh0aGlzLmJveEhlYWRlclRleHQpO1xuICAgICAgICB0aGlzLmJveEhlYWRlclRleHQuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcIl9kaXZfdGV4dFwiKTtcbiAgICAgICAgdGhpcy5ib3hIZWFkZXJUZXh0LmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtdGl0bGUtdGV4dFwiKTtcblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ0aXRsZVwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQ29sb2NhIHVtIHTDrXR1bG8gfCBBbGZhbnVtw6lyaWNvIHwgbsOjbyB8bsOjb3xcbiAgICAgICAgICAgIHRoaXMuYm94SGVhZGVyVGV4dC5pbm5lclRleHQgPSB0aGlzLmdldEF0dHJpYnV0ZShcInRpdGxlXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ib3hIZWFkZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJtYXgtd2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBvIHRhbWFuaG8gbcOheGltbyB8IFRhbWFuaG8gZW0gcGl4ZWwgfCBuw6NvIHwxMDAlfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IEF0aXZhIG91IGRlc2F0aXZhIG8gbWF4LXdpZHRoIHwgdHJ1ZSBvdSBmYWxzZXwgbsOjb3xmYWxzZXxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIm1heC13aWR0aFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZGl2IHBhcmEgZmF6ZXIgYSBzZXRhIHF1ZSBleHBhbmRlIG8gYm94XG4gICAgICAgIHRoaXMuZGl2Rm9vdGVyLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJfZm9vdGVyXCIpO1xuICAgICAgICB0aGlzLmRpdkZvb3Rlci5jbGFzc0xpc3QuYWRkKFwiYWItYm94LWZvb3RlclwiKTtcblxuICAgICAgICAvL3ZlcmlmaWNhIHNlIGV4aXN0ZSBhIGFsdHVyYSBpbmljaWFsLCBjb25zaWRlcmFkbyBwYXJhIGV4cGFuZGlyXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImluaXRpYWwtaGVpZ2h0XCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgYSBhbHR1cmEgaW5pY2lhbCBkbyBjb21wb25lbnRlIHF1YW5kbyBwcmVjaXNhIHNlciBleHBhbmRpZG98IDEwMHB4LCAyMDBweCwgMzAwcHh8IG7Do298bsOjb3xcblxuICAgICAgICAgICAgLy9hZGljaW9uYW5kbyBjbGFzc2VzIHBhcmEgY29uc2lkZXJhciBvIGZvb3RlclxuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYm94LWV4cGFuZGFibGVcIik7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUoXCJpcy1vcGVuZWRcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtY2xvc2VkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kaXZGb290ZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwidmlzaWJpbGl0eVwiKSA9PSBcImhpZGRlblwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogaGlkZGVuXG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBTZSBvIHBhcsOibWV0cm8gZXN0aXZlciBwcmVzZW50ZSBjb20gbyB2YWxvciBcImhpZGRlblwiLCBlc2NvbmRlIG8gb2JqZXRvIHwgaGlkZGVuIHwgbsOjb3wgbsOjb3xcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgdW1hIGxhcmd1cmEgcGFyYSBxdWFuZG8gZXN0aXZlciBlbSB0ZWxhIGdyYW5kZSAodGFibGV0cywgcGMpIHwgTnVtw6lyaWNvIHwgbsOjb3wgbsOjb3xcbiAgICAgICAgICAgIGlmICgkKFwiYWItcGFnZVwiKS5hdHRyKFwiZnVsbHNjcmVlblwiKSA9PSBcInRydWVcIil7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwic3RhdHVzXCIpKSB7XG4gICAgICAgICAgICB0aGlzLmJveEhlYWRlci5zZXRBdHRyaWJ1dGUoXCJzdGF0dXNcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJzdGF0dXNcIikpO1xuICAgICAgICAgICAgdGhpcy5kaXZGb290ZXIuc2V0QXR0cmlidXRlKFwic3RhdHVzXCIsIHRoaXMuZ2V0QXR0cmlidXRlKFwic3RhdHVzXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZm9yIGxlZ2FjeSBzdWJzdGl0dWlyIHRvZG9zIG9zIGgxIGRvcyBib3ggcG9yIGgzXG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC50YWdOYW1lID09IFwiSDFcIikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub3V0ZXJIVE1MID0gZWxlbWVudC5vdXRlckhUTUwucmVwbGFjZSgvaDEvZyxcImgzXCIpO1xuICAgICAgICAgICAgfSAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2FkZEV2ZW50KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICQodGhpcy5kaXZGb290ZXIpLm9uKFwidGFwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiaXMtb3BlbmVkXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBTZSBwb3NzdWlyIGluaXRpYWwtaGVpZ2h0LCBpbmljaWEgYWJlcnRvIG91IGZlY2hhZG8gfCB0cnVlIG91IGZhbHNlIHwgbsOjbyB8IGZhbHNlfFxuICAgICAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImlzLW9wZW5lZFwiLCBcImZhbHNlXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRBdHRyaWJ1dGUoXCJpcy1vcGVuZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH1cblxuXG4gICAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJhYi1ib3hcIikpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgICAgICAgdGhpcy5fYWRkRXZlbnQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gW1wiaXMtb3BlbmVkXCIsIFwibWF4LXdpZHRoXCIsIFwidGl0bGVcIiwgXCJ0aGVtZVwiLCBcImluaXRpYWwtaGVpZ2h0XCIsIFwiaWRcIiwgXCJ2aXNpYmlsaXR5XCIsIFwid2lkdGgtb24tYmlnc2NyZWVuXCIsIFwic3RhdHVzXCJdO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcbiAgICAgICAgc3dpdGNoIChhdHRyTmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcImlzLW9wZW5lZFwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYm94LW9wZW5lZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYm94LWNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYm94LWNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYm94LW9wZW5lZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgXG4gICAgICAgICAgICBjYXNlIFwibWF4LXdpZHRoXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLm1heFdpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUubWF4V2lkdGggPSBcIlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgIGNhc2UgXCJ0aXRsZVwiOlxuICAgIFxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3hIZWFkZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3hIZWFkZXJUZXh0LmlubmVyVGV4dCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJveEhlYWRlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm94SGVhZGVyVGV4dC5pbm5lclRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgIGNhc2UgXCJ0aGVtZVwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3hIZWFkZXIuY2xhc3NMaXN0LmFkZChcImFiLWJveC10aXRsZS1cIiArIG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGl2Rm9vdGVyLmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtZm9vdGVyLVwiICsgbmV3VmFsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJveEhlYWRlci5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYm94LXRpdGxlLVwiICsgb2xkVmFsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXZGb290ZXIuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJveC1mb290ZXItXCIgKyBuZXdWYWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgIGNhc2UgXCJpbml0aWFsLWhlaWdodFwiOlxuICAgICAgICAgICAgICAgIC8vYWRpY2lvbmEgYSBhbHR1cmEgaW5pY2lhbCBuYSBhbHR1cmEgZG8gb2JqZXRvXG4gICAgICAgICAgICAgICAgLy9zZXRhIE1heCBoZWlnaHRcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJveC1leHBhbmRhYmxlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpdkZvb3Rlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJveC1leHBhbmRhYmxlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpdkZvb3Rlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIC8vQm94IGFiZXJ0byBvdSBmZWNoYWRvXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiaXMtb3BlbmVkXCIpID09IFwiZmFsc2VcIiB8fCAhdGhpcy5oYXNBdHRyaWJ1dGUoXCJpcy1vcGVuZWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYm94LWNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1ib3gtY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgIGNhc2UgXCJpZFwiOlxuICAgICAgICAgICAgICAgIC8vbXVkYSBpZHNcbiAgICAgICAgICAgICAgICB0aGlzLmJveEhlYWRlci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcIl9kaXZfdGl0bGVcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5ib3hIZWFkZXJUZXh0LnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiX2Rpdl90ZXh0XCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGl2Rm9vdGVyLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiX2Zvb3RlclwiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgIGNhc2UgXCJ2aXNpYmlsaXR5XCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInNob3dcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsID09IFwiaGlkZGVuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcIndpZHRoLW9uLWJpZ3NjcmVlblwiOlxuICAgICAgICAgICAgICAgIGlmICgkKFwiYWItcGFnZVwiKS5hdHRyKFwiZnVsbHNjcmVlblwiKSA9PSBcInRydWVcIil7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwic3RhdHVzXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5ib3hIZWFkZXIuc2V0QXR0cmlidXRlKFwic3RhdHVzXCIsIG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXZGb290ZXIuc2V0QXR0cmlidXRlKFwic3RhdHVzXCIsIG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuXG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ2FiLWJveCcsIEFiQm94KTsiLCJcInVzZSBzdHJpY3RcIjtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICQod2luZG93KS5vbihcInJlc2l6ZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQoXCJhYi1wYWdlXCIpLmZpbmQoXCJhYi1jaGVja2JveFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIikpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJ3aWR0aFwiLCAkKHRoaXMpLmF0dHIoXCJ3aWR0aFwiKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJ3aWR0aFwiLCBcIjEwMCVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5jbGFzcyBBYkNoZWNrYm94IGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5jaGVja3NwYWNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5zcGFuTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgdGhpcy5zcGFuU3VidGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItY2hlY2tib3hcIjtcblxuICAgICAgICB0aGlzLl9hZGRFdmVudCgpO1xuICAgIH1cblxuICAgIF9yZW5kZXIoKSB7XG4gICAgICAgIC8vY29sb2NhIGNsYXNzZVxuICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQodGhpcy5tYWluQ2xhc3MpO1xuXG4gICAgICAgIC8vQ3JpYSB1bSBpZFxuICAgICAgICBsZXQgaWQgPSBnZW5lcmF0ZUlEKCk7XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgc2UgYSBjaGVja2JveCBqw6EgZXN0YXLDoSBzZWxlY2lvbmFkYXwgQm9vbGVhbiB8IG7Do298IGZhbHNlfFxuICAgICAgICAgICAgaWQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2FybWF6ZW5hIG8gY29udGXDumRvIHBhc3NhZG8gbm8gaHRtbFxuICAgICAgICBsZXQgY29udGV1ZG8gPSB0aGlzLmlubmVySFRNTDtcbiAgICAgICAgdGhpcy5pbm5lckhUTUwgPSBcIlwiO1xuXG4gICAgICAgIC8vQ29sb2NhIG9zIGF0cmlidXRvcyBubyBvYmpldG9cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhcmd1cmEgZG8gY29tcG9uZW50ZSAoYWZldGEgc29tZW50ZSBvIGVzcGHDp28gcXVlIHRlcsOhIHBhcmEgdGV4dCwgbsOjbyBhbHRlcmEgbyB0YW1hbmhvIGRhIGNoZWNrYm94KXwgJSBvdSBweHwgbsOjb3wgMTAwJXxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGhcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL09icmlnYXRvcmlvIGNoZWNhZ2VtIGFiYWl4byBkbyB3aWR0aFxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBhIGxhcmd1cmEgZG8gY29tcGVuZW50ZSBlbSB0ZWxhcyBtYWlvcmVzIChhZmV0YSBzb21lbnRlIG8gZXNwYcOnbyBxdWUgdGVyw6EgcGFyYSB0ZXh0LCBuw6NvIGFsdGVyYSBvIHRhbWFuaG8gZGEgY2hlY2tib3gpfCAlIG91IHB4fCBuw6NvfCB8XG4gICAgICAgICAgICBpZiAocG1iLnV0aWxzLnNob3dCaWdTY3JlZW4odG9wLiQoXCJib2R5XCIpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ3JpYSBjaGVja1xuICAgICAgICB0aGlzLmNoZWNrc3BhY2UuY2xhc3NMaXN0LmFkZChcImFiLWNoZWNrYm94LWNoZWNrc3BhY2VcIik7XG4gICAgICAgIHRoaXMuY2hlY2tzcGFjZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwiY2hrX2NoZWNrYm94XCIpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuY2hlY2tzcGFjZSk7XG5cbiAgICAgICAgLy9pbnNlcmUgbyBjb250ZcO6ZG8gbm8gb2JqZXRvXG4gICAgICAgIHRoaXMuc3BhbkxhYmVsLmNsYXNzTGlzdC5hZGQoXCJhYi1jaGVja2JveC10aXRsZVwiKTtcbiAgICAgICAgdGhpcy5zcGFuTGFiZWwuc2V0QXR0cmlidXRlKFwiY29udGVudC1hcmVhXCIsIFwidHJ1ZVwiKVxuICAgICAgICB0aGlzLnNwYW5MYWJlbC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwiY2hrX2xhYmVsXCIpO1xuICAgICAgICBpZiAoY29udGV1ZG8pIHtcbiAgICAgICAgICAgIHRoaXMuc3BhbkxhYmVsLmlubmVySFRNTCA9IGNvbnRldWRvO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwibGFiZWxcIikpIHtcbiAgICAgICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBMYWJlbCBkbyBjb21wb25lbnRlIHwgIHwgbsOjbyB8IHxcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW5MYWJlbC5pbm5lclRleHQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImxhYmVsXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5zcGFuTGFiZWwpO1xuXG4gICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLmNsYXNzTGlzdC5hZGQoXCJhYi1jaGVja2JveC1zdWJ0aXRsZVwiKTtcbiAgICAgICAgdGhpcy5zcGFuU3VidGl0bGUuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcImNoa19zdWJ0aXRsZVwiKTtcbiAgICAgICAgdGhpcy5zcGFuU3VidGl0bGUuaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJzdWJ0aXRsZVwiKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLnNwYW5TdWJ0aXRsZSk7XG5cbiAgICAgICAgLy9EZWZpbmUgc2UgZGV2ZXLDoSBzZXIgYWxpbmhhZG8gYSBkaXJlaXRhXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInBvc2l0aW9uXCIpID09IFwicmlnaHRcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IGxlZnQ7cmlnaHRcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBwYXJhIG9uZGUgZXN0YXLDoSBwb3NpY2lvbmFkbyBvIGNoZWNrYm94fCBQb3Npw6fDo28gfCBuw6NvfCBsZWZ0fFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5mbG9hdCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwicG9zaXRpb25cIik7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLnBhZGRpbmdSaWdodCA9IFwiMTVweFwiO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiB0cnVlO2ZhbHNlXG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgc2UgYSBjaGVja2JveCBlc3RhcsOhIGRlc2F0aXZhZGF8IEJvb2xlYW4gfCBuw6NvfCBmYWxzZXxcbiAgICAgICAgICAgIHRoaXMuY2hlY2tzcGFjZS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItY2hlY2tib3gtZGlzYWJsZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL3ZlcmlmaWNhIHNlIHRlbSBtYXggd2lkdGhcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwibWF4LXdpZHRoXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBMYXJndXJhIG3DoXhpbWEgZG8gY29tcG9uZW50ZSB8ICUgb3UgcHggfCBuw6NvIHwgfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwic3VidGl0bGVcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFN1YnRpdHVsbyBkbyBjb21wb25lbnRlIHwgIHwgbsOjbyB8IHxcbiAgICAgICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwic3VidGl0bGVcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL0xpbXBhIHZhcmlhdmVpc1xuICAgICAgICBpZCA9IG51bGw7XG4gICAgICAgIGNvbnRldWRvID0gbnVsbDtcbiAgICB9XG5cbiAgICBfYWRkRXZlbnQoKSB7XG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgICAgICQodGhpcykub24oXCJ0YXBcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgaWYgKF90aGlzLmdldEF0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpID09IFwiZmFsc2VcIiB8fCAhX3RoaXMuaGFzQXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiaXMtY2hlY2tlZFwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRBdHRyaWJ1dGUoXCJpcy1jaGVja2VkXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0QXR0cmlidXRlKFwiaXMtY2hlY2tlZFwiLCBcInRydWVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL0NoYW1hIGEgZnVuY2FvXG4gICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwib252YWxpZGF0ZVwiKSkge1xuICAgICAgICAgICAgICAgIGxldCBmbiA9IHdpbmRvd1tfdGhpcy5nZXRBdHRyaWJ1dGUoXCJvbnZhbGlkYXRlXCIpXTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoJChfdGhpcykpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZuID0gbmV3IEZ1bmN0aW9uKF90aGlzLmdldEF0dHJpYnV0ZShcIm9udmFsaWRhdGVcIikpO1xuICAgICAgICAgICAgICAgICAgICBmbi5jYWxsKCQoX3RoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMubWFpbkNsYXNzKSkge1xuICAgICAgICAgICAgLyp0aGlzLnNoYWRvd0RvbSA9IHRoaXMuYXR0YWNoU2hhZG93KHsgbW9kZTogJ29wZW4nIH0pOyAqL1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcImlzLWRpc2FibGVkXCIsIFwiaXMtY2hlY2tlZFwiLCBcIndpZHRoXCIsIFwid2lkdGgtb24tYmlnc2NyZWVuXCIsIFwiaWRcIiwgXCJzdWJ0aXRsZVwiLCBcImxhYmVsXCJdO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcblxuICAgICAgICBzd2l0Y2ggKGF0dHJOYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwiaXMtZGlzYWJsZWRcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tzcGFjZS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1jaGVja2JveC1kaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrc3BhY2UucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWNoZWNrYm94LWRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImlzLWNoZWNrZWRcIjpcbiAgICAgICAgICAgICAgICAvL1F1YW5kbyBpcy1kaXNhYmxlID0gdHJ1ZSwgZGVzYWJpbGl0YSBvIGJvdMOjb1xuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItY2hlY2tib3gtY2hlY2tzcGFjZS1taWRkbGVcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWNoZWNrYm94LWNoZWNrc3BhY2UtY2hlY2tlZFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PSBcIm5ldXRyYWxcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1jaGVja2JveC1jaGVja3NwYWNlLWNoZWNrZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWNoZWNrYm94LWNoZWNrc3BhY2UtbWlkZGxlXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWNoZWNrYm94LWNoZWNrc3BhY2UtbWlkZGxlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1jaGVja2JveC1jaGVja3NwYWNlLWNoZWNrZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiY2FuY2VsLWNhbGxiYWNrXCIpICE9IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm9uY2hhbmdlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZm4gPSB3aW5kb3dbdGhpcy5nZXRBdHRyaWJ1dGUoXCJvbmNoYW5nZVwiKV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm4uY2FsbCgkKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcIndpZHRoXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcIndpZHRoLW9uLWJpZ3NjcmVlblwiOlxuICAgICAgICAgICAgICAgIGlmIChwbWIudXRpbHMuc2hvd0JpZ1NjcmVlbih0b3AuJChcImJvZHlcIikpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaWRcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrc3BhY2Uuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJjaGtfY2hlY2tib3hcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuTGFiZWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJjaGtfbGFiZWxcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuU3VidGl0bGUuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJjaGtfc3VidGl0bGVcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJzdWJ0aXRsZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLmlubmVyVGV4dCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImxhYmVsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuTGFiZWwuaW5uZXJIVE1MID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0VGV4dCh0ZXh0KSB7XG4gICAgICAgIHRoaXMuc3BhbkxhYmVsLmlubmVySFRNTCA9IHRleHQ7XG4gICAgfVxuXG4gICAgZ2V0VGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3BhbkxhYmVsLmlubmVyVGV4dDtcbiAgICB9XG5cbiAgICBzZXROdW1iZXIodGV4dCkge1xuICAgICAgICBpZiAodGV4dCA9PSAxIHx8IHRleHQgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJpcy1jaGVja2VkXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwiaXMtY2hlY2tlZFwiLCBcImZhbHNlXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0TnVtYmVyKCkge1xuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1jaGVja2VkXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIxXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS5hdHRyKFwiaXMtY2hlY2tlZFwiKSA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBcIjBcIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZShcImFiLWNoZWNrYm94XCIsIEFiQ2hlY2tib3gpOyIsIlwidXNlIHN0cmljdFwiO1xuXG4kLmZuLmluY3JlbWVudFJlcXVlc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGN1cnIgPSAwO1xuICAgIGlmICh0aGlzLmF0dHIoXCJjdXJyZW50LXJlcXVlc3RcIikpIHtcbiAgICAgICAgY3VyciA9IHBhcnNlSW50KHRoaXMuYXR0cihcImN1cnJlbnQtcmVxdWVzdFwiKSk7XG4gICAgfVxuXG4gICAgY3VycisrO1xuICAgIHRoaXMuYXR0cihcImN1cnJlbnQtcmVxdWVzdFwiLCBjdXJyKTtcbn1cblxuJC5mbi5yZXNldFJlcXVlc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yZW1vdmVBdHRyKFwiY3VycmVudC1yZXF1ZXN0XCIpO1xufVxuXG5jbGFzcyBBYlBhZ2UgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmh0bWxPYmogPSAkKFwiaHRtbCxib2R5XCIpWzBdO1xuXG4gICAgICAgIC8vcGFnZUxvYWRlclxuICAgICAgICB0aGlzLnBhZ2VMb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy53cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5sb2FkQmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5iYXJSYW5nZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMubG9hZFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItcGFnZVwiO1xuICAgIH1cblxuICAgIF9yZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCh0aGlzLm1haW5DbGFzcyk7XG5cbiAgICAgICAgLy9DcmlhIHVtIGlkXG4gICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQXRyaWJ1dG8gcGFyYSBpZGVudGlmaWNhciBvIG9iamV0b3wgQWxmYW51bcOpcmljb3wgbsOjb3wgdmF6aW98XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGdlbmVyYXRlSUQoKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBwYXJhbWV0cm9zXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcImZ1bGxzY3JlZW5cIikgIT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogVXNhIG8gdGFtYW5obyB0b3RhbCBkYSB0ZWxhIHwgdHJ1ZSBvdSBmYWxzZSB8IG7Do28gfCB0cnVlIHxcbiAgICAgICAgICAgIHRoaXMuaHRtbE9iai5zdHlsZS5tYXJnaW4gPSBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5odG1sT2JqLnN0eWxlLnBhZGRpbmcgPSBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5odG1sT2JqLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgICAgICAgICB0aGlzLmh0bWxPYmouc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cbiAgICAgICAgICAgIHRoaXMuc3R5bGUudG9wID0gXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUubGVmdCA9IFwiMHB4XCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmJvdHRvbSA9IFwiMHB4XCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLnJpZ2h0ID0gXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLnBvc2l0aW9uID0gXCJmaXhlZFwiO1xuICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwicGFnZS0tbGltaXRlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbG9yIHBhZHJhb1xuICAgICAgICB0aGlzLnN0eWxlLnpJbmRleCA9IFwiMFwiO1xuXG4gICAgICAgIC8vc2UgZXhpc3RpciB1bSBtYXgtcmVxdWVzdCwgY29uc3RydWlyIG8gc2lzdGVtYSBkZSBsb2FkXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heC1yZXF1ZXN0XCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBNw6F4aW1vIGRlIHJlcXVlc3RzIHF1ZSB0ZXLDoSBuYSBww6FnaW5hIHBhcmEgbyBsb2FkZXIgfCBOdW3DqXJpY28gfCBuw6NvIHwgMCB8XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVMb2FkZXIoKTtcbiAgICAgICAgfSBlbHNle1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImh0bWxcIikuY2xhc3NMaXN0LmFkZChcImh0bWwtcGFnZS1sb2FkZWRcIik7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMubWFpbkNsYXNzKSkge1xuICAgICAgICAgICAgLyp0aGlzLnNoYWRvd0RvbSA9IHRoaXMuYXR0YWNoU2hhZG93KHtcbiAgICAgICAgICAgICAgICBtb2RlOiAnb3BlbidcbiAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcImxvYWRlci12aXNpYmlsaXR5XCIsIFwiY3VycmVudC1yZXF1ZXN0XCJdO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcbiAgICAgICAgaWYgKGF0dHJOYW1lID09IFwibG9hZGVyLXZpc2liaWxpdHlcIikge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbCAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICQodGhpcy5sb2dvKS5mYWRlT3V0KDEwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCh0aGlzLnBhZ2VMb2FkKS5mYWRlT3V0KDEwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBhZ2VMb2FkLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlTG9hZGVyKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQodGhpcy5wYWdlTG9hZCkuZmFkZUluKDEwMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIGlmIChhdHRyTmFtZSA9PSBcImN1cnJlbnQtcmVxdWVzdFwiKSB7XG4gICAgICAgICAgICB2YXIgcmVxQXR1YWwgPSBwYXJzZUludChuZXdWYWwpO1xuICAgICAgICAgICAgdmFyIHJlcU1heCA9IHBhcnNlSW50KHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXJlcXVlc3RcIikpO1xuICAgICAgICAgICAgdmFyIHRvdGFsID0gKCgxMDAgLyByZXFNYXgpICogcmVxQXR1YWwpO1xuXG4gICAgICAgICAgICB0aGlzLmJhclJhbmdlLnN0eWxlLndpZHRoID0gdG90YWwgKyBcIiVcIjtcblxuICAgICAgICAgICAgaWYgKHRvdGFsID49IDEwMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwibG9hZGVyLXZpc2liaWxpdHlcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5jbGFzc0xpc3QuYWRkKFwiaHRtbC1wYWdlLWxvYWRlZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxQXR1YWwgPSBudWxsO1xuICAgICAgICAgICAgcmVxTWF4ID0gbnVsbDtcbiAgICAgICAgICAgIHRvdGFsID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9jcmVhdGVMb2FkZXIoKSB7XG5cbiAgICAgICAgdGhpcy5wYWdlTG9hZC5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXJcIik7XG4gICAgICAgIHRoaXMucGFnZUxvYWQuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1wYWdlLWxvYWRlclwiKTtcbiAgICAgICAgdGhpcy5wYWdlTG9hZC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMucGFnZUxvYWQpO1xuXG4gICAgICAgIHRoaXMud3JhcHBlci5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItd3JhcHBlclwiKTtcbiAgICAgICAgdGhpcy5wYWdlTG9hZC5hcHBlbmRDaGlsZCh0aGlzLndyYXBwZXIpO1xuXG4gICAgICAgIHRoaXMubG9hZEJhci5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItcGF0aFwiKTtcbiAgICAgICAgdGhpcy53cmFwcGVyLmFwcGVuZENoaWxkKHRoaXMubG9hZEJhcik7XG5cbiAgICAgICAgdGhpcy5iYXJSYW5nZS5jbGFzc0xpc3QuYWRkKFwiYWItcGFnZS1sb2FkZXItcmFuZ2VcIik7XG4gICAgICAgIHRoaXMuYmFyUmFuZ2Uuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1wYWdlLWxvYWRlci1yYW5nZVwiKTtcbiAgICAgICAgdGhpcy5sb2FkQmFyLmFwcGVuZENoaWxkKHRoaXMuYmFyUmFuZ2UpO1xuXG4gICAgICAgIHRoaXMubG9hZFRleHQuY2xhc3NMaXN0LmFkZChcImFiLXBhZ2UtbG9hZGVyLXRleHRcIik7XG4gICAgICAgIHRoaXMubG9hZFRleHQuaW5uZXJUZXh0ID0gXCJjYXJyZWdhbmRvLi4uXCI7XG4gICAgICAgIHRoaXMud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmxvYWRUZXh0KTtcbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ2FiLXBhZ2UnLCBBYlBhZ2UpOyIsIlwidXNlIHN0cmljdFwiO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJChcImFiLXBhZ2VcIikuZmluZChcImFiLXRleHQtcmVhZC1vbmx5XCIpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cihcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSkge1xuICAgICAgICAgICAgICAgIGlmICgkKFwiYWItcGFnZVwiKS5hdHRyKFwiZnVsbHNjcmVlblwiKSA9PSBcInRydWVcIil7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwid2lkdGhcIiwgJCh0aGlzKS5hdHRyKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcImJyYWRlc2NvLXRleHQtcmVhZC1vbmx5LWJpZ3NjcmVlblwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKFwiYnJhZGVzY28tdGV4dC1yZWFkLW9ubHktYmlnc2NyZWVuXCIpXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJ3aWR0aFwiLCAkKHRoaXMpLmF0dHIoXCJ3aWR0aFwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcIndpZHRoXCIsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuXG5jbGFzcyBBYlRleHRSZWFkT25seSBleHRlbmRzIEhUTUxFbGVtZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMubGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGVnZW5kXCIpO1xuICAgICAgICB0aGlzLnRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItdGV4dC1yZWFkLW9ubHlcIjtcbiAgICB9XG5cbiAgICBfcmVuZGVyKCkge1xuICAgICAgICAvL0NyaWEgdW0gaWRcbiAgICAgICAgdmFyIGlkID0gZ2VuZXJhdGVJRCgpO1xuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogSWRlbnRpZmljYcOnw6NvIGRvIGNvbXBvbmVudGUuIEF0cmlidXRvIG9icmlnYXTDs3JpbyBwYXJhIGludGVyYWdpciBjb20gbyBvYmpldG8gfCBBbGZhbnVtw6lyaWNvIHwgc2ltIHwgdmF6aW8gfFxuICAgICAgICAgICAgaWQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNvbnRlbnRIdG1sID0gdGhpcy5pbm5lckhUTUwgO1xuICAgICAgICB0aGlzLmlubmVySFRNTCA9IFwiXCI7XG5cbiAgICAgICAgLy9jb2xvY2EgY2xhc3NlXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCh0aGlzLm1haW5DbGFzcyk7XG5cbiAgICAgICAgLy93aWR0aFxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIGEgbGFyZ3VyYSBkbyBjb21wb25lbnRlfCAlIG91IHB4fCBuw6NvfCB8XG4gICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3ZlcmlmaWNhIHdpZHRoLW9uLWJpZ3NjcmVlblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBhIGxhcmd1cmEgZG8gY29tcG9uZW50ZSBlbSB0ZWxhcyBtYWlvcmVzfCAlIG91IHB4fCBuw6NvfCB8XG4gICAgICAgICAgICBpZiAocG1iLnV0aWxzLnNob3dCaWdTY3JlZW4odG9wLiQoXCJib2R5XCIpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLXRleHQtcmVhZC1vbmx5LWJpZ3NjcmVlblwiKVxuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItdGV4dC1yZWFkLW9ubHktYmlnc2NyZWVuXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9Db2xvY2EgTGFiZWxcbiAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwibGFiZWxcIik7XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwibGFiZWxcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IENvbG9jYXIgdW1hIGRlc2NyacOnw6NvIHF1ZSByZXByZXNlbnRlIG8gdmFsb3IgcXVlIHNlcsOhIGNvbG9jYWRvIG5vIGlucHV0IGRhIHDDoWdpbmEgfCBBbGZhbnVtw6lyaWNvIHwgbsOjbyB8IHZhemlvIHxcbiAgICAgICAgICAgIHRoaXMubGFiZWwuaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJsYWJlbFwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMubGFiZWwpO1xuXG4gICAgICAgIC8vQ29sb2NhIElucHV0XG4gICAgICAgIHRoaXMudGV4dC5jbGFzc0xpc3QuYWRkKFwiYWItcGFyYWdyYWZvLW1lZGlvXCIpO1xuICAgICAgICB0aGlzLnRleHQuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcInRleHRcIik7XG4gICAgICAgIGlmIChjb250ZW50SHRtbC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnRleHQuaW5uZXJIVE1MID0gY29udGVudEh0bWw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLnRleHQpO1xuXG4gICAgICAgIC8vdmlzaWJsZVxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmxlXCIpID09IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBzZSBvIGNvbXBvbmVudGUgZXN0YXLDoSB2aXPDrXZlbCB8IEJvb2xlYW4gfCBuw6NvfCB0cnVlIHxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vbGltcGEgdmFyaWF2ZWlzXG4gICAgICAgIGlkID0gbnVsbDtcbiAgICAgICAgY29udGVudEh0bWwgPSBudWxsO1xuICAgIH1cblxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMubWFpbkNsYXNzKSkge1xuICAgICAgICAgICAgLyp0aGlzLnNoYWRvd0RvbSA9IHRoaXMuYXR0YWNoU2hhZG93KHtcbiAgICAgICAgICAgICAgICBtb2RlOiAnb3BlbidcbiAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcImxhYmVsXCIsIFwiaWRcIiwgXCJ3aWR0aFwiLCBcIndpZHRoLW9uLWJpZ3NjcmVlblwiLCBcInZpc2libGVcIl07XG4gICAgfVxuXG4gICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGF0dHJOYW1lLCBvbGRWYWwsIG5ld1ZhbCkge1xuXG4gICAgICAgIHN3aXRjaCAoYXR0ck5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJsYWJlbFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubGFiZWwuaW5uZXJUZXh0ID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcImlkXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcImxhYmVsXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcInRleHRcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgXG4gICAgICAgICAgICBjYXNlIFwid2lkdGhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcIndpZHRoLW9uLWJpZ3NjcmVlblwiOlxuICAgICAgICAgICAgICAgIGlmICgkKFwiYWItcGFnZVwiKS5hdHRyKFwiZnVsbHNjcmVlblwiKSA9PSBcInRydWVcIil7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgXG4gICAgICAgICAgICBjYXNlIFwidmlzaWJsZVwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRUZXh0KHRleHQpIHtcbiAgICAgICAgdGhpcy50ZXh0LmlubmVySFRNTCA9IHRleHQ7XG4gICAgfVxuXG4gICAgZ2V0VGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dC5pbm5lclRleHQ7XG4gICAgfVxuXG4gICAgZ2V0VGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dC5pbm5lclRleHQ7XG4gICAgfVxuXG4gICAgc2V0SHRtbCgpIHtcblxuICAgIH1cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgnYWItdGV4dC1yZWFkLW9ubHknLCBBYlRleHRSZWFkT25seSk7Il19
