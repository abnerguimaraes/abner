"use strict";

//Verfica Sistema Operacional
window.isIOS = (/iPad|iPhone|iPod/.test(navigator.platform) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) && !window.MSStream;
window.isAndroid = /(android)/i.test(navigator.userAgent);
window.isDesktop = !window.isIOS && !window.isAndroid;

(function(w, $, undefined) {

    w.tapHandling = false;
    w.tappy = true;

    var tap = function($els) {
        return $els.each(function() {

            var $el = $(this),
                resetTimer,
                startY,
                startX,
                cancel,
                scrollTolerance = 10;

            function trigger(e) {
                $(e.target).trigger("tap", [e, $(e.target).attr("href")]);
            }

            function getCoords(e) {
                var ev = e.originalEvent || e,
                    touches = ev.touches || ev.targetTouches;

                if (touches) {
                    return [touches[0].pageX, touches[0].pageY];
                } else {
                    return null;
                }
            }

            function start(e) {
                if (e.touches && e.touches.length > 1 || e.targetTouches && e.targetTouches.length > 1) {
                    return false;
                }

                var coords = getCoords(e);
                startX = coords[0];
                startY = coords[1];
            }

            // any touchscroll that results in > tolerance should cancel the tap
            function move(e) {
                if (!cancel) {
                    var coords = getCoords(e);
                    if (coords && (Math.abs(startY - coords[1]) > scrollTolerance || Math.abs(startX - coords[0]) > scrollTolerance)) {
                        cancel = true;
                    }
                }
            }

            function end(e) {
                clearTimeout(resetTimer);
                resetTimer = setTimeout(function() {
                    w.tapHandling = false;
                    cancel = false;
                }, 1000);

                // make sure no modifiers are present. thx http://www.jacklmoore.com/notes/click-events/
                if ((e.which && e.which > 1) || e.shiftKey || e.altKey || e.metaKey || e.ctrlKey) {
                    return;
                }

                e.preventDefault();

                // this part prevents a double callback from touch and mouse on the same tap

                // if a scroll happened between touchstart and touchend
                if (cancel || w.tapHandling && w.tapHandling !== e.type) {
                    cancel = false;
                    return;
                }

                w.tapHandling = e.type;
                trigger(e);
            }

            $el
                .bind("touchstart.tappy MSPointerDown.tappy", start)
                .bind("touchmove.tappy MSPointerMove.tappy", move)
                .bind("touchend.tappy MSPointerUp.tappy", end)
                .bind("click.tappy", end);
        });
    };

    var untap = function($els) {
        return $els.unbind(".tappy");
    };

    // use special events api
    if ($.event && $.event.special) {
        $.event.special.tap = {
            add: function(handleObj) {
                tap($(this));
            },
            remove: function(handleObj) {
                untap($(this));
            }
        };
    } else {
        // monkeybind
        var oldBind = $.fn.bind,
            oldUnbind = $.fn.unbind;
        $.fn.bind = function(evt) {
            if (/(^| )tap( |$)/.test(evt)) {
                tap(this);
            }
            return oldBind.apply(this, arguments);
        };
        $.fn.unbind = function(evt) {
            if (/(^| )tap( |$)/.test(evt)) {
                untap(this);
            }
            return oldUnbind.apply(this, arguments);
        };
    }

}(this, jQuery));


// ARRUMA ERRO NO IE9 ONDE NAO EXISTE WINDOW.CONSOLE
if (!window.console) {
    var console = {
        log: function() {},
        warn: function() {},
        error: function() {},
        time: function() {},
        timeEnd: function() {}
    }
}

/* ARRUMA INPUT NO IOS QUE NAO FUNCIONA DIREITO */
/*$(document).ready(function() {
    if (window.isIOS) {
        $(document).ready(function() {
            document.addEventListener('keydown', function(e) {
                window.focus();
                $(':focus').focus();
            });
        });
    }

});*/

var getXY = function(event) {
    var x = null;
    var y = null;

    if (event.originalEvent != null && event.originalEvent.touches != null) {
        var touch = event.originalEvent.touches[0] || event.originalEvent.changedTouches[0];
        x = parseFloat(touch.pageX);
        y = parseFloat(touch.pageY);
    } else {
        x = parseFloat(event.pageX);
        y = parseFloat(event.pageY);
    }

    var pos = new Object();
    pos.x = x;
    pos.y = y;

    return pos;
}

var support3d = function() {
    var ret = false;
    var supports3DTransforms = document.body.style['webkitPerspective'] !== undefined || document.body.style['MozPerspective'] !== undefined;
    if (supports3DTransforms) {
        ret = true;
    }
    return ret;
}

var getTransform = function(el) {
    var prop = "";

    if (el.css('-webkit-transform') != undefined) {
        prop = el.css('-webkit-transform');
    } else if (el.css('transform') != undefined) {
        prop = el.css('transform');
    } else if (el.css('-moz-transform') != undefined) {
        prop = el.css('-moz-transform');
    } else if (el.css('-ms-transform') != undefined) {
        prop = el.css('-ms-transform');
    } else {
        return [0, 0, 0];
    }

    var results = prop.match(/matrix(?:(3d)\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))(?:, (-{0,1}\d+)), -{0,1}\d+\)|\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))\))/);

    if (!results)
        return [0, 0, 0];
    if (results[1] == '3d')
        return results.slice(2, 5);

    results.push(0);
    return results.slice(5, 8);
}

var goToNextTabindex = function(event, obj, command) {
    var key = event.keyCode ? event.keyCode : event.which;

    if (key == 13 || key == 9) {
        var ficar = true;
        var ret = true;
        var tabindex = obj.attr('tabindex');

        if (key == 13 && obj[0].nodeName == "TEXTAREA") {
            return;
        }

        do {
            //Verifica o tabindex
            var gotoTabindex = obj.attr('goto-tab-index');
            var stopTabindex = obj.attr('stop-tab-index');

            //Vai opara
            if (tabindex && stopTabindex != "true") {
                tabindex = parseInt(tabindex);

                //avanca o tabindex
                if (gotoTabindex) {
                    tabindex = gotoTabindex;
                } else {
                    tabindex++;
                }

                //se Existir o elemento foca nele
                var nextObj = $('[tab-index=' + tabindex + ']');

                //Verifica se encontrou um objeto
                if (nextObj.length > 0 && nextObj.attr("is-disabled") != "true") {
                    ficar = false;                    

                    if (nextObj[0].nodeName == "ABNER-SELECT-UNDERLINE") {
                        nextObj.find("select").trigger("focus");
                    } else {
                        nextObj.find("[div-focus=true]").trigger(command);
                    };
                } else {
                    if (nextObj.length > 0) {
                        //verifica o proximo objeto
                        obj = nextObj;
                    } else {
                        ficar = false;
                    }
                }

                //removido para funcionar o enter
                //return false;
            } else {
                if (stopTabindex == "true") {
                    ficar = false;
                    ret = false;
                } else {
                    ficar = false;
                    ret = true;
                }

            }
        }
        while (ficar);

        //Se for tab deixar false
        if (key == 9) {
            ret = false;
        }

        //rodar saida
        return ret;
    }

}

var randomNumber = function() {
    //var random_integer = Math.random()*101|0;    
    return Math.random().toString(36).substr(2, 10);
}

var guid = function() {
    function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    }
    return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
}

var generateID = function() {
    return guid();
}

var pointerEventToXY = function(e) {
    var out = { x: 0, y: 0 };
    if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {
        var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
        out.x = touch.pageX;
        out.y = touch.pageY;
    } else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {
        out.x = e.pageX;
        out.y = e.pageY;
    }
    return out;
};
"use strict";

var AbnerUtils = function () { }

AbnerUtils.prototype.removeAccent = function (word) {
    var _this = this;

    var map = {
        "á": "a",
        "à": "a",
        "â": "a",
        "ã": "a",
        "ä": "a",
        "Á": "A",
        "À": "A",
        "Â": "A",
        "Ã": "A",
        "Ä": "A",
        "é": "e",
        "è": "e",
        "ê": "e",
        "ẽ": "e",
        "ë": "e",
        "É": "E",
        "È": "E",
        "Ê": "E",
        "Ẽ": "E",
        "Ë": "E",
        "í": "i",
        "ì": "i",
        "î": "i",
        "ĩ": "i",
        "ï": "i",
        "Í": "I",
        "Ì": "I",
        "Î": "I",
        "Ĩ": "I",
        "Ï": "I",
        "ó": "o",
        "ò": "o",
        "ô": "o",
        "õ": "o",
        "ö": "o",
        "Ó": "O",
        "Ò": "O",
        "Ô": "O",
        "Õ": "O",
        "Ö": "O",
        "ú": "u",
        "ù": "u",
        "û": "u",
        "ũ": "u",
        "ü": "u",
        "Ú": "U",
        "Ù": "U",
        "Û": "U",
        "Ũ": "U",
        "Ü": "U",
        "ý": "y",
        "ỳ": "y",
        "ŷ": "y",
        "ỹ": "y",
        "ÿ": "y",
        "Ý": "Y",
        "Ỳ": "Y",
        "Ŷ": "Y",
        "Ỹ": "Y",
        "Ÿ": "Y",
        "ñ": "n",
        "Ñ": "n",
        "Ç": "c",
        "ç": "c"
    };

    if (word != "") {
        return word.replace(/[àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãẽĩũñõÃẼĨŨÑÕäëïöüÿÄËÏÖÜŸÇç]/g, function (match) {
            return map[match];
        });
    } else {
        return null;
    }
}

//PEga variaveis da URL
AbnerUtils.prototype.getUrlVars = function () {
    var vars = new Object(),
        hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars[hash[0]] = hash[1];
    }
    return vars;
}

//Determina se é modo adaptativo 
AbnerUtils.prototype.showBigScreen = function (obj) {
    if (parseInt(obj.outerWidth()) >= 1024) {
        return true;
    } else {
        return false;
    }
}

AbnerUtils.prototype.getCheckedRadio = function (name) {
    if (name) {
        return $("input[type=radio][name=" + name + "]:checked").parent();
    } else {
        return $("input[type=radio]:checked").parent();
    }
}

AbnerUtils.prototype.getPhoneAsObject = function (phone) {

    var phoneObj = {
        ddi: "",
        ddd: "",
        phone: phone
    };

    phone = phone ? phone.replace(/\D+/g, '') : phone;

    if (phone && phone.length > 11) {
        phoneObj.ddi = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$1");
        phoneObj.ddd = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$2");
        phoneObj.phone = phone.replace(/^(\d{2})(\d{2})(\d{8,9})$/g, "\$3");
    } else if (phone && phone.length > 9) {
        phoneObj.ddd = phone.replace(/^(\d{2})(\d{8,9})$/g, "\$1");
        phoneObj.phone = phone.replace(/^(\d{2})(\d{8,9})$/g, "\$2");
    }

    return phoneObj;
}

AbnerUtils.prototype.formatPhone = function (phone) {

    var phoneReturn = phone.replace(/[^0-9]/g, '');

    if (phone && phone.length > 11) {
        phoneReturn = phone.replace(/^(\d{2})(\d{2})(\d{4,5})(\d{4})$/g, "\+$1 \($2) \$3 \$4");
    } else if (phone && phone.length > 9) {
        phoneReturn = phone.replace(/^(\d{2})(\d{4,5})(\d{4})$/g, "\($1) \$2 \$3");
    };

    return phoneReturn;
}

AbnerUtils.prototype.removeCpfCnpjFormat = function (valor, type) {

    if (valor) {
        //remove ponto e virgula
        valor = valor.replace(new RegExp(/[^\d]/g), "");

        if (type == "CNPJ") {
            var len = 14;
            var pad = "00000000000";
        } else if (type == "CPF") {
            var len = 11;
            var pad = "00000000000";
        } else {
            return "";
        }

        //transforma para numero
        valor = parseInt(valor);

        //se for maior que o valor defindo para len ele corta
        if (valor.length > len) {
            valor = valor.substring(0, len);
        }

        //Se ocorre algum erro, deixar vazio
        if (isNaN(valor)) {
            valor = "";

        } else {
            valor = pad.substring(0, pad.length - valor.length) + valor;
        }
    }
    return valor;
}

AbnerUtils.prototype.validarCNPJ = function (cnpj) {

    cnpj = cnpj.replace(/[^\d]+/g, '');
    
    if (cnpj == "0" ||
        cnpj == "00000000000000" ||
        cnpj == "11111111111111" ||
        cnpj == "22222222222222" ||
        cnpj == "33333333333333" ||
        cnpj == "44444444444444" ||
        cnpj == "55555555555555" ||
        cnpj == "66666666666666" ||
        cnpj == "77777777777777" ||
        cnpj == "88888888888888" ||
        cnpj == "99999999999999") {
        return false;
    }

    // Valida DVs
    var tamanho = cnpj.length - 2
    var numeros = cnpj.substring(0, tamanho);
    var digitos = cnpj.substring(tamanho);
    var soma = 0;
    var pos = tamanho - 7;
    var i = tamanho;

    for (i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2)
            pos = 9;
    }
    var resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
    if (resultado != digitos.charAt(0)) {
        return false;
    }

    tamanho = tamanho + 1;
    numeros = cnpj.substring(0, tamanho);
    soma = 0;
    pos = tamanho - 7;
    for (i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2)
            pos = 9;
    }

    resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;

    if (resultado != digitos.charAt(1)) {
        return false;
    }

    return true;
}

//valida o CPF digitado
AbnerUtils.prototype.validarCPF = function(cpf) {

    var exp = /\.|\-/g
    cpf = cpf.toString().replace(exp, "");
    if (cpf.length < 11) {
        var pad = "00000000000";
        cpf = pad.substring(0, pad.length - cpf.length) + cpf;
    }

    if (cpf == "0" ||
        cpf == "00000000000" ||
        cpf == "11111111111" ||
        cpf == "22222222222" ||
        cpf == "33333333333" ||
        cpf == "44444444444" ||
        cpf == "55555555555" ||
        cpf == "66666666666" ||
        cpf == "77777777777" ||
        cpf == "88888888888" ||
        cpf == "99999999999") {
        return false;
    }

    var soma;
    var resto;
    soma = 0;

    for (var i = 1; i <= 9; i++) {
        soma = soma + parseInt(cpf.substring(i - 1, i)) * (11 - i);
    }

    resto = (soma * 10) % 11;

    if ((resto == 10) || (resto == 11)) {
        resto = 0;
    }
    if (resto != parseInt(cpf.substring(9, 10))) {
        return false;
    }

    soma = 0;
    for (var i = 1; i <= 10; i++) {
        soma = soma + parseInt(cpf.substring(i - 1, i)) * (12 - i);
    }
    resto = (soma * 10) % 11;

    if ((resto == 10) || (resto == 11)) {
        resto = 0;
    }
    if (resto != parseInt(cpf.substring(10, 11))) {
        return false;
    }
    return true;
}

AbnerUtils.prototype.validarEMAIL = function(email) {
    var emailValidation = email.match(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+$/);

    if (email == emailValidation) {
        return emailValidation;
    }
}

//Funcoes uteis de uso do JQUERY
window.addEventListener('WebComponentsReady', function () {
    document.querySelector("html").classList.add("html-page-loaded");
});

$(document).ready(function () {
    $.fn.setCursorPosition = function (pos) {
        this.each(function (index, elem) {
            if (elem.setSelectionRange) {
                elem.setSelectionRange(pos, pos);
            } else if (elem.createTextRange) {
                var range = elem.createTextRange();
                range.collapse(true);
                range.moveEnd('character', pos);
                range.moveStart('character', pos);
                range.select();
            }
        });
        return this;
    };

    $.fn.validate = function () {
        var change = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if ($(this).attr("onchange")) {
            change = $(this).attr("onchange");
            $(this).removeAttr("onchange");
        }

        //tira o foco de qualquer elemento
        document.activeElement.blur();
        $(window).focus();

        if (change != null) {
            $(this).attr("onchange", change);
        }

        //se ouver um erro validacao esta incorreta
        if ($(this).attr("error") && $(this).attr("error") != "") {
            return false;
        } else {
            return true;
        }
    };

    $.fn.setFocus = function () {
        if ($(this).length > 0) {
            $(this).find("input").focus();
        } else {
            return null;
        }
    }

    $.fn.removeFocus = function () {
        if (document.activeElement) {
            document.activeElement.blur();
        }
    }

    $.fn.getText = function () {
        var text = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase().startsWith("AB-INPUT") ? "AB-INPUT" : tag.toUpperCase();
                var tagsAceitas = ["AB-TEXT-READ-ONLY", "AB-TEXT-AREA-UNDERLINE", "AB-SELECT", "AB-INPUT", "AB-TEXT", "AB-RADIO"];
                if (tagsAceitas.indexOf(tag) == -1) {
                    return null;
                }
            }
        } else {
            return null;
        }

        if ($(this).length > 1) {
            var textArray = new Array();
            for (const radio of this) {
                textArray.push(radio.getText());
            }
            text = textArray;
        } else {
            text = this[0].getText();
        };

        return text;
    };

    $.fn.setText = function (text, cancel) {
        var tag = new String();

        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (tag == "AB-TEXT-READ-ONLY") {
            this[0].setText(text);

        } else if (tag.startsWith("AB-INPUT-DATE")) {
            this[0].setText(text);

        } else if (tag.startsWith("AB-INPUT")) {
            this[0].setText(text);

        } else if (tag.startsWith("AB-TEXT")) {
            this[0].setText(text);

        } else if (tag.startsWith("AB-RADIO")) {
            this[0].setText(text);

        } else if (tag == "AB-TEXT-AREA-UNDERLINE") {
            this[0].setText(text);

        } else if (tag.startsWith("AB-SELECT")) {
            if (cancel) {
                $(this).find("select").val(text);
            } else {
                $(this).find("select").val(text).change();
            }
        }

        //salva valor
        if (!tag.startsWith("AB-INPUT-CHECKBOX")) {
            $(this).attr("loaded-value", $(this).getText());
        }
    };


    //funcao para corrigir o data
    $.fn.getNumber = function () {
        var text = null;
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (tag == "AB-TEXT-READ-ONLY") {
            text = this[0].getText();

        } else if (tag.startsWith("AB-INPUT-CHECKBOX")) {
            text = this[0].getNumber();

        } else if (tag.startsWith("AB-INPUT-RADIO")) {
            text = this[0].getNumber();
            
        } else if (tag.startsWith("AB-INPUT-SWITCH")) {
            text = this[0].getNumber();

        } else if (tag.startsWith("AB-INPUT-TIME")) {
            text = $(this).find("input").val() + "00";

        } else if (tag.startsWith("AB-INPUT-NUMBER")) {
            text = $(this).find("input").val();
            text = text.replace(new RegExp(/[^\d]/g), "");

        } else if (tag.startsWith("AB-INPUT-DATE")) {
            if (window.isIOS || window.isAndroid) {
                text = $(this).find("input").val();
                text = text.substring(8, 10) + "" + text.substring(5, 7) + "" + text.substring(0, 4);
            } else {
                text = $(this).find("input").val();
            }

        } else if (tag.startsWith("AB-INPUT")) {
            text = $(this).find("input").val();

        } else if (tag.startsWith("AB-TEXT-AREA-UNDERLINE")) {
            text = $(this).find("textarea").val();

        } else if (tag.startsWith("AB-SELECT")) {
            text = parseInt($(this).getObject().valor);

        } else if (tag.startsWith("AB-QUESTION")) {
            text = $(this).attr("answer");
        }

        if (text && tag != "AB-SELECT-UNDERLINE") {
            text = text.replace(new RegExp(/[^\d\,]/g), "");
        }

        return text;
    };

    //funcao para corrigir o data
    $.fn.setNumber = function (text, cancel) {
        var tag = new String();
        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        if (text || text == 0) {
            //Necessario ser string para regex
            text += "";
            text = text.replace(new RegExp(/[^\d-\,]/g), "");

            if (tag == "AB-TEXT-READ-ONLY") {
                this[0].setText(text);

            } else if (tag.startsWith("AB-INPUT-CHECKBOX")) {
                this[0].setNumber(text);

                $(this).attr("loaded-value", $(this).attr("is-checked"));

            } else if (tag.startsWith("AB-INPUT-RADIO")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-INPUT-SWITCH")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-INPUT-DATE")) {
                this[0].setText(text);

            } else if (tag.startsWith("AB-INPUT")) {
                this[0].setNumber(text);

            } else if (tag.startsWith("AB-SELECT")) {
                if (cancel) {
                    $(this[0].select).val(text);
                } else {
                    $(this[0].select).val(text).change();
                }
            }

            //salva valor
            if (!tag.startsWith("AB-INPUT-CHECKBOX")) {
                $(this).attr("loaded-value", $(this).getText());
            }
        }
    };

    $.fn.setOldValue = function () {
        $(this).setText($(this).attr("loaded-value"));
    };

    $.fn.isChanged = function (val) {
        var loadedValue = $(this).attr("loaded-value");
        var currentValue = $(this).getText();

        if (loadedValue || currentValue) {
            if (loadedValue !== currentValue) {
                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    $.fn.setObject = function (val) {
        var tag = $(this)[0].nodeName;
        if (tag.startsWith("AB-SELECT")) {
            $(this).find("select").val(val).change();
        }
    }

    $.fn.getObject = function () {
        var bean = new Object();

        if ((this)[0]) {
            var tag = $(this)[0].nodeName;

            if (tag.startsWith("AB-SELECT")) {
                bean.nome = $(this).find("select option:selected").text();
                bean.valor = $(this).find("select option:selected").attr("value");
            }
        }

        return bean;
    }


    //Avisar nossos componentes quando teve uma alteracao
    var origAppend = $.fn.append;
    $.fn.append = function () {
        if ($(this).hasClass("ab-container-content") && arguments[0].hasClass("ab-block")) {
            return false;
        } else {
            return origAppend.apply(this, arguments).trigger("append");
        }
    };

    //função para retornar se o campo esrá com erro ou não
    $.fn.hasError = function () {
        if ($(this).attr("error")) {
            return true;
        } else {
            return false;
        }
    }
});


//função para arrumar bug no iOS 8
if (!String.prototype.startsWith) {
    String.prototype.startsWith = function (searchString, position) {
        position = position || 0;
        return this.indexOf(searchString, position) === position;
    };
}

String.prototype.toUpperOnlyFirstLetter = function () {
    var str = this;

    var wordMap = {
        "rg": "RG",
        "cpf": "CPF",
        "cnpj": "CNPJ",
        "rne": "RNE",
        "cep": "CEP",
        "cnh": "CNH",
        "s.a.": "S.A."
    };

    if (str && str.length == 0) {
        return "";
    } else if (str && str.length == 1) {
        return str.toUpperCase()
    } else if (str && str.length > 1) {
        str = str.substr(0, 1).toUpperCase() + str.substr(1).toLowerCase();
        return str = str.replace(/\b(rg|cpf|cnpj|rne|cep|cnh)\b|s\.a\./gi, function (word) {
            return wordMap[word.toLowerCase()];
        });
    } else {
        return "";
    }
}

String.prototype.toCamelCase = function () {
    var str = this.toLowerCase();

    var wordsArray = ["de", "sem", "o", "do", "da"];

    var words = str.split(" ");

    var fullString = new String();

    for (var i = 0; i < words.length; i++) {
        if (wordsArray.indexOf(words[i]) == -1 && words[i].length > 1) {
            words[i] = words[i].toUpperOnlyFirstLetter();
        };
    };

    fullString = words.join(" ")

    return fullString;
}

String.prototype.formatPercent = function(decimals, integers) {
    var tmp = this;
    var dec = "1";
    var formatDecimal = 0;
    var negativeCheck = false;

    if (tmp.substring(0, 1) == "-") {
        negativeCheck = true;
        tmp = tmp.substring(1, tmp.length);
    };

    if (decimals) {
        dec = dec.rpad("0", parseInt(decimals) + 1);
        formatDecimal = parseInt(decimals);
    }
    dec = parseInt(dec);

    if ((tmp && parseInt(tmp) == 0) || tmp == "" || tmp == undefined || isNaN(parseInt(tmp))) {
        tmp = 0;
    } else {
        tmp = parseFloat(tmp) / dec;
    }

    if (negativeCheck) {
        tmp = tmp * -1;
    }

    var option = {
        minimumFractionDigits: formatDecimal,
        maximumFractionDigits: formatDecimal
    };

    tmp = new Intl.NumberFormat('pt-BR', option).format(tmp);

    return tmp;
}

String.prototype.formatCurrency = function () {
    var tmp = this;
    var negativeCheck = false;

    if (tmp.substring(0, 1) == "-") {
        negativeCheck = true;
        tmp = tmp.substring(1, tmp.length);
    };

    //remove zeros a esquerda
    if (tmp) {
        // tmp = parseInt(tmp) + "";
        tmp = tmp.replace(/^0+/, '');
    }

    //Qualquer coisa diferente de um numero valido retorna 0,00
    if ((tmp && parseInt(tmp) == 0) || tmp == "" || tmp == undefined || isNaN(parseInt(tmp))) {
        return "0,00";
    }

    //Verifica se existem somente decimais, e acrescenta um zero na frente
    if (tmp && tmp.length <= 2) {
        tmp = tmp.lpad("0", 3);
    }

    //se o tamanho for
    //coloca as casas decimais
    tmp = tmp.replace(/([0-9]{2})$/g, ",$1");

    //se tiver milhar coloca ponto
    if (tmp.length > 6) {
        tmp = tmp.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    if (negativeCheck == true) {
        tmp = "-" + tmp;
    }

    return tmp;
}

String.prototype.formatDate = function (options) {
    var dia = "";
    var mes = "";
    var ano = "";
    var itens = "";
    var dataFormatada = null;
    var str = this;

    if (options) {
        //options.date != "" && options.date != 0 && options.date != null
        options.date = str;

        switch (options.srcFormat) {
            case 'ddmmyyyy':
                ano = options.date.substring(4, 8);
                mes = options.date.substring(2, 4);
                dia = options.date.substring(0, 2);
                break;

            case 'yyyymmdd':
                ano = options.date.substring(0, 4);
                mes = options.date.substring(4, 6);
                dia = options.date.substring(6, 8);
                break;

            case 'dd.mm.yyyy':
                itens = options.date.split(".");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'dd/mm/yyyy':
                itens = options.date.split("/");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'yyyy.mm.dd':
                itens = options.date.split(".");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'dd-mm-yyyy':
                itens = options.date.split("-");
                ano = itens[2];
                mes = itens[1];
                dia = itens[0];
                break;

            case 'yyyy-mm-dd':
                itens = options.date.split("-");
                ano = itens[0];
                mes = itens[1];
                dia = itens[2];
                break;

            case 'yyyymm':
                ano = options.date.substring(0, 4);
                mes = options.date.substring(4, 6);
                break;

            default:
                console.log("Data inválida");
        }

        switch (options.targetFormat) {
            case 'dd/mm/yyyy':
                dataFormatada = dia + '/' + mes + '/' + ano;
                break;

            case 'yyyy/mm/dd':
                dataFormatada = ano + '/' + mes + '/' + dia;
                break;

            case 'dd.mm.yyyy':
                dataFormatada = dia + '.' + mes + '.' + ano;
                break;

            case 'yyyy.mm.dd':
                dataFormatada = ano + '.' + mes + '.' + dia;
                break;

            case 'dd-mm-yyyy':
                dataFormatada = dia + '-' + mes + '-' + ano;
                break;

            case 'yyyy-mm-dd':
                dataFormatada = ano + '-' + mes + '-' + dia;
                break;

            case 'mm/yyyy':
                dataFormatada = mes + '/' + ano;
                break;

            case 'mmyy':
                dataFormatada = mes + "" + ano.substring(2, 4);
                break;

            case 'ddmmyyyy':
                dataFormatada = dia + mes + ano;
                break;

            case 'yyyymmdd':
                dataFormatada = ano + mes + dia;
                break;

            default:
                console.log("erro");
        }
    }
    return dataFormatada;
}

String.prototype.formatTime = function (options) {
    var hora = "";
    var min = "";
    var seg = "";
    var itens = "";
    var horaFormatada = null;
    var str = this;

    if (options) {
        options.time = str;

        switch (options.srcFormat) {
            case 'hhmmss':
                hora = options.time.substring(0, 2);
                min = options.time.substring(2, 4);
                seg = options.time.substring(4, 6);
                break;

            case 'hh:mm:ss':
                itens = options.time.split(":");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            case 'hh.mm.ss':
                itens = options.time.split(".");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            case 'hh-mm-ss':
                itens = options.time.split("-");
                hora = itens[0];
                min = itens[1];
                seg = itens[2];
                break;

            default:
                console.log("Hora inválida");
        }

        switch (options.targetFormat) {
            case 'hh:mm:ss':
                horaFormatada = hora + ':' + min + ':' + seg;
                break;

            case 'hh.mm.ss':
                horaFormatada = hora + '.' + min + '.' + seg;
                break;

            case 'hh-mm-ss':
                horaFormatada = hora + '-' + min + '-' + seg;
                break;

            case 'hhmmss':
                horaFormatada = hora + min + seg;
                break;

            default:
                console.log("erro");
        }
    }
    return horaFormatada;
}

String.prototype.formatCpf = function () {
    var cpf = this.lpad("0", 11);
    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/g, "\$1.\$2.\$3\-\$4");
}

String.prototype.formatCnpj = function () {
    var cpf = this.lpad("0", 14);
    return cpf.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g, "\$1.\$2.\$3\/\$4\-$5");
}


String.prototype.dateDiff = function (srcFormat, targetData, type) {

    var dataIni = new Date(this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    }));
    var dataFim = new Date(targetData.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    }));

    if (type == "dia") {
        var difDias = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numDias = Math.ceil(difDias / (1000 * 3600 * 24));
        return numDias;
    } else if (type == "mes") {
        var difMeses = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numMeses = Math.ceil(difMeses / (1000 * 3600 * 24 * 30) - 1);
        return numMeses;
    } else if (type == 'ano') {
        var difMeses = Math.abs(dataFim.getTime() - dataIni.getTime());
        var numMeses = Math.ceil(difMeses / (1000 * 3600 * 24 * 30) - 1);
        return Math.floor(numMeses / 12);
    }
}

String.prototype.plusDays = function (srcFormat, days) {
    var dataFormatada = this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    });
    var dataGerada = new Date(dataFormatada);
    var dataFinal = "";
    dataGerada.setDate(dataGerada.getDate() + days);
    var mes = new String(dataGerada.getMonth() + 1).lpad('0', 2);
    var dia = new String(dataGerada.getDate()).lpad('0', 2);
    dataFinal = dia + '/' + mes + '/' + dataGerada.getFullYear();
    return dataFinal;
}

String.prototype.minusDays = function (srcFormat, days) {
    var dataFormatada = this.formatDate({
        "srcFormat": srcFormat,
        "targetFormat": "yyyy/mm/dd"
    });
    var dataGerada = new Date(dataFormatada);
    var dataFinal = "";
    dataGerada.setDate(dataGerada.getDate() - days);
    var mes = new String(dataGerada.getMonth() + 1).lpad('0', 2);
    var dia = new String(dataGerada.getDate()).lpad('0', 2);
    dataFinal = dia + '/' + mes + '/' + dataGerada.getFullYear();
    return dataFinal;
}

String.prototype.convertToNumber = function () {
    var codeString = this.substring(1, 12);
    var letter = this.substring(0, 1).toLowerCase();
    return letter.charCodeAt(0) - 96 + codeString;
}

String.prototype.lpad = function (padString, length) {
    var str = this;
    while (str.length < length)
        str = padString + str;
    return str;
}

String.prototype.getSigla = function () {
    var sigla = "";
    var name = this;

    if (name) {
        var userName = name.replace(new RegExp(/[-]/g), "");
        userName = userName.replace(new RegExp(/[\s]+/g), " ").trim();
        userName = userName.split(" ");
        var firstName = userName[0];
        var lastName = userName[userName.length - 1];
        sigla = firstName[0] + lastName[0];
    }

    return sigla;
}

String.prototype.rpad = function (padString, length) {
    var str = this;
    while (str.length < length)
        str = str + padString;
    return str;
}

String.prototype.trim = function () {
    return this.replace(/^\s+|\s+$/g, "");
}

//trimming space from left side of the string
String.prototype.ltrim = function () {
    return this.replace(/^\s+/, "");
}

//trimming space from right side of the string
String.prototype.rtrim = function () {
    return this.replace(/\s+$/, "");
}
"use strict";

$(document).ready(function() {
    $.fn.block = function(options) {
        var tag = "";
        var onlyLoad = true;

        //Tratamento
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }

        //se existir tela remove
        $(this).unblock();

        //Gera ID
        var id = randomNumber();
        $(this).attr("blockID", id);

        var divBlock = $("<div>");
        divBlock.on("tap", function(e) {
            e.preventDefault();
            e.stopPropagation();
        });
        divBlock.attr("id", id);

        //coloca preto ou branco
        if (options && options.transparency == false) {
            divBlock.addClass("ab-block-full-black");
        } else if (tag == "AB-PAGE" || tag == "BODY") {
            divBlock.addClass("ab-block-black");
        } else {
            divBlock.addClass("ab-block-white");
        }


        $(this).append(divBlock);
        

        var divWrapper = $("<div>");
        divWrapper.addClass("ab-block-wrapper");
        divWrapper.appendTo(divBlock);

        if ((options && options.showLoading && options.showLoading == true) || !options || options.showLoading == undefined) {
            var divLoading = $("<div>");

            if (onlyLoad) {
                divLoading.addClass("ab-block-loading-center");
            } else {
                divLoading.addClass("ab-block-loading");
            }

            divLoading.appendTo(divWrapper);
        }
    };

    //funcao para desbloquear a tela/componente
    $.fn.unblock = function() {

        //remove determinado block
        $("#" + $(this).attr("blockID")).remove();

        //Tratamento
        var tag = "";
        if ($(this).length > 0) {
            tag += $(this)[0].nodeName;
            if (tag) {
                tag = tag.toUpperCase();
            }
        } else {
            return null;
        }
    };
});
"use strict";

$(document).ready(function () {
    $(window).on("resize", function () {
        $("ab-page").find("ab-box").each(function () {
            if ($(this).attr("width")) {
                $(this).css("width", $(this).attr("width"));
            } else {
                $(this).css("width", "100%");
            };
        });
    });
});

class AbBox extends HTMLElement {

    constructor() {
        super();

        this.boxHeader = document.createElement("header");
        this.boxHeaderText = document.createElement("p");
        this.divFooter = document.createElement("footer");

        this.mainClass = "ab-box";
        
    }

    _render() {
        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificador único do objeto, com prefixo "box" | Alfanumérico | Não | Normal |
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        $(this).addClass("ab-box");

       // style.innerText = " .ab-box[status='analise'] { --border-status: 8px solid var(--box-status-analise); } .ab-box[status='ativo'] { --border-status: 8px solid var(--box-status-ativo); } .ab-box[status='inativo'] { --border-status: 8px solid var(--box-status-inativo); } .ab-box[status='cancelado'] { --border-status: 8px solid var(--box-status-cancelado); } :host(.ab-box) { box-sizing: border-box; display: inline-block; overflow: hidden; float: left; margin: 8px; width: -webkit-calc(100% - 16px); width: -moz-calc(100% - 16px); width: -o-calc(100% - 16px); width: calc(100% - 16px); border-radius: 5px; border-left: var(--border-status); box-shadow: var(--shadow-lv2); } .ab-box-content { box-sizing: border-box; padding: 8px; display: var(--boxDisp); justify-content: space-between; align-items: center; background-color: var(--bg-components); height: initial; overflow: hidden; float: var(--boxFloat); width: 100%; position: relative; } :host(.ab-box-expandable) .ab-box-content { padding: 8px; } .ab-box-footer { float: left; height: 40px; width: 100%; background-size: 20px; background-repeat: no-repeat; background-position: center; bottom: 0px; left: 8px; background-color: var(--bg-components); cursor: pointer; } :host(.ab-box-closed) :host(.ab-box-opened) .ab-box-content { max-height: 9000% !important; } :host(.ab-box-opened) .ab-box-form .ab-box-content { max-height: 100px } .ab-box-content::slotted(label) { font-size: 13px; font-family: 'ablinkmedium'; line-height: 18px; color: var(--cor-pri-text); display: block; width: 100%; padding: 8px; box-sizing: border-box; float: left; } .ab-box-title { box-sizing: border-box; display: inline-block; background-color: var(--bg-components); height: 50px; float: left; width: 100%; } .ab-box-title-text { line-height: 50px; box-sizing: border-box; font-size: 16px; font-family: 'ablinksemiboldregular'; font-weight: normal; color: var(--cor-titulo); float: left; padding-left: 8px; margin: 0px; } .ab-box-div-buttons { float: left; display: table; width: 100%; table-layout: fixed; vertical-align: top; background-color: var(--bg-components); margin-top: -5px; padding: 0px 16px 16px 16px; box-sizing: border-box; z-index: 1; position: relative; } br { line-height: 20px; }";

        if (this.getAttribute("theme") == 'flex'){
            $(this).addClass("ab-box__flex");            
        } else if (this.getAttribute("theme") == 'ativo'){
            $(this).addClass("ab-box__ativo");            
        } else if (this.getAttribute("theme") == 'inativo'){
            $(this).addClass("ab-box__inativo");
        } else if (this.getAttribute("theme") == 'dark'){
            $(this).addClass("ab-box__dark");
        }



        //Classe base
        this.classList.add(this.mainClass);

        //Coloca titulo
        this.boxHeader.setAttribute("id", id + "_div_title");
        this.boxHeader.classList.add("ab-box-title");


        this.boxHeader.appendChild(this.boxHeaderText);
        this.boxHeaderText.setAttribute("id", id + "_div_text");
        this.boxHeaderText.classList.add("ab-box-title-text");

        if (this.hasAttribute("title")) {
            //description: Coloca um título | Alfanumérico | não |não|
            this.boxHeaderText.innerText = this.getAttribute("title");
        } else {
            this.boxHeader.style.display = "none";
        }


        if (this.hasAttribute("max-width")) {
            //description: Define o tamanho máximo | Tamanho em pixel | não |100%|
            this.style.maxWidth = this.getAttribute("max-width");
        }

        if (this.hasAttribute("width")) {
            //description: Ativa ou desativa o max-width | true ou false| não|false|
            this.style.width = this.getAttribute("max-width");
        }

        //div para fazer a seta que expande o box
        this.divFooter.setAttribute("id", id + "_footer");
        this.divFooter.classList.add("ab-box-footer");

        //verifica se existe a altura inicial, considerado para expandir
        if (this.hasAttribute("initial-height")) {
            //description: Define a altura inicial do componente quando precisa ser expandido| 100px, 200px, 300px| não|não|

            //adicionando classes para considerar o footer
            this.classList.add("ab-box-expandable");

            if (!this.hasAttribute("is-opened")) {
                this.classList.add("ab-box-closed");
            }
        } else {
            this.divFooter.style.display = "none";
        }

        if (this.getAttribute("visibility") == "hidden") {
            //values: hidden
            //description: Se o parâmetro estiver presente com o valor "hidden", esconde o objeto | hidden | não| não|
            this.style.display = "none";
        }

        if (this.hasAttribute("width-on-bigscreen")) {
            //description: Define uma largura para quando estiver em tela grande (tablets, pc) | Numérico | não| não|
            if ($("ab-page").attr("fullscreen") == "true"){
                this.style.width = this.getAttribute("width-on-bigscreen");
            }
        }

        if (this.hasAttribute("status")) {
            this.boxHeader.setAttribute("status", this.getAttribute("status"));
            this.divFooter.setAttribute("status", this.getAttribute("status"));
        }

        //for legacy substituir todos os h1 dos box por h3
        for (const element of this.children) {
            if (element.tagName == "H1") {
                element.outerHTML = element.outerHTML.replace(/h1/g,"h3");
            }            
        }
    }

    _addEvent() {
        var _this = this;

        $(this.divFooter).on("tap", function (e) {
            e.preventDefault();
            e.stopPropagation();

            if (_this.getAttribute("is-opened") == "true") {
                //values: true;false
                //description: Se possuir initial-height, inicia aberto ou fechado | true ou false | não | false|
                _this.setAttribute("is-opened", "false");
            } else {
                _this.setAttribute("is-opened", "true");
            }
        });

    }


    connectedCallback() {
        if (!this.classList.contains("ab-box")) {
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return ["is-opened", "max-width", "title", "theme", "initial-height", "id", "visibility", "width-on-bigscreen", "status"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        switch (attrName) {
            case "is-opened":
                if (newVal == "true") {
                    this.classList.add("ab-box-opened");
                    this.classList.remove("ab-box-closed");
                } else if (newVal == "false") {
                    this.classList.add("ab-box-closed");
                    this.classList.remove("ab-box-opened");
                }
                break;
    
            case "max-width":
                if (newVal) {
                    this.style.maxWidth = newVal;
                } else {
                    this.style.maxWidth = "";
                }
                break;
    
            case "title":
    
                if (newVal) {
                    this.boxHeader.style.display = "block";
                    this.boxHeaderText.innerText = newVal;
                } else {
                    this.boxHeader.style.display = "none";
                    this.boxHeaderText.innerText = "";
                }
                break;
    
            case "theme":
                if (newVal) {
                    this.boxHeader.classList.add("ab-box-title-" + newVal);
                    this.divFooter.classList.add("ab-box-footer-" + newVal);
                } else {
                    this.boxHeader.classList.remove("ab-box-title-" + oldVal);
                    this.divFooter.classList.remove("ab-box-footer-" + newVal);
                }
                break;
    
            case "initial-height":
                //adiciona a altura inicial na altura do objeto
                //seta Max height
                if (newVal) {
                    this.classList.add("ab-box-expandable");
                    this.divFooter.style.display = "block";
                } else {
                    this.classList.remove("ab-box-expandable");
                    this.divFooter.style.display = "none";
                }
    
                //Box aberto ou fechado
                if (this.getAttribute("is-opened") == "false" || !this.hasAttribute("is-opened")) {
                    this.classList.add("ab-box-closed");
                } else {
                    this.classList.remove("ab-box-closed");
                }
                break;
    
            case "id":
                //muda ids
                this.boxHeader.setAttribute("id", newVal + "_div_title");
                this.boxHeaderText.setAttribute("id", newVal + "_div_text");
                this.divFooter.setAttribute("id", newVal + "_footer");
                break;
    
            case "visibility":
                if (newVal == "show") {
                    this.style.display = "inline-block";
                } else if (newVal == "hidden") {
                    this.style.display = "none";
                }
                break;
    
            case "width-on-bigscreen":
                if ($("ab-page").attr("fullscreen") == "true"){
                    this.style.width = newVal;
                }
                break;

            case "status":
                this.boxHeader.setAttribute("status", newVal);
                this.divFooter.setAttribute("status", newVal);
                break;
        
            default:
                break;
        }
    }


}
customElements.define('ab-box', AbBox);
"use strict";

$(document).ready(function () {
    $(window).on("resize", function () {
        $("ab-page").find("ab-button").each(function () {
            $(this).css("max-width", "100%");
            if ($(this).attr("width")) {
                $(this).css("width", $(this).attr("width"));
            }
        });
    });
});

class AbButton extends HTMLElement {

    constructor() {
        super();

        this.button = document.createElement("button");
        this.span = document.createElement("span");
        this.img = document.createElement("div");
        this.blocker = document.createElement("div");

        this.mainClass = "ab-button";

    }

    _render() {
        //coloca classe
        this.classList.add(this.mainClass);

        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificador único do objeto, com prefixo "btn"| Alfanumérico |não| randômico|
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        //Coloca os atributos no objeto
        if (this.hasAttribute("width")) {
            //description: Largura do botão| Alfanumérico| não| auto |
            this.style.width = this.getAttribute("width");
        }

        // if (this.hasAttribute("height")) {
        //     //description: Altura do botão| Alfanumérico| não| auto |
        //     this.style.height = this.getAttribute("height");
        // }

        if (this.getAttribute("last-button") == "true") {
            //description: Ultimo botão da página | Boolean | não | false |
            this.classList.add("ab-button-last-button");
        }

        //verifica width-on-bigscreen
        if ($("ab-page").attr("fullscreen") == "true") {
            if (this.hasAttribute("width-on-bigscreen")) {
                //description: Largura do componente em telas maiores| % ou px| não| |
                this.style.width = this.getAttribute("width-on-bigscreen");
            } else {
                this.style.maxWidth = "340px";
            }
        }

        //Cria botao
        this.button.setAttribute("id", id + "btn_button");
        this.appendChild(this.button);

        // adiciona o texto inserido no objeto para o span criado
        this.span.setAttribute("id", id + "btn_span");

        if (this.hasAttribute("label")) {
            //description: Colocar um texto no botão| Alfanumérico| sim| vazio|
            this.span.innerText = this.getAttribute("label").toUpperOnlyFirstLetter();
        }
        this.button.appendChild(this.span);

        // adiciona a imagem inserida no objeto no background de uma div
        this.img.setAttribute("div-image", "true");
        this.img.setAttribute("id", id + "btn_img");
        this.button.insertAdjacentElement("afterbegin", this.img);
        if (this.hasAttribute("icon") || this.hasAttribute("icon-class")) {
            this.img.style.backgroundImage = "url(" + this.getAttribute("icon") + ")";
            if (this.hasAttribute("icon-class")) {
                this.img.classList.add(this.getAttribute("icon-class"));
            }
        } else {
            this.img.style.display = "none";
        }

        // verifica se o botão é somente para mostrar o ícone e adiciona a classe
        if (this.getAttribute("icon-button") == "true") {
            //values: true;false
            //description: Trava o botão para ter somente o ícone| true ou false| não| false|
            this.classList.add("ab-button-img");
        }

        // verifica se tem o tamanho do icone e adiciona no tamanho do background
        if (this.hasAttribute("icon-size")) {
            //description: Altera o tamanho do icone| Número em px| não| |
            this.img.style.backgroundSize = this.getAttribute("icon-size");
        }

        // verifica se tem o tamanho do espaço do ícone e define a largura da div
        if (this.hasAttribute("icon-space-width")) {
            //description: Espaçamento do ícone com o texto| Número em px| não| |
            this.img.style.width = this.getAttribute("icon-space-width");
        }

        //Coloca cor no botao
        if (this.hasAttribute("theme")) {
            //values: normal;light;keyboard;keyboard-ok;dark-rounded;red-rounded;dark;vk
            //description: Altera a cor do componente| [[#Temas | Ver temas]]| não | vazio|
            this.classList.add("ab-button-" + this.getAttribute("theme"));
        } else if (this.getAttribute("theme") == "ab-button-keyboard") {
            this.classList.add("ab-button-keyboard");
        } else {
            this.classList.add("ab-button-normal");
        }

        if (this.getAttribute("position") == "center") {
            //values: center;right;left
            //description: Posição do botão| Center, right ou left| não| center|
            if (abner.utils.showBigScreen(top.$("body")) == true) {
                this.classList.add("ab-button-center-big");
            } else {
                this.classList.add("ab-button-center");
            }
        } else if (this.getAttribute("position") == "left") {
            //não faz nada
        } else if (this.getAttribute("position") == "right") {
            this.style.float = this.getAttribute("position");
        }

        //verifica se tem max width
        if (this.hasAttribute("max-width")) {
            //description: Largura máxima do botão| Número em px| não| |
            this.style.maxWidth = this.getAttribute("max-width");
        }

        this.blocker.classList.add("ab-button-block");
        this.blocker.setAttribute("id", id + "btn_iblocker");
        this.appendChild(this.blocker);

        if (this.getAttribute("is-disabled") == "true") {
            //values: true;false
            this.button.setAttribute("disabled", "disabled");
            this.blocker.style.display = "block";
        }

        if (this.getAttribute("is-blocked") == "true") {
            //values: true;false
            this.blocker.style.display = "block";
        }

        if (this.getAttribute("visibility") == "hidden") {
            //values: hidden;show
            this.style.display = "none";
        }

        //Mesmo comportamento porém com outro nome de atributo, necessário ajustar todos projetos que usam o de cima
        if (this.getAttribute("visible") == "false") {
            //values: true;false
            this.style.display = "none";
        }

        //Limpa variaveis
        id = null;
    }

    _addEvent() {
        var button = $(this.button);
        var _this = this;

        // altera o ícone do botão quando o botão é apertado e se é passado o atributo icon-active
        button.on("touchstart mousedown", function (e) {

            //Proibe o clique em dois botões ao mesmo tempo
            if (e && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length > 1) {
                return;
            };

            //tira o foco de qualquer elemento
            document.activeElement.blur();
            $(window).focus();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //se tiver especificado icon-active adiciona no lugar do normal quando o evento inicia
                if (_this.hasAttribute("icon-active")) {
                    //description: Caminho do ícone que aparecerá quando o botão for ativado. | Alfanumérico| não| vazio|
                    if (_this.hasAttribute("icon-active")) {
                        _this.img.style.backgroundImage = "url(" + _this.getAttribute("icon-active") + ")";
                    }
                }
                // se tiver tema adiciona o tema no objeto
                if (_this.hasAttribute("theme")) {
                    _this.classList.add("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.add("ab-button-normal-active");
                };
            };
        });

        // altera o ícone do botão quando o botão é solto e se é passado o atributo icon-active
        button.on("mouseup touchend", function (e) {
            e.preventDefault();

            //tira o foco de qualquer elemento
            document.activeElement.blur();
            $(window).focus();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //retorna o icone para o normal quando o evento termina
                if (_this.hasAttribute("icon-active")) {
                    if (_this.hasAttribute("icon")) {
                        _this.img.style.backgroundImage = "url(" + _this.getAttribute("icon") + ")";
                    }
                }
                //retira o tema adicionado
                if (_this.hasAttribute("theme")) {
                    _this.classList.remove("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.remove("ab-button-normal-active");
                }
            }
        });

        //ação quando o mouse ou o touch deixar a área do objeto botão
        button.on("mouseleave touchleave", function (e) {
            e.preventDefault();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                //retorna o icone para o normal quando o evento termina
                if (_this.hasAttribute("icon-active")) {
                    if (_this.hasAttribute("icon")) {
                        _this.img.style.backgroundImage = "url(" + iconActive + ")";
                    }
                }
                //retira o tema adicionado
                if (_this.hasAttribute("theme")) {
                    _this.classList.remove("ab-button-" + _this.getAttribute("theme") + "-active");
                } else {
                    _this.classList.remove("ab-button-normal-active");
                }
            }
        });

        $(this.blocker).on("tap", function (e) {
            e.preventDefault();
            e.stopPropagation();

            return false;
        });


    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({ mode: 'open' }); */
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return ["is-disabled", "label", "theme", "icon", "icon-class", "width", "icon-button", "icon-size", "icon-space-width", "visibility", "visible", "position", "width-on-bigscreen", "id", "max-width", "is-blocked"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "is-disabled":
                //Quando is-disable = true, desabilita o botão
                if (newVal == "true") {
                    this.button.setAttribute("disabled", "disabled");
                    this.blocker.style.display = "block";
                } else {
                    //Se o novo valor não habilitar o disable, ele retira as classes de active e remove o disable do botão
                    if (this.hasAttribute("theme")) {
                        this.classList.remove("ab-button-" + this.getAttribute("theme") + "-active");
                    } else {
                        this.classList.remove("ab-button-normal-active");
                    }

                    this.button.removeAttribute("disabled");
                    this.blocker.style.display = "none";
                }

                break;

            case "label":
                this.span.innerText = newVal.toUpperOnlyFirstLetter();
                break;

            case "theme":
                this.classList.remove("ab-button-" + oldVal);
                this.classList.remove("ab-button-normal");
                this.classList.add("ab-button-" + newVal);
                break;

            case "icon":
                this.img.style.display = "inline-block";
                this.img.style.backgroundImage = "url(" + newVal + ")";
                break;

            case "icon-class":
                this.img.style.display = "inline-block";
                this.img.classList.add(newVal);
                break;

            case "width":
                this.style.width = newVal;
                break;

            case "icon-button":
                if (newVal == "true") {
                    this.classList.add("ab-button-img");
                } else {
                    this.classList.remove("ab-button-img");
                }
                break;

            case "icon-size":
                this.img.style.backgroundSize = newVal;
                break;

            case "icon-space-width":
                this.img.style.width = newVal;
                break;

            case "visibility":
                if (newVal == "show") {
                    this.style.display = "table";
                } else if (newVal == "hidden") {
                    this.style.display = "none";
                }
                break;

            case "visible":
                if (newVal == "true") {
                    this.style.display = "table";
                } else if (newVal == "false") {
                    this.style.display = "none";
                }
                break;

            case "position":
                if (newVal == "center") {
                    if (abner.utils.showBigScreen(top.$("body")) == true) {
                        this.classList.add("ab-button-center-big");
                    } else {
                        this.classList.add("ab-button-center");
                    }
                } else if (newVal == "right") {
                    this.style.float = newVal;
                }
                break;

            case "width-on-bigscreen":
                if (abner.utils.showBigScreen(top.$("body"))) {
                    this.style.width = newVal;
                }
                break;

            case "id":
                this.img.setAttribute("id", newVal + "btn_img");
                this.button.setAttribute("id", newVal + "btn_button");
                this.span.setAttribute("id", newVal + "btn_span");
                this.blocker.setAttribute("id", newVal + "btn_iblocker");
                break;

            case "max-width":
                this.style.maxWidth = newVal;
                break;

            case "is-blocked":
                //Trata a alteração do atributo is-disable
                //Quando is-disable = true, desabilita o botão
                if (newVal == "true") {
                    this.blocker.style.display = "block";
                } else {
                    //Se o novo valor não habilitar o disable, ele retira as classes de active e remove o disable do botão
                    if (this.hasAttribute("theme")) {
                        this.classList.remove("ab-button-" + this.getAttribute("theme") + "-active");
                    } else {
                        this.classList.remove("ab-button-normal-active");
                    }
                    this.blocker.style.display = "none";
                }
                break;

            default:
                break;
        }
    }
}
customElements.define("ab-button", AbButton);
"use strict";

$(document).ready(function () {
    $(window).on("resize", function () {
        $("ab-page").find("ab-checkbox").each(function () {
            if ($(this).attr("width-on-bigscreen")) {
                if ($(this).attr("width")) {
                    $(this).css("width", $(this).attr("width"));
                } else {
                    $(this).css("width", "100%");
                }
            }
        });
    });
});

class AbCheckbox extends HTMLElement {

    constructor() {
        super();

        this.checkspace = document.createElement("div");
        this.spanLabel = document.createElement("span");
        this.spanSubtitle = document.createElement("span");

        this.mainClass = "ab-checkbox";

        this._addEvent();
    }

    _render() {
        //coloca classe
        this.classList.add(this.mainClass);

        //Cria um id
        let id = generateID();
        if (this.hasAttribute("id")) {
            //description: Define se a checkbox já estará selecionada| Boolean | não| false|
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        //armazena o conteúdo passado no html
        let conteudo = this.innerHTML;
        this.innerHTML = "";

        //Coloca os atributos no objeto
        if (this.hasAttribute("width")) {
            //description: Largura do componente (afeta somente o espaço que terá para text, não altera o tamanho da checkbox)| % ou px| não| 100%|
            this.style.width = this.getAttribute("width");
            this.style.maxWidth = this.getAttribute("width");
        }

        //Obrigatorio checagem abaixo do width
        if (this.hasAttribute("width-on-bigscreen")) {
            //description: Define a largura do compenente em telas maiores (afeta somente o espaço que terá para text, não altera o tamanho da checkbox)| % ou px| não| |
            if (abner.utils.showBigScreen(top.$("body"))) {
                this.style.width = this.getAttribute("width-on-bigscreen");
            }
        }

        //Cria check
        this.checkspace.classList.add("ab-checkbox-checkspace");
        this.checkspace.setAttribute("id", id + "chk_checkbox");
        this.appendChild(this.checkspace);

        //insere o conteúdo no objeto
        this.spanLabel.classList.add("ab-checkbox-title");
        this.spanLabel.setAttribute("content-area", "true")
        this.spanLabel.setAttribute("id", id + "chk_label");
        if (conteudo) {
            this.spanLabel.innerHTML = conteudo;
        } else {
            if (this.hasAttribute("label")) {
                //description: Label do componente |  | não | |
                this.spanLabel.innerText = this.getAttribute("label");
            }
        }
        this.appendChild(this.spanLabel);

        this.spanSubtitle.classList.add("ab-checkbox-subtitle");
        this.spanSubtitle.setAttribute("id", id + "chk_subtitle");
        this.spanSubtitle.innerText = this.getAttribute("subtitle");
        this.appendChild(this.spanSubtitle);

        //Define se deverá ser alinhado a direita
        if (this.getAttribute("position") == "right") {
            //values: left;right
            //description: Define para onde estará posicionado o checkbox| Posição | não| left|
            this.style.float = this.getAttribute("position");
            this.style.paddingRight = "15px";
        }

        if (this.getAttribute("is-disabled") == "true") {
            //values: true;false
            //description: Define se a checkbox estará desativada| Boolean | não| false|
            this.checkspace.setAttribute("disabled", "disabled");
            this.classList.add("ab-checkbox-disabled");
        }

        //verifica se tem max width
        if (this.hasAttribute("max-width")) {
            //description: Largura máxima do componente | % ou px | não | |
            this.style.maxWidth = this.getAttribute("max-width");
        }

        if (this.hasAttribute("subtitle")) {
            //description: Subtitulo do componente |  | não | |
            this.spanSubtitle.innerText = this.getAttribute("subtitle");
        }

        //Limpa variaveis
        id = null;
        conteudo = null;
    }

    _addEvent() {
        let _this = this;
        $(this).on("tap", function (e) {
            e.preventDefault();

            if (_this.getAttribute("is-disabled") == "false" || !_this.hasAttribute("is-disabled")) {
                if (_this.getAttribute("is-checked") == "true") {
                    _this.setAttribute("is-checked", "false");
                } else {
                    _this.setAttribute("is-checked", "true");
                }
            }

            //Chama a funcao
            if (_this.hasAttribute("onvalidate")) {
                let fn = window[_this.getAttribute("onvalidate")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                } else {
                    fn = new Function(_this.getAttribute("onvalidate"));
                    fn.call($(_this));
                }
            }
        });
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({ mode: 'open' }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["is-disabled", "is-checked", "width", "width-on-bigscreen", "id", "subtitle", "label"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "is-disabled":
                if (newVal == "true") {
                    this.checkspace.setAttribute("disabled", "disabled");
                    this.classList.add("ab-checkbox-disabled");
                } else {
                    this.checkspace.removeAttribute("disabled");
                    this.classList.remove("ab-checkbox-disabled");
                }
                break;

            case "is-checked":
                //Quando is-disable = true, desabilita o botão
                if (newVal == "true") {
                    this.classList.remove("ab-checkbox-checkspace-middle");
                    this.classList.add("ab-checkbox-checkspace-checked");
                } else if (newVal == "neutral") {
                    this.classList.remove("ab-checkbox-checkspace-checked");
                    this.classList.add("ab-checkbox-checkspace-middle");
                } else {
                    this.classList.remove("ab-checkbox-checkspace-middle");
                    this.classList.remove("ab-checkbox-checkspace-checked");
                }

                if (this.getAttribute("cancel-callback") != "true") {
                    if (this.hasAttribute("onchange")) {
                        let fn = window[this.getAttribute("onchange")];
                        if (typeof fn === 'function') {
                            fn.call($(this));
                        }
                    }
                }
                break;

            case "width":
                this.style.width = newVal;
                break;

            case "width-on-bigscreen":
                if (abner.utils.showBigScreen(top.$("body"))) {
                    this.style.width = newVal;
                }
                break;

            case "id":
                this.checkspace.setAttribute("id", newVal + "chk_checkbox");
                this.spanLabel.setAttribute("id", newVal + "chk_label");
                this.spanSubtitle.setAttribute("id", newVal + "chk_subtitle");
                break;

            case "subtitle":
                this.spanSubtitle.innerText = newVal;
                break;

            case "label":
                this.spanLabel.innerHTML = newVal;
                break;

            default:
                break;
        }
    }

    setText(text) {
        this.spanLabel.innerHTML = text;
    }

    getText() {
        return this.spanLabel.innerText;
    }

    setNumber(text) {
        if (text == 1 || text == true) {
            this.setAttribute("is-checked", "true");
        } else {
            this.setAttribute("is-checked", "false");
        }
    }

    getNumber() {
        if (this.getAttribute("is-checked") == "true") {
            return "1";
        } else if ($(this).attr("is-checked") == "false") {
            return "0";
        }
    }
}
customElements.define("ab-checkbox", AbCheckbox);
"use strict";

class AbHeader extends HTMLElement {

    constructor() {
        super();

        this.img = document.createElement("img");

        this.mainClass = "ab-header";
    }

    _render() {
        // ADICIONA CLASSE PADRAO
        this.classList.add(this.mainClass);

        //Gera novo id
        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificação do objeto, com prefixo "head" | Alfanumérico | sim | randômico |
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        //coloca o menu
        this.img.classList.add("ab-header-menu");
        this.img.setAttribute("src", "object/ab-menu/img/open-menu.svg");
        this.appendChild(this.img);

        // parametros
        if (this.hasAttribute("height")) {
            //description: Seta altura| Número com px ou %| não| 50px|
            this.style.height = this.getAttribute("height");
        } else {
            this.style.height = "55px";
        }

        if (this.hasAttribute("width")) {
            //description: Seta largura| Número com px ou %| não| 100%|
            this.style.width = this.getAttribute("width");
        } else {
            this.style.width = "100%";
        }

        // MOSTRA OU NAO MOSTRA
        if (this.hasAttribute("visible")) {
            //values: true;false
            //description: Mostra ou esconde objeto | Boolean | não| true|
            this.setAttribute("visible", this.getAttribute("visible"));
        } else {
            this.setAttribute("visible", "true");
        }
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["visible", "position-fixed", "width", "height"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        if (attrName == "visible") {
            if (newVal && (newVal == true || newVal == "true")) {
                this.style.display = "block";
            } else {
                this.style.display = "none";
            }

            this.fixContent();

        } else if (attrName == "position-fixed") {
            // Posicao
            this.fixContent();

        } else if (attrName == "width") {
            this.style.width = newVal;

        } else if (attrName == "height") {
            this.style.height = newVal;
        }
    }

    fixContent() {
        var page = $("body").children("ab-page");
        var content = page.children("ab-page");
        var objHeader = page.children("ab-header");
        var objFooter = page.children("ab-footer");

        var totalH = 0;
        var over = false; //verifica se muda o overflow

        //calcula a diferenca do header 
        if (objHeader.length == 1 && objHeader.attr("position-fixed") == "true" && objHeader.attr("visible") == "true") {
            totalH += parseFloat(objHeader.height());
            over = true;

        } else if (objHeader.attr("visible") == "true") {
            totalH += parseFloat(objHeader.height());
        }

        if (objFooter.length == 1 && objFooter.attr("position-fixed") == "true" && objFooter.attr("visible") == "true") {
            totalH += parseFloat(objFooter.css("height"));
            over = true;

        } else if (objFooter.attr("visible") == "true") {
            totalH += parseFloat(objFooterobjFooter.height());
        }

        if (over) {
            content.css("overflow-y", "auto");
        } else {
            content.css("overflow-y", "initial");
        }

        //arruma content
        content.css("height", "-webkit-calc(100% - " + totalH + "px)");
        content.css("height", "-moz-calc(100% - " + totalH + "px)");
        content.css("height", "-o-calc(100% - " + totalH + "px)");
        content.css("height", "calc(100% - " + totalH + "px)");

        //apaga variaveis
        page = null;
        content = null;
        objHeader = null;
        objFooter = null;
    }
}
customElements.define('ab-header', AbHeader);
"use strict";

class AbInput extends HTMLElement {

    constructor() {
        super();

        this.abner = new AbnerUtils();

        this.input = document.createElement("input");
        this.label = document.createElement("label");
        this.span = document.createElement("span");
        this.errorParent = false;

        this.mainClass = "ab-input-underline";

        this._addEvent();
    }

    _render() {

        var id = null;
        if (this.getAttribute("id")) {
            id = this.getAttribute("id");
        } else {
            id = generateID();
            this.setAttribute("id", id);
        };

        //Coloca classe principal do objeto
        this.classList.add(this.mainClass);

        //width
        if (this.hasAttribute("width")) {
            this.style.width = this.getAttribute("width");
        }

        //Obrigatorio checagem abaixo do width
        if (this.hasAttribute("width-on-bigscreen")) {
            if (this.abner.showBigScreen(top.$("body"))) {
                this.style.width = this.getAttribute("width-on-bigscreen");
            }
        }

        //Coloca Input
        this.appendChild(this.input);
        this.input.setAttribute("id", id + "_input");
        this.input.setAttribute("type", "text");

        //onfocus no objeto
        if (this.hasAttribute("onfocus")) {
            this.input.setAttribute("onfocus", this.getAttribute("onfocus"));
        }

        //BugIOS Corrigi bug do cursor na selecao do texto
        if (this.hasAttribute("maxlength")) {
            this.input.setAttribute("maxlength", this.getAttribute("maxlength"));
        } else {
            this.input.setAttribute("maxlength", "100");
        }

        if (this.hasAttribute("placeholder")) {
            this.input.setAttribute("placeholder", this.getAttribute("placeholder"));
        }

        //Coloca Label
        this.appendChild(this.label);
        this.label.setAttribute("id", id + "_label");
        this.label.setAttribute("for", id + "_input");

        if (this.hasAttribute("label")) {
            this.label.innerText = this.getAttribute("label");
        }

        //Coloca mensagem de erro 
        this.span.setAttribute("id", id + "_span");
        if (this.hasAttribute("error")) {
            this.span.innerText = this.getAttribute("error");
            this.classList.add("ab-input-underline-error");
        } else {
            //se tiver descrição
            if (this.hasAttribute("description")) {
                this.span.innerText = this.getAttribute("description");
            }
        }
        this.appendChild(this.span);

        //desabilitar o campo quando o atributo is-disabled é true
        if (this.getAttribute("is-disabled") == "true") {
            this.input.setAttribute("disabled", true);
        }

        //coloca tabindex
        if (this.hasAttribute("tab-index")) {
            this.input.setAttribute("tabindex", this.getAttribute("tab-index"));
        }

        //para qual index vai
        if (this.hasAttribute("goto-tab-index")) {
            this.input.setAttribute("goto-tab-index", this.getAttribute("goto-tab-index"));
        }

        //para qual index vai
        if (this.hasAttribute("stop-tab-index")) {
            this.input.setAttribute("stop-tab-index", this.getAttribute("stop-tab-index"));
        }

        //verifica se tem max width
        if (this.hasAttribute("max-width")) {
            this.style.maxWidth = this.getAttribute("max-width");
        }

        //visivel
        if (this.getAttribute("visible") == "false") {
            //values: true;false
            //description: Define se o componente estará invisível ou não | Boolean | não | |
            this.style.display = "none";
        }

        /*if (this.hasAttribute("value")) {
            this.innerText = this.getAttribute("value");
        };*/
    }

    _addEvent() {
        var input = $(this.input);
        var _this = this;

        input.on("focus", function () {
            //Arruma scroll no mobile quando sobe o teclado para ANDROID
            setTimeout(function () {
                _this.scrollIntoView();
            }, 500);

            _this.classList.add("ab-input-underline-min");
            _this.classList.add("ab-input-underline-focus");

            //Chama a funcao que colocou no onfocus
            if (this.hasAttribute("onfocus")) {
                var fn = window[this.getAttribute("onfocus")];
                if (typeof fn === 'function') {
                    fn.call($(this));
                }
            }
        });

        input.on("blur", function () {
            _this.classList.remove("ab-input-underline-focus");
            //Triga as validações
            if (!_this.hasAttribute("thousand-mask")) {
                _this.setAttribute("cancel-onchange", "true");
            };
            $(this).trigger("change");

            //Chama a funcao que colcou no onblur
            if (_this.hasAttribute("onblur")) {
                var fn = window[_this.getAttribute("onblur")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
        });

        //Ir para o próximo item quando apertar enter
        input.on("keydown", function (event) {
            var key = event.keyCode ? event.keyCode : event.which;
            //var shift = !!event.shiftKey;
            var max = 0
            var len = _this.input.value.length;
            if (this.hasAttribute("maxlength")) {
                max = this.getAttribute("maxlength");
                if (len > max) {
                    return;
                }
            } else {
                if (key == 13 || key == 9) {
                    return goToNextTabindex(event, $(this), "tap");
                }
            }
        });

        //evento change quando alterar o valor do input
        input.on("change", function (e) {
            e.preventDefault();
            e.stopPropagation();

            //Sobe ou nao o label caso tenha algum valor
            if (this.value.length == 0) {
                _this.classList.remove("ab-input-underline-min");
            } else {
                _this.classList.add("ab-input-underline-min");
            }

            //verifica se o campo é obrigatório
            if (_this.getAttribute("is-required") == "true" && !_this.errorChild) {
                //values: true;false
                if (this.value.length == 0) {
                    _this.setAttribute("error", "Campo obrigatório");
                    _this.errorParent = true;
                } else {
                    _this.removeAttribute("error");
                    _this.errorParent = false;
                    _this.span.innerText = _this.getAttribute("description");
                }
            }

            //Chama a funcao que colcou no onblur
            if (_this.hasAttribute("onchange") && _this.getAttribute("cancel-onchange") != "true") {
                var fn = window[_this.getAttribute("onchange")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
            _this.removeAttribute("cancel-onchange");

            //Chama a funcao que colcou no onblur
            if (_this.hasAttribute("onvalidate")) {
                var fn = window[_this.getAttribute("onvalidate")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
        });

        // $(this).on("change", function (e) {
        //     $(_this.input).trigger("change");
        // });
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["id", "error", "is-disabled", "label", "width", "maxlength", "width-on-bigscreen", "tab-index", "goto-tab-index", "value", "visible"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "error":
                if (newVal != undefined && newVal != null) {
                    this.span.innerText = newVal;
                    this.classList.add("ab-input-underline-error");
                    this.errorParent = true;
                }

                if (newVal == null || newVal == "") {
                    this.classList.remove("ab-input-underline-error");
                    this.errorParent = false;
                    this.span.innerText = "";
                    if (this.hasAttribute("description")) {
                        this.span.innerText = this.getAttribute("description");
                    }
                }
                break;

            case "is-disabled":
                //quando o atributo is-disabled é alterado, adiciona ou retira a classe underline-min
                if (newVal == "true") {
                    if (this.input.value.length > 0) {
                        this.classList.add("ab-input-underline-min");
                    }
                    this.input.setAttribute("disabled", true);
                } else {
                    if (this.input.value.length == 0) {
                        this.classList.remove("ab-input-underline-min");
                    }
                    this.input.removeAttribute("disabled");
                }
                break;

            case "label":
                this.label.innerText = newVal;
                break;

            case "id":
                this.label.setAttribute("for", newVal + "_input");
                this.label.setAttribute("id", newVal + "_label");
                this.input.setAttribute("id", newVal + "_input");
                this.span.setAttribute("id", newVal + "_span");
                break;

            case "maxlength":
                this.input.setAttribute("maxlength", newVal);
                break;

            case "width":
                this.style.width = newVal;
                break;

            case "width-on-bigscreen":
                if (this.abner.showBigScreen(top.$("body"))) {
                    this.style.width = newVal;
                }
                break;

            case "tab-index":
                this.input.setAttribute("tabindex", newVal);
                break;

            case "goto-tab-index":
                this.input.setAttribute("goto-tab-index", newVal);
                break;

            /*case "value":
                this.input.value = newVal;
                break;*/

            case "visible":
                if (newVal == "true") {
                    this.style.display = "inline-block";
                } else if (newVal == "false") {
                    this.style.display = "none";
                }
                break;

            default:
                break;
        }
    }

    setText(text) {
        if (this.classList.contains("ab-input-date-underline")) {
            this.setDate(text);
        } else {
            this.input.value = text;
        }

        $(this.input).change();
    }

    getText() {
        if (this.classList.contains("ab-input-date-underline")) {
            return this.getDate();
        } else {
            return this.input.value;
        }
    }

    setNumber(text) {
        this.input.value = text;

        $(this.input).change();
    }

    getNumber() {
        return this.input.value;
    }
}

customElements.define('ab-input', AbInput);
"use strict";

var ChassiFloatButton = function(chassi) {
    // Escopo do chassi
    this.chassi = chassi;

    // Tamanho
    this.size = "65";
}

ChassiFloatButton.prototype.onTouchMove = function(e) {
    e.preventDefault();

    var btnDiv = $("#DivautoHide");

    if (btnDiv.attr('id') != undefined) {
        // Pega o toque
        var touch = new Object();
        if (e.originalEvent && e.originalEvent.touches) {
            touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
        } else {
            touch = e;
        }

        var h = parseInt($(btnDiv).css("height"));
        var w = parseInt($(btnDiv).css("width"));

        // Move objeto
        $(btnDiv).css("top", touch.pageY - (h / 2));
        $(btnDiv).css("left", touch.pageX - (w / 2));
        $(btnDiv).attr("moved", "true");
    }
}

ChassiFloatButton.prototype.hide = function() {
    var _this = this;

    // Remove Timeout
    if (window.btnChassiFull != undefined) {
        window.clearInterval(window.btnChassiFull);
        window.btnChassiFull = undefined;
    }

    // remove evento
    $(document).unbind("touchmove mousemove", _this.onTouchMove);

    // Remove botao da tela
    $("#DivautoHide").remove();
}

ChassiFloatButton.prototype.refresh = function() {
    var btnDiv = $("#DivautoHide");

    if (btnDiv.attr('id') != undefined) {
        this.hide();
        this.show();
    }
}

ChassiFloatButton.prototype.setNewPosition = function(e, forceMove) {
    var _this = this;
    var oh = parseInt($("#DivautoHide").css("height"));
    var ow = parseInt($("#DivautoHide").css("width"));
    var ol = parseInt($("#DivautoHide").css("left"));
    var ot = parseInt($("#DivautoHide").css("top"));
    var ob = parseInt($("#DivautoHide").css("bottom"));

    var w = parseInt($(window).width());
    var h = parseInt($(window).height());

    var dontMove = false;

    if (ot < 30) {
        $("#DivautoHide").animate({
            "top": "10px"
        }, 100);
        dontMove = true;
    }

    if ((ot + oh + 30) > h) {
        $("#DivautoHide").animate({
            "top": h - (oh + 10)
        }, 100);
        dontMove = true;
    }

    if (dontMove == false || forceMove != undefined) {
        if ((ol + (ow / 2)) > (w / 2)) {
            $("#DivautoHide").animate({
                "left": w - ow - 10 + "px"
            }, 100);
        } else {
            $("#DivautoHide").animate({
                "left": "5px"
            }, 100);
        }
    }

    $(document).unbind("touchmove mousemove", _this.onTouchMove);
}

ChassiFloatButton.prototype.show = function() {
    var btnDiv = $("#DivautoHide");
    var _this = this;

    if (btnDiv.attr('id') == undefined) {

        var div = $("<div>", {
            id: "DivautoHide"
        });

        div.addClass('ab-menu-float');
        div.css('height', '0px');
        div.css('width', '0px');
        div.css('background-color', 'white');
        div.css('border', '1px solid #cacaca');
        div.css('border-radius', '54px');
        div.css('cursor', 'pointer');
        div.css('opacity', '0');
        div.css('position', 'fixed');
        div.css('text-align', 'center');
        div.css('z-index', 98);
        div.css('bottom', '10px');
        div.css('left', $(window).width());

        // Evitar Selecao
        div.attr('unselectable', 'on')
        div.css('user-select', 'none')
        div.on('selectstart', false);

        // Fecha botao ao terminar
        div.on("click", function(ev) {
            ev.preventDefault();

            if ($("#DivautoHide").attr("moved") == "false") {
                $("ab-menu").attr("visible", "true");
                _this.hide();
            }
        });

        // Adiciona no html
        $('body').append(div);

        // animacao
        div.animate({
            opacity: "1",
            height: this.size + "px",
            width: this.size + "px",
            'left': ($(window).width() - this.size - 10)
        }, 200, 'linear');

        // // Coloca funcoes
        div.on("touchstart mousedown", function(e) {
            $("#DivautoHide").attr("moved", "false");

            $(document).bind("touchmove mousemove", _this.onTouchMove);

            $("#DivautoHide").animate({
                "opacity": "1"
            }, 100);
        });

        // Quando subir encostar o botao
        div.on("touchend mouseup", function(e) {

            $(document).unbind("touchmove mousemove", _this.onTouchMove);

            _this.setNewPosition(e);
        });

        // Armazena funcao para deixar mais claro o botao
        if (window.btnChassiFull != undefined) {
            window.clearInterval(window.btnChassiFull);
            window.btnChassiFull = undefined;
        }

        // Coloca acao para ficar transparente
        window.btnChassiFull = setInterval(function() {
            var lastTopLeft = parseInt($("#DivautoHide").attr("lastTopLeft"));
            var ol = parseInt($("#DivautoHide").css("left"));
            var ot = parseInt($("#DivautoHide").css("top"));
            var tot = 0;

            if ($("#DivautoHide").css("left") != "auto" && $("#DivautoHide").css("top") != "auto") {
                tot = (ol + ot);
            } else {
                lastTopLeft = 0;
            }

            if (lastTopLeft == tot) {
                $("#DivautoHide").animate({
                    "opacity": "0.5"
                }, 100);
            }

            // Salva ultimo topleft
            $("#DivautoHide").attr("lastTopLeft", tot);

        }, 3000);
    }
}

class AbMenu extends HTMLElement {

    constructor() {
        super();

        this.mainClass = "ab-menu";

        this.state = "closed";
        this.startX = 0;
        this.currentX = 0;
        this.action = 0;
        this.maxTranslate = 0;
        this.currTranslate = 0;
        this.divOpacity = "0.8";
        this.zIndex = "102";
        this.animationTime = "200";
        this.floatButton = new ChassiFloatButton();
        this.isFooterOnBody = null;
        this.isHeaderOnBody = null;
    }

    _render() {
        var height = $(this).attr("height");
        if (height != undefined) {
            $(this).css("height", height);
        } else {
            $(this).css("height", "100%");
        }
    
        var width = $(this).attr("width");
        if (width != undefined) {
            $(this).css("width", width);
        } else {
            $(this).css("width", "200px");
        }

        var height = $(this).attr("height");
        if (height != undefined) {
            $(this).css("height", height);
        } else {
            $(this).css("height", "100%");
        }
    
        var width = $(this).attr("width");
        if (width != undefined) {
            $(this).css("width", width);
        } else {
            $(this).css("width", "200px");
        }
    
        // Verificacao do footer
        this.isFooterOnBody = false
        this.isHeaderOnBody = $("ab-header").parent().is("body");
    
        this.mode3d = this.support3d();
    
        // Configura menu
        $(this).css("zIndex", this.zIndex);
        $(this).css("position", "fixed");
        $(this).css("left", "0px");
        $(this).css("top", "0px");
        $(this).css("overflowY", "auto");
    
        // Ajusta animacoes
        this.maxTranslate = parseFloat($(this).css("width"));
    
        // Abre ou fecha menu
        var visible = $(this).attr("visible");
        if (visible != undefined) {
            this.visible(this, "0", visible);
        } else {
            this.visible(this, "0", "false");
        }
    
        if ($(this).attr("float-button") == "true") {
            $(window).on("resize",function() {
                _this.floatButton.refresh();
            });
        }
    
        if ($(this).attr("touch-move") == "true") {
            var _this = this;
            $(document).on("touchmove mousemove", function(event) {
                _this.mouseMove(event);
                // return false;
            });
    
            $(document).on("touchstart mousedown", function(event) {
                _this.mouseDown(event);
                // return false;
            });
    
            $(document).on("touchend mouseup", function(event) {
                _this.mouseUp(event);
                // return false;
            });
        }
    
        $(this).addClass(this.mainClass);
    }

    _addEvent() {
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return ["visible"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        if (attrName == "visible") {
            this.isFooterOnBody = false
            this.isHeaderOnBody = $("ab-header").parent().is("body");
    
            var visible = $(this).attr("visible");
    
            this.visible(this, this.animationTime, visible);
    
            if ($(this).attr("float-button") == "true") {
                if (visible == "false") {
                    this.floatButton.show();
                } else {
                    this.floatButton.hide();
                }
            }
        }    
    }

    moveX(_this, time, show, translateX) {
        var mode3d = this.support3d();
        var trans = this.getTransform(_this);
        var y = trans[1];
    
        // transicao
        if (mode3d) {
            $(_this).css("transition", "transform " + time + "ms");
            $(_this).css("-o-transition", "-o-transform " + time + "ms");
            $(_this).css("-ms-transition", "-ms-transform " + time + "ms");
            $(_this).css("-moz-transition", "-moz-transform " + time + "ms");
            $(_this).css("-webkit-transition", "-webkit-transform " + time + "ms");
        }
    
        if (show == false) {
            if (mode3d) {
                $(_this).css({
                    "transform": "translate3d(" + (-1 * translateX) + "px," + y + "px,0)",
                    "-webkit-transform": "translate3d(" + (-1 * translateX) + "px," + y + "px,0)",
                    "-moz-transform": "translate3d(" + (-1 * translateX) + "px," + y + "px,0)",
                    "-ms-transform": "translate3d(" + (-1 * translateX) + "px," + y + "px,0)",
                    "-o-transform": "translate3d(" + (-1 * translateX) + "px," + y + "px,0)"
                });
    
            } else {
                if (time == "0") {
                    $(_this).css("left", (-1 * translateX) + "px");
                } else {
                    $(_this).animate({
                        "left": (-1 * translateX) + "px"
                    }, time, function() {});
                }
            }
        } else {
            if (mode3d) {
                $(_this).css({
                    "transform": "translate3d(0," + y + "px,0)",
                    "-webkit-transform": "translate3d(0," + y + "px,0)",
                    "-moz-transform": "translate3d(0," + y + "px,0)",
                    "-ms-transform": "translate3d(0," + y + "px,0)",
                    "-o-transform": "translate3d(0," + y + "px,0)"
                });
    
            } else {
                if (time == "0") {
                    $(_this).css("left", "0px");
                } else {
                    $(_this).animate({
                        "left": "0px"
                    }, time, function() {});
                }
            }
        }
    }
    
    visible(_this, time, visible) {
    
        if (visible != "true") {
            this.currTranslate = 0;
            this.state = "closed";
    
            this.moveX(_this, time, false, this.maxTranslate);
            // this.moveX($("ab-header"), time, false, this.maxTranslate);
    
            if ($(_this).attr("animation") == "push" || $(_this).attr("animation") == "pushAndFit") {
                this.moveX($("ab-page"), time, true, (-1 * this.maxTranslate));
    
                if (this.isHeaderOnBody) {
                    this.moveX($("ab-header"), time, true, (-1 * this.maxTranslate));
                }
    
                if (this.isFooterOnBody) {
                    this.moveX($("ab-page"), time, true, (-1 * this.maxTranslate));
                }
            }
    
            this.removeBlockDiv();
    
            if ($(_this).attr("animation") == "pushAndFit") {
                setTimeout(function() {
                    $("ab-page").css("width", "100%");
                }, time);
            }
        } else {
            this.state = "opened";
            this.currTranslate = this.maxTranslate;
            this.moveX(_this, time, true, "0");
    
            if ($(_this).attr("animation") == "push" || $(_this).attr("animation") == "pushAndFit") {
                this.moveX($("ab-page"), time, false, (-1 * this.maxTranslate));
    
                if (this.isHeaderOnBody) {
                    this.moveX($("ab-header"), time, false, (-1 * this.maxTranslate));
                }
    
                if (this.isFooterOnBody) {
                    this.moveX($("ab-page"), time, false, (-1 * this.maxTranslate));
                }
            }
    
            this.createBlockDiv();
    
            if ($(_this).attr("animation") == "pushAndFit") {
                setTimeout(function() {
                    var w = parseFloat($("ab-menu").css("width"));
                    $("ab-page").css("width", "-webkit-calc(100% - " + w + "px)");
                    $("ab-page").css("width", "-moz-calc(100% - " + w + "px)");
                    $("ab-page").css("width", "-o-calc(100% - " + w + "px)");
                    $("ab-page").css("width", "calc(100% - " + w + "px)");
                }, time);
            }
        }
    }
    
    support3d() {
        var ret = false;
        var supports3DTransforms = document.body.style['webkitPerspective'] !== undefined || document.body.style['MozPerspective'] !== undefined;
        if (supports3DTransforms) {
            ret = true;
        }
        return ret;
    }
    
    getXY(event) {
        var x = null;
        var y = null;
    
        if (event.originalEvent != null && event.originalEvent.touches != null) {
            var touch = event.originalEvent.touches[0] || event.originalEvent.changedTouches[0];
            x = parseFloat(touch.pageX);
            y = parseFloat(touch.pageY);
        } else {
            x = parseFloat(event.pageX);
            y = parseFloat(event.pageY);
        }
    
        var pos = new Object();
        pos.x = x;
        pos.y = y;
    
        return pos;
    }
    
    mouseMove(event) {
        event.preventDefault();
        var _this = this;
    
        if (this.action == "move" && (this.state == "closed" || this.state == "opened")) {
    
            var pos = this.getXY(event);
    
            // fecha ou abre
            if (this.state == "closed") {
                this.currTranslate = (this.currentX + this.startX + pos.x);
            } else {
                this.currTranslate = (this.currentX + (pos.x - this.startX));
            }
    
            // deixa o translate no maximo e no minimo
            if (this.currTranslate >= this.maxTranslate) {
                this.currTranslate = this.maxTranslate;
            } else if (this.currTranslate <= 0) {
                this.currTranslate = 0;
            }
    
            var trans = this.getTransform(this);
            var x = parseInt(this.currTranslate);
            var y = trans[1];
            var delta = (x - this.maxTranslate);
    
            // Mudar Left
            if (this.mode3d) {
                $(this).css({
                    "transform": "translate3d(" + delta + "px," + y + "px,0)",
                    "-webkit-transform": "translate3d(" + delta + "px," + y + "px,0)",
                    "-moz-transform": "translate3d(" + delta + "px," + y + "px,0)",
                    "-ms-transform": "translate3d(" + delta + "px," + y + "px,0)",
                    "-o-transform": "translate3d(" + delta + "px," + y + "px,0)"
                });
    
                // move o resto
                if ($(this).attr("animation") == "push" || $(this).attr("animation") == "pushAndFit") {
                    var transPage = this.getTransform($("ab-page"));
                    var yPage = transPage[1];
                    $("ab-page").css({
                        "transform": "translate3d(" + x + "px," + yPage + "px,0)",
                        "-webkit-transform": "translate3d(" + x + "px," + yPage + "px,0)",
                        "-moz-transform": "translate3d(" + x + "px," + yPage + "px,0)",
                        "-ms-transform": "translate3d(" + x + "px," + yPage + "px,0)",
                        "-o-transform": "translate3d(" + x + "px," + yPage + "px,0)"
                    });
    
                    if (this.isHeaderOnBody) {
                        var transPage = this.getTransform($("ab-header"));
                        var yHead = transPage[1];
                        $("ab-header").css({
                            "transform": "translate3d(" + x + "px," + yHead + "px,0)",
                            "-webkit-transform": "translate3d(" + x + "px," + yHead + "px,0)",
                            "-moz-transform": "translate3d(" + x + "px," + yHead + "px,0)",
                            "-ms-transform": "translate3d(" + x + "px," + yHead + "px,0)",
                            "-o-transform": "translate3d(" + x + "px," + yHead + "px,0)"
                        });
                    }
    
                    if (this.isFooterOnBody) {
                        var transPage = this.getTransform($("ab-page"));
                        var yPage = transPage[1];
                        $("ab-page").css({
                            "transform": "translate3d(" + x + "px," + yPage + "px,0)",
                            "-webkit-transform": "translate3d(" + x + "px," + yPage + "px,0)",
                            "-moz-transform": "translate3d(" + x + "px," + yPage + "px,0)",
                            "-ms-transform": "translate3d(" + x + "px," + yPage + "px,0)",
                            "-o-transform": "translate3d(" + x + "px," + yPage + "px,0)"
                        });
                    }
                }
            } else {
    
                // Muda menu com a diferenca do tamanho dele
                var diff = parseFloat($(this).css("width"));
                diff = (x - parseFloat(diff));
                $(this).css("left", diff + "px");
    
                if ($(this).attr("animation") == "push" || $(this).attr("animation") == "pushAndFit") {
                    // muda outros com o x normal
                    $("ab-page").css("left", x + "px");
    
                    if (this.isHeaderOnBody) {
                        $("ab-header").css("left", x + "px");
                    }
    
                    if (this.isFooterOnBody) {
                        $("ab-footer").css("left", x + "px");
                    }
                }
            }
    
            // Arruma tamanho
            if ($(this).attr("animation") == "pushAndFit") {
                var diff = parseFloat($(this).css("width"));
                diff = (x - parseFloat(diff));
    
                $("ab-page").css("width", "-webkit-calc(100% - " + diff + "px)");
                $("ab-page").css("width", "-moz-calc(100% - " + diff + "px)");
                $("ab-page").css("width", "-o-calc(100% - " + diff + "px)");
                $("ab-page").css("width", "calc(100% - " + diff + "px)");
            }
        }
    }
    
    mouseDown(event) {
        var mode3d = this.support3d();
    
        // Verificacao do footer
        this.isFooterOnBody = false;
        this.isHeaderOnBody = $("ab-header").parent().is("body");
    
        if (this.state != "closing" && this.state != "opening") {
            // Pega x y
            var pos = this.getXY(event);
    
            // Pega o start x
            if ((this.state == "closed" && pos.x < 10) || (this.state == "opened" && (pos.x > (this.maxTranslate - (this.maxTranslate / 3))) && pos.x < this.maxTranslate + 40)) {
                event.preventDefault();
    
                // transicao
                if (mode3d) {
                    $(this).css("transition", "none");
                    $(this).css("-o-transition", "none");
                    $(this).css("-ms-transition", "none");
                    $(this).css("-moz-transition", "none");
                    $(this).css("-webkit-transition", "none");
    
                    if (this.isHeaderOnBody) {
                        $("ab-header").css("transition", "none");
                        $("ab-header").css("-o-transition", "none");
                        $("ab-header").css("-ms-transition", "none");
                        $("ab-header").css("-moz-transition", "none");
                        $("ab-header").css("-webkit-transition", "none");
                    }
    
                    if ($(this).attr("animation") == "push" || $(this).attr("animation") == "pushAndFit") {
                        $("ab-page").css({
                            "transition": "none",
                            "-o-transition": "none",
                            "-ms-transition": "none",
                            "-moz-transition": "none",
                            "-webkit-transition": "none"
                        });
                    }
                }
    
                if (this.state == "closed") {
                    this.removeBlockDiv();
                    this.createBlockDiv();
                }
    
                this.startX = pos.x;
                this.currentX = this.currTranslate;
                this.action = "move";
    
            }
        }
    }
    
    mouseUp(event) {
        if (this.action == "move") {
            // Se soltar no meio decide para onde ir
            if (Math.abs(this.currTranslate) < (this.maxTranslate / 2)) {
                if ($(this).attr("visible") == "false") {
                    this.visible(this, this.animationTime, "false");
                } else {
                    $(this).attr("visible", false);
                }
    
            } else {
                if ($(this).attr("visible") == "true") {
                    this.visible(this, this.animationTime, "true");
                } else {
                    $(this).attr("visible", true);
                }
            }
    
            this.action = null;
            this.startX = null;
            this.currentX = null;
        }
    }
    
    removeBlockDiv() {
        if ($("#ab-menu-block-div").length != 0) {
            $("#ab-menu-block-div").css("opacity", "0");
            $("#ab-menu-block-div").css("-webkit-opacity", "0");
            $("#ab-menu-block-div").css("-moz-opacity", "0");
            $("#ab-menu-block-div").css("-ms-opacity", "0");
            $("#ab-menu-block-div").css("-0-opacity", "0");
    
            setTimeout(function() {
                $("#ab-menu-block-div").remove();
            }, this.animationTime);
        }
    }
    
    createBlockDiv(forceOpacity) {
        if ($(this).attr("block-content") == "true") {
            if ($("#ab-menu-block-div").length == 0) {
                var div = $("<div>");
                div.appendTo($("ab-menu").parent());
                div.css("zIndex", (this.zIndex - 1));
                div.attr("id", "ab-menu-block-div");
                div.addClass("ab-menu-block-div");
    
                if ($(this).attr("close-image") != undefined && $(this).attr("close-image") != "") {
                    var imgClose = $("<img>");
                    imgClose.attr("src", $(this).attr("close-image"));
                    imgClose.addClass("ab-menu-block-close");
                    imgClose.appendTo(div);
                }
    
                // animacao de opacidade
                div.css("transition", "opacity " + this.animationTime + "ms linear");
                div.css("-webkit-transition", "-webkit-opacity " + this.animationTime + "ms linear");
    
                div.on("touchstart mousedown", function(event) {
                    // event.preventDefault();
                    // return false;
                });
    
                div.on("touchend mouseup", function(event) {
                    // event.preventDefault();
                    $("ab-menu").attr("visible", "false");
                });
    
                div.on("touchmove mousemove", function(event) {
                    event.preventDefault();
                    // return false;
                });
    
                // Se abrir forcando opacity maxima
                if (forceOpacity) {
                    $(".ab-menu-block-div").css("opacity", this.divOpacity);
                }
            }
            // altera opacidade
            if ($(".ab-menu-block-div").css("opacity") != this.divOpacity) {
                $(".ab-menu-block-div").css("opacity", this.divOpacity);
                $(".ab-menu-block-div").css("-webkit-opacity", this.divOpacity);
                $(".ab-menu-block-div").css("-moz-opacity", this.divOpacity);
                $(".ab-menu-block-div").css("-ms-opacity", this.divOpacity);
            }
        }
    }

    getTransform(el) {
        var prop = "";
    
        if ($(el).css('-webkit-transform') != undefined) {
            prop = $(el).css('-webkit-transform');
        } else if ($(el).css('transform') != undefined) {
            prop = $(el).css('transform');
        } else if ($(el).css('-moz-transform') != undefined) {
            prop = $(el).css('-moz-transform');
        } else if ($(el).css('-ms-transform') != undefined) {
            prop = $(el).css('-ms-transform');
        } else {
            return [0, 0, 0];
        }
    
        var results = prop
            .match(/matrix(?:(3d)\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))(?:, (-{0,1}\d+)), -{0,1}\d+\)|\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))\))/);
    
        if (!results)
            return [0, 0, 0];
        if (results[1] == '3d')
            return results.slice(2, 5);
    
        results.push(0);
        return results.slice(5, 8);
    }
}
customElements.define("ab-menu", AbMenu);

class AbMenuBtn extends HTMLElement {

    constructor() {
        super();

        this.mainClass = "ab-menu-btn";

    }

    _render() {
        $(this).attr("href", "javascript:void(0)");

        $(this).on("touchstart mousedown", function() {
            if ($("ab-menu").attr("visible") == "true") {
                $("ab-menu").attr("visible", "false");
            } else {
                $("ab-menu").attr("visible", "true");
            }
        });
    
        $(this).addClass(this.mainClass);
    }

    _addEvent() { }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return [];
    }

    attributeChangedCallback(attrName, oldVal, newVal) { }
}
customElements.define("ab-menu-btn", AbMenuBtn);
"use strict";

window['onchangeforcheckbox'] = null;
class AbModalUtil {

    constructor() {

        this.divBackground = document.createElement("div");

    }

    hide() {
        if ($("#ab-modal").length > 0) {

            $("#ab-modal").remove();
            $('.chat-body-div').css("overflow-y", "scroll");

        }
    }

    show(prop) {
        var id = generateID();
        var _this = this;


        //compatibilidade com versao antiga
        if (prop && prop.callBack) {
            prop.callback = prop.callBack;
        }

        this.hide();

        //Cria fundo preto
        this.divBackground.classList.add("ab-modal-background");
        this.divBackground.setAttribute("id", "ab-modal");
        setTimeout(function () {
            _this.hide();
            $("body")[0].appendChild(_this.divBackground);
            
        }, 1);

        $(this.divBackground).on("mousedown touchstart", function (e) {
            if  (e.target == this) {
                e.preventDefault();
                e.stopPropagation();
                if (_this.divBackground.getAttribute("closable") == "true" && e.target.id == _this.divBackground.getAttribute("id")) {
                    _this.hide();
                }
            }
        });

        if (prop.closable) {
            this.divBackground.setAttribute("closable", prop.closable);
        }

        switch (prop.type) {
            case "promocional":
                this.modalPromocional(prop);
                break;

            case "checkbox":
                this.modalCheckOrList(prop);
                break;

            case "tela":
                this.modalTela(prop);
                break;

            default:
                if (prop.list && prop.list.length > 0) {
                    this.modalCheckOrList(prop);
                } else {
                    this.modalNormal(prop);
                }
                break;
        }
    }

    modalNormal(prop) {
        var _this = this;

        var divWrapper = document.createElement("div");
        divWrapper.classList.add("ab-modal-wrapper");
        divWrapper.setAttribute("id", "ab-modal" + "_divWrapper");
        this.divBackground.appendChild(divWrapper);

        //Cria janela branca para colocar o texto e botoes
        var divModal = document.createElement("div");
        divModal.classList.add("ab-modal-window");
        divModal.setAttribute("id", "ab-modal" + "_divModal");
        divWrapper.appendChild(divModal);

        if (prop.type) {
            //Se tiver type sucess, error, alerta, divulgacao e orientacao, apresenta imagem no content representando o caso
            var divModalIcon = document.createElement("div");
            divModalIcon.classList.add("ab-modal-icon");
            this.divBackground.classList.add("ab-modal-" + prop.type);
            divModal.appendChild(divModalIcon);
        // } else {
        //     this.divBackground.classList.add("ab-modal-alerta");
        }

        if(prop.maxWidth){
            divModal.style.maxWidth = prop.maxWidth;
            divModal.style.margin = "auto";
        }

        //Se tiver titulo, adiciona div de titulo
        if (prop.title) {
            var divTitle = document.createElement("div");
            divTitle.classList.add("ab-modal-title");
            divTitle.setAttribute("id", "ab-modal_divTitle");
            if (typeof prop.title == 'object') {
                var serializer = new XMLSerializer();
                divTitle.innerHTML = serializer.serializeToString(prop.title[0]);
            } else {
                divTitle.innerHTML = prop.title;
            }
            divModal.appendChild(divTitle);
        };

        //Se tiver texto, apresenta texto
        if (prop.text) {
            var spanText = $("<span/>");
            //spanText.html(prop.text);
            if (typeof prop.text == 'object') {
                var serializer = new XMLSerializer();
                spanText.html(serializer.serializeToString(prop.text[0]));
            } else {
                spanText.html(prop.text);
            }
            spanText.addClass("ab-modal-span");
            spanText.appendTo(divModal);
        }

        //Cria botoes solicitados
        if (prop.buttons && prop.buttons.length > 0) {
            //Para cada item "buttons" no html, irá criar um botão.
            for (var i = 0; i < prop.buttons.length; i++) {
                let btnModalNormal = document.createElement("ab-button");
                btnModalNormal.setAttribute("label", prop.buttons[i].title);
                btnModalNormal.setAttribute("order", i);
                if (i > 0) {
                    btnModalNormal.setAttribute("theme", "secondary");
                }
                divModal.appendChild(btnModalNormal);
                $(btnModalNormal).on("tap", function (e) {
                    e.preventDefault();

                    _this.hide();

                    let order = parseInt($(this).attr("order"));
                    if (typeof prop.buttons[order].callback === 'function') {
                        prop.buttons[order].callback.call(null);
                    }
                });
            }
        }

        $(divWrapper).on("touchstart mousedown", function (e) {
            if (divModal.scrollHeight > divModal.clientHeight) {
                if (e.target.id == "ab-modal_divWrapper" || e.target.id == "ab-modal_divTitle") {
                    e.preventDefault();
                } else {
                    e.stopPropagation();
                }
            } else {
                e.preventDefault();
            }
        });

        setTimeout(function () {
            if (prop && typeof prop.onopen === 'function') {
                prop.onopen.call(null, divContent);
            }
        }, 2);
    }

    modalPromocional(prop) {
        var _this = this;

        this.divBackground.style.backgroundColor = "transparent";

        let divPromo = document.createElement("div");
        divPromo.classList.add("ab-modal-promocional-content");
        this.divBackground.appendChild(divPromo);

        let closePromo = document.createElement("span");
        closePromo.classList.add("ab-modal-promocional-close");
        closePromo.innerText = "X"
        divPromo.appendChild(closePromo);
        $(closePromo).on("tap", function (e) {
            e.preventDefault();

            _this.hide();

            if (typeof prop.buttons[0].callback === 'function') {
                prop.buttons[0].callback.call(null);
            }
        });

        let divImg = document.createElement("div");
        divImg.classList.add("ab-modal-promocional-imagem");
        divPromo.appendChild(divImg);

        let imgPromo = document.createElement("img");
        imgPromo.setAttribute("src", prop.imgPromo);
        divImg.appendChild(imgPromo);

        let titlePromo = document.createElement("h2");
        titlePromo.classList.add("ab-modal-promocional-title");
        titlePromo.innerText = prop.title;
        divPromo.appendChild(titlePromo);

        let pPromo = document.createElement("p");
        pPromo.classList.add("ab-modal-promocional-text");
        pPromo.innerHTML = prop.text;
        divPromo.appendChild(pPromo);

        if (prop.buttons[0]) {
            let btnPromo = document.createElement("ab-button");
            btnPromo.classList.add("ab-modal-promocional-button");
            if (prop.buttons[0].title) {
                btnPromo.setAttribute("label", prop.buttons[0].title.toUpperOnlyFirstLetter());
            } else {
                btnPromo.setAttribute("label", "Fechar");
            }
            divPromo.appendChild(btnPromo);
            $(btnPromo).on("tap", function (e) {
                e.preventDefault();

                _this.hide();

                if (typeof prop.buttons[0].callback === 'function') {
                    prop.buttons[0].callback.call(null);
                }
            });
        }
    }

    modalCheckOrList(prop) {
        var _this = this;

        this.divBackground.style.backgroundColor = "transparent";

        let divTela = document.createElement("div");
        divTela.classList.add("ab-modal-tela-window");
        this.divBackground.appendChild(divTela);

        let closeTela = document.createElement("span");
        closeTela.classList.add("ab-modal-tela-close");
        closeTela.innerText = "X"
        divTela.appendChild(closeTela);
        $(closeTela).on("tap", function (e) {
            e.preventDefault();

            _this.hide();
        });

        let divTitle = document.createElement("div");
        divTitle.classList.add("ab-modal-tela-title");
        divTitle.innerHTML = prop.title;
        divTela.appendChild(divTitle);

        let divContent = document.createElement("div");
        divContent.classList.add("ab-modal-tela-content");
        divContent.setAttribute("id", "ab-modal-content");
        divTela.appendChild(divContent);

        let divButton = document.createElement("div");
        divButton.classList.add("ab-modal-tela-buttons");
        divTela.appendChild(divButton);

        //Se tiver lista na chamada do modal no HTML, cria a lista
        if (prop.list && prop.list.length > 0) {
            //trata para quando for lista normal ou lista de checkbox
            if (prop.type == "checkbox") {
                //adiciona attr max-select para o modal
                if (prop["max-select"]) {
                    divContent.setAttribute("max-select", prop["max-select"]);
                }

                //cria os checkbox no modal
                for (let i = 0; i < prop.list.length; i++) {
                    let modalCheck = document.createElement("ab-checkbox");
                    modalCheck.classList.add("modal-checkbox");
                    modalCheck.setAttribute("cancel-callback", "true");
                    divContent.appendChild(modalCheck);

                    if (prop.list[i].code) {
                        modalCheck.setAttribute("code", prop.list[i].code);
                    }
                    if (prop.list[i].subtitle) {
                        modalCheck.setAttribute("subtitle", prop.list[i].subtitle);
                    }

                    modalCheck.setAttribute("is-checked", prop.list[i].checked == undefined ? "false" : prop.list[i].checked);
                    modalCheck.setAttribute("label", prop.list[i].label == undefined ? "NÃO INFORMADO" : prop.list[i].label);

                    if (prop && prop.onchange) {
                        window['onchangeforcheckbox'] = prop.onchange;

                        modalCheck.setAttribute("onchange", 'onchangeforcheckbox');
                    }

                    modalCheck.setAttribute("cancel-callback", "false");
                }

                if (prop.buttons[0]) {
                    let btnTela = document.createElement("ab-button");
                    btnTela.classList.add("ab-modal-promocional-button");
                    if (prop.buttons[0].title) {
                        btnTela.setAttribute("label", prop.buttons[0].title.toUpperOnlyFirstLetter());
                    } else {
                        btnTela.setAttribute("label", "Fechar");
                    }
                    divButton.appendChild(btnTela);
                    $(btnTela).on("tap", function (e) {
                        e.preventDefault();

                        var data = [];
                        $("#ab-modal-content").children().each(function () {

                            var item = {
                                "code": $(this).attr("code"),
                                "label": $(this).attr("label"),
                                "subtitle": $(this).attr("subtitle"),
                                "checked": $(this).attr("is-checked")
                            }

                            data.push(item);
                        });

                        _this.hide();

                        if (typeof prop.buttons[0].callback === 'function') {
                            prop.buttons[0].callback.call(null, data);
                        }
                    });
                }
            } else {

                //Para cada item na array list, irá criar 1 item na lista
                for (var i = 0; i < prop.list.length; i++) {
                    let divItem = document.createElement("div");
                    var divSpan = document.createElement("span");
                    divSpan.innerHTML = prop.list[i].text;
                    divSpan.setAttribute("code", prop.list[i].code);
                    divSpan.setAttribute("content", "text");
                    divItem.classList.add("ab-modal-list");
                    divContent.appendChild(divItem);
                    divItem.appendChild(divSpan);

                    //Se tiver subtexto, adiciona texto embaixo do texto principal
                    if (prop.list[i].subtext) {
                        var divParag = document.createElement("p");
                        divParag.innerHTML = prop.list[i].subtext;
                        divParag.setAttribute("content", "subtext");
                        divSpan.appendChild(divParag);
                    }

                    if (prop.callback) {
                        var divIcon = document.createElement("ab-icon-button");
                        divIcon.classList.add("ab-icon-button-seta");
                        divItem.appendChild(divIcon);
                        divItem.setAttribute("order", i);
                        $(divItem).on("tap", function (e) {
                            e.preventDefault();

                            var data = new Object();
                            data.text = $(this).children("[content=text]")[0].childNodes[0].nodeValue;
                            data.subtext = $(this).children("[content=text]").children("[content=subtext]").text();
                            data.code = $(this).children("[content=text]").attr("code");

                            _this.hide();

                            if (prop && typeof prop.callback === 'function') {
                                prop.callback.call(null, data);
                            }
                        });
                    }
                }
                let btnTela = document.createElement("ab-button");
                btnTela.setAttribute("label", "Fechar");
                divButton.appendChild(btnTela);
                $(btnTela).on("tap", function (e) {
                    e.preventDefault();

                    _this.hide();
                });
            }
        }

        $("body").removeFocus();

        setTimeout(function () {
            if (prop && typeof prop.onopen === 'function') {
                prop.onopen.call(null, $(divContent));
            }
        }, 2);
    }

    modalTela(prop) {
        var _this = this;

        this.divBackground.style.backgroundColor = "transparent";

        let divTela = document.createElement("div");
        divTela.classList.add("ab-modal-tela-window");
        this.divBackground.appendChild(divTela);

        let closeTela = document.createElement("span");
        closeTela.classList.add("ab-modal-tela-close");
        closeTela.innerText = "X"
        divTela.appendChild(closeTela);
        $(closeTela).on("tap", function (e) {
            e.preventDefault();

            _this.hide();
        });

        let divTitle = document.createElement("div");
        divTitle.classList.add("ab-modal-tela-title");
        divTitle.innerHTML = prop.title;
        divTela.appendChild(divTitle);

        let divContent = document.createElement("div");
        divContent.classList.add("ab-modal-tela-content");
        divContent.setAttribute("id", "ab-modal-content");
        divTela.appendChild(divContent);

        let divButton = document.createElement("div");
        divButton.classList.add("ab-modal-tela-buttons");
        divTela.appendChild(divButton);

        divContent.innerHTML = prop.text;

        //Cria botoes solicitados
        if (prop.buttons && prop.buttons.length > 0) {
            //Para cada item "buttons" no html, irá criar um botão.
            let btnHeight = 0;
            for (var i = 0; i < prop.buttons.length; i++) {
                let btnTela = document.createElement("ab-button");
                btnTela.setAttribute("label", prop.buttons[i].title);
                btnTela.setAttribute("order", i);
                if (i > 0) {
                    btnTela.setAttribute("theme", "secondary");
                }
                divButton.appendChild(btnTela);
                btnHeight = btnHeight + 64;
                $(btnTela).on("tap", function (e) {
                    e.preventDefault();

                    _this.hide();

                    let order = parseInt($(this).attr("order"));
                    if (typeof prop.buttons[order].callback === 'function') {
                        prop.buttons[order].callback.call(null);
                    }
                });
            }
            divButton.style.height = btnHeight + "px";
            if (btnHeight > 64) {
                divContent.setAttribute("style", "calc(100% - 210px) !important;");
            }
        }

        $("body").removeFocus();

        setTimeout(function () {
            if (prop && typeof prop.onopen === 'function') {
                prop.onopen.call(null, $(divContent));
            }
        }, 2);
    }
}

"use strict";

//component-wrapper: bradesco-input-password-underline
class AbPassword extends AbInput {

    constructor() {
        super();

        this.childClass = "ab-password";
        // this.img = document.createElement("img");
        this.errorChild = false;

        this._addEventChild();
    }

    _renderChild() {
        //Coloca classe principal do objeto
        this.classList.add(this.childClass);

        this.input.setAttribute("type", "password");

        if (this.getAttribute("keyboard") == "number") {
            this.input.setAttribute("pattern", "[0-9]*");
        }

        if (!this.hasAttribute("maxlength")) {
            this.input.setAttribute("maxlength", "10");
        }

    }

    _addEventChild() {
        var _this = this;

        //Ir para o próximo item quando apertar enter
        $(this.input).on("keydown", function (e) {
            return goToNextTabindex(e, $(this), "tap");
        });

    }

    connectedCallback() {
        if (!this.classList.contains(this.childClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            super.connectedCallback();
            this._renderChild();
        }
    }

    static get observedAttributes() {
        return ["id", "error", "is-disabled", "label", "width", "maxlength", "width-on-bigscreen", "tab-index", "goto-tab-index", "value", "visible", "description"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        super.attributeChangedCallback(attrName, oldVal, newVal);

        if (attrName == "description") {
            this.span.innerText = newVal;
        }
    }

}
customElements.define('ab-password', AbPassword);
"use strict";

class AbRadio extends HTMLElement {

    constructor() {
        super();

        this.radioinput = document.createElement("input");
        this.radio = document.createElement("div");
        this.spanLabel = document.createElement("span");
        this.spanSubtitle = document.createElement("span");

        this.mainClass = "ab-radio";

    }

    _render() {
        //coloca classe
        this.classList.add(this.mainClass);

        //Cria um id
        let id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificação do campo. Atributo obrigatório para interagir com o input| Alfanumérico| sim| randomico |
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        //armazena o conteúdo passado no html
        let conteudo = this.innerHTML;
        this.innerHTML = "";

        //Coloca os atributos no objeto
        if (this.hasAttribute("width")) {
            //description: Largura do input.| Alfanumérico| não| 100%|
            this.style.width = this.getAttribute("width");
            this.style.maxWidth = this.getAttribute("width");
        }

        //Obrigatorio checagem abaixo do width
        if (this.hasAttribute("width-on-bigscreen")) {
            //description: Largura do componente em telas maiores| % ou px| não| |
            if (abner.utils.showBigScreen(top.$("body"))) {
                this.style.width = this.getAttribute("width-on-bigscreen");
            }
        }

        //Cria check
        this.radioinput.classList.add("ab-radio-input");
        this.radioinput.setAttribute("type", "radio");
        this.radioinput.setAttribute("name", this.getAttribute("name"));
        this.radioinput.setAttribute("id", id + "rd_radioinput");
        this.appendChild(this.radioinput);

        //Cria objeto
        this.radio.classList.add("ab-radio-radiospace");
        this.radio.setAttribute("id", id + "rd_radio");
        this.appendChild(this.radio);

        //insere o conteúdo no objeto
        this.spanLabel.classList.add("ab-radio-title");
        this.spanLabel.setAttribute("content-area", "true")
        this.spanLabel.setAttribute("id", id + "rd_label");
        if (conteudo) {
            this.spanLabel.innerHTML = conteudo;
        } else {
            if (this.hasAttribute("label")) {
                //description: Label do componente |  | não | |
                this.spanLabel.innerText = this.getAttribute("label");
            }
        }
        this.appendChild(this.spanLabel);

        this.spanSubtitle.classList.add("ab-radio-subtitle");
        this.spanSubtitle.setAttribute("id", id + "rd_subtitle");
        this.spanSubtitle.innerText = this.getAttribute("subtitle");
        this.appendChild(this.spanSubtitle);

        //Define se deverá ser alinhado a direita
        if (this.hasAttribute("position") == "right") {
            //values: left;right
            //description: Posição do input| Position| não| left|
            this.style.float = this.getAttribute("position");
            this.style.paddingRight = "15px";
            this.radio.style.textAlign = "right";
        }

        if (this.getAttribute("is-disabled") == "true") {
            //values: true;false
            //description: Desabilita o campo para alteração.| String| não| vazio|
            this.radio.setAttribute("disabled", "disabled");
            this.classList.add("ab-radio-disabled");
        }

        //verifica se tem max width
        if (this.hasAttribute("max-width")) {
            //description: Largura máxima| px | não| vazio|
            this.style.maxWidth = this.getAttribute("max-width");
        }

        if (this.hasAttribute("subtitle")) {
            //description: Subtitulo do componente| Boolean| não| false|
            this.spanSubtitle.innerText = this.getAttribute("subtitle");
        }

        if (this.getAttribute("is-checked") == "true") {
            //values: true;false
            //description: Define se o input estará selecionado ou não| Boolean| não| false|
            this.radioinput.setAttribute("checked", true);
        }

        //Limpa variaveis
        id = null;
        conteudo = null;
    }

    _addEvent() {
        var _this = this;
        $(this).on("tap", function (e) {
            e.preventDefault();

            if (_this.getAttribute("is-disabled") != "true") {
                _this.radioinput.checked = true;

                if (_this.hasAttribute("onchange")) {
                    var fn = window[_this.getAttribute("onchange")];
                    if (typeof fn === 'function') {
                        fn.call($(_this));
                    }
                }
            };
        });
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({ mode: 'open' }); */
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return ["is-disabled", "width", "width-on-bigscreen", "id", "subtitle", "label", "name", "is-checked"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "is-disabled":
                if (newVal == "true") {
                    this.radio.setAttribute("disabled", "disabled");
                    this.classList.add("ab-radio-disabled");
                } else {
                    this.radio.removeAttribute("disabled");
                    this.classList.remove("ab-radio-disabled");
                }
                break;
        
            case "width":
                this.style.width = newVal;
                break;
        
            case "width-on-bigscreen":
                if (abner.utils.showBigScreen(top.$("body"))) {
                    this.style.width = newVal;
                }
                break;
        
            case "id":
                this.radioinput.setAttribute("id", newVal + "rd_radioinput");
                this.radio.setAttribute("id", newVal + "rd_radio");
                this.spanLabel.setAttribute("id", newVal + "rd_label");
                this.spanSubtitle.setAttribute("id", newVal + "rd_subtitle");
                break;
        
            case "subtitle":
                this.spanSubtitle.innerText = newVal;
                break;
        
            case "label":
                this.spanLabel.innerText = newVal;
                break;
        
            case "name":
                this.radioinput.setAttribute("name", newVal);
                break;
        
            case "is-checked":
                if (newVal == "true") {
                    this.radioinput.checked = true;
                }
                break;
        
            default:
                break;
        }
    }

    setText(text) {
        
        this.spanLabel.innerHTML = text;
    }

    getText() {

        return this.spanLabel.innerText;
    }

    setNumber(text) {
        
        if (text == 1 || text == true) {
            this.radioinput.checked = true;
        } else {
            this.radioinput.checked = false;
        }

    }

    getNumber() {

        if (this.radioinput.checked == true) {
            return "1";
        } else {
            return "0";
        }
    }
}
customElements.define("ab-radio", AbRadio);
"use strict";

$(document).ready(function () {
    //funcao para corrigir o data
    $.fn.fillSelect = function (selectArr, callback) {
        this[0].fillSelect(selectArr, callback);

        var fn = window[callback];
        if (typeof fn === 'function') {
            fn.call(null);
        } else if (typeof callback === 'function') {
            callback.call(null);
        }
    };


});

class AbSelect extends HTMLElement {

    constructor() {
        super();

        this.label = document.createElement("label");
        this.select = document.createElement("select");
        this.option = document.createElement('option');
        this.img = document.createElement("img");
        this.legend = document.createElement("legend");

        this.mainClass = "ab-select";

    }

    _render() {
        //Cria um id
        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificador único do objeto, com prefixo "sel"| Alfanumérico |não| randômico|
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        this.classList.add(this.mainClass);

        //no caso do combo ja fica mimificado
        this.classList.add("ab-select-min");

        //Coloca Label
        this.label.classList.add("ab-select-label");
        this.label.setAttribute("id", id + "sl_label");
        this.label.setAttribute("for", id + "sl_input");
        this.appendChild(this.label);

        if (this.hasAttribute("label")) {
            //description: Colocar uma descrição que represente o valor que será colocado no input da página| Alfanumérico| não| vazio|
            this.label.innerText = this.getAttribute("label");
        };

        //Cria o combo
        this.select.classList.add("ab-select-select");
        this.select.setAttribute("id", id + "sl_input")
        this.appendChild(this.select);

        //onfocus no objeto
        if (this.hasAttribute("onfocus")) {
            this.select.setAttribute("onfocus", this.getAttribute("onfocus"));
        }

        //preenche combo
        this.option.setAttribute("selected", true);
        this.option.setAttribute("value", "");
        this.option.innerText = "Selecione";
        this.appendChild(this.select);

        //coloca cor no label
        if (this.hasAttribute("width")) {
            //description: Largura do select. | Alfanumérico | não | 100% |
            this.style.width = this.getAttribute("width");
        }

        //verifica width-on-bigscreen
        if (this.hasAttribute("width-on-bigscreen")) {
            //description: Largura do componente em telas maiores| % ou px| não| |
            if (pmb.utils.showBigScreen(top.$("body"))) {
                this.style.width = this.getAttribute("width-on-bigscreen");
            }
        }

        //desabilitar o campo quando o atributo is-disabled é true
        if (this.getAttribute("is-disabled") == "true") {
            //values: true;false
            //description: Desabilita o campo para alteração. | Booleano | não | vazio |
            this.select.setAttribute("disabled", true);
        }

        //coloca tabindex
        if (this.hasAttribute("tab-index")) {
            //description: Ordem de tabulação na página. | Numérico | não | vazio |
            this.select.setAttribute("tabindex", this.getAttribute("tab-index"));
        }

        //para qual index vai
        if (this.hasAttribute("goto-tab-index")) {
            this.select.setAttribute("goto-tab-index", this.getAttribute("goto-tab-index"));
        }

        //para qual index vai
        if (this.hasAttribute("stop-tab-index")) {
            this.select.setAttribute("stop-tab-index", this.getAttribute("stop-tab-index"));
        }

        //Mesmo comportamento porém com outro nome de atributo, necessário ajustar todos projetos que usam o de cima
        if (this.getAttribute("visible") == "false") {
            //values: true;false
            this.style.display = "none";
        }

        //Coloca mensagem de erro 
        this.legend.classList.add("ab-select-span");
        this.legend.setAttribute("id", id + "sl_span");
        if (this.hasAttribute("error")) {
            this.legend.innerText = this.getAttribute("error");
            this.classList.add("ab-select-error");
        } else {
            //se tiver descrição
            if (this.hasAttribute("description")) {
                this.legend.innerText = this.getAttribute("description");
            };
        }
        this.appendChild(this.legend);

        this.img.classList.add("ab-select-seta");
        this.img.setAttribute("src", "object/ab-select/img/seta-baixo.svg");
        this.appendChild(this.img);

        //Limpar variaveis
        id = null;
    }

    _addEvent() {

        var selectEl = $(this.select);

        //Ao sair ele volta o label ou deixa o valor
        selectEl.on("blur", function () {
            var _this = this.parentElement;
            //tira classe que mostra focus
            _this.classList.remove("ab-select-focus");

            //Na checar conteudo
            _this.setAttribute("cancel-onchange", "true");
            $(this).trigger("change");

            //Chama a funcao que colcou no onblur
            if (_this.hasAttribute("onblur")) {
                var fn = window[_this.getAttribute("onblur")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
            _this = null;
        });

        //na mudanca
        selectEl.on("change", function () {
            var _this = this.parentElement;
            //verifica se o campo é obrigatório
            if (_this.getAttribute("is-required") == "true") {
                //values: true;false
                if (_this.getSelected(this)) {
                    _this.removeAttribute("error");
                } else {
                    _this.setAttribute("error", "Campo obrigatório");
                }
            }

            //Chama a funcao que colcou no onchange
            if (_this.hasAttribute("onchange") && _this.getAttribute("cancel-onchange") != "true") {
                var functionsArray = _this.getAttribute("onchange").split(";");

                for (var i = 0; i < functionsArray.length; i++) {
                    var fn = window[functionsArray[i].trim()];
                    if (typeof fn === 'function') {
                        fn.call($(_this));
                    } else {
                        functionsArray[i];
                    }
                }
            }
            _this.removeAttribute("cancel-onchange");

            //Chama a funcao que colcou no onblur
            if (_this.hasAttribute("onvalidate")) {
                var fn = window[_this.getAttribute("onvalidate")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
            _this = null;
        });

        selectEl.on("focus", function (e) {
            var _this = this.parentElement;
            //e.preventDefault();
            //e.stopPropagation();

            //mostra que esta com focu
            _this.classList.add("ab-select-focus");
            _this = null;
        });

        //Ir para o próximo item quando apertar enter
        selectEl.on("keydown", function (event) {
            var _this = this.parentElement;
            return goToNextTabindex(event, $(_this), "tap");
            _this = null;
        });
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
            this._addEvent();
        }
    }

    static get observedAttributes() {
        return ["error", "is-disabled", "label", "width", "id", "width-on-bigscreen", "tab-index", "goto-tab-index", "description", "icon", "visible"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        switch (attrName) {
            case "error":
                if (newVal != undefined && newVal != null) {
                    this.legend.innerText = newVal;
                    this.classList.add("ab-select-error");
                } else {
                    this.legend.innerText = "";
                    if (this.hasAttribute("description")) {
                        this.legend.innerText = this.getAttribute("description");
                    }
                    this.classList.remove("ab-select-error");
                }
                break;

            case "is-disabled":
                if (newVal == "true") {
                    this.select.setAttribute("disabled", true);
                    this.removeAttribute("error");
                } else {
                    this.select.removeAttribute("disabled");
                }
                break;

            case "label":
                this.label.innerText = newVal;
                break;

            case "width":
                this.style.width = newVal;
                break;

            case "id":
                if (oldVal != null) {
                    this.img.setAttribute("id", newVal + "sl_img");
                    this.label.setAttribute("for", newVal + "sl_input");
                    this.label.setAttribute("id", newVal + "sl_label");
                    this.select.setAttribute("id", newVal + "sl_input");
                    this.legend.setAttribute("id", newVal + "sl_span");
                }
                break;

            case "width-on-bigscreen":
                if (pmb.utils.showBigScreen(top.$("body"))) {
                    this.style.width = newVal;
                }
                break;

            case "tab-index":
                this.select.setAttribute("tabindex", newVal);
                break;

            case "goto-tab-index":
                this.select.setAttribute("goto-tab-index", newVal);
                break;

            case "description":
                if (newVal) {
                    this.legend.innerText = newVal;
                }
                break;

            case "icon":
                obj.children("#" + id + "sl_img").remove();

                var img = $("<img />");
                img.attr("id", id + "sl_img");

                //Coloca icone
                if (obj.attr("error")) {
                    if (obj.attr("error-icon")) {
                        img.attr("src", obj.attr("error-icon"));
                    } else {
                        img.attr("src", obj.attr("icon"));
                    }
                } else {
                    img.attr("src", obj.attr("icon"));
                }

                img.appendTo(obj);
                img = null;

                //Muda estilo com imagem
                this.classList.add("ab-select-img");
                break;

            case "visible":
                if (newVal == "true") {
                    this.style.display = "block";
                } else if (newVal == "false") {
                    this.style.display = "none";
                }
                break;
        
            default:
                break;
        }
    }

    setText(text) {

    }

    getText() {
        let index = this.select.options.selectedIndex;
        if (index == -1) {
            return "";
        } 

        return this.select.options[index].value;
    }

    setNumber(text) {

    }

    getNumber() {
        let index = this.select.options.selectedIndex;
        if (index == -1) {
            return "";
        } 

        return parseInt(this.select.options[index].value);
    }

    getSelected(select) {
        var selectedIndex = select.options.selectedIndex;

        if (selectedIndex == -1) {
            return false;
        }

        if (select.options[selectedIndex].value == "") {
            return false;
        } else {
            return true;
        }
    }

    fillSelect(selectArr) {
        if (!selectArr) {
            return;
        }

        //bloqueia combo
        $(this.select).block();

        //limpa combo
        this.select.innerHTML = "";

        //preenche combo
        var optionsArray = [];
        optionsArray.push(option);
        for (var i = 0; i < selectArr.length; i++) {
            optionsArray.push("<option value='" + selectArr[i].valor + "'>" + selectArr[i].nome + "</option>");
        }
        this.select.innerHTML = optionsArray.join("");

        var option = document.createElement("OPTION");
        option.setAttribute("selected", true);
        option.setAttribute("value", "");
        option.innerHTML = "Selecione";
        this.select.prepend(option);

        $(this.select).unblock();
    };

}

customElements.define('ab-select', AbSelect);
"use strict";

class AbText extends AbInput {

    constructor() {
        super();

        this.childClass = "ab-text";
        this.errorChild = false;

        this.abner = new AbnerUtils();

        this._addEventChild();
    }

    _renderChild() {
        //adiciona class
        this.classList.add(this.childClass);
    }

    _addEventChild() {
        var input = $(this.input);
        var _this = this;
        var abner = new AbnerUtils();

        //evento change quando alterar o valor do input
        input.on("change", function (e) {
            e.preventDefault();

            if (_this.getAttribute("letters-only") == "true" && this.value.length > 0) {
                var text = abner.removeAccent(this.value);
                this.value = text;
                var textmatch = this.value.match(/^[A-Za-z ]+$/);
                if (textmatch == null) {
                    _this.setAttribute("error", "É permitido apenas letras");
                    this.errorChild = true;
                } else {
                    if (!this.errorParent) {
                        _this.removeAttribute("error");
                    }
                    this.errorChild = false;
                }
            };
        });
    }

    connectedCallback() {
        if (!this.classList.contains(this.childClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            super.connectedCallback();
            this._renderChild();
        }
    }

    static get observedAttributes() {
        return ['id', 'error', 'is-disabled', 'label', 'width', 'maxlength', 'width-on-bigscreen', 'tab-index', 'goto-tab-index', 'value'];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        super.attributeChangedCallback(attrName, oldVal, newVal);
    }

}

customElements.define('ab-text', AbText);
"use strict";

class AbTextReadOnly extends HTMLElement {

    constructor() {
        super();

        this.label = document.createElement("legend");
        this.text = document.createElement("p");

        this.mainClass = "ab-text-read-only";
    }

    _render() {
        //Cria um id
        var id = generateID();
        if (this.hasAttribute("id")) {
            //description: Identificação do componente. Atributo obrigatório para interagir com o objeto | Alfanumérico | sim | vazio |
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        };

        var contentHtml = this.innerHTML ;
        this.innerHTML = "";

        //coloca classe
        this.classList.add(this.mainClass);

        //width
        if (this.hasAttribute("width")) {
            //description: Define a largura do componente| % ou px| não| |
            this.style.width = this.getAttribute("width");
        };

        //verifica width-on-bigscreen
        if (this.hasAttribute("width-on-bigscreen")) {
            //description: Define a largura do componente em telas maiores| % ou px| não| |
            if (abner.utils.showBigScreen(top.$("body"))) {
                this.classList.add("ab-text-read-only-bigscreen")
                this.style.width = this.getAttribute("width-on-bigscreen");
            } else {
                this.classList.remove("ab-text-read-only-bigscreen")
            }
        };

        //Coloca Label
        this.label.setAttribute("id", id + "label");

        if (this.hasAttribute("label")) {
            //description: Colocar uma descrição que represente o valor que será colocado no input da página | Alfanumérico | não | vazio |
            this.label.innerText = this.getAttribute("label");
        }
        this.appendChild(this.label);

        //Coloca Input
        this.text.classList.add("ab-paragrafo-medio");
        this.text.setAttribute("id", id + "text");
        if (contentHtml.length > 0) {
            this.text.innerHTML = contentHtml;
        }
        this.appendChild(this.text);

        //visible
        if (this.getAttribute("visible") == "false") {
            //values: true;false
            //description: Define se o componente estará visível | Boolean | não| true |
            this.style.display = "none";
        };

        //limpa variaveis
        id = null;
        contentHtml = null;
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["label", "id", "width", "width-on-bigscreen", "visible"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "label":
                this.label.innerText = newVal;
                break;
    
            case "id":
                this.label.setAttribute("id", newVal + "label");
                this.text.setAttribute("id", newVal + "text");
                break;
    
            case "width":
                this.style.width = newVal;
                break;
    
            case "width-on-bigscreen":
                if ($("ab-page").attr("fullscreen") == "true"){
                    this.style.width = this.getAttribute("width-on-bigscreen");
                }
                break;
    
            case "visible":
                if (newVal == "true") {
                    this.style.display = "inline-block";
                } else if (newVal == "false") {
                    this.style.display = "none";
                }
                break;
        
            default:
                break;
        }
    }

    setText(text) {
        this.text.innerHTML = text;
    }

    getText() {
        return this.text.innerText;
    }

    getText() {
        return this.text.innerText;
    }

    setHtml() {

    }
}
customElements.define('ab-text-read-only', AbTextReadOnly);
"use strict";

class AbTextAreaUnderline extends HTMLElement {

    constructor() {
        super();

        this.textarea = document.createElement("textarea");
        this.label = document.createElement("label");
        this.span = document.createElement("span");

        this.mainClass = "ab-text-area-underline";

        this._addEvent();
    }

    _render() {
        //Cria um id
        var id = generateID();
        if (this.hasAttribute("id")) {
            id = this.getAttribute("id");
        } else {
            this.setAttribute("id", id);
        }

        //coloca classe
        this.classList.add(this.mainClass);

        if (!this.hasAttribute("max-rows")) {
            this.setAttribute("max-rows", "20");
        }

        //width
        if (this.hasAttribute("width")) {
            //description: Define a largura do componente | % ou px | não | 100% |
            this.style.width = this.getAttribute("width");
        }

        //Obrigatorio checagem abaixo do width
        if (this.hasAttribute("width-on-bigscreen")) {
            if (pmb.utils.showBigScreen(top.$("body"))) {
                this.style.width = obj.attr("width-on-bigscreen");
            }
        }

        //Coloca Textarea
        this.appendChild(this.textarea);
        this.textarea.setAttribute("id", id + "txa_input");

        //onfocus no objeto
        if (this.hasAttribute("onfocus")) {
            this.textarea.setAttribute("onfocus", this.getAttribute("onfocus"));
        }

        if (this.hasAttribute("maxlength")) {
            //description: Define a quantidade máxima de caracteres a ser digitado no campo | numeric | não | 
            this.textarea.setAttribute("maxlength", this.getAttribute("maxlength"));
        }

        if (this.hasAttribute("rows")) {
            //description: Define a quantidade de linhas da exibição do campo | numeric | não | 1 |
            this.textarea.setAttribute("rows", this.getAttribute("rows"));
        } else {
            this.textarea.setAttribute("rows", "1");
        }

        //Coloca label
        this.appendChild(this.label);
        this.label.setAttribute("id", id + "txa_label");
        this.label.setAttribute("for", id + "txa_input");

        if (this.hasAttribute("label")) {
            //description: Define o texto que será apresentado como label do campo | varchar | não | |
            this.label.innerText = this.getAttribute("label");
        };

        //Coloca mensagem de erro 
        this.appendChild(this.span);
        this.span.setAttribute("id", id + "txa_span");

        if (this.hasAttribute("error")) {
            //description: Define mensagem de erro caso o campo esteja inválido | varchar | não | |
            this.span.innerText = this.getAttribute("error");
            this.classList.add("ab-text-area-underline-error");
        }

        //desabilitar o campo quando o atributo is-disabled é true
        if (this.getAttribute("is-disabled") == "true") {
            //values: true;false
            //description: Define se o campo estará desativado | true ou false | não | false |
            this.textarea.setAttribute("disabled", true);
        }

        if (this.hasAttribute("max-width")) {
            //description: Define a largura máxima do componente | % ou px | não | 100% |
            this.style.maxWidth = this.getAttribute("max-width");
        }

        //coloca tabindex
        if (this.hasAttribute("tab-index")) {
            //description: Ordem de tabulação na página.| Numérico| não| vazio|
            this.textarea.setAttribute("tabindex", this.getAttribute("tab-index"));
        }

        //para qual index vai
        if (this.hasAttribute("goto-tab-index")) {
            this.textarea.setAttribute("goto-tab-index", this.getAttribute("goto-tab-index"));
        }

        //para qual index vai
        if (this.hasAttribute("stop-tab-index")) {
            this.textarea.setAttribute("stop-tab-index", this.getAttribute("stop-tab-index"));
        }

        /*
        DATA BINDING
        WORK IN PROGRESS
        USE AT YOUR OWN RISK
        BE AWARE OF DRAGONS
        - GABS 02/10/2019
        */

        if (this.hasAttribute("data-binding-obj")) {
            this.createDataBinding();
        }

    }

    _addEvent() {
        var textarea = $(this.textarea);
        var _this = this;

        textarea.on("keyup", function (event) {
            if (_this.getAttribute("auto-height") == "true") {
                while ($(this)[0].scrollHeight > $(this)[0].offsetHeight) {
                    var rows = this.getAttribute("rows");
                    var maxRow = _this.getAttribute("max-rows");
                    rows++;
                    if (rows >= maxRow) {
                        break
                    } else {
                        this.setAttribute("rows", rows);
                    }
                }
            }

            //Ir para o próximo item quando apertar enter
            return goToNextTabindex(event, $(this), "focus");
        });

        textarea.on("blur", function () {
            //BugIOS Retira a marcacao do foco
            _this.removeAttribute("focus-executed");

            //Triga as validações
            _this.setAttribute("cancel-onchange", "true");
            $(this).trigger("change");

            //Chama a funcao que colcou no onblur
            if (_this.hasAttribute("onblur")) {
                var fn = window[_this.getAttribute("onblur")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
        });

        textarea.on("focus", function (e) {
            //BugIOS
            if (_this.getAttribute("focus-executed") == "true") {
                return false;
            }
            _this.setAttribute("focus-executed", "true");

            e.preventDefault();
            e.stopPropagation();

            if (_this.getAttribute("is-disabled") != "true") {
                //Coloca foco no input
                _this.classList.add("ab-text-area-underline-min");

                $(this).setCursorPosition($("textarea")[0].value.length);

                //Arruma scroll no mobile quando sobe o teclado para ANDROID
                if (window.isAndroid) {
                    setTimeout(function () {
                        _this.scrollIntoView();
                    }, 500);
                }
            }

            //Chama a funcao que colocou no onfocus
            if (_this.hasAttribute("onfocus")) {
                var fn = window[_this.getAttribute("onfocus")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
        });

        //evento change quando alterar o valor do input
        textarea.on("change", function (e) {
            e.preventDefault();
            e.stopPropagation();

            if (this.value == "" || this.value == null) {
                if (_this.getAttribute("focus-executed") != "true") {
                    _this.classList.remove("ab-text-area-underline-min");
                }

                if (_this.hasAttribute("rows")) {
                    this.setAttribute("rows", _this.getAttribute("rows"));
                } else {
                    this.setAttribute("rows", "1");
                }
            } else {
                _this.classList.add("ab-text-area-underline-min");
            }

            //verifica se o campo é obrigatório
            if (_this.getAttribute("is-required") == "true") {
                //values: true;false
                //description: Define se o campo será obrigatório | true ou false | não | false |
                if (this.value.length == 0) {
                    _this.setAttribute("error", "Campo obrigatório");
                } else {
                    _this.removeAttribute("error");
                }
            }

            //se tiver ajuste
            if (_this.getAttribute("auto-height") == "true") {
                while ($(this)[0].scrollHeight > $(this)[0].offsetHeight) {
                    var rows = this.getAttribute("rows");
                    var maxRow = _this.getAttribute("max-rows");
                    rows++;
                    this.setAttribute("rows", rows);
                    if (rows >= maxRow) {
                        break
                    }
                }
            }

            //Chama a funcao que colcou no onblur
            if (_this.hasAttribute("onchange") && _this.getAttribute("cancel-onchange") != "true") {
                var fn = window[_this.getAttribute("onchange")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
            _this.removeAttribute("cancel-onchange");

            //Chama a funcao que colcou no onblur
            if (_this.hasAttribute("onvalidate")) {
                var fn = window[_this.getAttribute("onvalidate")];
                if (typeof fn === 'function') {
                    fn.call($(_this));
                }
            }
        });
    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["error", "is-disabled", "label", "id", "width", "maxlength", "rows"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {

        switch (attrName) {
            case "error":
                if (newVal != undefined && newVal != null) {
                    this.span.innerText = newVal;
                    this.classList.add("ab-text-area-underline-error");

                    /*if (this.hasAttribute("error-icon")) {
                        obj.children("#" + id + "txa_img").attr("src", obj.attr("error-icon"));
                    }*/
                } else {
                    this.classList.remove("ab-text-area-underline-error");
                    this.span.innerText = "";

                    /*if (obj.attr("icon")) {
                        obj.children("#" + id + "txa_img").attr("src", obj.attr("icon"));
                    }*/
                }
                break;

            case "is-disabled":
                //quando o atributo is-disabled é alterado, adiciona ou retira a classe underline-min
                if (newVal == "true") {
                    this.classList.add("ab-text-area-underline-min");
                    this.textarea.setAttribute("disabled", true);
                } else {
                    if (this.textarea.value == "") {
                        this.classList.remove("ab-text-area-underline-min");
                    }
                    this.textarea.removeAttribute("disabled");
                }
                break;

            case "label":
                this.label.innerText = newVal;
                break;

            case "id":
                this.textarea.setAttribute("id", newVal + "txa_input");
                this.label.setAttribute("for", newVal + "txa_input");
                this.label.setAttribute("id", newVal + "txa_label");
                this.span.setAttribute("id", newVal + "txa_span");
                break;

            case "width":
                this.style.width = newVal;
                break;

            case "maxlength":
                this.textarea.setAttribute("maxlength", newVal);
                break;

            case "rows":
                this.textarea.setAttribute("rows", newVal);
                break;

            case "data-binding-obj":
                this.createDataBinding(obj);
                break;
        
            default:
                break;
        }
    }

    createDataBinding() {

        new pmb.utils.DataBinding({
            object: this.getAttribute("data-binding-obj")
        })
        .addBinding(this.textarea, "value", "change");

    }

    setText(text) {
        this.textarea.value = text;
        if (text.length > 0) {
            this.classList.add("ab-text-area-underline-min");
        }
    }

    getText() {
        return this.textarea.value;
    }
}

customElements.define('ab-text-area-underline', AbTextAreaUnderline);
"use strict";

$.fn.incrementRequest = function () {
    var curr = 0;
    if (this.attr("current-request")) {
        curr = parseInt(this.attr("current-request"));
    }

    curr++;
    this.attr("current-request", curr);
}

$.fn.resetRequest = function () {
    this.removeAttr("current-request");
}

class AbPage extends HTMLElement {

    constructor() {
        super();

        this.htmlObj = $("html,body")[0];

        //pageLoader
        this.pageLoad = document.createElement("div");
        this.wrapper = document.createElement("div");
        this.loadBar = document.createElement("div");
        this.barRange = document.createElement("div");
        this.loadText = document.createElement("p");

        this.mainClass = "ab-page";
    }

    _render() {
        this.classList.add(this.mainClass);

        //Cria um id
        if (!this.hasAttribute("id")) {
            //description: Atributo para identificar o objeto| Alfanumérico| não| vazio|
            this.setAttribute("id", generateID());
        }

        // parametros
        if (this.getAttribute("fullscreen") != "false") {
            //values: true;false
            //description: Usa o tamanho total da tela | true ou false | não | true |
            this.htmlObj.style.margin = "0px";
            this.htmlObj.style.padding = "0px";
            this.htmlObj.style.width = "100%";
            this.htmlObj.style.height = "100%";

            this.style.top = "0px";
            this.style.left = "0px";
            this.style.bottom = "0px";
            this.style.right = "0px";
            this.style.height = "100%";
            this.style.width = "100%";
            this.style.position = "fixed";
        } else{
            $(this).addClass("page--limited");
        }

        // Valor padrao
        this.style.zIndex = "0";

        //se existir um max-request, construir o sistema de load
        if (this.hasAttribute("max-request")) {
            //description: Máximo de requests que terá na página para o loader | Numérico | não | 0 |
            this._createLoader();
        } else{
            document.querySelector("html").classList.add("html-page-loaded");
        }

    }

    connectedCallback() {
        if (!this.classList.contains(this.mainClass)) {
            /*this.shadowDom = this.attachShadow({
                mode: 'open'
            }); */
            this._render();
        }
    }

    static get observedAttributes() {
        return ["loader-visibility", "current-request"];
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
        if (attrName == "loader-visibility") {
            if (newVal != "true") {
                $(this.logo).fadeOut(100, function () {
                    this.remove();
                });

                $(this.pageLoad).fadeOut(100, function () {
                    this.remove();
                });
            } else if (this.pageLoad.length == 0) {
                this._createLoader();
            } else {
                $(this.pageLoad).fadeIn(100);
            }

        } else if (attrName == "current-request") {
            var reqAtual = parseInt(newVal);
            var reqMax = parseInt(this.getAttribute("max-request"));
            var total = ((100 / reqMax) * reqAtual);

            this.barRange.style.width = total + "%";

            if (total >= 100) {
                this.setAttribute("loader-visibility", "false");
                document.querySelector("html").classList.add("html-page-loaded");
            }

            reqAtual = null;
            reqMax = null;
            total = null;
        }
    }

    _createLoader() {

        this.pageLoad.classList.add("ab-page-loader");
        this.pageLoad.setAttribute("id", "ab-page-loader");
        this.pageLoad.style.display = "block";
        this.appendChild(this.pageLoad);

        this.wrapper.classList.add("ab-page-loader-wrapper");
        this.pageLoad.appendChild(this.wrapper);

        this.loadBar.classList.add("ab-page-loader-path");
        this.wrapper.appendChild(this.loadBar);

        this.barRange.classList.add("ab-page-loader-range");
        this.barRange.setAttribute("id", "ab-page-loader-range");
        this.loadBar.appendChild(this.barRange);

        this.loadText.classList.add("ab-page-loader-text");
        this.loadText.innerText = "carregando...";
        this.wrapper.appendChild(this.loadText);
    }
}
customElements.define('ab-page', AbPage);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFiLXN1cHBvcnQvanMvYWItZml4LmpzIiwiYWItc3VwcG9ydC9qcy9hYi11dGlsLmpzIiwiYWItYmxvY2svanMvYWItYmxvY2suanMiLCJhYi1ib3gvanMvYWItYm94LmpzIiwiYWItYnV0dG9uL2pzL2FiLWJ1dHRvbi5qcyIsImFiLWNoZWNrYm94L2pzL2FiLWNoZWNrYm94LmpzIiwiYWItaGVhZGVyL2pzL2FiLWhlYWRlci5qcyIsImFiLWlucHV0L2pzL2FiLWlucHV0LmpzIiwiYWItbWVudS9qcy9hYi1tZW51LmpzIiwiYWItbW9kYWwvanMvYWItbW9kYWwuanMiLCJhYi1wYXNzd29yZC9qcy9hYi1wYXNzd29yZC5qcyIsImFiLXJhZGlvL2pzL2FiLXJhZGlvLmpzIiwiYWItc2VsZWN0L2pzL2FiLXNlbGVjdC5qcyIsImFiLXRleHQvanMvYWItdGV4dC5qcyIsImFiLXRleHQtcmVhZC1vbmx5L2pzL2FiLXRleHQtcmVhZC1vbmx5LmpzIiwiYWItdGV4dC1hcmVhLXVuZGVybGluZS9qcy9hYi10ZXh0LWFyZWEtdW5kZXJsaW5lLmpzIiwiYWItcGFnZS9qcy9hYi1wYWdlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0VEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3aENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDelBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25QQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2x5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNWRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDblpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IndlYmNvbXAuYWJuZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vVmVyZmljYSBTaXN0ZW1hIE9wZXJhY2lvbmFsXG53aW5kb3cuaXNJT1MgPSAoL2lQYWR8aVBob25lfGlQb2QvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSB8fCAobmF2aWdhdG9yLnBsYXRmb3JtID09PSAnTWFjSW50ZWwnICYmIG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyA+IDEpKSAmJiAhd2luZG93Lk1TU3RyZWFtO1xud2luZG93LmlzQW5kcm9pZCA9IC8oYW5kcm9pZCkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xud2luZG93LmlzRGVza3RvcCA9ICF3aW5kb3cuaXNJT1MgJiYgIXdpbmRvdy5pc0FuZHJvaWQ7XG5cbihmdW5jdGlvbih3LCAkLCB1bmRlZmluZWQpIHtcblxuICAgIHcudGFwSGFuZGxpbmcgPSBmYWxzZTtcbiAgICB3LnRhcHB5ID0gdHJ1ZTtcblxuICAgIHZhciB0YXAgPSBmdW5jdGlvbigkZWxzKSB7XG4gICAgICAgIHJldHVybiAkZWxzLmVhY2goZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgIHJlc2V0VGltZXIsXG4gICAgICAgICAgICAgICAgc3RhcnRZLFxuICAgICAgICAgICAgICAgIHN0YXJ0WCxcbiAgICAgICAgICAgICAgICBjYW5jZWwsXG4gICAgICAgICAgICAgICAgc2Nyb2xsVG9sZXJhbmNlID0gMTA7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRyaWdnZXIoZSkge1xuICAgICAgICAgICAgICAgICQoZS50YXJnZXQpLnRyaWdnZXIoXCJ0YXBcIiwgW2UsICQoZS50YXJnZXQpLmF0dHIoXCJocmVmXCIpXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENvb3JkcyhlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV2ID0gZS5vcmlnaW5hbEV2ZW50IHx8IGUsXG4gICAgICAgICAgICAgICAgICAgIHRvdWNoZXMgPSBldi50b3VjaGVzIHx8IGV2LnRhcmdldFRvdWNoZXM7XG5cbiAgICAgICAgICAgICAgICBpZiAodG91Y2hlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3RvdWNoZXNbMF0ucGFnZVgsIHRvdWNoZXNbMF0ucGFnZVldO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gc3RhcnQoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLnRvdWNoZXMgJiYgZS50b3VjaGVzLmxlbmd0aCA+IDEgfHwgZS50YXJnZXRUb3VjaGVzICYmIGUudGFyZ2V0VG91Y2hlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgY29vcmRzID0gZ2V0Q29vcmRzKGUpO1xuICAgICAgICAgICAgICAgIHN0YXJ0WCA9IGNvb3Jkc1swXTtcbiAgICAgICAgICAgICAgICBzdGFydFkgPSBjb29yZHNbMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGFueSB0b3VjaHNjcm9sbCB0aGF0IHJlc3VsdHMgaW4gPiB0b2xlcmFuY2Ugc2hvdWxkIGNhbmNlbCB0aGUgdGFwXG4gICAgICAgICAgICBmdW5jdGlvbiBtb3ZlKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29vcmRzID0gZ2V0Q29vcmRzKGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29vcmRzICYmIChNYXRoLmFicyhzdGFydFkgLSBjb29yZHNbMV0pID4gc2Nyb2xsVG9sZXJhbmNlIHx8IE1hdGguYWJzKHN0YXJ0WCAtIGNvb3Jkc1swXSkgPiBzY3JvbGxUb2xlcmFuY2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlbmQoZSkge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChyZXNldFRpbWVyKTtcbiAgICAgICAgICAgICAgICByZXNldFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdy50YXBIYW5kbGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcblxuICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBubyBtb2RpZmllcnMgYXJlIHByZXNlbnQuIHRoeCBodHRwOi8vd3d3LmphY2tsbW9vcmUuY29tL25vdGVzL2NsaWNrLWV2ZW50cy9cbiAgICAgICAgICAgICAgICBpZiAoKGUud2hpY2ggJiYgZS53aGljaCA+IDEpIHx8IGUuc2hpZnRLZXkgfHwgZS5hbHRLZXkgfHwgZS5tZXRhS2V5IHx8IGUuY3RybEtleSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgLy8gdGhpcyBwYXJ0IHByZXZlbnRzIGEgZG91YmxlIGNhbGxiYWNrIGZyb20gdG91Y2ggYW5kIG1vdXNlIG9uIHRoZSBzYW1lIHRhcFxuXG4gICAgICAgICAgICAgICAgLy8gaWYgYSBzY3JvbGwgaGFwcGVuZWQgYmV0d2VlbiB0b3VjaHN0YXJ0IGFuZCB0b3VjaGVuZFxuICAgICAgICAgICAgICAgIGlmIChjYW5jZWwgfHwgdy50YXBIYW5kbGluZyAmJiB3LnRhcEhhbmRsaW5nICE9PSBlLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3LnRhcEhhbmRsaW5nID0gZS50eXBlO1xuICAgICAgICAgICAgICAgIHRyaWdnZXIoZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRlbFxuICAgICAgICAgICAgICAgIC5iaW5kKFwidG91Y2hzdGFydC50YXBweSBNU1BvaW50ZXJEb3duLnRhcHB5XCIsIHN0YXJ0KVxuICAgICAgICAgICAgICAgIC5iaW5kKFwidG91Y2htb3ZlLnRhcHB5IE1TUG9pbnRlck1vdmUudGFwcHlcIiwgbW92ZSlcbiAgICAgICAgICAgICAgICAuYmluZChcInRvdWNoZW5kLnRhcHB5IE1TUG9pbnRlclVwLnRhcHB5XCIsIGVuZClcbiAgICAgICAgICAgICAgICAuYmluZChcImNsaWNrLnRhcHB5XCIsIGVuZCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgdW50YXAgPSBmdW5jdGlvbigkZWxzKSB7XG4gICAgICAgIHJldHVybiAkZWxzLnVuYmluZChcIi50YXBweVwiKTtcbiAgICB9O1xuXG4gICAgLy8gdXNlIHNwZWNpYWwgZXZlbnRzIGFwaVxuICAgIGlmICgkLmV2ZW50ICYmICQuZXZlbnQuc3BlY2lhbCkge1xuICAgICAgICAkLmV2ZW50LnNwZWNpYWwudGFwID0ge1xuICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihoYW5kbGVPYmopIHtcbiAgICAgICAgICAgICAgICB0YXAoJCh0aGlzKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihoYW5kbGVPYmopIHtcbiAgICAgICAgICAgICAgICB1bnRhcCgkKHRoaXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBtb25rZXliaW5kXG4gICAgICAgIHZhciBvbGRCaW5kID0gJC5mbi5iaW5kLFxuICAgICAgICAgICAgb2xkVW5iaW5kID0gJC5mbi51bmJpbmQ7XG4gICAgICAgICQuZm4uYmluZCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgaWYgKC8oXnwgKXRhcCggfCQpLy50ZXN0KGV2dCkpIHtcbiAgICAgICAgICAgICAgICB0YXAodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2xkQmluZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9O1xuICAgICAgICAkLmZuLnVuYmluZCA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgaWYgKC8oXnwgKXRhcCggfCQpLy50ZXN0KGV2dCkpIHtcbiAgICAgICAgICAgICAgICB1bnRhcCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvbGRVbmJpbmQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbn0odGhpcywgalF1ZXJ5KSk7XG5cblxuLy8gQVJSVU1BIEVSUk8gTk8gSUU5IE9OREUgTkFPIEVYSVNURSBXSU5ET1cuQ09OU09MRVxuaWYgKCF3aW5kb3cuY29uc29sZSkge1xuICAgIHZhciBjb25zb2xlID0ge1xuICAgICAgICBsb2c6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgIHdhcm46IGZ1bmN0aW9uKCkge30sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICB0aW1lOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICB0aW1lRW5kOiBmdW5jdGlvbigpIHt9XG4gICAgfVxufVxuXG4vKiBBUlJVTUEgSU5QVVQgTk8gSU9TIFFVRSBOQU8gRlVOQ0lPTkEgRElSRUlUTyAqL1xuLyokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICBpZiAod2luZG93LmlzSU9TKSB7XG4gICAgICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAkKCc6Zm9jdXMnKS5mb2N1cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSk7Ki9cblxudmFyIGdldFhZID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgeCA9IG51bGw7XG4gICAgdmFyIHkgPSBudWxsO1xuXG4gICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQgIT0gbnVsbCAmJiBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXMgIT0gbnVsbCkge1xuICAgICAgICB2YXIgdG91Y2ggPSBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0gfHwgZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXTtcbiAgICAgICAgeCA9IHBhcnNlRmxvYXQodG91Y2gucGFnZVgpO1xuICAgICAgICB5ID0gcGFyc2VGbG9hdCh0b3VjaC5wYWdlWSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgeCA9IHBhcnNlRmxvYXQoZXZlbnQucGFnZVgpO1xuICAgICAgICB5ID0gcGFyc2VGbG9hdChldmVudC5wYWdlWSk7XG4gICAgfVxuXG4gICAgdmFyIHBvcyA9IG5ldyBPYmplY3QoKTtcbiAgICBwb3MueCA9IHg7XG4gICAgcG9zLnkgPSB5O1xuXG4gICAgcmV0dXJuIHBvcztcbn1cblxudmFyIHN1cHBvcnQzZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciByZXQgPSBmYWxzZTtcbiAgICB2YXIgc3VwcG9ydHMzRFRyYW5zZm9ybXMgPSBkb2N1bWVudC5ib2R5LnN0eWxlWyd3ZWJraXRQZXJzcGVjdGl2ZSddICE9PSB1bmRlZmluZWQgfHwgZG9jdW1lbnQuYm9keS5zdHlsZVsnTW96UGVyc3BlY3RpdmUnXSAhPT0gdW5kZWZpbmVkO1xuICAgIGlmIChzdXBwb3J0czNEVHJhbnNmb3Jtcykge1xuICAgICAgICByZXQgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuXG52YXIgZ2V0VHJhbnNmb3JtID0gZnVuY3Rpb24oZWwpIHtcbiAgICB2YXIgcHJvcCA9IFwiXCI7XG5cbiAgICBpZiAoZWwuY3NzKCctd2Via2l0LXRyYW5zZm9ybScpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICBwcm9wID0gZWwuY3NzKCctd2Via2l0LXRyYW5zZm9ybScpO1xuICAgIH0gZWxzZSBpZiAoZWwuY3NzKCd0cmFuc2Zvcm0nKSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcCA9IGVsLmNzcygndHJhbnNmb3JtJyk7XG4gICAgfSBlbHNlIGlmIChlbC5jc3MoJy1tb3otdHJhbnNmb3JtJykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHByb3AgPSBlbC5jc3MoJy1tb3otdHJhbnNmb3JtJyk7XG4gICAgfSBlbHNlIGlmIChlbC5jc3MoJy1tcy10cmFuc2Zvcm0nKSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcCA9IGVsLmNzcygnLW1zLXRyYW5zZm9ybScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbMCwgMCwgMF07XG4gICAgfVxuXG4gICAgdmFyIHJlc3VsdHMgPSBwcm9wLm1hdGNoKC9tYXRyaXgoPzooM2QpXFwoLXswLDF9XFxkKyg/OiwgLXswLDF9XFxkKykqKD86LCAoLXswLDF9XFxkKykpKD86LCAoLXswLDF9XFxkKykpKD86LCAoLXswLDF9XFxkKykpLCAtezAsMX1cXGQrXFwpfFxcKC17MCwxfVxcZCsoPzosIC17MCwxfVxcZCspKig/OiwgKC17MCwxfVxcZCspKSg/OiwgKC17MCwxfVxcZCspKVxcKSkvKTtcblxuICAgIGlmICghcmVzdWx0cylcbiAgICAgICAgcmV0dXJuIFswLCAwLCAwXTtcbiAgICBpZiAocmVzdWx0c1sxXSA9PSAnM2QnKVxuICAgICAgICByZXR1cm4gcmVzdWx0cy5zbGljZSgyLCA1KTtcblxuICAgIHJlc3VsdHMucHVzaCgwKTtcbiAgICByZXR1cm4gcmVzdWx0cy5zbGljZSg1LCA4KTtcbn1cblxudmFyIGdvVG9OZXh0VGFiaW5kZXggPSBmdW5jdGlvbihldmVudCwgb2JqLCBjb21tYW5kKSB7XG4gICAgdmFyIGtleSA9IGV2ZW50LmtleUNvZGUgPyBldmVudC5rZXlDb2RlIDogZXZlbnQud2hpY2g7XG5cbiAgICBpZiAoa2V5ID09IDEzIHx8IGtleSA9PSA5KSB7XG4gICAgICAgIHZhciBmaWNhciA9IHRydWU7XG4gICAgICAgIHZhciByZXQgPSB0cnVlO1xuICAgICAgICB2YXIgdGFiaW5kZXggPSBvYmouYXR0cigndGFiaW5kZXgnKTtcblxuICAgICAgICBpZiAoa2V5ID09IDEzICYmIG9ialswXS5ub2RlTmFtZSA9PSBcIlRFWFRBUkVBXCIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIC8vVmVyaWZpY2EgbyB0YWJpbmRleFxuICAgICAgICAgICAgdmFyIGdvdG9UYWJpbmRleCA9IG9iai5hdHRyKCdnb3RvLXRhYi1pbmRleCcpO1xuICAgICAgICAgICAgdmFyIHN0b3BUYWJpbmRleCA9IG9iai5hdHRyKCdzdG9wLXRhYi1pbmRleCcpO1xuXG4gICAgICAgICAgICAvL1ZhaSBvcGFyYVxuICAgICAgICAgICAgaWYgKHRhYmluZGV4ICYmIHN0b3BUYWJpbmRleCAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgIHRhYmluZGV4ID0gcGFyc2VJbnQodGFiaW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgLy9hdmFuY2EgbyB0YWJpbmRleFxuICAgICAgICAgICAgICAgIGlmIChnb3RvVGFiaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiaW5kZXggPSBnb3RvVGFiaW5kZXg7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiaW5kZXgrKztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL3NlIEV4aXN0aXIgbyBlbGVtZW50byBmb2NhIG5lbGVcbiAgICAgICAgICAgICAgICB2YXIgbmV4dE9iaiA9ICQoJ1t0YWItaW5kZXg9JyArIHRhYmluZGV4ICsgJ10nKTtcblxuICAgICAgICAgICAgICAgIC8vVmVyaWZpY2Egc2UgZW5jb250cm91IHVtIG9iamV0b1xuICAgICAgICAgICAgICAgIGlmIChuZXh0T2JqLmxlbmd0aCA+IDAgJiYgbmV4dE9iai5hdHRyKFwiaXMtZGlzYWJsZWRcIikgIT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmljYXIgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0T2JqWzBdLm5vZGVOYW1lID09IFwiQUJORVItU0VMRUNULVVOREVSTElORVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0T2JqLmZpbmQoXCJzZWxlY3RcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dE9iai5maW5kKFwiW2Rpdi1mb2N1cz10cnVlXVwiKS50cmlnZ2VyKGNvbW1hbmQpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0T2JqLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmVyaWZpY2EgbyBwcm94aW1vIG9iamV0b1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqID0gbmV4dE9iajtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpY2FyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL3JlbW92aWRvIHBhcmEgZnVuY2lvbmFyIG8gZW50ZXJcbiAgICAgICAgICAgICAgICAvL3JldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0b3BUYWJpbmRleCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICBmaWNhciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWNhciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdoaWxlIChmaWNhcik7XG5cbiAgICAgICAgLy9TZSBmb3IgdGFiIGRlaXhhciBmYWxzZVxuICAgICAgICBpZiAoa2V5ID09IDkpIHtcbiAgICAgICAgICAgIHJldCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9yb2RhciBzYWlkYVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cblxufVxuXG52YXIgcmFuZG9tTnVtYmVyID0gZnVuY3Rpb24oKSB7XG4gICAgLy92YXIgcmFuZG9tX2ludGVnZXIgPSBNYXRoLnJhbmRvbSgpKjEwMXwwOyAgICBcbiAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDEwKTtcbn1cblxudmFyIGd1aWQgPSBmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBzNCgpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApXG4gICAgICAgICAgICAudG9TdHJpbmcoMTYpXG4gICAgICAgICAgICAuc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICByZXR1cm4gczQoKSArIHM0KCkgKyAnLScgKyBzNCgpICsgJy0nICsgczQoKSArICctJyArXG4gICAgICAgIHM0KCkgKyAnLScgKyBzNCgpICsgczQoKSArIHM0KCk7XG59XG5cbnZhciBnZW5lcmF0ZUlEID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGd1aWQoKTtcbn1cblxudmFyIHBvaW50ZXJFdmVudFRvWFkgPSBmdW5jdGlvbihlKSB7XG4gICAgdmFyIG91dCA9IHsgeDogMCwgeTogMCB9O1xuICAgIGlmIChlLnR5cGUgPT0gJ3RvdWNoc3RhcnQnIHx8IGUudHlwZSA9PSAndG91Y2htb3ZlJyB8fCBlLnR5cGUgPT0gJ3RvdWNoZW5kJyB8fCBlLnR5cGUgPT0gJ3RvdWNoY2FuY2VsJykge1xuICAgICAgICB2YXIgdG91Y2ggPSBlLm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXSB8fCBlLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF07XG4gICAgICAgIG91dC54ID0gdG91Y2gucGFnZVg7XG4gICAgICAgIG91dC55ID0gdG91Y2gucGFnZVk7XG4gICAgfSBlbHNlIGlmIChlLnR5cGUgPT0gJ21vdXNlZG93bicgfHwgZS50eXBlID09ICdtb3VzZXVwJyB8fCBlLnR5cGUgPT0gJ21vdXNlbW92ZScgfHwgZS50eXBlID09ICdtb3VzZW92ZXInIHx8IGUudHlwZSA9PSAnbW91c2VvdXQnIHx8IGUudHlwZSA9PSAnbW91c2VlbnRlcicgfHwgZS50eXBlID09ICdtb3VzZWxlYXZlJykge1xuICAgICAgICBvdXQueCA9IGUucGFnZVg7XG4gICAgICAgIG91dC55ID0gZS5wYWdlWTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBBYm5lclV0aWxzID0gZnVuY3Rpb24gKCkgeyB9XG5cbkFibmVyVXRpbHMucHJvdG90eXBlLnJlbW92ZUFjY2VudCA9IGZ1bmN0aW9uICh3b3JkKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHZhciBtYXAgPSB7XG4gICAgICAgIFwiw6FcIjogXCJhXCIsXG4gICAgICAgIFwiw6BcIjogXCJhXCIsXG4gICAgICAgIFwiw6JcIjogXCJhXCIsXG4gICAgICAgIFwiw6NcIjogXCJhXCIsXG4gICAgICAgIFwiw6RcIjogXCJhXCIsXG4gICAgICAgIFwiw4FcIjogXCJBXCIsXG4gICAgICAgIFwiw4BcIjogXCJBXCIsXG4gICAgICAgIFwiw4JcIjogXCJBXCIsXG4gICAgICAgIFwiw4NcIjogXCJBXCIsXG4gICAgICAgIFwiw4RcIjogXCJBXCIsXG4gICAgICAgIFwiw6lcIjogXCJlXCIsXG4gICAgICAgIFwiw6hcIjogXCJlXCIsXG4gICAgICAgIFwiw6pcIjogXCJlXCIsXG4gICAgICAgIFwi4bq9XCI6IFwiZVwiLFxuICAgICAgICBcIsOrXCI6IFwiZVwiLFxuICAgICAgICBcIsOJXCI6IFwiRVwiLFxuICAgICAgICBcIsOIXCI6IFwiRVwiLFxuICAgICAgICBcIsOKXCI6IFwiRVwiLFxuICAgICAgICBcIuG6vFwiOiBcIkVcIixcbiAgICAgICAgXCLDi1wiOiBcIkVcIixcbiAgICAgICAgXCLDrVwiOiBcImlcIixcbiAgICAgICAgXCLDrFwiOiBcImlcIixcbiAgICAgICAgXCLDrlwiOiBcImlcIixcbiAgICAgICAgXCLEqVwiOiBcImlcIixcbiAgICAgICAgXCLDr1wiOiBcImlcIixcbiAgICAgICAgXCLDjVwiOiBcIklcIixcbiAgICAgICAgXCLDjFwiOiBcIklcIixcbiAgICAgICAgXCLDjlwiOiBcIklcIixcbiAgICAgICAgXCLEqFwiOiBcIklcIixcbiAgICAgICAgXCLDj1wiOiBcIklcIixcbiAgICAgICAgXCLDs1wiOiBcIm9cIixcbiAgICAgICAgXCLDslwiOiBcIm9cIixcbiAgICAgICAgXCLDtFwiOiBcIm9cIixcbiAgICAgICAgXCLDtVwiOiBcIm9cIixcbiAgICAgICAgXCLDtlwiOiBcIm9cIixcbiAgICAgICAgXCLDk1wiOiBcIk9cIixcbiAgICAgICAgXCLDklwiOiBcIk9cIixcbiAgICAgICAgXCLDlFwiOiBcIk9cIixcbiAgICAgICAgXCLDlVwiOiBcIk9cIixcbiAgICAgICAgXCLDllwiOiBcIk9cIixcbiAgICAgICAgXCLDulwiOiBcInVcIixcbiAgICAgICAgXCLDuVwiOiBcInVcIixcbiAgICAgICAgXCLDu1wiOiBcInVcIixcbiAgICAgICAgXCLFqVwiOiBcInVcIixcbiAgICAgICAgXCLDvFwiOiBcInVcIixcbiAgICAgICAgXCLDmlwiOiBcIlVcIixcbiAgICAgICAgXCLDmVwiOiBcIlVcIixcbiAgICAgICAgXCLDm1wiOiBcIlVcIixcbiAgICAgICAgXCLFqFwiOiBcIlVcIixcbiAgICAgICAgXCLDnFwiOiBcIlVcIixcbiAgICAgICAgXCLDvVwiOiBcInlcIixcbiAgICAgICAgXCLhu7NcIjogXCJ5XCIsXG4gICAgICAgIFwixbdcIjogXCJ5XCIsXG4gICAgICAgIFwi4bu5XCI6IFwieVwiLFxuICAgICAgICBcIsO/XCI6IFwieVwiLFxuICAgICAgICBcIsOdXCI6IFwiWVwiLFxuICAgICAgICBcIuG7slwiOiBcIllcIixcbiAgICAgICAgXCLFtlwiOiBcIllcIixcbiAgICAgICAgXCLhu7hcIjogXCJZXCIsXG4gICAgICAgIFwixbhcIjogXCJZXCIsXG4gICAgICAgIFwiw7FcIjogXCJuXCIsXG4gICAgICAgIFwiw5FcIjogXCJuXCIsXG4gICAgICAgIFwiw4dcIjogXCJjXCIsXG4gICAgICAgIFwiw6dcIjogXCJjXCJcbiAgICB9O1xuXG4gICAgaWYgKHdvcmQgIT0gXCJcIikge1xuICAgICAgICByZXR1cm4gd29yZC5yZXBsYWNlKC9bw6DDqMOsw7LDucOAw4jDjMOSw5nDocOpw63Ds8O6w73DgcOJw43Dk8Oaw53DosOqw67DtMO7w4LDisOOw5TDm8Oj4bq9xKnFqcOxw7XDg+G6vMSoxajDkcOVw6TDq8Ovw7bDvMO/w4TDi8OPw5bDnMW4w4fDp10vZywgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICAgICAgICByZXR1cm4gbWFwW21hdGNoXTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vL1BFZ2EgdmFyaWF2ZWlzIGRhIFVSTFxuQWJuZXJVdGlscy5wcm90b3R5cGUuZ2V0VXJsVmFycyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdmFycyA9IG5ldyBPYmplY3QoKSxcbiAgICAgICAgaGFzaDtcbiAgICB2YXIgaGFzaGVzID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc2xpY2Uod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignPycpICsgMSkuc3BsaXQoJyYnKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhhc2hlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBoYXNoID0gaGFzaGVzW2ldLnNwbGl0KCc9Jyk7XG4gICAgICAgIHZhcnNbaGFzaFswXV0gPSBoYXNoWzFdO1xuICAgIH1cbiAgICByZXR1cm4gdmFycztcbn1cblxuLy9EZXRlcm1pbmEgc2Ugw6kgbW9kbyBhZGFwdGF0aXZvIFxuQWJuZXJVdGlscy5wcm90b3R5cGUuc2hvd0JpZ1NjcmVlbiA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICBpZiAocGFyc2VJbnQob2JqLm91dGVyV2lkdGgoKSkgPj0gMTAyNCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG5BYm5lclV0aWxzLnByb3RvdHlwZS5nZXRDaGVja2VkUmFkaW8gPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIGlmIChuYW1lKSB7XG4gICAgICAgIHJldHVybiAkKFwiaW5wdXRbdHlwZT1yYWRpb11bbmFtZT1cIiArIG5hbWUgKyBcIl06Y2hlY2tlZFwiKS5wYXJlbnQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJChcImlucHV0W3R5cGU9cmFkaW9dOmNoZWNrZWRcIikucGFyZW50KCk7XG4gICAgfVxufVxuXG5BYm5lclV0aWxzLnByb3RvdHlwZS5nZXRQaG9uZUFzT2JqZWN0ID0gZnVuY3Rpb24gKHBob25lKSB7XG5cbiAgICB2YXIgcGhvbmVPYmogPSB7XG4gICAgICAgIGRkaTogXCJcIixcbiAgICAgICAgZGRkOiBcIlwiLFxuICAgICAgICBwaG9uZTogcGhvbmVcbiAgICB9O1xuXG4gICAgcGhvbmUgPSBwaG9uZSA/IHBob25lLnJlcGxhY2UoL1xcRCsvZywgJycpIDogcGhvbmU7XG5cbiAgICBpZiAocGhvbmUgJiYgcGhvbmUubGVuZ3RoID4gMTEpIHtcbiAgICAgICAgcGhvbmVPYmouZGRpID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHsyfSkoXFxkezgsOX0pJC9nLCBcIlxcJDFcIik7XG4gICAgICAgIHBob25lT2JqLmRkZCA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7Mn0pKFxcZHs4LDl9KSQvZywgXCJcXCQyXCIpO1xuICAgICAgICBwaG9uZU9iai5waG9uZSA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7Mn0pKFxcZHs4LDl9KSQvZywgXCJcXCQzXCIpO1xuICAgIH0gZWxzZSBpZiAocGhvbmUgJiYgcGhvbmUubGVuZ3RoID4gOSkge1xuICAgICAgICBwaG9uZU9iai5kZGQgPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezgsOX0pJC9nLCBcIlxcJDFcIik7XG4gICAgICAgIHBob25lT2JqLnBob25lID0gcGhvbmUucmVwbGFjZSgvXihcXGR7Mn0pKFxcZHs4LDl9KSQvZywgXCJcXCQyXCIpO1xuICAgIH1cblxuICAgIHJldHVybiBwaG9uZU9iajtcbn1cblxuQWJuZXJVdGlscy5wcm90b3R5cGUuZm9ybWF0UGhvbmUgPSBmdW5jdGlvbiAocGhvbmUpIHtcblxuICAgIHZhciBwaG9uZVJldHVybiA9IHBob25lLnJlcGxhY2UoL1teMC05XS9nLCAnJyk7XG5cbiAgICBpZiAocGhvbmUgJiYgcGhvbmUubGVuZ3RoID4gMTEpIHtcbiAgICAgICAgcGhvbmVSZXR1cm4gPSBwaG9uZS5yZXBsYWNlKC9eKFxcZHsyfSkoXFxkezJ9KShcXGR7NCw1fSkoXFxkezR9KSQvZywgXCJcXCskMSBcXCgkMikgXFwkMyBcXCQ0XCIpO1xuICAgIH0gZWxzZSBpZiAocGhvbmUgJiYgcGhvbmUubGVuZ3RoID4gOSkge1xuICAgICAgICBwaG9uZVJldHVybiA9IHBob25lLnJlcGxhY2UoL14oXFxkezJ9KShcXGR7NCw1fSkoXFxkezR9KSQvZywgXCJcXCgkMSkgXFwkMiBcXCQzXCIpO1xuICAgIH07XG5cbiAgICByZXR1cm4gcGhvbmVSZXR1cm47XG59XG5cbkFibmVyVXRpbHMucHJvdG90eXBlLnJlbW92ZUNwZkNucGpGb3JtYXQgPSBmdW5jdGlvbiAodmFsb3IsIHR5cGUpIHtcblxuICAgIGlmICh2YWxvcikge1xuICAgICAgICAvL3JlbW92ZSBwb250byBlIHZpcmd1bGFcbiAgICAgICAgdmFsb3IgPSB2YWxvci5yZXBsYWNlKG5ldyBSZWdFeHAoL1teXFxkXS9nKSwgXCJcIik7XG5cbiAgICAgICAgaWYgKHR5cGUgPT0gXCJDTlBKXCIpIHtcbiAgICAgICAgICAgIHZhciBsZW4gPSAxNDtcbiAgICAgICAgICAgIHZhciBwYWQgPSBcIjAwMDAwMDAwMDAwXCI7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcIkNQRlwiKSB7XG4gICAgICAgICAgICB2YXIgbGVuID0gMTE7XG4gICAgICAgICAgICB2YXIgcGFkID0gXCIwMDAwMDAwMDAwMFwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvL3RyYW5zZm9ybWEgcGFyYSBudW1lcm9cbiAgICAgICAgdmFsb3IgPSBwYXJzZUludCh2YWxvcik7XG5cbiAgICAgICAgLy9zZSBmb3IgbWFpb3IgcXVlIG8gdmFsb3IgZGVmaW5kbyBwYXJhIGxlbiBlbGUgY29ydGFcbiAgICAgICAgaWYgKHZhbG9yLmxlbmd0aCA+IGxlbikge1xuICAgICAgICAgICAgdmFsb3IgPSB2YWxvci5zdWJzdHJpbmcoMCwgbGVuKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vU2Ugb2NvcnJlIGFsZ3VtIGVycm8sIGRlaXhhciB2YXppb1xuICAgICAgICBpZiAoaXNOYU4odmFsb3IpKSB7XG4gICAgICAgICAgICB2YWxvciA9IFwiXCI7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbG9yID0gcGFkLnN1YnN0cmluZygwLCBwYWQubGVuZ3RoIC0gdmFsb3IubGVuZ3RoKSArIHZhbG9yO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWxvcjtcbn1cblxuQWJuZXJVdGlscy5wcm90b3R5cGUudmFsaWRhckNOUEogPSBmdW5jdGlvbiAoY25waikge1xuXG4gICAgY25waiA9IGNucGoucmVwbGFjZSgvW15cXGRdKy9nLCAnJyk7XG4gICAgXG4gICAgaWYgKGNucGogPT0gXCIwXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjAwMDAwMDAwMDAwMDAwXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjExMTExMTExMTExMTExXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjIyMjIyMjIyMjIyMjIyXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjMzMzMzMzMzMzMzMzMzXCIgfHxcbiAgICAgICAgY25waiA9PSBcIjQ0NDQ0NDQ0NDQ0NDQ0XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjU1NTU1NTU1NTU1NTU1XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjY2NjY2NjY2NjY2NjY2XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjc3Nzc3Nzc3Nzc3Nzc3XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjg4ODg4ODg4ODg4ODg4XCIgfHxcbiAgICAgICAgY25waiA9PSBcIjk5OTk5OTk5OTk5OTk5XCIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYSBEVnNcbiAgICB2YXIgdGFtYW5obyA9IGNucGoubGVuZ3RoIC0gMlxuICAgIHZhciBudW1lcm9zID0gY25wai5zdWJzdHJpbmcoMCwgdGFtYW5obyk7XG4gICAgdmFyIGRpZ2l0b3MgPSBjbnBqLnN1YnN0cmluZyh0YW1hbmhvKTtcbiAgICB2YXIgc29tYSA9IDA7XG4gICAgdmFyIHBvcyA9IHRhbWFuaG8gLSA3O1xuICAgIHZhciBpID0gdGFtYW5obztcblxuICAgIGZvciAoaSA9IHRhbWFuaG87IGkgPj0gMTsgaS0tKSB7XG4gICAgICAgIHNvbWEgKz0gbnVtZXJvcy5jaGFyQXQodGFtYW5obyAtIGkpICogcG9zLS07XG4gICAgICAgIGlmIChwb3MgPCAyKVxuICAgICAgICAgICAgcG9zID0gOTtcbiAgICB9XG4gICAgdmFyIHJlc3VsdGFkbyA9IHNvbWEgJSAxMSA8IDIgPyAwIDogMTEgLSBzb21hICUgMTE7XG4gICAgaWYgKHJlc3VsdGFkbyAhPSBkaWdpdG9zLmNoYXJBdCgwKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdGFtYW5obyA9IHRhbWFuaG8gKyAxO1xuICAgIG51bWVyb3MgPSBjbnBqLnN1YnN0cmluZygwLCB0YW1hbmhvKTtcbiAgICBzb21hID0gMDtcbiAgICBwb3MgPSB0YW1hbmhvIC0gNztcbiAgICBmb3IgKGkgPSB0YW1hbmhvOyBpID49IDE7IGktLSkge1xuICAgICAgICBzb21hICs9IG51bWVyb3MuY2hhckF0KHRhbWFuaG8gLSBpKSAqIHBvcy0tO1xuICAgICAgICBpZiAocG9zIDwgMilcbiAgICAgICAgICAgIHBvcyA9IDk7XG4gICAgfVxuXG4gICAgcmVzdWx0YWRvID0gc29tYSAlIDExIDwgMiA/IDAgOiAxMSAtIHNvbWEgJSAxMTtcblxuICAgIGlmIChyZXN1bHRhZG8gIT0gZGlnaXRvcy5jaGFyQXQoMSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xufVxuXG4vL3ZhbGlkYSBvIENQRiBkaWdpdGFkb1xuQWJuZXJVdGlscy5wcm90b3R5cGUudmFsaWRhckNQRiA9IGZ1bmN0aW9uKGNwZikge1xuXG4gICAgdmFyIGV4cCA9IC9cXC58XFwtL2dcbiAgICBjcGYgPSBjcGYudG9TdHJpbmcoKS5yZXBsYWNlKGV4cCwgXCJcIik7XG4gICAgaWYgKGNwZi5sZW5ndGggPCAxMSkge1xuICAgICAgICB2YXIgcGFkID0gXCIwMDAwMDAwMDAwMFwiO1xuICAgICAgICBjcGYgPSBwYWQuc3Vic3RyaW5nKDAsIHBhZC5sZW5ndGggLSBjcGYubGVuZ3RoKSArIGNwZjtcbiAgICB9XG5cbiAgICBpZiAoY3BmID09IFwiMFwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjAwMDAwMDAwMDAwXCIgfHxcbiAgICAgICAgY3BmID09IFwiMTExMTExMTExMTFcIiB8fFxuICAgICAgICBjcGYgPT0gXCIyMjIyMjIyMjIyMlwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjMzMzMzMzMzMzMzXCIgfHxcbiAgICAgICAgY3BmID09IFwiNDQ0NDQ0NDQ0NDRcIiB8fFxuICAgICAgICBjcGYgPT0gXCI1NTU1NTU1NTU1NVwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjY2NjY2NjY2NjY2XCIgfHxcbiAgICAgICAgY3BmID09IFwiNzc3Nzc3Nzc3NzdcIiB8fFxuICAgICAgICBjcGYgPT0gXCI4ODg4ODg4ODg4OFwiIHx8XG4gICAgICAgIGNwZiA9PSBcIjk5OTk5OTk5OTk5XCIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHZhciBzb21hO1xuICAgIHZhciByZXN0bztcbiAgICBzb21hID0gMDtcblxuICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IDk7IGkrKykge1xuICAgICAgICBzb21hID0gc29tYSArIHBhcnNlSW50KGNwZi5zdWJzdHJpbmcoaSAtIDEsIGkpKSAqICgxMSAtIGkpO1xuICAgIH1cblxuICAgIHJlc3RvID0gKHNvbWEgKiAxMCkgJSAxMTtcblxuICAgIGlmICgocmVzdG8gPT0gMTApIHx8IChyZXN0byA9PSAxMSkpIHtcbiAgICAgICAgcmVzdG8gPSAwO1xuICAgIH1cbiAgICBpZiAocmVzdG8gIT0gcGFyc2VJbnQoY3BmLnN1YnN0cmluZyg5LCAxMCkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBzb21hID0gMDtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8PSAxMDsgaSsrKSB7XG4gICAgICAgIHNvbWEgPSBzb21hICsgcGFyc2VJbnQoY3BmLnN1YnN0cmluZyhpIC0gMSwgaSkpICogKDEyIC0gaSk7XG4gICAgfVxuICAgIHJlc3RvID0gKHNvbWEgKiAxMCkgJSAxMTtcblxuICAgIGlmICgocmVzdG8gPT0gMTApIHx8IChyZXN0byA9PSAxMSkpIHtcbiAgICAgICAgcmVzdG8gPSAwO1xuICAgIH1cbiAgICBpZiAocmVzdG8gIT0gcGFyc2VJbnQoY3BmLnN1YnN0cmluZygxMCwgMTEpKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuXG5BYm5lclV0aWxzLnByb3RvdHlwZS52YWxpZGFyRU1BSUwgPSBmdW5jdGlvbihlbWFpbCkge1xuICAgIHZhciBlbWFpbFZhbGlkYXRpb24gPSBlbWFpbC5tYXRjaCgvXlthLXpBLVowLTkuXy1dK0BbYS16QS1aMC05Ll8tXStcXC5bYS16QS1aMC05Ll8tXSskLyk7XG5cbiAgICBpZiAoZW1haWwgPT0gZW1haWxWYWxpZGF0aW9uKSB7XG4gICAgICAgIHJldHVybiBlbWFpbFZhbGlkYXRpb247XG4gICAgfVxufVxuXG4vL0Z1bmNvZXMgdXRlaXMgZGUgdXNvIGRvIEpRVUVSWVxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ1dlYkNvbXBvbmVudHNSZWFkeScsIGZ1bmN0aW9uICgpIHtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5jbGFzc0xpc3QuYWRkKFwiaHRtbC1wYWdlLWxvYWRlZFwiKTtcbn0pO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJC5mbi5zZXRDdXJzb3JQb3NpdGlvbiA9IGZ1bmN0aW9uIChwb3MpIHtcbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbSkge1xuICAgICAgICAgICAgaWYgKGVsZW0uc2V0U2VsZWN0aW9uUmFuZ2UpIHtcbiAgICAgICAgICAgICAgICBlbGVtLnNldFNlbGVjdGlvblJhbmdlKHBvcywgcG9zKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbS5jcmVhdGVUZXh0UmFuZ2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBlbGVtLmNyZWF0ZVRleHRSYW5nZSgpO1xuICAgICAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKHRydWUpO1xuICAgICAgICAgICAgICAgIHJhbmdlLm1vdmVFbmQoJ2NoYXJhY3RlcicsIHBvcyk7XG4gICAgICAgICAgICAgICAgcmFuZ2UubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBwb3MpO1xuICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgICQuZm4udmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjaGFuZ2UgPSBudWxsO1xuICAgICAgICB2YXIgdGFnID0gbmV3IFN0cmluZygpO1xuICAgICAgICAvL1RyYXRhbWVudG9cbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGFnICs9ICQodGhpcylbMF0ubm9kZU5hbWU7XG4gICAgICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICAgICAgdGFnID0gdGFnLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJvbmNoYW5nZVwiKSkge1xuICAgICAgICAgICAgY2hhbmdlID0gJCh0aGlzKS5hdHRyKFwib25jaGFuZ2VcIik7XG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoXCJvbmNoYW5nZVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdGlyYSBvIGZvY28gZGUgcXVhbHF1ZXIgZWxlbWVudG9cbiAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgICAgICQod2luZG93KS5mb2N1cygpO1xuXG4gICAgICAgIGlmIChjaGFuZ2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwib25jaGFuZ2VcIiwgY2hhbmdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vc2Ugb3V2ZXIgdW0gZXJybyB2YWxpZGFjYW8gZXN0YSBpbmNvcnJldGFcbiAgICAgICAgaWYgKCQodGhpcykuYXR0cihcImVycm9yXCIpICYmICQodGhpcykuYXR0cihcImVycm9yXCIpICE9IFwiXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuZm4uc2V0Rm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICQodGhpcykuZmluZChcImlucHV0XCIpLmZvY3VzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZm4ucmVtb3ZlRm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZm4uZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRleHQgPSBudWxsO1xuICAgICAgICB2YXIgdGFnID0gbmV3IFN0cmluZygpO1xuICAgICAgICAvL1RyYXRhbWVudG9cbiAgICAgICAgaWYgKCQodGhpcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGFnICs9ICQodGhpcylbMF0ubm9kZU5hbWU7XG4gICAgICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICAgICAgdGFnID0gdGFnLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aChcIkFCLUlOUFVUXCIpID8gXCJBQi1JTlBVVFwiIDogdGFnLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdmFyIHRhZ3NBY2VpdGFzID0gW1wiQUItVEVYVC1SRUFELU9OTFlcIiwgXCJBQi1URVhULUFSRUEtVU5ERVJMSU5FXCIsIFwiQUItU0VMRUNUXCIsIFwiQUItSU5QVVRcIiwgXCJBQi1URVhUXCIsIFwiQUItUkFESU9cIl07XG4gICAgICAgICAgICAgICAgaWYgKHRhZ3NBY2VpdGFzLmluZGV4T2YodGFnKSA9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHZhciB0ZXh0QXJyYXkgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcmFkaW8gb2YgdGhpcykge1xuICAgICAgICAgICAgICAgIHRleHRBcnJheS5wdXNoKHJhZGlvLmdldFRleHQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dEFycmF5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGV4dCA9IHRoaXNbMF0uZ2V0VGV4dCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgIH07XG5cbiAgICAkLmZuLnNldFRleHQgPSBmdW5jdGlvbiAodGV4dCwgY2FuY2VsKSB7XG4gICAgICAgIHZhciB0YWcgPSBuZXcgU3RyaW5nKCk7XG5cbiAgICAgICAgLy9UcmF0YW1lbnRvXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRhZyArPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuICAgICAgICAgICAgaWYgKHRhZykge1xuICAgICAgICAgICAgICAgIHRhZyA9IHRhZy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGFnID09IFwiQUItVEVYVC1SRUFELU9OTFlcIikge1xuICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1EQVRFXCIpKSB7XG4gICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVUXCIpKSB7XG4gICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVRFWFRcIikpIHtcbiAgICAgICAgICAgIHRoaXNbMF0uc2V0VGV4dCh0ZXh0KTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItUkFESU9cIikpIHtcbiAgICAgICAgICAgIHRoaXNbMF0uc2V0VGV4dCh0ZXh0KTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZyA9PSBcIkFCLVRFWFQtQVJFQS1VTkRFUkxJTkVcIikge1xuICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1TRUxFQ1RcIikpIHtcbiAgICAgICAgICAgIGlmIChjYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJzZWxlY3RcIikudmFsKHRleHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJzZWxlY3RcIikudmFsKHRleHQpLmNoYW5nZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9zYWx2YSB2YWxvclxuICAgICAgICBpZiAoIXRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtQ0hFQ0tCT1hcIikpIHtcbiAgICAgICAgICAgICQodGhpcykuYXR0cihcImxvYWRlZC12YWx1ZVwiLCAkKHRoaXMpLmdldFRleHQoKSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvL2Z1bmNhbyBwYXJhIGNvcnJpZ2lyIG8gZGF0YVxuICAgICQuZm4uZ2V0TnVtYmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdGV4dCA9IG51bGw7XG4gICAgICAgIHZhciB0YWcgPSBuZXcgU3RyaW5nKCk7XG4gICAgICAgIC8vVHJhdGFtZW50b1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWcgKz0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRhZyA9PSBcIkFCLVRFWFQtUkVBRC1PTkxZXCIpIHtcbiAgICAgICAgICAgIHRleHQgPSB0aGlzWzBdLmdldFRleHQoKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtQ0hFQ0tCT1hcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSB0aGlzWzBdLmdldE51bWJlcigpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1SQURJT1wiKSkge1xuICAgICAgICAgICAgdGV4dCA9IHRoaXNbMF0uZ2V0TnVtYmVyKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULVNXSVRDSFwiKSkge1xuICAgICAgICAgICAgdGV4dCA9IHRoaXNbMF0uZ2V0TnVtYmVyKCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULVRJTUVcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJpbnB1dFwiKS52YWwoKSArIFwiMDBcIjtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtTlVNQkVSXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwiaW5wdXRcIikudmFsKCk7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAoL1teXFxkXS9nKSwgXCJcIik7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULURBVEVcIikpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuaXNJT1MgfHwgd2luZG93LmlzQW5kcm9pZCkge1xuICAgICAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoOCwgMTApICsgXCJcIiArIHRleHQuc3Vic3RyaW5nKDUsIDcpICsgXCJcIiArIHRleHQuc3Vic3RyaW5nKDAsIDQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwiaW5wdXRcIikudmFsKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVUXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5maW5kKFwiaW5wdXRcIikudmFsKCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVRFWFQtQVJFQS1VTkRFUkxJTkVcIikpIHtcbiAgICAgICAgICAgIHRleHQgPSAkKHRoaXMpLmZpbmQoXCJ0ZXh0YXJlYVwiKS52YWwoKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItU0VMRUNUXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gcGFyc2VJbnQoJCh0aGlzKS5nZXRPYmplY3QoKS52YWxvcik7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVFVRVNUSU9OXCIpKSB7XG4gICAgICAgICAgICB0ZXh0ID0gJCh0aGlzKS5hdHRyKFwiYW5zd2VyXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRleHQgJiYgdGFnICE9IFwiQUItU0VMRUNULVVOREVSTElORVwiKSB7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAoL1teXFxkXFwsXS9nKSwgXCJcIik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICB9O1xuXG4gICAgLy9mdW5jYW8gcGFyYSBjb3JyaWdpciBvIGRhdGFcbiAgICAkLmZuLnNldE51bWJlciA9IGZ1bmN0aW9uICh0ZXh0LCBjYW5jZWwpIHtcbiAgICAgICAgdmFyIHRhZyA9IG5ldyBTdHJpbmcoKTtcbiAgICAgICAgLy9UcmF0YW1lbnRvXG4gICAgICAgIGlmICgkKHRoaXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRhZyArPSAkKHRoaXMpWzBdLm5vZGVOYW1lO1xuICAgICAgICAgICAgaWYgKHRhZykge1xuICAgICAgICAgICAgICAgIHRhZyA9IHRhZy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGV4dCB8fCB0ZXh0ID09IDApIHtcbiAgICAgICAgICAgIC8vTmVjZXNzYXJpbyBzZXIgc3RyaW5nIHBhcmEgcmVnZXhcbiAgICAgICAgICAgIHRleHQgKz0gXCJcIjtcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobmV3IFJlZ0V4cCgvW15cXGQtXFwsXS9nKSwgXCJcIik7XG5cbiAgICAgICAgICAgIGlmICh0YWcgPT0gXCJBQi1URVhULVJFQUQtT05MWVwiKSB7XG4gICAgICAgICAgICAgICAgdGhpc1swXS5zZXRUZXh0KHRleHQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItSU5QVVQtQ0hFQ0tCT1hcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldE51bWJlcih0ZXh0KTtcblxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImxvYWRlZC12YWx1ZVwiLCAkKHRoaXMpLmF0dHIoXCJpcy1jaGVja2VkXCIpKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULVJBRElPXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpc1swXS5zZXROdW1iZXIodGV4dCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVC1TV0lUQ0hcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldE51bWJlcih0ZXh0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULURBVEVcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzWzBdLnNldFRleHQodGV4dCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFnLnN0YXJ0c1dpdGgoXCJBQi1JTlBVVFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXNbMF0uc2V0TnVtYmVyKHRleHQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItU0VMRUNUXCIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXNbMF0uc2VsZWN0KS52YWwodGV4dCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzWzBdLnNlbGVjdCkudmFsKHRleHQpLmNoYW5nZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9zYWx2YSB2YWxvclxuICAgICAgICAgICAgaWYgKCF0YWcuc3RhcnRzV2l0aChcIkFCLUlOUFVULUNIRUNLQk9YXCIpKSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwibG9hZGVkLXZhbHVlXCIsICQodGhpcykuZ2V0VGV4dCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkLmZuLnNldE9sZFZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnNldFRleHQoJCh0aGlzKS5hdHRyKFwibG9hZGVkLXZhbHVlXCIpKTtcbiAgICB9O1xuXG4gICAgJC5mbi5pc0NoYW5nZWQgPSBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgIHZhciBsb2FkZWRWYWx1ZSA9ICQodGhpcykuYXR0cihcImxvYWRlZC12YWx1ZVwiKTtcbiAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9ICQodGhpcykuZ2V0VGV4dCgpO1xuXG4gICAgICAgIGlmIChsb2FkZWRWYWx1ZSB8fCBjdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChsb2FkZWRWYWx1ZSAhPT0gY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZm4uc2V0T2JqZWN0ID0gZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICB2YXIgdGFnID0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgaWYgKHRhZy5zdGFydHNXaXRoKFwiQUItU0VMRUNUXCIpKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJzZWxlY3RcIikudmFsKHZhbCkuY2hhbmdlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkLmZuLmdldE9iamVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGJlYW4gPSBuZXcgT2JqZWN0KCk7XG5cbiAgICAgICAgaWYgKCh0aGlzKVswXSkge1xuICAgICAgICAgICAgdmFyIHRhZyA9ICQodGhpcylbMF0ubm9kZU5hbWU7XG5cbiAgICAgICAgICAgIGlmICh0YWcuc3RhcnRzV2l0aChcIkFCLVNFTEVDVFwiKSkge1xuICAgICAgICAgICAgICAgIGJlYW4ubm9tZSA9ICQodGhpcykuZmluZChcInNlbGVjdCBvcHRpb246c2VsZWN0ZWRcIikudGV4dCgpO1xuICAgICAgICAgICAgICAgIGJlYW4udmFsb3IgPSAkKHRoaXMpLmZpbmQoXCJzZWxlY3Qgb3B0aW9uOnNlbGVjdGVkXCIpLmF0dHIoXCJ2YWx1ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBiZWFuO1xuICAgIH1cblxuXG4gICAgLy9BdmlzYXIgbm9zc29zIGNvbXBvbmVudGVzIHF1YW5kbyB0ZXZlIHVtYSBhbHRlcmFjYW9cbiAgICB2YXIgb3JpZ0FwcGVuZCA9ICQuZm4uYXBwZW5kO1xuICAgICQuZm4uYXBwZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcyhcImFiLWNvbnRhaW5lci1jb250ZW50XCIpICYmIGFyZ3VtZW50c1swXS5oYXNDbGFzcyhcImFiLWJsb2NrXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gb3JpZ0FwcGVuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLnRyaWdnZXIoXCJhcHBlbmRcIik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy9mdW7Dp8OjbyBwYXJhIHJldG9ybmFyIHNlIG8gY2FtcG8gZXNyw6EgY29tIGVycm8gb3UgbsOjb1xuICAgICQuZm4uaGFzRXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJlcnJvclwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuXG4vL2Z1bsOnw6NvIHBhcmEgYXJydW1hciBidWcgbm8gaU9TIDhcbmlmICghU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoKSB7XG4gICAgU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoID0gZnVuY3Rpb24gKHNlYXJjaFN0cmluZywgcG9zaXRpb24pIHtcbiAgICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbiB8fCAwO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleE9mKHNlYXJjaFN0cmluZywgcG9zaXRpb24pID09PSBwb3NpdGlvbjtcbiAgICB9O1xufVxuXG5TdHJpbmcucHJvdG90eXBlLnRvVXBwZXJPbmx5Rmlyc3RMZXR0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG5cbiAgICB2YXIgd29yZE1hcCA9IHtcbiAgICAgICAgXCJyZ1wiOiBcIlJHXCIsXG4gICAgICAgIFwiY3BmXCI6IFwiQ1BGXCIsXG4gICAgICAgIFwiY25walwiOiBcIkNOUEpcIixcbiAgICAgICAgXCJybmVcIjogXCJSTkVcIixcbiAgICAgICAgXCJjZXBcIjogXCJDRVBcIixcbiAgICAgICAgXCJjbmhcIjogXCJDTkhcIixcbiAgICAgICAgXCJzLmEuXCI6IFwiUy5BLlwiXG4gICAgfTtcblxuICAgIGlmIChzdHIgJiYgc3RyLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH0gZWxzZSBpZiAoc3RyICYmIHN0ci5sZW5ndGggPT0gMSkge1xuICAgICAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKClcbiAgICB9IGVsc2UgaWYgKHN0ciAmJiBzdHIubGVuZ3RoID4gMSkge1xuICAgICAgICBzdHIgPSBzdHIuc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBzdHIuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiBzdHIgPSBzdHIucmVwbGFjZSgvXFxiKHJnfGNwZnxjbnBqfHJuZXxjZXB8Y25oKVxcYnxzXFwuYVxcLi9naSwgZnVuY3Rpb24gKHdvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB3b3JkTWFwW3dvcmQudG9Mb3dlckNhc2UoKV07XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbn1cblxuU3RyaW5nLnByb3RvdHlwZS50b0NhbWVsQ2FzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc3RyID0gdGhpcy50b0xvd2VyQ2FzZSgpO1xuXG4gICAgdmFyIHdvcmRzQXJyYXkgPSBbXCJkZVwiLCBcInNlbVwiLCBcIm9cIiwgXCJkb1wiLCBcImRhXCJdO1xuXG4gICAgdmFyIHdvcmRzID0gc3RyLnNwbGl0KFwiIFwiKTtcblxuICAgIHZhciBmdWxsU3RyaW5nID0gbmV3IFN0cmluZygpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAod29yZHNBcnJheS5pbmRleE9mKHdvcmRzW2ldKSA9PSAtMSAmJiB3b3Jkc1tpXS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB3b3Jkc1tpXSA9IHdvcmRzW2ldLnRvVXBwZXJPbmx5Rmlyc3RMZXR0ZXIoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgZnVsbFN0cmluZyA9IHdvcmRzLmpvaW4oXCIgXCIpXG5cbiAgICByZXR1cm4gZnVsbFN0cmluZztcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXRQZXJjZW50ID0gZnVuY3Rpb24oZGVjaW1hbHMsIGludGVnZXJzKSB7XG4gICAgdmFyIHRtcCA9IHRoaXM7XG4gICAgdmFyIGRlYyA9IFwiMVwiO1xuICAgIHZhciBmb3JtYXREZWNpbWFsID0gMDtcbiAgICB2YXIgbmVnYXRpdmVDaGVjayA9IGZhbHNlO1xuXG4gICAgaWYgKHRtcC5zdWJzdHJpbmcoMCwgMSkgPT0gXCItXCIpIHtcbiAgICAgICAgbmVnYXRpdmVDaGVjayA9IHRydWU7XG4gICAgICAgIHRtcCA9IHRtcC5zdWJzdHJpbmcoMSwgdG1wLmxlbmd0aCk7XG4gICAgfTtcblxuICAgIGlmIChkZWNpbWFscykge1xuICAgICAgICBkZWMgPSBkZWMucnBhZChcIjBcIiwgcGFyc2VJbnQoZGVjaW1hbHMpICsgMSk7XG4gICAgICAgIGZvcm1hdERlY2ltYWwgPSBwYXJzZUludChkZWNpbWFscyk7XG4gICAgfVxuICAgIGRlYyA9IHBhcnNlSW50KGRlYyk7XG5cbiAgICBpZiAoKHRtcCAmJiBwYXJzZUludCh0bXApID09IDApIHx8IHRtcCA9PSBcIlwiIHx8IHRtcCA9PSB1bmRlZmluZWQgfHwgaXNOYU4ocGFyc2VJbnQodG1wKSkpIHtcbiAgICAgICAgdG1wID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0bXAgPSBwYXJzZUZsb2F0KHRtcCkgLyBkZWM7XG4gICAgfVxuXG4gICAgaWYgKG5lZ2F0aXZlQ2hlY2spIHtcbiAgICAgICAgdG1wID0gdG1wICogLTE7XG4gICAgfVxuXG4gICAgdmFyIG9wdGlvbiA9IHtcbiAgICAgICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiBmb3JtYXREZWNpbWFsLFxuICAgICAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IGZvcm1hdERlY2ltYWxcbiAgICB9O1xuXG4gICAgdG1wID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KCdwdC1CUicsIG9wdGlvbikuZm9ybWF0KHRtcCk7XG5cbiAgICByZXR1cm4gdG1wO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdEN1cnJlbmN5ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0bXAgPSB0aGlzO1xuICAgIHZhciBuZWdhdGl2ZUNoZWNrID0gZmFsc2U7XG5cbiAgICBpZiAodG1wLnN1YnN0cmluZygwLCAxKSA9PSBcIi1cIikge1xuICAgICAgICBuZWdhdGl2ZUNoZWNrID0gdHJ1ZTtcbiAgICAgICAgdG1wID0gdG1wLnN1YnN0cmluZygxLCB0bXAubGVuZ3RoKTtcbiAgICB9O1xuXG4gICAgLy9yZW1vdmUgemVyb3MgYSBlc3F1ZXJkYVxuICAgIGlmICh0bXApIHtcbiAgICAgICAgLy8gdG1wID0gcGFyc2VJbnQodG1wKSArIFwiXCI7XG4gICAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC9eMCsvLCAnJyk7XG4gICAgfVxuXG4gICAgLy9RdWFscXVlciBjb2lzYSBkaWZlcmVudGUgZGUgdW0gbnVtZXJvIHZhbGlkbyByZXRvcm5hIDAsMDBcbiAgICBpZiAoKHRtcCAmJiBwYXJzZUludCh0bXApID09IDApIHx8IHRtcCA9PSBcIlwiIHx8IHRtcCA9PSB1bmRlZmluZWQgfHwgaXNOYU4ocGFyc2VJbnQodG1wKSkpIHtcbiAgICAgICAgcmV0dXJuIFwiMCwwMFwiO1xuICAgIH1cblxuICAgIC8vVmVyaWZpY2Egc2UgZXhpc3RlbSBzb21lbnRlIGRlY2ltYWlzLCBlIGFjcmVzY2VudGEgdW0gemVybyBuYSBmcmVudGVcbiAgICBpZiAodG1wICYmIHRtcC5sZW5ndGggPD0gMikge1xuICAgICAgICB0bXAgPSB0bXAubHBhZChcIjBcIiwgMyk7XG4gICAgfVxuXG4gICAgLy9zZSBvIHRhbWFuaG8gZm9yXG4gICAgLy9jb2xvY2EgYXMgY2FzYXMgZGVjaW1haXNcbiAgICB0bXAgPSB0bXAucmVwbGFjZSgvKFswLTldezJ9KSQvZywgXCIsJDFcIik7XG5cbiAgICAvL3NlIHRpdmVyIG1pbGhhciBjb2xvY2EgcG9udG9cbiAgICBpZiAodG1wLmxlbmd0aCA+IDYpIHtcbiAgICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL1xcQig/PShcXGR7M30pKyg/IVxcZCkpL2csIFwiLlwiKTtcbiAgICB9XG5cbiAgICBpZiAobmVnYXRpdmVDaGVjayA9PSB0cnVlKSB7XG4gICAgICAgIHRtcCA9IFwiLVwiICsgdG1wO1xuICAgIH1cblxuICAgIHJldHVybiB0bXA7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0RGF0ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdmFyIGRpYSA9IFwiXCI7XG4gICAgdmFyIG1lcyA9IFwiXCI7XG4gICAgdmFyIGFubyA9IFwiXCI7XG4gICAgdmFyIGl0ZW5zID0gXCJcIjtcbiAgICB2YXIgZGF0YUZvcm1hdGFkYSA9IG51bGw7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG5cbiAgICBpZiAob3B0aW9ucykge1xuICAgICAgICAvL29wdGlvbnMuZGF0ZSAhPSBcIlwiICYmIG9wdGlvbnMuZGF0ZSAhPSAwICYmIG9wdGlvbnMuZGF0ZSAhPSBudWxsXG4gICAgICAgIG9wdGlvbnMuZGF0ZSA9IHN0cjtcblxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMuc3JjRm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlICdkZG1teXl5eSc6XG4gICAgICAgICAgICAgICAgYW5vID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZyg0LCA4KTtcbiAgICAgICAgICAgICAgICBtZXMgPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDIsIDQpO1xuICAgICAgICAgICAgICAgIGRpYSA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoMCwgMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXltbWRkJzpcbiAgICAgICAgICAgICAgICBhbm8gPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDAsIDQpO1xuICAgICAgICAgICAgICAgIG1lcyA9IG9wdGlvbnMuZGF0ZS5zdWJzdHJpbmcoNCwgNik7XG4gICAgICAgICAgICAgICAgZGlhID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZyg2LCA4KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGQubW0ueXl5eSc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLmRhdGUuc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgICAgIGFubyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIG1lcyA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIGRpYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZC9tbS95eXl5JzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMuZGF0ZS5zcGxpdChcIi9cIik7XG4gICAgICAgICAgICAgICAgYW5vID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgbWVzID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgZGlhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXkubW0uZGQnOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy5kYXRlLnNwbGl0KFwiLlwiKTtcbiAgICAgICAgICAgICAgICBhbm8gPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBtZXMgPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBkaWEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZGQtbW0teXl5eSc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLmRhdGUuc3BsaXQoXCItXCIpO1xuICAgICAgICAgICAgICAgIGFubyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIG1lcyA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIGRpYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5LW1tLWRkJzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMuZGF0ZS5zcGxpdChcIi1cIik7XG4gICAgICAgICAgICAgICAgYW5vID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgbWVzID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgZGlhID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3l5eXltbSc6XG4gICAgICAgICAgICAgICAgYW5vID0gb3B0aW9ucy5kYXRlLnN1YnN0cmluZygwLCA0KTtcbiAgICAgICAgICAgICAgICBtZXMgPSBvcHRpb25zLmRhdGUuc3Vic3RyaW5nKDQsIDYpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGF0YSBpbnbDoWxpZGFcIik7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMudGFyZ2V0Rm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlICdkZC9tbS95eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gZGlhICsgJy8nICsgbWVzICsgJy8nICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5L21tL2RkJzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gYW5vICsgJy8nICsgbWVzICsgJy8nICsgZGlhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZC5tbS55eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gZGlhICsgJy4nICsgbWVzICsgJy4nICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5Lm1tLmRkJzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gYW5vICsgJy4nICsgbWVzICsgJy4nICsgZGlhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkZC1tbS15eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gZGlhICsgJy0nICsgbWVzICsgJy0nICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5LW1tLWRkJzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gYW5vICsgJy0nICsgbWVzICsgJy0nICsgZGlhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdtbS95eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gbWVzICsgJy8nICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdtbXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gbWVzICsgXCJcIiArIGFuby5zdWJzdHJpbmcoMiwgNCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2RkbW15eXl5JzpcbiAgICAgICAgICAgICAgICBkYXRhRm9ybWF0YWRhID0gZGlhICsgbWVzICsgYW5vO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICd5eXl5bW1kZCc6XG4gICAgICAgICAgICAgICAgZGF0YUZvcm1hdGFkYSA9IGFubyArIG1lcyArIGRpYTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9cIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGFGb3JtYXRhZGE7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0VGltZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdmFyIGhvcmEgPSBcIlwiO1xuICAgIHZhciBtaW4gPSBcIlwiO1xuICAgIHZhciBzZWcgPSBcIlwiO1xuICAgIHZhciBpdGVucyA9IFwiXCI7XG4gICAgdmFyIGhvcmFGb3JtYXRhZGEgPSBudWxsO1xuICAgIHZhciBzdHIgPSB0aGlzO1xuXG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucy50aW1lID0gc3RyO1xuXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5zcmNGb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgJ2hobW1zcyc6XG4gICAgICAgICAgICAgICAgaG9yYSA9IG9wdGlvbnMudGltZS5zdWJzdHJpbmcoMCwgMik7XG4gICAgICAgICAgICAgICAgbWluID0gb3B0aW9ucy50aW1lLnN1YnN0cmluZygyLCA0KTtcbiAgICAgICAgICAgICAgICBzZWcgPSBvcHRpb25zLnRpbWUuc3Vic3RyaW5nKDQsIDYpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdoaDptbTpzcyc6XG4gICAgICAgICAgICAgICAgaXRlbnMgPSBvcHRpb25zLnRpbWUuc3BsaXQoXCI6XCIpO1xuICAgICAgICAgICAgICAgIGhvcmEgPSBpdGVuc1swXTtcbiAgICAgICAgICAgICAgICBtaW4gPSBpdGVuc1sxXTtcbiAgICAgICAgICAgICAgICBzZWcgPSBpdGVuc1syXTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaGgubW0uc3MnOlxuICAgICAgICAgICAgICAgIGl0ZW5zID0gb3B0aW9ucy50aW1lLnNwbGl0KFwiLlwiKTtcbiAgICAgICAgICAgICAgICBob3JhID0gaXRlbnNbMF07XG4gICAgICAgICAgICAgICAgbWluID0gaXRlbnNbMV07XG4gICAgICAgICAgICAgICAgc2VnID0gaXRlbnNbMl07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2hoLW1tLXNzJzpcbiAgICAgICAgICAgICAgICBpdGVucyA9IG9wdGlvbnMudGltZS5zcGxpdChcIi1cIik7XG4gICAgICAgICAgICAgICAgaG9yYSA9IGl0ZW5zWzBdO1xuICAgICAgICAgICAgICAgIG1pbiA9IGl0ZW5zWzFdO1xuICAgICAgICAgICAgICAgIHNlZyA9IGl0ZW5zWzJdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSG9yYSBpbnbDoWxpZGFcIik7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMudGFyZ2V0Rm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlICdoaDptbTpzcyc6XG4gICAgICAgICAgICAgICAgaG9yYUZvcm1hdGFkYSA9IGhvcmEgKyAnOicgKyBtaW4gKyAnOicgKyBzZWc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2hoLm1tLnNzJzpcbiAgICAgICAgICAgICAgICBob3JhRm9ybWF0YWRhID0gaG9yYSArICcuJyArIG1pbiArICcuJyArIHNlZztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaGgtbW0tc3MnOlxuICAgICAgICAgICAgICAgIGhvcmFGb3JtYXRhZGEgPSBob3JhICsgJy0nICsgbWluICsgJy0nICsgc2VnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdoaG1tc3MnOlxuICAgICAgICAgICAgICAgIGhvcmFGb3JtYXRhZGEgPSBob3JhICsgbWluICsgc2VnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb1wiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaG9yYUZvcm1hdGFkYTtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXRDcGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNwZiA9IHRoaXMubHBhZChcIjBcIiwgMTEpO1xuICAgIHJldHVybiBjcGYucmVwbGFjZSgvKFxcZHszfSkoXFxkezN9KShcXGR7M30pKFxcZHsyfSkvZywgXCJcXCQxLlxcJDIuXFwkM1xcLVxcJDRcIik7XG59XG5cblN0cmluZy5wcm90b3R5cGUuZm9ybWF0Q25waiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY3BmID0gdGhpcy5scGFkKFwiMFwiLCAxNCk7XG4gICAgcmV0dXJuIGNwZi5yZXBsYWNlKC8oXFxkezJ9KShcXGR7M30pKFxcZHszfSkoXFxkezR9KShcXGR7Mn0pL2csIFwiXFwkMS5cXCQyLlxcJDNcXC9cXCQ0XFwtJDVcIik7XG59XG5cblxuU3RyaW5nLnByb3RvdHlwZS5kYXRlRGlmZiA9IGZ1bmN0aW9uIChzcmNGb3JtYXQsIHRhcmdldERhdGEsIHR5cGUpIHtcblxuICAgIHZhciBkYXRhSW5pID0gbmV3IERhdGUodGhpcy5mb3JtYXREYXRlKHtcbiAgICAgICAgXCJzcmNGb3JtYXRcIjogc3JjRm9ybWF0LFxuICAgICAgICBcInRhcmdldEZvcm1hdFwiOiBcInl5eXkvbW0vZGRcIlxuICAgIH0pKTtcbiAgICB2YXIgZGF0YUZpbSA9IG5ldyBEYXRlKHRhcmdldERhdGEuZm9ybWF0RGF0ZSh7XG4gICAgICAgIFwic3JjRm9ybWF0XCI6IHNyY0Zvcm1hdCxcbiAgICAgICAgXCJ0YXJnZXRGb3JtYXRcIjogXCJ5eXl5L21tL2RkXCJcbiAgICB9KSk7XG5cbiAgICBpZiAodHlwZSA9PSBcImRpYVwiKSB7XG4gICAgICAgIHZhciBkaWZEaWFzID0gTWF0aC5hYnMoZGF0YUZpbS5nZXRUaW1lKCkgLSBkYXRhSW5pLmdldFRpbWUoKSk7XG4gICAgICAgIHZhciBudW1EaWFzID0gTWF0aC5jZWlsKGRpZkRpYXMgLyAoMTAwMCAqIDM2MDAgKiAyNCkpO1xuICAgICAgICByZXR1cm4gbnVtRGlhcztcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJtZXNcIikge1xuICAgICAgICB2YXIgZGlmTWVzZXMgPSBNYXRoLmFicyhkYXRhRmltLmdldFRpbWUoKSAtIGRhdGFJbmkuZ2V0VGltZSgpKTtcbiAgICAgICAgdmFyIG51bU1lc2VzID0gTWF0aC5jZWlsKGRpZk1lc2VzIC8gKDEwMDAgKiAzNjAwICogMjQgKiAzMCkgLSAxKTtcbiAgICAgICAgcmV0dXJuIG51bU1lc2VzO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnYW5vJykge1xuICAgICAgICB2YXIgZGlmTWVzZXMgPSBNYXRoLmFicyhkYXRhRmltLmdldFRpbWUoKSAtIGRhdGFJbmkuZ2V0VGltZSgpKTtcbiAgICAgICAgdmFyIG51bU1lc2VzID0gTWF0aC5jZWlsKGRpZk1lc2VzIC8gKDEwMDAgKiAzNjAwICogMjQgKiAzMCkgLSAxKTtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IobnVtTWVzZXMgLyAxMik7XG4gICAgfVxufVxuXG5TdHJpbmcucHJvdG90eXBlLnBsdXNEYXlzID0gZnVuY3Rpb24gKHNyY0Zvcm1hdCwgZGF5cykge1xuICAgIHZhciBkYXRhRm9ybWF0YWRhID0gdGhpcy5mb3JtYXREYXRlKHtcbiAgICAgICAgXCJzcmNGb3JtYXRcIjogc3JjRm9ybWF0LFxuICAgICAgICBcInRhcmdldEZvcm1hdFwiOiBcInl5eXkvbW0vZGRcIlxuICAgIH0pO1xuICAgIHZhciBkYXRhR2VyYWRhID0gbmV3IERhdGUoZGF0YUZvcm1hdGFkYSk7XG4gICAgdmFyIGRhdGFGaW5hbCA9IFwiXCI7XG4gICAgZGF0YUdlcmFkYS5zZXREYXRlKGRhdGFHZXJhZGEuZ2V0RGF0ZSgpICsgZGF5cyk7XG4gICAgdmFyIG1lcyA9IG5ldyBTdHJpbmcoZGF0YUdlcmFkYS5nZXRNb250aCgpICsgMSkubHBhZCgnMCcsIDIpO1xuICAgIHZhciBkaWEgPSBuZXcgU3RyaW5nKGRhdGFHZXJhZGEuZ2V0RGF0ZSgpKS5scGFkKCcwJywgMik7XG4gICAgZGF0YUZpbmFsID0gZGlhICsgJy8nICsgbWVzICsgJy8nICsgZGF0YUdlcmFkYS5nZXRGdWxsWWVhcigpO1xuICAgIHJldHVybiBkYXRhRmluYWw7XG59XG5cblN0cmluZy5wcm90b3R5cGUubWludXNEYXlzID0gZnVuY3Rpb24gKHNyY0Zvcm1hdCwgZGF5cykge1xuICAgIHZhciBkYXRhRm9ybWF0YWRhID0gdGhpcy5mb3JtYXREYXRlKHtcbiAgICAgICAgXCJzcmNGb3JtYXRcIjogc3JjRm9ybWF0LFxuICAgICAgICBcInRhcmdldEZvcm1hdFwiOiBcInl5eXkvbW0vZGRcIlxuICAgIH0pO1xuICAgIHZhciBkYXRhR2VyYWRhID0gbmV3IERhdGUoZGF0YUZvcm1hdGFkYSk7XG4gICAgdmFyIGRhdGFGaW5hbCA9IFwiXCI7XG4gICAgZGF0YUdlcmFkYS5zZXREYXRlKGRhdGFHZXJhZGEuZ2V0RGF0ZSgpIC0gZGF5cyk7XG4gICAgdmFyIG1lcyA9IG5ldyBTdHJpbmcoZGF0YUdlcmFkYS5nZXRNb250aCgpICsgMSkubHBhZCgnMCcsIDIpO1xuICAgIHZhciBkaWEgPSBuZXcgU3RyaW5nKGRhdGFHZXJhZGEuZ2V0RGF0ZSgpKS5scGFkKCcwJywgMik7XG4gICAgZGF0YUZpbmFsID0gZGlhICsgJy8nICsgbWVzICsgJy8nICsgZGF0YUdlcmFkYS5nZXRGdWxsWWVhcigpO1xuICAgIHJldHVybiBkYXRhRmluYWw7XG59XG5cblN0cmluZy5wcm90b3R5cGUuY29udmVydFRvTnVtYmVyID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBjb2RlU3RyaW5nID0gdGhpcy5zdWJzdHJpbmcoMSwgMTIpO1xuICAgIHZhciBsZXR0ZXIgPSB0aGlzLnN1YnN0cmluZygwLCAxKS50b0xvd2VyQ2FzZSgpO1xuICAgIHJldHVybiBsZXR0ZXIuY2hhckNvZGVBdCgwKSAtIDk2ICsgY29kZVN0cmluZztcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5scGFkID0gZnVuY3Rpb24gKHBhZFN0cmluZywgbGVuZ3RoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG4gICAgd2hpbGUgKHN0ci5sZW5ndGggPCBsZW5ndGgpXG4gICAgICAgIHN0ciA9IHBhZFN0cmluZyArIHN0cjtcbiAgICByZXR1cm4gc3RyO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmdldFNpZ2xhID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzaWdsYSA9IFwiXCI7XG4gICAgdmFyIG5hbWUgPSB0aGlzO1xuXG4gICAgaWYgKG5hbWUpIHtcbiAgICAgICAgdmFyIHVzZXJOYW1lID0gbmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAoL1stXS9nKSwgXCJcIik7XG4gICAgICAgIHVzZXJOYW1lID0gdXNlck5hbWUucmVwbGFjZShuZXcgUmVnRXhwKC9bXFxzXSsvZyksIFwiIFwiKS50cmltKCk7XG4gICAgICAgIHVzZXJOYW1lID0gdXNlck5hbWUuc3BsaXQoXCIgXCIpO1xuICAgICAgICB2YXIgZmlyc3ROYW1lID0gdXNlck5hbWVbMF07XG4gICAgICAgIHZhciBsYXN0TmFtZSA9IHVzZXJOYW1lW3VzZXJOYW1lLmxlbmd0aCAtIDFdO1xuICAgICAgICBzaWdsYSA9IGZpcnN0TmFtZVswXSArIGxhc3ROYW1lWzBdO1xuICAgIH1cblxuICAgIHJldHVybiBzaWdsYTtcbn1cblxuU3RyaW5nLnByb3RvdHlwZS5ycGFkID0gZnVuY3Rpb24gKHBhZFN0cmluZywgbGVuZ3RoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXM7XG4gICAgd2hpbGUgKHN0ci5sZW5ndGggPCBsZW5ndGgpXG4gICAgICAgIHN0ciA9IHN0ciArIHBhZFN0cmluZztcbiAgICByZXR1cm4gc3RyO1xufVxuXG5TdHJpbmcucHJvdG90eXBlLnRyaW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIik7XG59XG5cbi8vdHJpbW1pbmcgc3BhY2UgZnJvbSBsZWZ0IHNpZGUgb2YgdGhlIHN0cmluZ1xuU3RyaW5nLnByb3RvdHlwZS5sdHJpbSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9eXFxzKy8sIFwiXCIpO1xufVxuXG4vL3RyaW1taW5nIHNwYWNlIGZyb20gcmlnaHQgc2lkZSBvZiB0aGUgc3RyaW5nXG5TdHJpbmcucHJvdG90eXBlLnJ0cmltID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL1xccyskLywgXCJcIik7XG59IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICQuZm4uYmxvY2sgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHZhciB0YWcgPSBcIlwiO1xuICAgICAgICB2YXIgb25seUxvYWQgPSB0cnVlO1xuXG4gICAgICAgIC8vVHJhdGFtZW50b1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWcgKz0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9zZSBleGlzdGlyIHRlbGEgcmVtb3ZlXG4gICAgICAgICQodGhpcykudW5ibG9jaygpO1xuXG4gICAgICAgIC8vR2VyYSBJRFxuICAgICAgICB2YXIgaWQgPSByYW5kb21OdW1iZXIoKTtcbiAgICAgICAgJCh0aGlzKS5hdHRyKFwiYmxvY2tJRFwiLCBpZCk7XG5cbiAgICAgICAgdmFyIGRpdkJsb2NrID0gJChcIjxkaXY+XCIpO1xuICAgICAgICBkaXZCbG9jay5vbihcInRhcFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9KTtcbiAgICAgICAgZGl2QmxvY2suYXR0cihcImlkXCIsIGlkKTtcblxuICAgICAgICAvL2NvbG9jYSBwcmV0byBvdSBicmFuY29cbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50cmFuc3BhcmVuY3kgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGRpdkJsb2NrLmFkZENsYXNzKFwiYWItYmxvY2stZnVsbC1ibGFja1wiKTtcbiAgICAgICAgfSBlbHNlIGlmICh0YWcgPT0gXCJBQi1QQUdFXCIgfHwgdGFnID09IFwiQk9EWVwiKSB7XG4gICAgICAgICAgICBkaXZCbG9jay5hZGRDbGFzcyhcImFiLWJsb2NrLWJsYWNrXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGl2QmxvY2suYWRkQ2xhc3MoXCJhYi1ibG9jay13aGl0ZVwiKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgJCh0aGlzKS5hcHBlbmQoZGl2QmxvY2spO1xuICAgICAgICBcblxuICAgICAgICB2YXIgZGl2V3JhcHBlciA9ICQoXCI8ZGl2PlwiKTtcbiAgICAgICAgZGl2V3JhcHBlci5hZGRDbGFzcyhcImFiLWJsb2NrLXdyYXBwZXJcIik7XG4gICAgICAgIGRpdldyYXBwZXIuYXBwZW5kVG8oZGl2QmxvY2spO1xuXG4gICAgICAgIGlmICgob3B0aW9ucyAmJiBvcHRpb25zLnNob3dMb2FkaW5nICYmIG9wdGlvbnMuc2hvd0xvYWRpbmcgPT0gdHJ1ZSkgfHwgIW9wdGlvbnMgfHwgb3B0aW9ucy5zaG93TG9hZGluZyA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBkaXZMb2FkaW5nID0gJChcIjxkaXY+XCIpO1xuXG4gICAgICAgICAgICBpZiAob25seUxvYWQpIHtcbiAgICAgICAgICAgICAgICBkaXZMb2FkaW5nLmFkZENsYXNzKFwiYWItYmxvY2stbG9hZGluZy1jZW50ZXJcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRpdkxvYWRpbmcuYWRkQ2xhc3MoXCJhYi1ibG9jay1sb2FkaW5nXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkaXZMb2FkaW5nLmFwcGVuZFRvKGRpdldyYXBwZXIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vZnVuY2FvIHBhcmEgZGVzYmxvcXVlYXIgYSB0ZWxhL2NvbXBvbmVudGVcbiAgICAkLmZuLnVuYmxvY2sgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAvL3JlbW92ZSBkZXRlcm1pbmFkbyBibG9ja1xuICAgICAgICAkKFwiI1wiICsgJCh0aGlzKS5hdHRyKFwiYmxvY2tJRFwiKSkucmVtb3ZlKCk7XG5cbiAgICAgICAgLy9UcmF0YW1lbnRvXG4gICAgICAgIHZhciB0YWcgPSBcIlwiO1xuICAgICAgICBpZiAoJCh0aGlzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWcgKz0gJCh0aGlzKVswXS5ub2RlTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfTtcbn0pOyIsIlwidXNlIHN0cmljdFwiO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJChcImFiLXBhZ2VcIikuZmluZChcImFiLWJveFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwid2lkdGhcIiwgJCh0aGlzKS5hdHRyKFwid2lkdGhcIikpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcIndpZHRoXCIsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cbmNsYXNzIEFiQm94IGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5ib3hIZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaGVhZGVyXCIpO1xuICAgICAgICB0aGlzLmJveEhlYWRlclRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICAgICAgdGhpcy5kaXZGb290ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZm9vdGVyXCIpO1xuXG4gICAgICAgIHRoaXMubWFpbkNsYXNzID0gXCJhYi1ib3hcIjtcbiAgICAgICAgXG4gICAgfVxuXG4gICAgX3JlbmRlcigpIHtcbiAgICAgICAgdmFyIGlkID0gZ2VuZXJhdGVJRCgpO1xuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogSWRlbnRpZmljYWRvciDDum5pY28gZG8gb2JqZXRvLCBjb20gcHJlZml4byBcImJveFwiIHwgQWxmYW51bcOpcmljbyB8IE7Do28gfCBOb3JtYWwgfFxuICAgICAgICAgICAgaWQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCk7XG4gICAgICAgIH1cblxuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiYWItYm94XCIpO1xuXG4gICAgICAgLy8gc3R5bGUuaW5uZXJUZXh0ID0gXCIgLmFiLWJveFtzdGF0dXM9J2FuYWxpc2UnXSB7IC0tYm9yZGVyLXN0YXR1czogOHB4IHNvbGlkIHZhcigtLWJveC1zdGF0dXMtYW5hbGlzZSk7IH0gLmFiLWJveFtzdGF0dXM9J2F0aXZvJ10geyAtLWJvcmRlci1zdGF0dXM6IDhweCBzb2xpZCB2YXIoLS1ib3gtc3RhdHVzLWF0aXZvKTsgfSAuYWItYm94W3N0YXR1cz0naW5hdGl2byddIHsgLS1ib3JkZXItc3RhdHVzOiA4cHggc29saWQgdmFyKC0tYm94LXN0YXR1cy1pbmF0aXZvKTsgfSAuYWItYm94W3N0YXR1cz0nY2FuY2VsYWRvJ10geyAtLWJvcmRlci1zdGF0dXM6IDhweCBzb2xpZCB2YXIoLS1ib3gtc3RhdHVzLWNhbmNlbGFkbyk7IH0gOmhvc3QoLmFiLWJveCkgeyBib3gtc2l6aW5nOiBib3JkZXItYm94OyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IG92ZXJmbG93OiBoaWRkZW47IGZsb2F0OiBsZWZ0OyBtYXJnaW46IDhweDsgd2lkdGg6IC13ZWJraXQtY2FsYygxMDAlIC0gMTZweCk7IHdpZHRoOiAtbW96LWNhbGMoMTAwJSAtIDE2cHgpOyB3aWR0aDogLW8tY2FsYygxMDAlIC0gMTZweCk7IHdpZHRoOiBjYWxjKDEwMCUgLSAxNnB4KTsgYm9yZGVyLXJhZGl1czogNXB4OyBib3JkZXItbGVmdDogdmFyKC0tYm9yZGVyLXN0YXR1cyk7IGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1sdjIpOyB9IC5hYi1ib3gtY29udGVudCB7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IHBhZGRpbmc6IDhweDsgZGlzcGxheTogdmFyKC0tYm94RGlzcCk7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmctY29tcG9uZW50cyk7IGhlaWdodDogaW5pdGlhbDsgb3ZlcmZsb3c6IGhpZGRlbjsgZmxvYXQ6IHZhcigtLWJveEZsb2F0KTsgd2lkdGg6IDEwMCU7IHBvc2l0aW9uOiByZWxhdGl2ZTsgfSA6aG9zdCguYWItYm94LWV4cGFuZGFibGUpIC5hYi1ib3gtY29udGVudCB7IHBhZGRpbmc6IDhweDsgfSAuYWItYm94LWZvb3RlciB7IGZsb2F0OiBsZWZ0OyBoZWlnaHQ6IDQwcHg7IHdpZHRoOiAxMDAlOyBiYWNrZ3JvdW5kLXNpemU6IDIwcHg7IGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7IGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsgYm90dG9tOiAwcHg7IGxlZnQ6IDhweDsgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmctY29tcG9uZW50cyk7IGN1cnNvcjogcG9pbnRlcjsgfSA6aG9zdCguYWItYm94LWNsb3NlZCkgOmhvc3QoLmFiLWJveC1vcGVuZWQpIC5hYi1ib3gtY29udGVudCB7IG1heC1oZWlnaHQ6IDkwMDAlICFpbXBvcnRhbnQ7IH0gOmhvc3QoLmFiLWJveC1vcGVuZWQpIC5hYi1ib3gtZm9ybSAuYWItYm94LWNvbnRlbnQgeyBtYXgtaGVpZ2h0OiAxMDBweCB9IC5hYi1ib3gtY29udGVudDo6c2xvdHRlZChsYWJlbCkgeyBmb250LXNpemU6IDEzcHg7IGZvbnQtZmFtaWx5OiAnYWJsaW5rbWVkaXVtJzsgbGluZS1oZWlnaHQ6IDE4cHg7IGNvbG9yOiB2YXIoLS1jb3ItcHJpLXRleHQpOyBkaXNwbGF5OiBibG9jazsgd2lkdGg6IDEwMCU7IHBhZGRpbmc6IDhweDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgZmxvYXQ6IGxlZnQ7IH0gLmFiLWJveC10aXRsZSB7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmctY29tcG9uZW50cyk7IGhlaWdodDogNTBweDsgZmxvYXQ6IGxlZnQ7IHdpZHRoOiAxMDAlOyB9IC5hYi1ib3gtdGl0bGUtdGV4dCB7IGxpbmUtaGVpZ2h0OiA1MHB4OyBib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDE2cHg7IGZvbnQtZmFtaWx5OiAnYWJsaW5rc2VtaWJvbGRyZWd1bGFyJzsgZm9udC13ZWlnaHQ6IG5vcm1hbDsgY29sb3I6IHZhcigtLWNvci10aXR1bG8pOyBmbG9hdDogbGVmdDsgcGFkZGluZy1sZWZ0OiA4cHg7IG1hcmdpbjogMHB4OyB9IC5hYi1ib3gtZGl2LWJ1dHRvbnMgeyBmbG9hdDogbGVmdDsgZGlzcGxheTogdGFibGU7IHdpZHRoOiAxMDAlOyB0YWJsZS1sYXlvdXQ6IGZpeGVkOyB2ZXJ0aWNhbC1hbGlnbjogdG9wOyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iZy1jb21wb25lbnRzKTsgbWFyZ2luLXRvcDogLTVweDsgcGFkZGluZzogMHB4IDE2cHggMTZweCAxNnB4OyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB6LWluZGV4OiAxOyBwb3NpdGlvbjogcmVsYXRpdmU7IH0gYnIgeyBsaW5lLWhlaWdodDogMjBweDsgfVwiO1xuXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpID09ICdmbGV4Jyl7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiYWItYm94X19mbGV4XCIpOyAgICAgICAgICAgIFxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwidGhlbWVcIikgPT0gJ2F0aXZvJyl7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiYWItYm94X19hdGl2b1wiKTsgICAgICAgICAgICBcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpID09ICdpbmF0aXZvJyl7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiYWItYm94X19pbmF0aXZvXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwidGhlbWVcIikgPT0gJ2RhcmsnKXtcbiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJhYi1ib3hfX2RhcmtcIik7XG4gICAgICAgIH1cblxuXG5cbiAgICAgICAgLy9DbGFzc2UgYmFzZVxuICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQodGhpcy5tYWluQ2xhc3MpO1xuXG4gICAgICAgIC8vQ29sb2NhIHRpdHVsb1xuICAgICAgICB0aGlzLmJveEhlYWRlci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwiX2Rpdl90aXRsZVwiKTtcbiAgICAgICAgdGhpcy5ib3hIZWFkZXIuY2xhc3NMaXN0LmFkZChcImFiLWJveC10aXRsZVwiKTtcblxuXG4gICAgICAgIHRoaXMuYm94SGVhZGVyLmFwcGVuZENoaWxkKHRoaXMuYm94SGVhZGVyVGV4dCk7XG4gICAgICAgIHRoaXMuYm94SGVhZGVyVGV4dC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwiX2Rpdl90ZXh0XCIpO1xuICAgICAgICB0aGlzLmJveEhlYWRlclRleHQuY2xhc3NMaXN0LmFkZChcImFiLWJveC10aXRsZS10ZXh0XCIpO1xuXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInRpdGxlXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBDb2xvY2EgdW0gdMOtdHVsbyB8IEFsZmFudW3DqXJpY28gfCBuw6NvIHxuw6NvfFxuICAgICAgICAgICAgdGhpcy5ib3hIZWFkZXJUZXh0LmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwidGl0bGVcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmJveEhlYWRlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heC13aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIG8gdGFtYW5obyBtw6F4aW1vIHwgVGFtYW5obyBlbSBwaXhlbCB8IG7Do28gfDEwMCV8XG4gICAgICAgICAgICB0aGlzLnN0eWxlLm1heFdpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJtYXgtd2lkdGhcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQXRpdmEgb3UgZGVzYXRpdmEgbyBtYXgtd2lkdGggfCB0cnVlIG91IGZhbHNlfCBuw6NvfGZhbHNlfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9kaXYgcGFyYSBmYXplciBhIHNldGEgcXVlIGV4cGFuZGUgbyBib3hcbiAgICAgICAgdGhpcy5kaXZGb290ZXIuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcIl9mb290ZXJcIik7XG4gICAgICAgIHRoaXMuZGl2Rm9vdGVyLmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtZm9vdGVyXCIpO1xuXG4gICAgICAgIC8vdmVyaWZpY2Egc2UgZXhpc3RlIGEgYWx0dXJhIGluaWNpYWwsIGNvbnNpZGVyYWRvIHBhcmEgZXhwYW5kaXJcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaW5pdGlhbC1oZWlnaHRcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBhIGFsdHVyYSBpbmljaWFsIGRvIGNvbXBvbmVudGUgcXVhbmRvIHByZWNpc2Egc2VyIGV4cGFuZGlkb3wgMTAwcHgsIDIwMHB4LCAzMDBweHwgbsOjb3xuw6NvfFxuXG4gICAgICAgICAgICAvL2FkaWNpb25hbmRvIGNsYXNzZXMgcGFyYSBjb25zaWRlcmFyIG8gZm9vdGVyXG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtZXhwYW5kYWJsZVwiKTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0F0dHJpYnV0ZShcImlzLW9wZW5lZFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJveC1jbG9zZWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRpdkZvb3Rlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmlsaXR5XCIpID09IFwiaGlkZGVuXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiBoaWRkZW5cbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFNlIG8gcGFyw6JtZXRybyBlc3RpdmVyIHByZXNlbnRlIGNvbSBvIHZhbG9yIFwiaGlkZGVuXCIsIGVzY29uZGUgbyBvYmpldG8gfCBoaWRkZW4gfCBuw6NvfCBuw6NvfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSB1bWEgbGFyZ3VyYSBwYXJhIHF1YW5kbyBlc3RpdmVyIGVtIHRlbGEgZ3JhbmRlICh0YWJsZXRzLCBwYykgfCBOdW3DqXJpY28gfCBuw6NvfCBuw6NvfFxuICAgICAgICAgICAgaWYgKCQoXCJhYi1wYWdlXCIpLmF0dHIoXCJmdWxsc2NyZWVuXCIpID09IFwidHJ1ZVwiKXtcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJzdGF0dXNcIikpIHtcbiAgICAgICAgICAgIHRoaXMuYm94SGVhZGVyLnNldEF0dHJpYnV0ZShcInN0YXR1c1wiLCB0aGlzLmdldEF0dHJpYnV0ZShcInN0YXR1c1wiKSk7XG4gICAgICAgICAgICB0aGlzLmRpdkZvb3Rlci5zZXRBdHRyaWJ1dGUoXCJzdGF0dXNcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJzdGF0dXNcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9mb3IgbGVnYWN5IHN1YnN0aXR1aXIgdG9kb3Mgb3MgaDEgZG9zIGJveCBwb3IgaDNcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIHRoaXMuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50LnRhZ05hbWUgPT0gXCJIMVwiKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vdXRlckhUTUwgPSBlbGVtZW50Lm91dGVySFRNTC5yZXBsYWNlKC9oMS9nLFwiaDNcIik7XG4gICAgICAgICAgICB9ICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfYWRkRXZlbnQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgJCh0aGlzLmRpdkZvb3Rlcikub24oXCJ0YXBcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1vcGVuZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFNlIHBvc3N1aXIgaW5pdGlhbC1oZWlnaHQsIGluaWNpYSBhYmVydG8gb3UgZmVjaGFkbyB8IHRydWUgb3UgZmFsc2UgfCBuw6NvIHwgZmFsc2V8XG4gICAgICAgICAgICAgICAgX3RoaXMuc2V0QXR0cmlidXRlKFwiaXMtb3BlbmVkXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImlzLW9wZW5lZFwiLCBcInRydWVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyhcImFiLWJveFwiKSkge1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgICAgICAgICB0aGlzLl9hZGRFdmVudCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBvYnNlcnZlZEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXCJpcy1vcGVuZWRcIiwgXCJtYXgtd2lkdGhcIiwgXCJ0aXRsZVwiLCBcInRoZW1lXCIsIFwiaW5pdGlhbC1oZWlnaHRcIiwgXCJpZFwiLCBcInZpc2liaWxpdHlcIiwgXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIiwgXCJzdGF0dXNcIl07XG4gICAgfVxuXG4gICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGF0dHJOYW1lLCBvbGRWYWwsIG5ld1ZhbCkge1xuICAgICAgICBzd2l0Y2ggKGF0dHJOYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwiaXMtb3BlbmVkXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtb3BlbmVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1ib3gtY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsID09IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1ib3gtb3BlbmVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgIGNhc2UgXCJtYXgtd2lkdGhcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUubWF4V2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcInRpdGxlXCI6XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJveEhlYWRlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJveEhlYWRlclRleHQuaW5uZXJUZXh0ID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm94SGVhZGVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3hIZWFkZXJUZXh0LmlubmVyVGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcInRoZW1lXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJveEhlYWRlci5jbGFzc0xpc3QuYWRkKFwiYWItYm94LXRpdGxlLVwiICsgbmV3VmFsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXZGb290ZXIuY2xhc3NMaXN0LmFkZChcImFiLWJveC1mb290ZXItXCIgKyBuZXdWYWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm94SGVhZGVyLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1ib3gtdGl0bGUtXCIgKyBvbGRWYWwpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpdkZvb3Rlci5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYm94LWZvb3Rlci1cIiArIG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcImluaXRpYWwtaGVpZ2h0XCI6XG4gICAgICAgICAgICAgICAgLy9hZGljaW9uYSBhIGFsdHVyYSBpbmljaWFsIG5hIGFsdHVyYSBkbyBvYmpldG9cbiAgICAgICAgICAgICAgICAvL3NldGEgTWF4IGhlaWdodFxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYm94LWV4cGFuZGFibGVcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGl2Rm9vdGVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYm94LWV4cGFuZGFibGVcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGl2Rm9vdGVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgLy9Cb3ggYWJlcnRvIG91IGZlY2hhZG9cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1vcGVuZWRcIikgPT0gXCJmYWxzZVwiIHx8ICF0aGlzLmhhc0F0dHJpYnV0ZShcImlzLW9wZW5lZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1ib3gtY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJveC1jbG9zZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcImlkXCI6XG4gICAgICAgICAgICAgICAgLy9tdWRhIGlkc1xuICAgICAgICAgICAgICAgIHRoaXMuYm94SGVhZGVyLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiX2Rpdl90aXRsZVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJveEhlYWRlclRleHQuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJfZGl2X3RleHRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXZGb290ZXIuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJfZm9vdGVyXCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcInZpc2liaWxpdHlcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwic2hvd1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT0gXCJoaWRkZW5cIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgXG4gICAgICAgICAgICBjYXNlIFwid2lkdGgtb24tYmlnc2NyZWVuXCI6XG4gICAgICAgICAgICAgICAgaWYgKCQoXCJhYi1wYWdlXCIpLmF0dHIoXCJmdWxsc2NyZWVuXCIpID09IFwidHJ1ZVwiKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJzdGF0dXNcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmJveEhlYWRlci5zZXRBdHRyaWJ1dGUoXCJzdGF0dXNcIiwgbmV3VmFsKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpdkZvb3Rlci5zZXRBdHRyaWJ1dGUoXCJzdGF0dXNcIiwgbmV3VmFsKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgnYWItYm94JywgQWJCb3gpOyIsIlwidXNlIHN0cmljdFwiO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJChcImFiLXBhZ2VcIikuZmluZChcImFiLWJ1dHRvblwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQodGhpcykuY3NzKFwibWF4LXdpZHRoXCIsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwid2lkdGhcIiwgJCh0aGlzKS5hdHRyKFwid2lkdGhcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5jbGFzcyBBYkJ1dHRvbiBleHRlbmRzIEhUTUxFbGVtZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy5zcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgIHRoaXMuaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgdGhpcy5ibG9ja2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItYnV0dG9uXCI7XG5cbiAgICB9XG5cbiAgICBfcmVuZGVyKCkge1xuICAgICAgICAvL2NvbG9jYSBjbGFzc2VcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHRoaXMubWFpbkNsYXNzKTtcblxuICAgICAgICB2YXIgaWQgPSBnZW5lcmF0ZUlEKCk7XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBJZGVudGlmaWNhZG9yIMO6bmljbyBkbyBvYmpldG8sIGNvbSBwcmVmaXhvIFwiYnRuXCJ8IEFsZmFudW3DqXJpY28gfG7Do298IHJhbmTDtG1pY298XG4gICAgICAgICAgICBpZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ29sb2NhIG9zIGF0cmlidXRvcyBubyBvYmpldG9cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhcmd1cmEgZG8gYm90w6NvfCBBbGZhbnVtw6lyaWNvfCBuw6NvfCBhdXRvIHxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaGVpZ2h0XCIpKSB7XG4gICAgICAgIC8vICAgICAvL2Rlc2NyaXB0aW9uOiBBbHR1cmEgZG8gYm90w6NvfCBBbGZhbnVtw6lyaWNvfCBuw6NvfCBhdXRvIHxcbiAgICAgICAgLy8gICAgIHRoaXMuc3R5bGUuaGVpZ2h0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIik7XG4gICAgICAgIC8vIH1cblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJsYXN0LWJ1dHRvblwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogVWx0aW1vIGJvdMOjbyBkYSBww6FnaW5hIHwgQm9vbGVhbiB8IG7Do28gfCBmYWxzZSB8XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tbGFzdC1idXR0b25cIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL3ZlcmlmaWNhIHdpZHRoLW9uLWJpZ3NjcmVlblxuICAgICAgICBpZiAoJChcImFiLXBhZ2VcIikuYXR0cihcImZ1bGxzY3JlZW5cIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSkge1xuICAgICAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhcmd1cmEgZG8gY29tcG9uZW50ZSBlbSB0ZWxhcyBtYWlvcmVzfCAlIG91IHB4fCBuw6NvfCB8XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLm1heFdpZHRoID0gXCIzNDBweFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9DcmlhIGJvdGFvXG4gICAgICAgIHRoaXMuYnV0dG9uLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJidG5fYnV0dG9uXCIpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuYnV0dG9uKTtcblxuICAgICAgICAvLyBhZGljaW9uYSBvIHRleHRvIGluc2VyaWRvIG5vIG9iamV0byBwYXJhIG8gc3BhbiBjcmlhZG9cbiAgICAgICAgdGhpcy5zcGFuLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJidG5fc3BhblwiKTtcblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJsYWJlbFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQ29sb2NhciB1bSB0ZXh0byBubyBib3TDo298IEFsZmFudW3DqXJpY298IHNpbXwgdmF6aW98XG4gICAgICAgICAgICB0aGlzLnNwYW4uaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJsYWJlbFwiKS50b1VwcGVyT25seUZpcnN0TGV0dGVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5idXR0b24uYXBwZW5kQ2hpbGQodGhpcy5zcGFuKTtcblxuICAgICAgICAvLyBhZGljaW9uYSBhIGltYWdlbSBpbnNlcmlkYSBubyBvYmpldG8gbm8gYmFja2dyb3VuZCBkZSB1bWEgZGl2XG4gICAgICAgIHRoaXMuaW1nLnNldEF0dHJpYnV0ZShcImRpdi1pbWFnZVwiLCBcInRydWVcIik7XG4gICAgICAgIHRoaXMuaW1nLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJidG5faW1nXCIpO1xuICAgICAgICB0aGlzLmJ1dHRvbi5pbnNlcnRBZGphY2VudEVsZW1lbnQoXCJhZnRlcmJlZ2luXCIsIHRoaXMuaW1nKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaWNvblwiKSB8fCB0aGlzLmhhc0F0dHJpYnV0ZShcImljb24tY2xhc3NcIikpIHtcbiAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgdGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uXCIpICsgXCIpXCI7XG4gICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uLWNsYXNzXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuY2xhc3NMaXN0LmFkZCh0aGlzLmdldEF0dHJpYnV0ZShcImljb24tY2xhc3NcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbWcuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdmVyaWZpY2Egc2UgbyBib3TDo28gw6kgc29tZW50ZSBwYXJhIG1vc3RyYXIgbyDDrWNvbmUgZSBhZGljaW9uYSBhIGNsYXNzZVxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uLWJ1dHRvblwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFRyYXZhIG8gYm90w6NvIHBhcmEgdGVyIHNvbWVudGUgbyDDrWNvbmV8IHRydWUgb3UgZmFsc2V8IG7Do298IGZhbHNlfFxuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWltZ1wiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHZlcmlmaWNhIHNlIHRlbSBvIHRhbWFuaG8gZG8gaWNvbmUgZSBhZGljaW9uYSBubyB0YW1hbmhvIGRvIGJhY2tncm91bmRcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaWNvbi1zaXplXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBBbHRlcmEgbyB0YW1hbmhvIGRvIGljb25lfCBOw7ptZXJvIGVtIHB4fCBuw6NvfCB8XG4gICAgICAgICAgICB0aGlzLmltZy5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWNvbi1zaXplXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdmVyaWZpY2Egc2UgdGVtIG8gdGFtYW5obyBkbyBlc3Bhw6dvIGRvIMOtY29uZSBlIGRlZmluZSBhIGxhcmd1cmEgZGEgZGl2XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImljb24tc3BhY2Utd2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IEVzcGHDp2FtZW50byBkbyDDrWNvbmUgY29tIG8gdGV4dG98IE7Dum1lcm8gZW0gcHh8IG7Do298IHxcbiAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJpY29uLXNwYWNlLXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9Db2xvY2EgY29yIG5vIGJvdGFvXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInRoZW1lXCIpKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogbm9ybWFsO2xpZ2h0O2tleWJvYXJkO2tleWJvYXJkLW9rO2Rhcmstcm91bmRlZDtyZWQtcm91bmRlZDtkYXJrO3ZrXG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBBbHRlcmEgYSBjb3IgZG8gY29tcG9uZW50ZXwgW1sjVGVtYXMgfCBWZXIgdGVtYXNdXXwgbsOjbyB8IHZhemlvfFxuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLVwiICsgdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSA9PSBcImFiLWJ1dHRvbi1rZXlib2FyZFwiKSB7XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24ta2V5Ym9hcmRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tbm9ybWFsXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwicG9zaXRpb25cIikgPT0gXCJjZW50ZXJcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IGNlbnRlcjtyaWdodDtsZWZ0XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBQb3Npw6fDo28gZG8gYm90w6NvfCBDZW50ZXIsIHJpZ2h0IG91IGxlZnR8IG7Do298IGNlbnRlcnxcbiAgICAgICAgICAgIGlmIChhYm5lci51dGlscy5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1jZW50ZXItYmlnXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tY2VudGVyXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwicG9zaXRpb25cIikgPT0gXCJsZWZ0XCIpIHtcbiAgICAgICAgICAgIC8vbsOjbyBmYXogbmFkYVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwicG9zaXRpb25cIikgPT0gXCJyaWdodFwiKSB7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmZsb2F0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJwb3NpdGlvblwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdmVyaWZpY2Egc2UgdGVtIG1heCB3aWR0aFxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJtYXgtd2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhcmd1cmEgbcOheGltYSBkbyBib3TDo298IE7Dum1lcm8gZW0gcHh8IG7Do298IHxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUubWF4V2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIm1heC13aWR0aFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYmxvY2tlci5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWJsb2NrXCIpO1xuICAgICAgICB0aGlzLmJsb2NrZXIuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcImJ0bl9pYmxvY2tlclwiKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmJsb2NrZXIpO1xuXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgdGhpcy5idXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiaXMtYmxvY2tlZFwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIHRoaXMuYmxvY2tlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwidmlzaWJpbGl0eVwiKSA9PSBcImhpZGRlblwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogaGlkZGVuO3Nob3dcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9NZXNtbyBjb21wb3J0YW1lbnRvIHBvcsOpbSBjb20gb3V0cm8gbm9tZSBkZSBhdHJpYnV0bywgbmVjZXNzw6FyaW8gYWp1c3RhciB0b2RvcyBwcm9qZXRvcyBxdWUgdXNhbSBvIGRlIGNpbWFcbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwidmlzaWJsZVwiKSA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiB0cnVlO2ZhbHNlXG4gICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vTGltcGEgdmFyaWF2ZWlzXG4gICAgICAgIGlkID0gbnVsbDtcbiAgICB9XG5cbiAgICBfYWRkRXZlbnQoKSB7XG4gICAgICAgIHZhciBidXR0b24gPSAkKHRoaXMuYnV0dG9uKTtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICAvLyBhbHRlcmEgbyDDrWNvbmUgZG8gYm90w6NvIHF1YW5kbyBvIGJvdMOjbyDDqSBhcGVydGFkbyBlIHNlIMOpIHBhc3NhZG8gbyBhdHJpYnV0byBpY29uLWFjdGl2ZVxuICAgICAgICBidXR0b24ub24oXCJ0b3VjaHN0YXJ0IG1vdXNlZG93blwiLCBmdW5jdGlvbiAoZSkge1xuXG4gICAgICAgICAgICAvL1Byb2liZSBvIGNsaXF1ZSBlbSBkb2lzIGJvdMO1ZXMgYW8gbWVzbW8gdGVtcG9cbiAgICAgICAgICAgIGlmIChlICYmIGUub3JpZ2luYWxFdmVudCAmJiBlLm9yaWdpbmFsRXZlbnQudG91Y2hlcyAmJiBlLm9yaWdpbmFsRXZlbnQudG91Y2hlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy90aXJhIG8gZm9jbyBkZSBxdWFscXVlciBlbGVtZW50b1xuICAgICAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgICAgICAgICAkKHdpbmRvdykuZm9jdXMoKTtcblxuICAgICAgICAgICAgaWYgKF90aGlzLmdldEF0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpID09IFwiZmFsc2VcIiB8fCAhX3RoaXMuaGFzQXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICAvL3NlIHRpdmVyIGVzcGVjaWZpY2FkbyBpY29uLWFjdGl2ZSBhZGljaW9uYSBubyBsdWdhciBkbyBub3JtYWwgcXVhbmRvIG8gZXZlbnRvIGluaWNpYVxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uLWFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBDYW1pbmhvIGRvIMOtY29uZSBxdWUgYXBhcmVjZXLDoSBxdWFuZG8gbyBib3TDo28gZm9yIGF0aXZhZG8uIHwgQWxmYW51bcOpcmljb3wgbsOjb3wgdmF6aW98XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpY29uLWFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgX3RoaXMuZ2V0QXR0cmlidXRlKFwiaWNvbi1hY3RpdmVcIikgKyBcIilcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBzZSB0aXZlciB0ZW1hIGFkaWNpb25hIG8gdGVtYSBubyBvYmpldG9cbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwidGhlbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LmFkZChcImFiLWJ1dHRvbi1cIiArIF90aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpICsgXCItYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tbm9ybWFsLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYWx0ZXJhIG8gw61jb25lIGRvIGJvdMOjbyBxdWFuZG8gbyBib3TDo28gw6kgc29sdG8gZSBzZSDDqSBwYXNzYWRvIG8gYXRyaWJ1dG8gaWNvbi1hY3RpdmVcbiAgICAgICAgYnV0dG9uLm9uKFwibW91c2V1cCB0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAvL3RpcmEgbyBmb2NvIGRlIHF1YWxxdWVyIGVsZW1lbnRvXG4gICAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgICAgICQod2luZG93KS5mb2N1cygpO1xuXG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikgPT0gXCJmYWxzZVwiIHx8ICFfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSkge1xuICAgICAgICAgICAgICAgIC8vcmV0b3JuYSBvIGljb25lIHBhcmEgbyBub3JtYWwgcXVhbmRvIG8gZXZlbnRvIHRlcm1pbmFcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwiaWNvbi1hY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcImljb25cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmltZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIF90aGlzLmdldEF0dHJpYnV0ZShcImljb25cIikgKyBcIilcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL3JldGlyYSBvIHRlbWEgYWRpY2lvbmFkb1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJ0aGVtZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLVwiICsgX3RoaXMuZ2V0QXR0cmlidXRlKFwidGhlbWVcIikgKyBcIi1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1ub3JtYWwtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9hw6fDo28gcXVhbmRvIG8gbW91c2Ugb3UgbyB0b3VjaCBkZWl4YXIgYSDDoXJlYSBkbyBvYmpldG8gYm90w6NvXG4gICAgICAgIGJ1dHRvbi5vbihcIm1vdXNlbGVhdmUgdG91Y2hsZWF2ZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikgPT0gXCJmYWxzZVwiIHx8ICFfdGhpcy5oYXNBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSkge1xuICAgICAgICAgICAgICAgIC8vcmV0b3JuYSBvIGljb25lIHBhcmEgbyBub3JtYWwgcXVhbmRvIG8gZXZlbnRvIHRlcm1pbmFcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwiaWNvbi1hY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcImljb25cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmltZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGljb25BY3RpdmUgKyBcIilcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL3JldGlyYSBvIHRlbWEgYWRpY2lvbmFkb1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJ0aGVtZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLVwiICsgX3RoaXMuZ2V0QXR0cmlidXRlKFwidGhlbWVcIikgKyBcIi1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1ub3JtYWwtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCh0aGlzLmJsb2NrZXIpLm9uKFwidGFwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuXG5cbiAgICB9XG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLm1haW5DbGFzcykpIHtcbiAgICAgICAgICAgIC8qdGhpcy5zaGFkb3dEb20gPSB0aGlzLmF0dGFjaFNoYWRvdyh7IG1vZGU6ICdvcGVuJyB9KTsgKi9cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgICAgICAgdGhpcy5fYWRkRXZlbnQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gW1wiaXMtZGlzYWJsZWRcIiwgXCJsYWJlbFwiLCBcInRoZW1lXCIsIFwiaWNvblwiLCBcImljb24tY2xhc3NcIiwgXCJ3aWR0aFwiLCBcImljb24tYnV0dG9uXCIsIFwiaWNvbi1zaXplXCIsIFwiaWNvbi1zcGFjZS13aWR0aFwiLCBcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIsIFwicG9zaXRpb25cIiwgXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIiwgXCJpZFwiLCBcIm1heC13aWR0aFwiLCBcImlzLWJsb2NrZWRcIl07XG4gICAgfVxuXG4gICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGF0dHJOYW1lLCBvbGRWYWwsIG5ld1ZhbCkge1xuXG4gICAgICAgIHN3aXRjaCAoYXR0ck5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJpcy1kaXNhYmxlZFwiOlxuICAgICAgICAgICAgICAgIC8vUXVhbmRvIGlzLWRpc2FibGUgPSB0cnVlLCBkZXNhYmlsaXRhIG8gYm90w6NvXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJsb2NrZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL1NlIG8gbm92byB2YWxvciBuw6NvIGhhYmlsaXRhciBvIGRpc2FibGUsIGVsZSByZXRpcmEgYXMgY2xhc3NlcyBkZSBhY3RpdmUgZSByZW1vdmUgbyBkaXNhYmxlIGRvIGJvdMOjb1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ0aGVtZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLVwiICsgdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiKSArIFwiLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1ub3JtYWwtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJsYWJlbFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3Bhbi5pbm5lclRleHQgPSBuZXdWYWwudG9VcHBlck9ubHlGaXJzdExldHRlcigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwidGhlbWVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tXCIgKyBvbGRWYWwpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1ub3JtYWxcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLVwiICsgbmV3VmFsKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImljb25cIjpcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmltZy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIG5ld1ZhbCArIFwiKVwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaWNvbi1jbGFzc1wiOlxuICAgICAgICAgICAgICAgIHRoaXMuaW1nLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgICAgICAgICAgICAgIHRoaXMuaW1nLmNsYXNzTGlzdC5hZGQobmV3VmFsKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcIndpZHRoXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImljb24tYnV0dG9uXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24taW1nXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWJ1dHRvbi1pbWdcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaWNvbi1zaXplXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc3R5bGUuYmFja2dyb3VuZFNpemUgPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpY29uLXNwYWNlLXdpZHRoXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ2aXNpYmlsaXR5XCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInNob3dcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcInRhYmxlXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT0gXCJoaWRkZW5cIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ2aXNpYmxlXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcInRhYmxlXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcInBvc2l0aW9uXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcImNlbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhYm5lci51dGlscy5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItYnV0dG9uLWNlbnRlci1iaWdcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1idXR0b24tY2VudGVyXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT0gXCJyaWdodFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZmxvYXQgPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwid2lkdGgtb24tYmlnc2NyZWVuXCI6XG4gICAgICAgICAgICAgICAgaWYgKGFibmVyLnV0aWxzLnNob3dCaWdTY3JlZW4odG9wLiQoXCJib2R5XCIpKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImlkXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5pbWcuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJidG5faW1nXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiYnRuX2J1dHRvblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW4uc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJidG5fc3BhblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsb2NrZXIuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJidG5faWJsb2NrZXJcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJtYXgtd2lkdGhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLm1heFdpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaXMtYmxvY2tlZFwiOlxuICAgICAgICAgICAgICAgIC8vVHJhdGEgYSBhbHRlcmHDp8OjbyBkbyBhdHJpYnV0byBpcy1kaXNhYmxlXG4gICAgICAgICAgICAgICAgLy9RdWFuZG8gaXMtZGlzYWJsZSA9IHRydWUsIGRlc2FiaWxpdGEgbyBib3TDo29cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU2UgbyBub3ZvIHZhbG9yIG7Do28gaGFiaWxpdGFyIG8gZGlzYWJsZSwgZWxlIHJldGlyYSBhcyBjbGFzc2VzIGRlIGFjdGl2ZSBlIHJlbW92ZSBvIGRpc2FibGUgZG8gYm90w6NvXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInRoZW1lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1idXR0b24tXCIgKyB0aGlzLmdldEF0dHJpYnV0ZShcInRoZW1lXCIpICsgXCItYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItYnV0dG9uLW5vcm1hbC1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ibG9ja2VyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoXCJhYi1idXR0b25cIiwgQWJCdXR0b24pOyIsIlwidXNlIHN0cmljdFwiO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJChcImFiLXBhZ2VcIikuZmluZChcImFiLWNoZWNrYm94XCIpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cihcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSkge1xuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcIndpZHRoXCIsICQodGhpcykuYXR0cihcIndpZHRoXCIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcIndpZHRoXCIsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cbmNsYXNzIEFiQ2hlY2tib3ggZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmNoZWNrc3BhY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB0aGlzLnNwYW5MYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICB0aGlzLnNwYW5TdWJ0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXG4gICAgICAgIHRoaXMubWFpbkNsYXNzID0gXCJhYi1jaGVja2JveFwiO1xuXG4gICAgICAgIHRoaXMuX2FkZEV2ZW50KCk7XG4gICAgfVxuXG4gICAgX3JlbmRlcigpIHtcbiAgICAgICAgLy9jb2xvY2EgY2xhc3NlXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCh0aGlzLm1haW5DbGFzcyk7XG5cbiAgICAgICAgLy9DcmlhIHVtIGlkXG4gICAgICAgIGxldCBpZCA9IGdlbmVyYXRlSUQoKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaWRcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBzZSBhIGNoZWNrYm94IGrDoSBlc3RhcsOhIHNlbGVjaW9uYWRhfCBCb29sZWFuIHwgbsOjb3wgZmFsc2V8XG4gICAgICAgICAgICBpZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vYXJtYXplbmEgbyBjb250ZcO6ZG8gcGFzc2FkbyBubyBodG1sXG4gICAgICAgIGxldCBjb250ZXVkbyA9IHRoaXMuaW5uZXJIVE1MO1xuICAgICAgICB0aGlzLmlubmVySFRNTCA9IFwiXCI7XG5cbiAgICAgICAgLy9Db2xvY2Egb3MgYXRyaWJ1dG9zIG5vIG9iamV0b1xuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTGFyZ3VyYSBkbyBjb21wb25lbnRlIChhZmV0YSBzb21lbnRlIG8gZXNwYcOnbyBxdWUgdGVyw6EgcGFyYSB0ZXh0LCBuw6NvIGFsdGVyYSBvIHRhbWFuaG8gZGEgY2hlY2tib3gpfCAlIG91IHB4fCBuw6NvfCAxMDAlfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGhcIik7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLm1heFdpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vT2JyaWdhdG9yaW8gY2hlY2FnZW0gYWJhaXhvIGRvIHdpZHRoXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIGEgbGFyZ3VyYSBkbyBjb21wZW5lbnRlIGVtIHRlbGFzIG1haW9yZXMgKGFmZXRhIHNvbWVudGUgbyBlc3Bhw6dvIHF1ZSB0ZXLDoSBwYXJhIHRleHQsIG7Do28gYWx0ZXJhIG8gdGFtYW5obyBkYSBjaGVja2JveCl8ICUgb3UgcHh8IG7Do298IHxcbiAgICAgICAgICAgIGlmIChhYm5lci51dGlscy5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL0NyaWEgY2hlY2tcbiAgICAgICAgdGhpcy5jaGVja3NwYWNlLmNsYXNzTGlzdC5hZGQoXCJhYi1jaGVja2JveC1jaGVja3NwYWNlXCIpO1xuICAgICAgICB0aGlzLmNoZWNrc3BhY2Uuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcImNoa19jaGVja2JveFwiKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmNoZWNrc3BhY2UpO1xuXG4gICAgICAgIC8vaW5zZXJlIG8gY29udGXDumRvIG5vIG9iamV0b1xuICAgICAgICB0aGlzLnNwYW5MYWJlbC5jbGFzc0xpc3QuYWRkKFwiYWItY2hlY2tib3gtdGl0bGVcIik7XG4gICAgICAgIHRoaXMuc3BhbkxhYmVsLnNldEF0dHJpYnV0ZShcImNvbnRlbnQtYXJlYVwiLCBcInRydWVcIilcbiAgICAgICAgdGhpcy5zcGFuTGFiZWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcImNoa19sYWJlbFwiKTtcbiAgICAgICAgaWYgKGNvbnRldWRvKSB7XG4gICAgICAgICAgICB0aGlzLnNwYW5MYWJlbC5pbm5lckhUTUwgPSBjb250ZXVkbztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImxhYmVsXCIpKSB7XG4gICAgICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTGFiZWwgZG8gY29tcG9uZW50ZSB8ICB8IG7Do28gfCB8XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuTGFiZWwuaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJsYWJlbFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuc3BhbkxhYmVsKTtcblxuICAgICAgICB0aGlzLnNwYW5TdWJ0aXRsZS5jbGFzc0xpc3QuYWRkKFwiYWItY2hlY2tib3gtc3VidGl0bGVcIik7XG4gICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJjaGtfc3VidGl0bGVcIik7XG4gICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwic3VidGl0bGVcIik7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5zcGFuU3VidGl0bGUpO1xuXG4gICAgICAgIC8vRGVmaW5lIHNlIGRldmVyw6Egc2VyIGFsaW5oYWRvIGEgZGlyZWl0YVxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJwb3NpdGlvblwiKSA9PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiBsZWZ0O3JpZ2h0XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgcGFyYSBvbmRlIGVzdGFyw6EgcG9zaWNpb25hZG8gbyBjaGVja2JveHwgUG9zacOnw6NvIHwgbsOjb3wgbGVmdHxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuZmxvYXQgPSB0aGlzLmdldEF0dHJpYnV0ZShcInBvc2l0aW9uXCIpO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5wYWRkaW5nUmlnaHQgPSBcIjE1cHhcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIHNlIGEgY2hlY2tib3ggZXN0YXLDoSBkZXNhdGl2YWRhfCBCb29sZWFuIHwgbsOjb3wgZmFsc2V8XG4gICAgICAgICAgICB0aGlzLmNoZWNrc3BhY2Uuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLWNoZWNrYm94LWRpc2FibGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy92ZXJpZmljYSBzZSB0ZW0gbWF4IHdpZHRoXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heC13aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTGFyZ3VyYSBtw6F4aW1hIGRvIGNvbXBvbmVudGUgfCAlIG91IHB4IHwgbsOjbyB8IHxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUubWF4V2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIm1heC13aWR0aFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInN1YnRpdGxlXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBTdWJ0aXR1bG8gZG8gY29tcG9uZW50ZSB8ICB8IG7Do28gfCB8XG4gICAgICAgICAgICB0aGlzLnNwYW5TdWJ0aXRsZS5pbm5lclRleHQgPSB0aGlzLmdldEF0dHJpYnV0ZShcInN1YnRpdGxlXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9MaW1wYSB2YXJpYXZlaXNcbiAgICAgICAgaWQgPSBudWxsO1xuICAgICAgICBjb250ZXVkbyA9IG51bGw7XG4gICAgfVxuXG4gICAgX2FkZEV2ZW50KCkge1xuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgICAgICAkKHRoaXMpLm9uKFwidGFwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSA9PSBcImZhbHNlXCIgfHwgIV90aGlzLmhhc0F0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmdldEF0dHJpYnV0ZShcImlzLWNoZWNrZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0QXR0cmlidXRlKFwiaXMtY2hlY2tlZFwiLCBcImZhbHNlXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImlzLWNoZWNrZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9DaGFtYSBhIGZ1bmNhb1xuICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcIm9udmFsaWRhdGVcIikpIHtcbiAgICAgICAgICAgICAgICBsZXQgZm4gPSB3aW5kb3dbX3RoaXMuZ2V0QXR0cmlidXRlKFwib252YWxpZGF0ZVwiKV07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBmbi5jYWxsKCQoX3RoaXMpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmbiA9IG5ldyBGdW5jdGlvbihfdGhpcy5nZXRBdHRyaWJ1dGUoXCJvbnZhbGlkYXRlXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgZm4uY2FsbCgkKF90aGlzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLm1haW5DbGFzcykpIHtcbiAgICAgICAgICAgIC8qdGhpcy5zaGFkb3dEb20gPSB0aGlzLmF0dGFjaFNoYWRvdyh7IG1vZGU6ICdvcGVuJyB9KTsgKi9cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBvYnNlcnZlZEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXCJpcy1kaXNhYmxlZFwiLCBcImlzLWNoZWNrZWRcIiwgXCJ3aWR0aFwiLCBcIndpZHRoLW9uLWJpZ3NjcmVlblwiLCBcImlkXCIsIFwic3VidGl0bGVcIiwgXCJsYWJlbFwiXTtcbiAgICB9XG5cbiAgICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2soYXR0ck5hbWUsIG9sZFZhbCwgbmV3VmFsKSB7XG5cbiAgICAgICAgc3dpdGNoIChhdHRyTmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcImlzLWRpc2FibGVkXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrc3BhY2Uuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItY2hlY2tib3gtZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja3NwYWNlLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1jaGVja2JveC1kaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpcy1jaGVja2VkXCI6XG4gICAgICAgICAgICAgICAgLy9RdWFuZG8gaXMtZGlzYWJsZSA9IHRydWUsIGRlc2FiaWxpdGEgbyBib3TDo29cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWNoZWNrYm94LWNoZWNrc3BhY2UtbWlkZGxlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1jaGVja2JveC1jaGVja3NwYWNlLWNoZWNrZWRcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT0gXCJuZXV0cmFsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItY2hlY2tib3gtY2hlY2tzcGFjZS1jaGVja2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1jaGVja2JveC1jaGVja3NwYWNlLW1pZGRsZVwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1jaGVja2JveC1jaGVja3NwYWNlLW1pZGRsZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItY2hlY2tib3gtY2hlY2tzcGFjZS1jaGVja2VkXCIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcImNhbmNlbC1jYWxsYmFja1wiKSAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJvbmNoYW5nZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZuID0gd2luZG93W3RoaXMuZ2V0QXR0cmlidXRlKFwib25jaGFuZ2VcIildO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ3aWR0aFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIjpcbiAgICAgICAgICAgICAgICBpZiAoYWJuZXIudXRpbHMuc2hvd0JpZ1NjcmVlbih0b3AuJChcImJvZHlcIikpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaWRcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrc3BhY2Uuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJjaGtfY2hlY2tib3hcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuTGFiZWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJjaGtfbGFiZWxcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuU3VidGl0bGUuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJjaGtfc3VidGl0bGVcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJzdWJ0aXRsZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLmlubmVyVGV4dCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImxhYmVsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuTGFiZWwuaW5uZXJIVE1MID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0VGV4dCh0ZXh0KSB7XG4gICAgICAgIHRoaXMuc3BhbkxhYmVsLmlubmVySFRNTCA9IHRleHQ7XG4gICAgfVxuXG4gICAgZ2V0VGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3BhbkxhYmVsLmlubmVyVGV4dDtcbiAgICB9XG5cbiAgICBzZXROdW1iZXIodGV4dCkge1xuICAgICAgICBpZiAodGV4dCA9PSAxIHx8IHRleHQgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJpcy1jaGVja2VkXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwiaXMtY2hlY2tlZFwiLCBcImZhbHNlXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0TnVtYmVyKCkge1xuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1jaGVja2VkXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIxXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS5hdHRyKFwiaXMtY2hlY2tlZFwiKSA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBcIjBcIjtcbiAgICAgICAgfVxuICAgIH1cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZShcImFiLWNoZWNrYm94XCIsIEFiQ2hlY2tib3gpOyIsIlwidXNlIHN0cmljdFwiO1xuXG5jbGFzcyBBYkhlYWRlciBleHRlbmRzIEhUTUxFbGVtZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItaGVhZGVyXCI7XG4gICAgfVxuXG4gICAgX3JlbmRlcigpIHtcbiAgICAgICAgLy8gQURJQ0lPTkEgQ0xBU1NFIFBBRFJBT1xuICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQodGhpcy5tYWluQ2xhc3MpO1xuXG4gICAgICAgIC8vR2VyYSBub3ZvIGlkXG4gICAgICAgIHZhciBpZCA9IGdlbmVyYXRlSUQoKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiaWRcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IElkZW50aWZpY2HDp8OjbyBkbyBvYmpldG8sIGNvbSBwcmVmaXhvIFwiaGVhZFwiIHwgQWxmYW51bcOpcmljbyB8IHNpbSB8IHJhbmTDtG1pY28gfFxuICAgICAgICAgICAgaWQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NvbG9jYSBvIG1lbnVcbiAgICAgICAgdGhpcy5pbWcuY2xhc3NMaXN0LmFkZChcImFiLWhlYWRlci1tZW51XCIpO1xuICAgICAgICB0aGlzLmltZy5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJvYmplY3QvYWItbWVudS9pbWcvb3Blbi1tZW51LnN2Z1wiKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmltZyk7XG5cbiAgICAgICAgLy8gcGFyYW1ldHJvc1xuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJoZWlnaHRcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFNldGEgYWx0dXJhfCBOw7ptZXJvIGNvbSBweCBvdSAlfCBuw6NvfCA1MHB4fFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5oZWlnaHQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImhlaWdodFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuaGVpZ2h0ID0gXCI1NXB4XCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogU2V0YSBsYXJndXJhfCBOw7ptZXJvIGNvbSBweCBvdSAlfCBuw6NvfCAxMDAlfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGhcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBNT1NUUkEgT1UgTkFPIE1PU1RSQVxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ2aXNpYmxlXCIpKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTW9zdHJhIG91IGVzY29uZGUgb2JqZXRvIHwgQm9vbGVhbiB8IG7Do298IHRydWV8XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcInZpc2libGVcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmxlXCIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwidmlzaWJsZVwiLCBcInRydWVcIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLm1haW5DbGFzcykpIHtcbiAgICAgICAgICAgIC8qdGhpcy5zaGFkb3dEb20gPSB0aGlzLmF0dGFjaFNoYWRvdyh7XG4gICAgICAgICAgICAgICAgbW9kZTogJ29wZW4nXG4gICAgICAgICAgICB9KTsgKi9cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBvYnNlcnZlZEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXCJ2aXNpYmxlXCIsIFwicG9zaXRpb24tZml4ZWRcIiwgXCJ3aWR0aFwiLCBcImhlaWdodFwiXTtcbiAgICB9XG5cbiAgICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2soYXR0ck5hbWUsIG9sZFZhbCwgbmV3VmFsKSB7XG4gICAgICAgIGlmIChhdHRyTmFtZSA9PSBcInZpc2libGVcIikge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbCAmJiAobmV3VmFsID09IHRydWUgfHwgbmV3VmFsID09IFwidHJ1ZVwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZml4Q29udGVudCgpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoYXR0ck5hbWUgPT0gXCJwb3NpdGlvbi1maXhlZFwiKSB7XG4gICAgICAgICAgICAvLyBQb3NpY2FvXG4gICAgICAgICAgICB0aGlzLmZpeENvbnRlbnQoKTtcblxuICAgICAgICB9IGVsc2UgaWYgKGF0dHJOYW1lID09IFwid2lkdGhcIikge1xuICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcblxuICAgICAgICB9IGVsc2UgaWYgKGF0dHJOYW1lID09IFwiaGVpZ2h0XCIpIHtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuaGVpZ2h0ID0gbmV3VmFsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZml4Q29udGVudCgpIHtcbiAgICAgICAgdmFyIHBhZ2UgPSAkKFwiYm9keVwiKS5jaGlsZHJlbihcImFiLXBhZ2VcIik7XG4gICAgICAgIHZhciBjb250ZW50ID0gcGFnZS5jaGlsZHJlbihcImFiLXBhZ2VcIik7XG4gICAgICAgIHZhciBvYmpIZWFkZXIgPSBwYWdlLmNoaWxkcmVuKFwiYWItaGVhZGVyXCIpO1xuICAgICAgICB2YXIgb2JqRm9vdGVyID0gcGFnZS5jaGlsZHJlbihcImFiLWZvb3RlclwiKTtcblxuICAgICAgICB2YXIgdG90YWxIID0gMDtcbiAgICAgICAgdmFyIG92ZXIgPSBmYWxzZTsgLy92ZXJpZmljYSBzZSBtdWRhIG8gb3ZlcmZsb3dcblxuICAgICAgICAvL2NhbGN1bGEgYSBkaWZlcmVuY2EgZG8gaGVhZGVyIFxuICAgICAgICBpZiAob2JqSGVhZGVyLmxlbmd0aCA9PSAxICYmIG9iakhlYWRlci5hdHRyKFwicG9zaXRpb24tZml4ZWRcIikgPT0gXCJ0cnVlXCIgJiYgb2JqSGVhZGVyLmF0dHIoXCJ2aXNpYmxlXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICB0b3RhbEggKz0gcGFyc2VGbG9hdChvYmpIZWFkZXIuaGVpZ2h0KCkpO1xuICAgICAgICAgICAgb3ZlciA9IHRydWU7XG5cbiAgICAgICAgfSBlbHNlIGlmIChvYmpIZWFkZXIuYXR0cihcInZpc2libGVcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIHRvdGFsSCArPSBwYXJzZUZsb2F0KG9iakhlYWRlci5oZWlnaHQoKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2JqRm9vdGVyLmxlbmd0aCA9PSAxICYmIG9iakZvb3Rlci5hdHRyKFwicG9zaXRpb24tZml4ZWRcIikgPT0gXCJ0cnVlXCIgJiYgb2JqRm9vdGVyLmF0dHIoXCJ2aXNpYmxlXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICB0b3RhbEggKz0gcGFyc2VGbG9hdChvYmpGb290ZXIuY3NzKFwiaGVpZ2h0XCIpKTtcbiAgICAgICAgICAgIG92ZXIgPSB0cnVlO1xuXG4gICAgICAgIH0gZWxzZSBpZiAob2JqRm9vdGVyLmF0dHIoXCJ2aXNpYmxlXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICB0b3RhbEggKz0gcGFyc2VGbG9hdChvYmpGb290ZXJvYmpGb290ZXIuaGVpZ2h0KCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG92ZXIpIHtcbiAgICAgICAgICAgIGNvbnRlbnQuY3NzKFwib3ZlcmZsb3cteVwiLCBcImF1dG9cIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250ZW50LmNzcyhcIm92ZXJmbG93LXlcIiwgXCJpbml0aWFsXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9hcnJ1bWEgY29udGVudFxuICAgICAgICBjb250ZW50LmNzcyhcImhlaWdodFwiLCBcIi13ZWJraXQtY2FsYygxMDAlIC0gXCIgKyB0b3RhbEggKyBcInB4KVwiKTtcbiAgICAgICAgY29udGVudC5jc3MoXCJoZWlnaHRcIiwgXCItbW96LWNhbGMoMTAwJSAtIFwiICsgdG90YWxIICsgXCJweClcIik7XG4gICAgICAgIGNvbnRlbnQuY3NzKFwiaGVpZ2h0XCIsIFwiLW8tY2FsYygxMDAlIC0gXCIgKyB0b3RhbEggKyBcInB4KVwiKTtcbiAgICAgICAgY29udGVudC5jc3MoXCJoZWlnaHRcIiwgXCJjYWxjKDEwMCUgLSBcIiArIHRvdGFsSCArIFwicHgpXCIpO1xuXG4gICAgICAgIC8vYXBhZ2EgdmFyaWF2ZWlzXG4gICAgICAgIHBhZ2UgPSBudWxsO1xuICAgICAgICBjb250ZW50ID0gbnVsbDtcbiAgICAgICAgb2JqSGVhZGVyID0gbnVsbDtcbiAgICAgICAgb2JqRm9vdGVyID0gbnVsbDtcbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ2FiLWhlYWRlcicsIEFiSGVhZGVyKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuY2xhc3MgQWJJbnB1dCBleHRlbmRzIEhUTUxFbGVtZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuYWJuZXIgPSBuZXcgQWJuZXJVdGlscygpO1xuXG4gICAgICAgIHRoaXMuaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgICAgIHRoaXMubGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIik7XG4gICAgICAgIHRoaXMuc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICB0aGlzLmVycm9yUGFyZW50ID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5tYWluQ2xhc3MgPSBcImFiLWlucHV0LXVuZGVybGluZVwiO1xuXG4gICAgICAgIHRoaXMuX2FkZEV2ZW50KCk7XG4gICAgfVxuXG4gICAgX3JlbmRlcigpIHtcblxuICAgICAgICB2YXIgaWQgPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpZFwiKSkge1xuICAgICAgICAgICAgaWQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWQgPSBnZW5lcmF0ZUlEKCk7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL0NvbG9jYSBjbGFzc2UgcHJpbmNpcGFsIGRvIG9iamV0b1xuICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQodGhpcy5tYWluQ2xhc3MpO1xuXG4gICAgICAgIC8vd2lkdGhcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9PYnJpZ2F0b3JpbyBjaGVjYWdlbSBhYmFpeG8gZG8gd2lkdGhcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hYm5lci5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL0NvbG9jYSBJbnB1dFxuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuaW5wdXQpO1xuICAgICAgICB0aGlzLmlucHV0LnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJfaW5wdXRcIik7XG4gICAgICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRleHRcIik7XG5cbiAgICAgICAgLy9vbmZvY3VzIG5vIG9iamV0b1xuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJvbmZvY3VzXCIpKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0LnNldEF0dHJpYnV0ZShcIm9uZm9jdXNcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJvbmZvY3VzXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQnVnSU9TIENvcnJpZ2kgYnVnIGRvIGN1cnNvciBuYSBzZWxlY2FvIGRvIHRleHRvXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heGxlbmd0aFwiKSkge1xuICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRBdHRyaWJ1dGUoXCJtYXhsZW5ndGhcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJtYXhsZW5ndGhcIikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRBdHRyaWJ1dGUoXCJtYXhsZW5ndGhcIiwgXCIxMDBcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJwbGFjZWhvbGRlclwiKSkge1xuICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRBdHRyaWJ1dGUoXCJwbGFjZWhvbGRlclwiLCB0aGlzLmdldEF0dHJpYnV0ZShcInBsYWNlaG9sZGVyXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ29sb2NhIExhYmVsXG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5sYWJlbCk7XG4gICAgICAgIHRoaXMubGFiZWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcIl9sYWJlbFwiKTtcbiAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJmb3JcIiwgaWQgKyBcIl9pbnB1dFwiKTtcblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJsYWJlbFwiKSkge1xuICAgICAgICAgICAgdGhpcy5sYWJlbC5pbm5lclRleHQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImxhYmVsXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9Db2xvY2EgbWVuc2FnZW0gZGUgZXJybyBcbiAgICAgICAgdGhpcy5zcGFuLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJfc3BhblwiKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiZXJyb3JcIikpIHtcbiAgICAgICAgICAgIHRoaXMuc3Bhbi5pbm5lclRleHQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImVycm9yXCIpO1xuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItaW5wdXQtdW5kZXJsaW5lLWVycm9yXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy9zZSB0aXZlciBkZXNjcmnDp8Ojb1xuICAgICAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiZGVzY3JpcHRpb25cIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW4uaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJkZXNjcmlwdGlvblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuc3Bhbik7XG5cbiAgICAgICAgLy9kZXNhYmlsaXRhciBvIGNhbXBvIHF1YW5kbyBvIGF0cmlidXRvIGlzLWRpc2FibGVkIMOpIHRydWVcbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NvbG9jYSB0YWJpbmRleFxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ0YWItaW5kZXhcIikpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0YWItaW5kZXhcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9wYXJhIHF1YWwgaW5kZXggdmFpXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImdvdG8tdGFiLWluZGV4XCIpKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0LnNldEF0dHJpYnV0ZShcImdvdG8tdGFiLWluZGV4XCIsIHRoaXMuZ2V0QXR0cmlidXRlKFwiZ290by10YWItaW5kZXhcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9wYXJhIHF1YWwgaW5kZXggdmFpXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInN0b3AtdGFiLWluZGV4XCIpKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0LnNldEF0dHJpYnV0ZShcInN0b3AtdGFiLWluZGV4XCIsIHRoaXMuZ2V0QXR0cmlidXRlKFwic3RvcC10YWItaW5kZXhcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy92ZXJpZmljYSBzZSB0ZW0gbWF4IHdpZHRoXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heC13aWR0aFwiKSkge1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy92aXNpdmVsXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcInZpc2libGVcIikgPT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIHNlIG8gY29tcG9uZW50ZSBlc3RhcsOhIGludmlzw612ZWwgb3UgbsOjbyB8IEJvb2xlYW4gfCBuw6NvIHwgfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvKmlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInZhbHVlXCIpKSB7XG4gICAgICAgICAgICB0aGlzLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwidmFsdWVcIik7XG4gICAgICAgIH07Ki9cbiAgICB9XG5cbiAgICBfYWRkRXZlbnQoKSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcy5pbnB1dCk7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgaW5wdXQub24oXCJmb2N1c1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvL0FycnVtYSBzY3JvbGwgbm8gbW9iaWxlIHF1YW5kbyBzb2JlIG8gdGVjbGFkbyBwYXJhIEFORFJPSURcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLnNjcm9sbEludG9WaWV3KCk7XG4gICAgICAgICAgICB9LCA1MDApO1xuXG4gICAgICAgICAgICBfdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItaW5wdXQtdW5kZXJsaW5lLW1pblwiKTtcbiAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1pbnB1dC11bmRlcmxpbmUtZm9jdXNcIik7XG5cbiAgICAgICAgICAgIC8vQ2hhbWEgYSBmdW5jYW8gcXVlIGNvbG9jb3Ugbm8gb25mb2N1c1xuICAgICAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwib25mb2N1c1wiKSkge1xuICAgICAgICAgICAgICAgIHZhciBmbiA9IHdpbmRvd1t0aGlzLmdldEF0dHJpYnV0ZShcIm9uZm9jdXNcIildO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgZm4uY2FsbCgkKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlucHV0Lm9uKFwiYmx1clwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItaW5wdXQtdW5kZXJsaW5lLWZvY3VzXCIpO1xuICAgICAgICAgICAgLy9UcmlnYSBhcyB2YWxpZGHDp8O1ZXNcbiAgICAgICAgICAgIGlmICghX3RoaXMuaGFzQXR0cmlidXRlKFwidGhvdXNhbmQtbWFza1wiKSkge1xuICAgICAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImNhbmNlbC1vbmNoYW5nZVwiLCBcInRydWVcIik7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgJCh0aGlzKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuXG4gICAgICAgICAgICAvL0NoYW1hIGEgZnVuY2FvIHF1ZSBjb2xjb3Ugbm8gb25ibHVyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwib25ibHVyXCIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZuID0gd2luZG93W190aGlzLmdldEF0dHJpYnV0ZShcIm9uYmx1clwiKV07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBmbi5jYWxsKCQoX3RoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vSXIgcGFyYSBvIHByw7N4aW1vIGl0ZW0gcXVhbmRvIGFwZXJ0YXIgZW50ZXJcbiAgICAgICAgaW5wdXQub24oXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIGtleSA9IGV2ZW50LmtleUNvZGUgPyBldmVudC5rZXlDb2RlIDogZXZlbnQud2hpY2g7XG4gICAgICAgICAgICAvL3ZhciBzaGlmdCA9ICEhZXZlbnQuc2hpZnRLZXk7XG4gICAgICAgICAgICB2YXIgbWF4ID0gMFxuICAgICAgICAgICAgdmFyIGxlbiA9IF90aGlzLmlucHV0LnZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heGxlbmd0aFwiKSkge1xuICAgICAgICAgICAgICAgIG1heCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4bGVuZ3RoXCIpO1xuICAgICAgICAgICAgICAgIGlmIChsZW4gPiBtYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGtleSA9PSAxMyB8fCBrZXkgPT0gOSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ29Ub05leHRUYWJpbmRleChldmVudCwgJCh0aGlzKSwgXCJ0YXBcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL2V2ZW50byBjaGFuZ2UgcXVhbmRvIGFsdGVyYXIgbyB2YWxvciBkbyBpbnB1dFxuICAgICAgICBpbnB1dC5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgLy9Tb2JlIG91IG5hbyBvIGxhYmVsIGNhc28gdGVuaGEgYWxndW0gdmFsb3JcbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWlucHV0LXVuZGVybGluZS1taW5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1pbnB1dC11bmRlcmxpbmUtbWluXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL3ZlcmlmaWNhIHNlIG8gY2FtcG8gw6kgb2JyaWdhdMOzcmlvXG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiaXMtcmVxdWlyZWRcIikgPT0gXCJ0cnVlXCIgJiYgIV90aGlzLmVycm9yQ2hpbGQpIHtcbiAgICAgICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImVycm9yXCIsIFwiQ2FtcG8gb2JyaWdhdMOzcmlvXCIpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5lcnJvclBhcmVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVtb3ZlQXR0cmlidXRlKFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmVycm9yUGFyZW50ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNwYW4uaW5uZXJUZXh0ID0gX3RoaXMuZ2V0QXR0cmlidXRlKFwiZGVzY3JpcHRpb25cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL0NoYW1hIGEgZnVuY2FvIHF1ZSBjb2xjb3Ugbm8gb25ibHVyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwib25jaGFuZ2VcIikgJiYgX3RoaXMuZ2V0QXR0cmlidXRlKFwiY2FuY2VsLW9uY2hhbmdlXCIpICE9IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZuID0gd2luZG93W190aGlzLmdldEF0dHJpYnV0ZShcIm9uY2hhbmdlXCIpXTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoJChfdGhpcykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLnJlbW92ZUF0dHJpYnV0ZShcImNhbmNlbC1vbmNoYW5nZVwiKTtcblxuICAgICAgICAgICAgLy9DaGFtYSBhIGZ1bmNhbyBxdWUgY29sY291IG5vIG9uYmx1clxuICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcIm9udmFsaWRhdGVcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm4gPSB3aW5kb3dbX3RoaXMuZ2V0QXR0cmlidXRlKFwib252YWxpZGF0ZVwiKV07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBmbi5jYWxsKCQoX3RoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vICQodGhpcykub24oXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgLy8gICAgICQoX3RoaXMuaW5wdXQpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgIC8vIH0pO1xuICAgIH1cblxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMubWFpbkNsYXNzKSkge1xuICAgICAgICAgICAgLyp0aGlzLnNoYWRvd0RvbSA9IHRoaXMuYXR0YWNoU2hhZG93KHtcbiAgICAgICAgICAgICAgICBtb2RlOiAnb3BlbidcbiAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcImlkXCIsIFwiZXJyb3JcIiwgXCJpcy1kaXNhYmxlZFwiLCBcImxhYmVsXCIsIFwid2lkdGhcIiwgXCJtYXhsZW5ndGhcIiwgXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIiwgXCJ0YWItaW5kZXhcIiwgXCJnb3RvLXRhYi1pbmRleFwiLCBcInZhbHVlXCIsIFwidmlzaWJsZVwiXTtcbiAgICB9XG5cbiAgICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2soYXR0ck5hbWUsIG9sZFZhbCwgbmV3VmFsKSB7XG5cbiAgICAgICAgc3dpdGNoIChhdHRyTmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCAhPSB1bmRlZmluZWQgJiYgbmV3VmFsICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGFuLmlubmVyVGV4dCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItaW5wdXQtdW5kZXJsaW5lLWVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yUGFyZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IG51bGwgfHwgbmV3VmFsID09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItaW5wdXQtdW5kZXJsaW5lLWVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yUGFyZW50ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3Bhbi5pbm5lclRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJkZXNjcmlwdGlvblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGFuLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiZGVzY3JpcHRpb25cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpcy1kaXNhYmxlZFwiOlxuICAgICAgICAgICAgICAgIC8vcXVhbmRvIG8gYXRyaWJ1dG8gaXMtZGlzYWJsZWQgw6kgYWx0ZXJhZG8sIGFkaWNpb25hIG91IHJldGlyYSBhIGNsYXNzZSB1bmRlcmxpbmUtbWluXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnB1dC52YWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1pbnB1dC11bmRlcmxpbmUtbWluXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXQudmFsdWUubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLWlucHV0LXVuZGVybGluZS1taW5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJsYWJlbFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubGFiZWwuaW5uZXJUZXh0ID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaWRcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsLnNldEF0dHJpYnV0ZShcImZvclwiLCBuZXdWYWwgKyBcIl9pbnB1dFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiX2xhYmVsXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJfaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwiX3NwYW5cIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJtYXhsZW5ndGhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldEF0dHJpYnV0ZShcIm1heGxlbmd0aFwiLCBuZXdWYWwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwid2lkdGhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gbmV3VmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwid2lkdGgtb24tYmlnc2NyZWVuXCI6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWJuZXIuc2hvd0JpZ1NjcmVlbih0b3AuJChcImJvZHlcIikpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwidGFiLWluZGV4XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCBuZXdWYWwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiZ290by10YWItaW5kZXhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldEF0dHJpYnV0ZShcImdvdG8tdGFiLWluZGV4XCIsIG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8qY2FzZSBcInZhbHVlXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhazsqL1xuXG4gICAgICAgICAgICBjYXNlIFwidmlzaWJsZVwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0VGV4dCh0ZXh0KSB7XG4gICAgICAgIGlmICh0aGlzLmNsYXNzTGlzdC5jb250YWlucyhcImFiLWlucHV0LWRhdGUtdW5kZXJsaW5lXCIpKSB7XG4gICAgICAgICAgICB0aGlzLnNldERhdGUodGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0LnZhbHVlID0gdGV4dDtcbiAgICAgICAgfVxuXG4gICAgICAgICQodGhpcy5pbnB1dCkuY2hhbmdlKCk7XG4gICAgfVxuXG4gICAgZ2V0VGV4dCgpIHtcbiAgICAgICAgaWYgKHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYWItaW5wdXQtZGF0ZS11bmRlcmxpbmVcIikpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERhdGUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0LnZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0TnVtYmVyKHRleHQpIHtcbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IHRleHQ7XG5cbiAgICAgICAgJCh0aGlzLmlucHV0KS5jaGFuZ2UoKTtcbiAgICB9XG5cbiAgICBnZXROdW1iZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlucHV0LnZhbHVlO1xuICAgIH1cbn1cblxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdhYi1pbnB1dCcsIEFiSW5wdXQpOyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgQ2hhc3NpRmxvYXRCdXR0b24gPSBmdW5jdGlvbihjaGFzc2kpIHtcbiAgICAvLyBFc2NvcG8gZG8gY2hhc3NpXG4gICAgdGhpcy5jaGFzc2kgPSBjaGFzc2k7XG5cbiAgICAvLyBUYW1hbmhvXG4gICAgdGhpcy5zaXplID0gXCI2NVwiO1xufVxuXG5DaGFzc2lGbG9hdEJ1dHRvbi5wcm90b3R5cGUub25Ub3VjaE1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgdmFyIGJ0bkRpdiA9ICQoXCIjRGl2YXV0b0hpZGVcIik7XG5cbiAgICBpZiAoYnRuRGl2LmF0dHIoJ2lkJykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vIFBlZ2EgbyB0b3F1ZVxuICAgICAgICB2YXIgdG91Y2ggPSBuZXcgT2JqZWN0KCk7XG4gICAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMpIHtcbiAgICAgICAgICAgIHRvdWNoID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0gfHwgZS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdG91Y2ggPSBlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGggPSBwYXJzZUludCgkKGJ0bkRpdikuY3NzKFwiaGVpZ2h0XCIpKTtcbiAgICAgICAgdmFyIHcgPSBwYXJzZUludCgkKGJ0bkRpdikuY3NzKFwid2lkdGhcIikpO1xuXG4gICAgICAgIC8vIE1vdmUgb2JqZXRvXG4gICAgICAgICQoYnRuRGl2KS5jc3MoXCJ0b3BcIiwgdG91Y2gucGFnZVkgLSAoaCAvIDIpKTtcbiAgICAgICAgJChidG5EaXYpLmNzcyhcImxlZnRcIiwgdG91Y2gucGFnZVggLSAodyAvIDIpKTtcbiAgICAgICAgJChidG5EaXYpLmF0dHIoXCJtb3ZlZFwiLCBcInRydWVcIik7XG4gICAgfVxufVxuXG5DaGFzc2lGbG9hdEJ1dHRvbi5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAvLyBSZW1vdmUgVGltZW91dFxuICAgIGlmICh3aW5kb3cuYnRuQ2hhc3NpRnVsbCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwod2luZG93LmJ0bkNoYXNzaUZ1bGwpO1xuICAgICAgICB3aW5kb3cuYnRuQ2hhc3NpRnVsbCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvLyByZW1vdmUgZXZlbnRvXG4gICAgJChkb2N1bWVudCkudW5iaW5kKFwidG91Y2htb3ZlIG1vdXNlbW92ZVwiLCBfdGhpcy5vblRvdWNoTW92ZSk7XG5cbiAgICAvLyBSZW1vdmUgYm90YW8gZGEgdGVsYVxuICAgICQoXCIjRGl2YXV0b0hpZGVcIikucmVtb3ZlKCk7XG59XG5cbkNoYXNzaUZsb2F0QnV0dG9uLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJ0bkRpdiA9ICQoXCIjRGl2YXV0b0hpZGVcIik7XG5cbiAgICBpZiAoYnRuRGl2LmF0dHIoJ2lkJykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICB0aGlzLnNob3coKTtcbiAgICB9XG59XG5cbkNoYXNzaUZsb2F0QnV0dG9uLnByb3RvdHlwZS5zZXROZXdQb3NpdGlvbiA9IGZ1bmN0aW9uKGUsIGZvcmNlTW92ZSkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdmFyIG9oID0gcGFyc2VJbnQoJChcIiNEaXZhdXRvSGlkZVwiKS5jc3MoXCJoZWlnaHRcIikpO1xuICAgIHZhciBvdyA9IHBhcnNlSW50KCQoXCIjRGl2YXV0b0hpZGVcIikuY3NzKFwid2lkdGhcIikpO1xuICAgIHZhciBvbCA9IHBhcnNlSW50KCQoXCIjRGl2YXV0b0hpZGVcIikuY3NzKFwibGVmdFwiKSk7XG4gICAgdmFyIG90ID0gcGFyc2VJbnQoJChcIiNEaXZhdXRvSGlkZVwiKS5jc3MoXCJ0b3BcIikpO1xuICAgIHZhciBvYiA9IHBhcnNlSW50KCQoXCIjRGl2YXV0b0hpZGVcIikuY3NzKFwiYm90dG9tXCIpKTtcblxuICAgIHZhciB3ID0gcGFyc2VJbnQoJCh3aW5kb3cpLndpZHRoKCkpO1xuICAgIHZhciBoID0gcGFyc2VJbnQoJCh3aW5kb3cpLmhlaWdodCgpKTtcblxuICAgIHZhciBkb250TW92ZSA9IGZhbHNlO1xuXG4gICAgaWYgKG90IDwgMzApIHtcbiAgICAgICAgJChcIiNEaXZhdXRvSGlkZVwiKS5hbmltYXRlKHtcbiAgICAgICAgICAgIFwidG9wXCI6IFwiMTBweFwiXG4gICAgICAgIH0sIDEwMCk7XG4gICAgICAgIGRvbnRNb3ZlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoKG90ICsgb2ggKyAzMCkgPiBoKSB7XG4gICAgICAgICQoXCIjRGl2YXV0b0hpZGVcIikuYW5pbWF0ZSh7XG4gICAgICAgICAgICBcInRvcFwiOiBoIC0gKG9oICsgMTApXG4gICAgICAgIH0sIDEwMCk7XG4gICAgICAgIGRvbnRNb3ZlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoZG9udE1vdmUgPT0gZmFsc2UgfHwgZm9yY2VNb3ZlICE9IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoKG9sICsgKG93IC8gMikpID4gKHcgLyAyKSkge1xuICAgICAgICAgICAgJChcIiNEaXZhdXRvSGlkZVwiKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBcImxlZnRcIjogdyAtIG93IC0gMTAgKyBcInB4XCJcbiAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKFwiI0RpdmF1dG9IaWRlXCIpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIFwibGVmdFwiOiBcIjVweFwiXG4gICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJChkb2N1bWVudCkudW5iaW5kKFwidG91Y2htb3ZlIG1vdXNlbW92ZVwiLCBfdGhpcy5vblRvdWNoTW92ZSk7XG59XG5cbkNoYXNzaUZsb2F0QnV0dG9uLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJ0bkRpdiA9ICQoXCIjRGl2YXV0b0hpZGVcIik7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIGlmIChidG5EaXYuYXR0cignaWQnKSA9PSB1bmRlZmluZWQpIHtcblxuICAgICAgICB2YXIgZGl2ID0gJChcIjxkaXY+XCIsIHtcbiAgICAgICAgICAgIGlkOiBcIkRpdmF1dG9IaWRlXCJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGl2LmFkZENsYXNzKCdhYi1tZW51LWZsb2F0Jyk7XG4gICAgICAgIGRpdi5jc3MoJ2hlaWdodCcsICcwcHgnKTtcbiAgICAgICAgZGl2LmNzcygnd2lkdGgnLCAnMHB4Jyk7XG4gICAgICAgIGRpdi5jc3MoJ2JhY2tncm91bmQtY29sb3InLCAnd2hpdGUnKTtcbiAgICAgICAgZGl2LmNzcygnYm9yZGVyJywgJzFweCBzb2xpZCAjY2FjYWNhJyk7XG4gICAgICAgIGRpdi5jc3MoJ2JvcmRlci1yYWRpdXMnLCAnNTRweCcpO1xuICAgICAgICBkaXYuY3NzKCdjdXJzb3InLCAncG9pbnRlcicpO1xuICAgICAgICBkaXYuY3NzKCdvcGFjaXR5JywgJzAnKTtcbiAgICAgICAgZGl2LmNzcygncG9zaXRpb24nLCAnZml4ZWQnKTtcbiAgICAgICAgZGl2LmNzcygndGV4dC1hbGlnbicsICdjZW50ZXInKTtcbiAgICAgICAgZGl2LmNzcygnei1pbmRleCcsIDk4KTtcbiAgICAgICAgZGl2LmNzcygnYm90dG9tJywgJzEwcHgnKTtcbiAgICAgICAgZGl2LmNzcygnbGVmdCcsICQod2luZG93KS53aWR0aCgpKTtcblxuICAgICAgICAvLyBFdml0YXIgU2VsZWNhb1xuICAgICAgICBkaXYuYXR0cigndW5zZWxlY3RhYmxlJywgJ29uJylcbiAgICAgICAgZGl2LmNzcygndXNlci1zZWxlY3QnLCAnbm9uZScpXG4gICAgICAgIGRpdi5vbignc2VsZWN0c3RhcnQnLCBmYWxzZSk7XG5cbiAgICAgICAgLy8gRmVjaGEgYm90YW8gYW8gdGVybWluYXJcbiAgICAgICAgZGl2Lm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGlmICgkKFwiI0RpdmF1dG9IaWRlXCIpLmF0dHIoXCJtb3ZlZFwiKSA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgICAkKFwiYWItbWVudVwiKS5hdHRyKFwidmlzaWJsZVwiLCBcInRydWVcIik7XG4gICAgICAgICAgICAgICAgX3RoaXMuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGljaW9uYSBubyBodG1sXG4gICAgICAgICQoJ2JvZHknKS5hcHBlbmQoZGl2KTtcblxuICAgICAgICAvLyBhbmltYWNhb1xuICAgICAgICBkaXYuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBcIjFcIixcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5zaXplICsgXCJweFwiLFxuICAgICAgICAgICAgd2lkdGg6IHRoaXMuc2l6ZSArIFwicHhcIixcbiAgICAgICAgICAgICdsZWZ0JzogKCQod2luZG93KS53aWR0aCgpIC0gdGhpcy5zaXplIC0gMTApXG4gICAgICAgIH0sIDIwMCwgJ2xpbmVhcicpO1xuXG4gICAgICAgIC8vIC8vIENvbG9jYSBmdW5jb2VzXG4gICAgICAgIGRpdi5vbihcInRvdWNoc3RhcnQgbW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICQoXCIjRGl2YXV0b0hpZGVcIikuYXR0cihcIm1vdmVkXCIsIFwiZmFsc2VcIik7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQpLmJpbmQoXCJ0b3VjaG1vdmUgbW91c2Vtb3ZlXCIsIF90aGlzLm9uVG91Y2hNb3ZlKTtcblxuICAgICAgICAgICAgJChcIiNEaXZhdXRvSGlkZVwiKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBcIm9wYWNpdHlcIjogXCIxXCJcbiAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFF1YW5kbyBzdWJpciBlbmNvc3RhciBvIGJvdGFvXG4gICAgICAgIGRpdi5vbihcInRvdWNoZW5kIG1vdXNldXBcIiwgZnVuY3Rpb24oZSkge1xuXG4gICAgICAgICAgICAkKGRvY3VtZW50KS51bmJpbmQoXCJ0b3VjaG1vdmUgbW91c2Vtb3ZlXCIsIF90aGlzLm9uVG91Y2hNb3ZlKTtcblxuICAgICAgICAgICAgX3RoaXMuc2V0TmV3UG9zaXRpb24oZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFybWF6ZW5hIGZ1bmNhbyBwYXJhIGRlaXhhciBtYWlzIGNsYXJvIG8gYm90YW9cbiAgICAgICAgaWYgKHdpbmRvdy5idG5DaGFzc2lGdWxsICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwod2luZG93LmJ0bkNoYXNzaUZ1bGwpO1xuICAgICAgICAgICAgd2luZG93LmJ0bkNoYXNzaUZ1bGwgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDb2xvY2EgYWNhbyBwYXJhIGZpY2FyIHRyYW5zcGFyZW50ZVxuICAgICAgICB3aW5kb3cuYnRuQ2hhc3NpRnVsbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGxhc3RUb3BMZWZ0ID0gcGFyc2VJbnQoJChcIiNEaXZhdXRvSGlkZVwiKS5hdHRyKFwibGFzdFRvcExlZnRcIikpO1xuICAgICAgICAgICAgdmFyIG9sID0gcGFyc2VJbnQoJChcIiNEaXZhdXRvSGlkZVwiKS5jc3MoXCJsZWZ0XCIpKTtcbiAgICAgICAgICAgIHZhciBvdCA9IHBhcnNlSW50KCQoXCIjRGl2YXV0b0hpZGVcIikuY3NzKFwidG9wXCIpKTtcbiAgICAgICAgICAgIHZhciB0b3QgPSAwO1xuXG4gICAgICAgICAgICBpZiAoJChcIiNEaXZhdXRvSGlkZVwiKS5jc3MoXCJsZWZ0XCIpICE9IFwiYXV0b1wiICYmICQoXCIjRGl2YXV0b0hpZGVcIikuY3NzKFwidG9wXCIpICE9IFwiYXV0b1wiKSB7XG4gICAgICAgICAgICAgICAgdG90ID0gKG9sICsgb3QpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYXN0VG9wTGVmdCA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChsYXN0VG9wTGVmdCA9PSB0b3QpIHtcbiAgICAgICAgICAgICAgICAkKFwiI0RpdmF1dG9IaWRlXCIpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBcIm9wYWNpdHlcIjogXCIwLjVcIlxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNhbHZhIHVsdGltbyB0b3BsZWZ0XG4gICAgICAgICAgICAkKFwiI0RpdmF1dG9IaWRlXCIpLmF0dHIoXCJsYXN0VG9wTGVmdFwiLCB0b3QpO1xuXG4gICAgICAgIH0sIDMwMDApO1xuICAgIH1cbn1cblxuY2xhc3MgQWJNZW51IGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5tYWluQ2xhc3MgPSBcImFiLW1lbnVcIjtcblxuICAgICAgICB0aGlzLnN0YXRlID0gXCJjbG9zZWRcIjtcbiAgICAgICAgdGhpcy5zdGFydFggPSAwO1xuICAgICAgICB0aGlzLmN1cnJlbnRYID0gMDtcbiAgICAgICAgdGhpcy5hY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLm1heFRyYW5zbGF0ZSA9IDA7XG4gICAgICAgIHRoaXMuY3VyclRyYW5zbGF0ZSA9IDA7XG4gICAgICAgIHRoaXMuZGl2T3BhY2l0eSA9IFwiMC44XCI7XG4gICAgICAgIHRoaXMuekluZGV4ID0gXCIxMDJcIjtcbiAgICAgICAgdGhpcy5hbmltYXRpb25UaW1lID0gXCIyMDBcIjtcbiAgICAgICAgdGhpcy5mbG9hdEJ1dHRvbiA9IG5ldyBDaGFzc2lGbG9hdEJ1dHRvbigpO1xuICAgICAgICB0aGlzLmlzRm9vdGVyT25Cb2R5ID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc0hlYWRlck9uQm9keSA9IG51bGw7XG4gICAgfVxuXG4gICAgX3JlbmRlcigpIHtcbiAgICAgICAgdmFyIGhlaWdodCA9ICQodGhpcykuYXR0cihcImhlaWdodFwiKTtcbiAgICAgICAgaWYgKGhlaWdodCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICQodGhpcykuY3NzKFwiaGVpZ2h0XCIsIGhlaWdodCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKHRoaXMpLmNzcyhcImhlaWdodFwiLCBcIjEwMCVcIik7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgdmFyIHdpZHRoID0gJCh0aGlzKS5hdHRyKFwid2lkdGhcIik7XG4gICAgICAgIGlmICh3aWR0aCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICQodGhpcykuY3NzKFwid2lkdGhcIiwgd2lkdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJ3aWR0aFwiLCBcIjIwMHB4XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGhlaWdodCA9ICQodGhpcykuYXR0cihcImhlaWdodFwiKTtcbiAgICAgICAgaWYgKGhlaWdodCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICQodGhpcykuY3NzKFwiaGVpZ2h0XCIsIGhlaWdodCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKHRoaXMpLmNzcyhcImhlaWdodFwiLCBcIjEwMCVcIik7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgdmFyIHdpZHRoID0gJCh0aGlzKS5hdHRyKFwid2lkdGhcIik7XG4gICAgICAgIGlmICh3aWR0aCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICQodGhpcykuY3NzKFwid2lkdGhcIiwgd2lkdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJ3aWR0aFwiLCBcIjIwMHB4XCIpO1xuICAgICAgICB9XG4gICAgXG4gICAgICAgIC8vIFZlcmlmaWNhY2FvIGRvIGZvb3RlclxuICAgICAgICB0aGlzLmlzRm9vdGVyT25Cb2R5ID0gZmFsc2VcbiAgICAgICAgdGhpcy5pc0hlYWRlck9uQm9keSA9ICQoXCJhYi1oZWFkZXJcIikucGFyZW50KCkuaXMoXCJib2R5XCIpO1xuICAgIFxuICAgICAgICB0aGlzLm1vZGUzZCA9IHRoaXMuc3VwcG9ydDNkKCk7XG4gICAgXG4gICAgICAgIC8vIENvbmZpZ3VyYSBtZW51XG4gICAgICAgICQodGhpcykuY3NzKFwiekluZGV4XCIsIHRoaXMuekluZGV4KTtcbiAgICAgICAgJCh0aGlzKS5jc3MoXCJwb3NpdGlvblwiLCBcImZpeGVkXCIpO1xuICAgICAgICAkKHRoaXMpLmNzcyhcImxlZnRcIiwgXCIwcHhcIik7XG4gICAgICAgICQodGhpcykuY3NzKFwidG9wXCIsIFwiMHB4XCIpO1xuICAgICAgICAkKHRoaXMpLmNzcyhcIm92ZXJmbG93WVwiLCBcImF1dG9cIik7XG4gICAgXG4gICAgICAgIC8vIEFqdXN0YSBhbmltYWNvZXNcbiAgICAgICAgdGhpcy5tYXhUcmFuc2xhdGUgPSBwYXJzZUZsb2F0KCQodGhpcykuY3NzKFwid2lkdGhcIikpO1xuICAgIFxuICAgICAgICAvLyBBYnJlIG91IGZlY2hhIG1lbnVcbiAgICAgICAgdmFyIHZpc2libGUgPSAkKHRoaXMpLmF0dHIoXCJ2aXNpYmxlXCIpO1xuICAgICAgICBpZiAodmlzaWJsZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudmlzaWJsZSh0aGlzLCBcIjBcIiwgdmlzaWJsZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnZpc2libGUodGhpcywgXCIwXCIsIFwiZmFsc2VcIik7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgaWYgKCQodGhpcykuYXR0cihcImZsb2F0LWJ1dHRvblwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZmxvYXRCdXR0b24ucmVmcmVzaCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgaWYgKCQodGhpcykuYXR0cihcInRvdWNoLW1vdmVcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbihcInRvdWNobW92ZSBtb3VzZW1vdmVcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5tb3VzZU1vdmUoZXZlbnQpO1xuICAgICAgICAgICAgICAgIC8vIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICAgICAgJChkb2N1bWVudCkub24oXCJ0b3VjaHN0YXJ0IG1vdXNlZG93blwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIF90aGlzLm1vdXNlRG93bihldmVudCk7XG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgXG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbihcInRvdWNoZW5kIG1vdXNldXBcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5tb3VzZVVwKGV2ZW50KTtcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKHRoaXMubWFpbkNsYXNzKTtcbiAgICB9XG5cbiAgICBfYWRkRXZlbnQoKSB7XG4gICAgfVxuXG4gICAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5jbGFzc0xpc3QuY29udGFpbnModGhpcy5tYWluQ2xhc3MpKSB7XG4gICAgICAgICAgICAvKnRoaXMuc2hhZG93RG9tID0gdGhpcy5hdHRhY2hTaGFkb3coe1xuICAgICAgICAgICAgICAgIG1vZGU6ICdvcGVuJ1xuICAgICAgICAgICAgfSk7ICovXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2FkZEV2ZW50KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcInZpc2libGVcIl07XG4gICAgfVxuXG4gICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGF0dHJOYW1lLCBvbGRWYWwsIG5ld1ZhbCkge1xuICAgICAgICBpZiAoYXR0ck5hbWUgPT0gXCJ2aXNpYmxlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuaXNGb290ZXJPbkJvZHkgPSBmYWxzZVxuICAgICAgICAgICAgdGhpcy5pc0hlYWRlck9uQm9keSA9ICQoXCJhYi1oZWFkZXJcIikucGFyZW50KCkuaXMoXCJib2R5XCIpO1xuICAgIFxuICAgICAgICAgICAgdmFyIHZpc2libGUgPSAkKHRoaXMpLmF0dHIoXCJ2aXNpYmxlXCIpO1xuICAgIFxuICAgICAgICAgICAgdGhpcy52aXNpYmxlKHRoaXMsIHRoaXMuYW5pbWF0aW9uVGltZSwgdmlzaWJsZSk7XG4gICAgXG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwiZmxvYXQtYnV0dG9uXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZpc2libGUgPT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmxvYXRCdXR0b24uc2hvdygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmxvYXRCdXR0b24uaGlkZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSAgICBcbiAgICB9XG5cbiAgICBtb3ZlWChfdGhpcywgdGltZSwgc2hvdywgdHJhbnNsYXRlWCkge1xuICAgICAgICB2YXIgbW9kZTNkID0gdGhpcy5zdXBwb3J0M2QoKTtcbiAgICAgICAgdmFyIHRyYW5zID0gdGhpcy5nZXRUcmFuc2Zvcm0oX3RoaXMpO1xuICAgICAgICB2YXIgeSA9IHRyYW5zWzFdO1xuICAgIFxuICAgICAgICAvLyB0cmFuc2ljYW9cbiAgICAgICAgaWYgKG1vZGUzZCkge1xuICAgICAgICAgICAgJChfdGhpcykuY3NzKFwidHJhbnNpdGlvblwiLCBcInRyYW5zZm9ybSBcIiArIHRpbWUgKyBcIm1zXCIpO1xuICAgICAgICAgICAgJChfdGhpcykuY3NzKFwiLW8tdHJhbnNpdGlvblwiLCBcIi1vLXRyYW5zZm9ybSBcIiArIHRpbWUgKyBcIm1zXCIpO1xuICAgICAgICAgICAgJChfdGhpcykuY3NzKFwiLW1zLXRyYW5zaXRpb25cIiwgXCItbXMtdHJhbnNmb3JtIFwiICsgdGltZSArIFwibXNcIik7XG4gICAgICAgICAgICAkKF90aGlzKS5jc3MoXCItbW96LXRyYW5zaXRpb25cIiwgXCItbW96LXRyYW5zZm9ybSBcIiArIHRpbWUgKyBcIm1zXCIpO1xuICAgICAgICAgICAgJChfdGhpcykuY3NzKFwiLXdlYmtpdC10cmFuc2l0aW9uXCIsIFwiLXdlYmtpdC10cmFuc2Zvcm0gXCIgKyB0aW1lICsgXCJtc1wiKTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICBpZiAoc2hvdyA9PSBmYWxzZSkge1xuICAgICAgICAgICAgaWYgKG1vZGUzZCkge1xuICAgICAgICAgICAgICAgICQoX3RoaXMpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIFwidHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoXCIgKyAoLTEgKiB0cmFuc2xhdGVYKSArIFwicHgsXCIgKyB5ICsgXCJweCwwKVwiLFxuICAgICAgICAgICAgICAgICAgICBcIi13ZWJraXQtdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoXCIgKyAoLTEgKiB0cmFuc2xhdGVYKSArIFwicHgsXCIgKyB5ICsgXCJweCwwKVwiLFxuICAgICAgICAgICAgICAgICAgICBcIi1tb3otdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoXCIgKyAoLTEgKiB0cmFuc2xhdGVYKSArIFwicHgsXCIgKyB5ICsgXCJweCwwKVwiLFxuICAgICAgICAgICAgICAgICAgICBcIi1tcy10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArICgtMSAqIHRyYW5zbGF0ZVgpICsgXCJweCxcIiArIHkgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiLW8tdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoXCIgKyAoLTEgKiB0cmFuc2xhdGVYKSArIFwicHgsXCIgKyB5ICsgXCJweCwwKVwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aW1lID09IFwiMFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICQoX3RoaXMpLmNzcyhcImxlZnRcIiwgKC0xICogdHJhbnNsYXRlWCkgKyBcInB4XCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoX3RoaXMpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJsZWZ0XCI6ICgtMSAqIHRyYW5zbGF0ZVgpICsgXCJweFwiXG4gICAgICAgICAgICAgICAgICAgIH0sIHRpbWUsIGZ1bmN0aW9uKCkge30pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChtb2RlM2QpIHtcbiAgICAgICAgICAgICAgICAkKF90aGlzKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBcInRyYW5zZm9ybVwiOiBcInRyYW5zbGF0ZTNkKDAsXCIgKyB5ICsgXCJweCwwKVwiLFxuICAgICAgICAgICAgICAgICAgICBcIi13ZWJraXQtdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoMCxcIiArIHkgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiLW1vei10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZCgwLFwiICsgeSArIFwicHgsMClcIixcbiAgICAgICAgICAgICAgICAgICAgXCItbXMtdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoMCxcIiArIHkgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiLW8tdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoMCxcIiArIHkgKyBcInB4LDApXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICBcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRpbWUgPT0gXCIwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgJChfdGhpcykuY3NzKFwibGVmdFwiLCBcIjBweFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKF90aGlzKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGVmdFwiOiBcIjBweFwiXG4gICAgICAgICAgICAgICAgICAgIH0sIHRpbWUsIGZ1bmN0aW9uKCkge30pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICB2aXNpYmxlKF90aGlzLCB0aW1lLCB2aXNpYmxlKSB7XG4gICAgXG4gICAgICAgIGlmICh2aXNpYmxlICE9IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJUcmFuc2xhdGUgPSAwO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFwiY2xvc2VkXCI7XG4gICAgXG4gICAgICAgICAgICB0aGlzLm1vdmVYKF90aGlzLCB0aW1lLCBmYWxzZSwgdGhpcy5tYXhUcmFuc2xhdGUpO1xuICAgICAgICAgICAgLy8gdGhpcy5tb3ZlWCgkKFwiYWItaGVhZGVyXCIpLCB0aW1lLCBmYWxzZSwgdGhpcy5tYXhUcmFuc2xhdGUpO1xuICAgIFxuICAgICAgICAgICAgaWYgKCQoX3RoaXMpLmF0dHIoXCJhbmltYXRpb25cIikgPT0gXCJwdXNoXCIgfHwgJChfdGhpcykuYXR0cihcImFuaW1hdGlvblwiKSA9PSBcInB1c2hBbmRGaXRcIikge1xuICAgICAgICAgICAgICAgIHRoaXMubW92ZVgoJChcImFiLXBhZ2VcIiksIHRpbWUsIHRydWUsICgtMSAqIHRoaXMubWF4VHJhbnNsYXRlKSk7XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNIZWFkZXJPbkJvZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlWCgkKFwiYWItaGVhZGVyXCIpLCB0aW1lLCB0cnVlLCAoLTEgKiB0aGlzLm1heFRyYW5zbGF0ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0Zvb3Rlck9uQm9keSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVYKCQoXCJhYi1wYWdlXCIpLCB0aW1lLCB0cnVlLCAoLTEgKiB0aGlzLm1heFRyYW5zbGF0ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQmxvY2tEaXYoKTtcbiAgICBcbiAgICAgICAgICAgIGlmICgkKF90aGlzKS5hdHRyKFwiYW5pbWF0aW9uXCIpID09IFwicHVzaEFuZEZpdFwiKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJChcImFiLXBhZ2VcIikuY3NzKFwid2lkdGhcIiwgXCIxMDAlXCIpO1xuICAgICAgICAgICAgICAgIH0sIHRpbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFwib3BlbmVkXCI7XG4gICAgICAgICAgICB0aGlzLmN1cnJUcmFuc2xhdGUgPSB0aGlzLm1heFRyYW5zbGF0ZTtcbiAgICAgICAgICAgIHRoaXMubW92ZVgoX3RoaXMsIHRpbWUsIHRydWUsIFwiMFwiKTtcbiAgICBcbiAgICAgICAgICAgIGlmICgkKF90aGlzKS5hdHRyKFwiYW5pbWF0aW9uXCIpID09IFwicHVzaFwiIHx8ICQoX3RoaXMpLmF0dHIoXCJhbmltYXRpb25cIikgPT0gXCJwdXNoQW5kRml0XCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdmVYKCQoXCJhYi1wYWdlXCIpLCB0aW1lLCBmYWxzZSwgKC0xICogdGhpcy5tYXhUcmFuc2xhdGUpKTtcbiAgICBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0hlYWRlck9uQm9keSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVYKCQoXCJhYi1oZWFkZXJcIiksIHRpbWUsIGZhbHNlLCAoLTEgKiB0aGlzLm1heFRyYW5zbGF0ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0Zvb3Rlck9uQm9keSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVYKCQoXCJhYi1wYWdlXCIpLCB0aW1lLCBmYWxzZSwgKC0xICogdGhpcy5tYXhUcmFuc2xhdGUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUJsb2NrRGl2KCk7XG4gICAgXG4gICAgICAgICAgICBpZiAoJChfdGhpcykuYXR0cihcImFuaW1hdGlvblwiKSA9PSBcInB1c2hBbmRGaXRcIikge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB3ID0gcGFyc2VGbG9hdCgkKFwiYWItbWVudVwiKS5jc3MoXCJ3aWR0aFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICQoXCJhYi1wYWdlXCIpLmNzcyhcIndpZHRoXCIsIFwiLXdlYmtpdC1jYWxjKDEwMCUgLSBcIiArIHcgKyBcInB4KVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcImFiLXBhZ2VcIikuY3NzKFwid2lkdGhcIiwgXCItbW96LWNhbGMoMTAwJSAtIFwiICsgdyArIFwicHgpXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiYWItcGFnZVwiKS5jc3MoXCJ3aWR0aFwiLCBcIi1vLWNhbGMoMTAwJSAtIFwiICsgdyArIFwicHgpXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiYWItcGFnZVwiKS5jc3MoXCJ3aWR0aFwiLCBcImNhbGMoMTAwJSAtIFwiICsgdyArIFwicHgpXCIpO1xuICAgICAgICAgICAgICAgIH0sIHRpbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHN1cHBvcnQzZCgpIHtcbiAgICAgICAgdmFyIHJldCA9IGZhbHNlO1xuICAgICAgICB2YXIgc3VwcG9ydHMzRFRyYW5zZm9ybXMgPSBkb2N1bWVudC5ib2R5LnN0eWxlWyd3ZWJraXRQZXJzcGVjdGl2ZSddICE9PSB1bmRlZmluZWQgfHwgZG9jdW1lbnQuYm9keS5zdHlsZVsnTW96UGVyc3BlY3RpdmUnXSAhPT0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAoc3VwcG9ydHMzRFRyYW5zZm9ybXMpIHtcbiAgICAgICAgICAgIHJldCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG4gICAgXG4gICAgZ2V0WFkoZXZlbnQpIHtcbiAgICAgICAgdmFyIHggPSBudWxsO1xuICAgICAgICB2YXIgeSA9IG51bGw7XG4gICAgXG4gICAgICAgIGlmIChldmVudC5vcmlnaW5hbEV2ZW50ICE9IG51bGwgJiYgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZhciB0b3VjaCA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXSB8fCBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuICAgICAgICAgICAgeCA9IHBhcnNlRmxvYXQodG91Y2gucGFnZVgpO1xuICAgICAgICAgICAgeSA9IHBhcnNlRmxvYXQodG91Y2gucGFnZVkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeCA9IHBhcnNlRmxvYXQoZXZlbnQucGFnZVgpO1xuICAgICAgICAgICAgeSA9IHBhcnNlRmxvYXQoZXZlbnQucGFnZVkpO1xuICAgICAgICB9XG4gICAgXG4gICAgICAgIHZhciBwb3MgPSBuZXcgT2JqZWN0KCk7XG4gICAgICAgIHBvcy54ID0geDtcbiAgICAgICAgcG9zLnkgPSB5O1xuICAgIFxuICAgICAgICByZXR1cm4gcG9zO1xuICAgIH1cbiAgICBcbiAgICBtb3VzZU1vdmUoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICBcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uID09IFwibW92ZVwiICYmICh0aGlzLnN0YXRlID09IFwiY2xvc2VkXCIgfHwgdGhpcy5zdGF0ZSA9PSBcIm9wZW5lZFwiKSkge1xuICAgIFxuICAgICAgICAgICAgdmFyIHBvcyA9IHRoaXMuZ2V0WFkoZXZlbnQpO1xuICAgIFxuICAgICAgICAgICAgLy8gZmVjaGEgb3UgYWJyZVxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT0gXCJjbG9zZWRcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VyclRyYW5zbGF0ZSA9ICh0aGlzLmN1cnJlbnRYICsgdGhpcy5zdGFydFggKyBwb3MueCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VyclRyYW5zbGF0ZSA9ICh0aGlzLmN1cnJlbnRYICsgKHBvcy54IC0gdGhpcy5zdGFydFgpKTtcbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIC8vIGRlaXhhIG8gdHJhbnNsYXRlIG5vIG1heGltbyBlIG5vIG1pbmltb1xuICAgICAgICAgICAgaWYgKHRoaXMuY3VyclRyYW5zbGF0ZSA+PSB0aGlzLm1heFRyYW5zbGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VyclRyYW5zbGF0ZSA9IHRoaXMubWF4VHJhbnNsYXRlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmN1cnJUcmFuc2xhdGUgPD0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VyclRyYW5zbGF0ZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICB2YXIgdHJhbnMgPSB0aGlzLmdldFRyYW5zZm9ybSh0aGlzKTtcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQodGhpcy5jdXJyVHJhbnNsYXRlKTtcbiAgICAgICAgICAgIHZhciB5ID0gdHJhbnNbMV07XG4gICAgICAgICAgICB2YXIgZGVsdGEgPSAoeCAtIHRoaXMubWF4VHJhbnNsYXRlKTtcbiAgICBcbiAgICAgICAgICAgIC8vIE11ZGFyIExlZnRcbiAgICAgICAgICAgIGlmICh0aGlzLm1vZGUzZCkge1xuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIGRlbHRhICsgXCJweCxcIiArIHkgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiLXdlYmtpdC10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIGRlbHRhICsgXCJweCxcIiArIHkgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiLW1vei10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIGRlbHRhICsgXCJweCxcIiArIHkgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiLW1zLXRyYW5zZm9ybVwiOiBcInRyYW5zbGF0ZTNkKFwiICsgZGVsdGEgKyBcInB4LFwiICsgeSArIFwicHgsMClcIixcbiAgICAgICAgICAgICAgICAgICAgXCItby10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIGRlbHRhICsgXCJweCxcIiArIHkgKyBcInB4LDApXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICBcbiAgICAgICAgICAgICAgICAvLyBtb3ZlIG8gcmVzdG9cbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwiYW5pbWF0aW9uXCIpID09IFwicHVzaFwiIHx8ICQodGhpcykuYXR0cihcImFuaW1hdGlvblwiKSA9PSBcInB1c2hBbmRGaXRcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNQYWdlID0gdGhpcy5nZXRUcmFuc2Zvcm0oJChcImFiLXBhZ2VcIikpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgeVBhZ2UgPSB0cmFuc1BhZ2VbMV07XG4gICAgICAgICAgICAgICAgICAgICQoXCJhYi1wYWdlXCIpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInRyYW5zZm9ybVwiOiBcInRyYW5zbGF0ZTNkKFwiICsgeCArIFwicHgsXCIgKyB5UGFnZSArIFwicHgsMClcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiLXdlYmtpdC10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIHggKyBcInB4LFwiICsgeVBhZ2UgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIi1tb3otdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoXCIgKyB4ICsgXCJweCxcIiArIHlQYWdlICsgXCJweCwwKVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCItbXMtdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoXCIgKyB4ICsgXCJweCxcIiArIHlQYWdlICsgXCJweCwwKVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCItby10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIHggKyBcInB4LFwiICsgeVBhZ2UgKyBcInB4LDApXCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzSGVhZGVyT25Cb2R5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNQYWdlID0gdGhpcy5nZXRUcmFuc2Zvcm0oJChcImFiLWhlYWRlclwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeUhlYWQgPSB0cmFuc1BhZ2VbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiYWItaGVhZGVyXCIpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIHggKyBcInB4LFwiICsgeUhlYWQgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItd2Via2l0LXRyYW5zZm9ybVwiOiBcInRyYW5zbGF0ZTNkKFwiICsgeCArIFwicHgsXCIgKyB5SGVhZCArIFwicHgsMClcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi1tb3otdHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoXCIgKyB4ICsgXCJweCxcIiArIHlIZWFkICsgXCJweCwwKVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLW1zLXRyYW5zZm9ybVwiOiBcInRyYW5zbGF0ZTNkKFwiICsgeCArIFwicHgsXCIgKyB5SGVhZCArIFwicHgsMClcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi1vLXRyYW5zZm9ybVwiOiBcInRyYW5zbGF0ZTNkKFwiICsgeCArIFwicHgsXCIgKyB5SGVhZCArIFwicHgsMClcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNGb290ZXJPbkJvZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc1BhZ2UgPSB0aGlzLmdldFRyYW5zZm9ybSgkKFwiYWItcGFnZVwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeVBhZ2UgPSB0cmFuc1BhZ2VbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiYWItcGFnZVwiKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHJhbnNmb3JtXCI6IFwidHJhbnNsYXRlM2QoXCIgKyB4ICsgXCJweCxcIiArIHlQYWdlICsgXCJweCwwKVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLXdlYmtpdC10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIHggKyBcInB4LFwiICsgeVBhZ2UgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItbW96LXRyYW5zZm9ybVwiOiBcInRyYW5zbGF0ZTNkKFwiICsgeCArIFwicHgsXCIgKyB5UGFnZSArIFwicHgsMClcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi1tcy10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIHggKyBcInB4LFwiICsgeVBhZ2UgKyBcInB4LDApXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItby10cmFuc2Zvcm1cIjogXCJ0cmFuc2xhdGUzZChcIiArIHggKyBcInB4LFwiICsgeVBhZ2UgKyBcInB4LDApXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICBcbiAgICAgICAgICAgICAgICAvLyBNdWRhIG1lbnUgY29tIGEgZGlmZXJlbmNhIGRvIHRhbWFuaG8gZGVsZVxuICAgICAgICAgICAgICAgIHZhciBkaWZmID0gcGFyc2VGbG9hdCgkKHRoaXMpLmNzcyhcIndpZHRoXCIpKTtcbiAgICAgICAgICAgICAgICBkaWZmID0gKHggLSBwYXJzZUZsb2F0KGRpZmYpKTtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcImxlZnRcIiwgZGlmZiArIFwicHhcIik7XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cihcImFuaW1hdGlvblwiKSA9PSBcInB1c2hcIiB8fCAkKHRoaXMpLmF0dHIoXCJhbmltYXRpb25cIikgPT0gXCJwdXNoQW5kRml0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbXVkYSBvdXRyb3MgY29tIG8geCBub3JtYWxcbiAgICAgICAgICAgICAgICAgICAgJChcImFiLXBhZ2VcIikuY3NzKFwibGVmdFwiLCB4ICsgXCJweFwiKTtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNIZWFkZXJPbkJvZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCJhYi1oZWFkZXJcIikuY3NzKFwibGVmdFwiLCB4ICsgXCJweFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0Zvb3Rlck9uQm9keSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcImFiLWZvb3RlclwiKS5jc3MoXCJsZWZ0XCIsIHggKyBcInB4XCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgLy8gQXJydW1hIHRhbWFuaG9cbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJhbmltYXRpb25cIikgPT0gXCJwdXNoQW5kRml0XCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGlmZiA9IHBhcnNlRmxvYXQoJCh0aGlzKS5jc3MoXCJ3aWR0aFwiKSk7XG4gICAgICAgICAgICAgICAgZGlmZiA9ICh4IC0gcGFyc2VGbG9hdChkaWZmKSk7XG4gICAgXG4gICAgICAgICAgICAgICAgJChcImFiLXBhZ2VcIikuY3NzKFwid2lkdGhcIiwgXCItd2Via2l0LWNhbGMoMTAwJSAtIFwiICsgZGlmZiArIFwicHgpXCIpO1xuICAgICAgICAgICAgICAgICQoXCJhYi1wYWdlXCIpLmNzcyhcIndpZHRoXCIsIFwiLW1vei1jYWxjKDEwMCUgLSBcIiArIGRpZmYgKyBcInB4KVwiKTtcbiAgICAgICAgICAgICAgICAkKFwiYWItcGFnZVwiKS5jc3MoXCJ3aWR0aFwiLCBcIi1vLWNhbGMoMTAwJSAtIFwiICsgZGlmZiArIFwicHgpXCIpO1xuICAgICAgICAgICAgICAgICQoXCJhYi1wYWdlXCIpLmNzcyhcIndpZHRoXCIsIFwiY2FsYygxMDAlIC0gXCIgKyBkaWZmICsgXCJweClcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgbW91c2VEb3duKGV2ZW50KSB7XG4gICAgICAgIHZhciBtb2RlM2QgPSB0aGlzLnN1cHBvcnQzZCgpO1xuICAgIFxuICAgICAgICAvLyBWZXJpZmljYWNhbyBkbyBmb290ZXJcbiAgICAgICAgdGhpcy5pc0Zvb3Rlck9uQm9keSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzSGVhZGVyT25Cb2R5ID0gJChcImFiLWhlYWRlclwiKS5wYXJlbnQoKS5pcyhcImJvZHlcIik7XG4gICAgXG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9IFwiY2xvc2luZ1wiICYmIHRoaXMuc3RhdGUgIT0gXCJvcGVuaW5nXCIpIHtcbiAgICAgICAgICAgIC8vIFBlZ2EgeCB5XG4gICAgICAgICAgICB2YXIgcG9zID0gdGhpcy5nZXRYWShldmVudCk7XG4gICAgXG4gICAgICAgICAgICAvLyBQZWdhIG8gc3RhcnQgeFxuICAgICAgICAgICAgaWYgKCh0aGlzLnN0YXRlID09IFwiY2xvc2VkXCIgJiYgcG9zLnggPCAxMCkgfHwgKHRoaXMuc3RhdGUgPT0gXCJvcGVuZWRcIiAmJiAocG9zLnggPiAodGhpcy5tYXhUcmFuc2xhdGUgLSAodGhpcy5tYXhUcmFuc2xhdGUgLyAzKSkpICYmIHBvcy54IDwgdGhpcy5tYXhUcmFuc2xhdGUgKyA0MCkpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFxuICAgICAgICAgICAgICAgIC8vIHRyYW5zaWNhb1xuICAgICAgICAgICAgICAgIGlmIChtb2RlM2QpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCItby10cmFuc2l0aW9uXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCItbXMtdHJhbnNpdGlvblwiLCBcIm5vbmVcIik7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwiLW1vei10cmFuc2l0aW9uXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCItd2Via2l0LXRyYW5zaXRpb25cIiwgXCJub25lXCIpO1xuICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0hlYWRlck9uQm9keSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcImFiLWhlYWRlclwiKS5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCJhYi1oZWFkZXJcIikuY3NzKFwiLW8tdHJhbnNpdGlvblwiLCBcIm5vbmVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiYWItaGVhZGVyXCIpLmNzcyhcIi1tcy10cmFuc2l0aW9uXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCJhYi1oZWFkZXJcIikuY3NzKFwiLW1vei10cmFuc2l0aW9uXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCJhYi1oZWFkZXJcIikuY3NzKFwiLXdlYmtpdC10cmFuc2l0aW9uXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwiYW5pbWF0aW9uXCIpID09IFwicHVzaFwiIHx8ICQodGhpcykuYXR0cihcImFuaW1hdGlvblwiKSA9PSBcInB1c2hBbmRGaXRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcImFiLXBhZ2VcIikuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRyYW5zaXRpb25cIjogXCJub25lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItby10cmFuc2l0aW9uXCI6IFwibm9uZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLW1zLXRyYW5zaXRpb25cIjogXCJub25lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItbW96LXRyYW5zaXRpb25cIjogXCJub25lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItd2Via2l0LXRyYW5zaXRpb25cIjogXCJub25lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09IFwiY2xvc2VkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVCbG9ja0RpdigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUJsb2NrRGl2KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRYID0gcG9zLng7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50WCA9IHRoaXMuY3VyclRyYW5zbGF0ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbiA9IFwibW92ZVwiO1xuICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIG1vdXNlVXAoZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uID09IFwibW92ZVwiKSB7XG4gICAgICAgICAgICAvLyBTZSBzb2x0YXIgbm8gbWVpbyBkZWNpZGUgcGFyYSBvbmRlIGlyXG4gICAgICAgICAgICBpZiAoTWF0aC5hYnModGhpcy5jdXJyVHJhbnNsYXRlKSA8ICh0aGlzLm1heFRyYW5zbGF0ZSAvIDIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cihcInZpc2libGVcIikgPT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSh0aGlzLCB0aGlzLmFuaW1hdGlvblRpbWUsIFwiZmFsc2VcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwidmlzaWJsZVwiLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwidmlzaWJsZVwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUodGhpcywgdGhpcy5hbmltYXRpb25UaW1lLCBcInRydWVcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwidmlzaWJsZVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICB0aGlzLmFjdGlvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0WCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRYID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZW1vdmVCbG9ja0RpdigpIHtcbiAgICAgICAgaWYgKCQoXCIjYWItbWVudS1ibG9jay1kaXZcIikubGVuZ3RoICE9IDApIHtcbiAgICAgICAgICAgICQoXCIjYWItbWVudS1ibG9jay1kaXZcIikuY3NzKFwib3BhY2l0eVwiLCBcIjBcIik7XG4gICAgICAgICAgICAkKFwiI2FiLW1lbnUtYmxvY2stZGl2XCIpLmNzcyhcIi13ZWJraXQtb3BhY2l0eVwiLCBcIjBcIik7XG4gICAgICAgICAgICAkKFwiI2FiLW1lbnUtYmxvY2stZGl2XCIpLmNzcyhcIi1tb3otb3BhY2l0eVwiLCBcIjBcIik7XG4gICAgICAgICAgICAkKFwiI2FiLW1lbnUtYmxvY2stZGl2XCIpLmNzcyhcIi1tcy1vcGFjaXR5XCIsIFwiMFwiKTtcbiAgICAgICAgICAgICQoXCIjYWItbWVudS1ibG9jay1kaXZcIikuY3NzKFwiLTAtb3BhY2l0eVwiLCBcIjBcIik7XG4gICAgXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoXCIjYWItbWVudS1ibG9jay1kaXZcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LCB0aGlzLmFuaW1hdGlvblRpbWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNyZWF0ZUJsb2NrRGl2KGZvcmNlT3BhY2l0eSkge1xuICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwiYmxvY2stY29udGVudFwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgaWYgKCQoXCIjYWItbWVudS1ibG9jay1kaXZcIikubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgZGl2ID0gJChcIjxkaXY+XCIpO1xuICAgICAgICAgICAgICAgIGRpdi5hcHBlbmRUbygkKFwiYWItbWVudVwiKS5wYXJlbnQoKSk7XG4gICAgICAgICAgICAgICAgZGl2LmNzcyhcInpJbmRleFwiLCAodGhpcy56SW5kZXggLSAxKSk7XG4gICAgICAgICAgICAgICAgZGl2LmF0dHIoXCJpZFwiLCBcImFiLW1lbnUtYmxvY2stZGl2XCIpO1xuICAgICAgICAgICAgICAgIGRpdi5hZGRDbGFzcyhcImFiLW1lbnUtYmxvY2stZGl2XCIpO1xuICAgIFxuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJjbG9zZS1pbWFnZVwiKSAhPSB1bmRlZmluZWQgJiYgJCh0aGlzKS5hdHRyKFwiY2xvc2UtaW1hZ2VcIikgIT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1nQ2xvc2UgPSAkKFwiPGltZz5cIik7XG4gICAgICAgICAgICAgICAgICAgIGltZ0Nsb3NlLmF0dHIoXCJzcmNcIiwgJCh0aGlzKS5hdHRyKFwiY2xvc2UtaW1hZ2VcIikpO1xuICAgICAgICAgICAgICAgICAgICBpbWdDbG9zZS5hZGRDbGFzcyhcImFiLW1lbnUtYmxvY2stY2xvc2VcIik7XG4gICAgICAgICAgICAgICAgICAgIGltZ0Nsb3NlLmFwcGVuZFRvKGRpdik7XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIC8vIGFuaW1hY2FvIGRlIG9wYWNpZGFkZVxuICAgICAgICAgICAgICAgIGRpdi5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwib3BhY2l0eSBcIiArIHRoaXMuYW5pbWF0aW9uVGltZSArIFwibXMgbGluZWFyXCIpO1xuICAgICAgICAgICAgICAgIGRpdi5jc3MoXCItd2Via2l0LXRyYW5zaXRpb25cIiwgXCItd2Via2l0LW9wYWNpdHkgXCIgKyB0aGlzLmFuaW1hdGlvblRpbWUgKyBcIm1zIGxpbmVhclwiKTtcbiAgICBcbiAgICAgICAgICAgICAgICBkaXYub24oXCJ0b3VjaHN0YXJ0IG1vdXNlZG93blwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgXG4gICAgICAgICAgICAgICAgZGl2Lm9uKFwidG91Y2hlbmQgbW91c2V1cFwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiYWItbWVudVwiKS5hdHRyKFwidmlzaWJsZVwiLCBcImZhbHNlXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICAgICAgICAgIGRpdi5vbihcInRvdWNobW92ZSBtb3VzZW1vdmVcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICAgICAgICAgIC8vIFNlIGFicmlyIGZvcmNhbmRvIG9wYWNpdHkgbWF4aW1hXG4gICAgICAgICAgICAgICAgaWYgKGZvcmNlT3BhY2l0eSkge1xuICAgICAgICAgICAgICAgICAgICAkKFwiLmFiLW1lbnUtYmxvY2stZGl2XCIpLmNzcyhcIm9wYWNpdHlcIiwgdGhpcy5kaXZPcGFjaXR5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBhbHRlcmEgb3BhY2lkYWRlXG4gICAgICAgICAgICBpZiAoJChcIi5hYi1tZW51LWJsb2NrLWRpdlwiKS5jc3MoXCJvcGFjaXR5XCIpICE9IHRoaXMuZGl2T3BhY2l0eSkge1xuICAgICAgICAgICAgICAgICQoXCIuYWItbWVudS1ibG9jay1kaXZcIikuY3NzKFwib3BhY2l0eVwiLCB0aGlzLmRpdk9wYWNpdHkpO1xuICAgICAgICAgICAgICAgICQoXCIuYWItbWVudS1ibG9jay1kaXZcIikuY3NzKFwiLXdlYmtpdC1vcGFjaXR5XCIsIHRoaXMuZGl2T3BhY2l0eSk7XG4gICAgICAgICAgICAgICAgJChcIi5hYi1tZW51LWJsb2NrLWRpdlwiKS5jc3MoXCItbW96LW9wYWNpdHlcIiwgdGhpcy5kaXZPcGFjaXR5KTtcbiAgICAgICAgICAgICAgICAkKFwiLmFiLW1lbnUtYmxvY2stZGl2XCIpLmNzcyhcIi1tcy1vcGFjaXR5XCIsIHRoaXMuZGl2T3BhY2l0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRUcmFuc2Zvcm0oZWwpIHtcbiAgICAgICAgdmFyIHByb3AgPSBcIlwiO1xuICAgIFxuICAgICAgICBpZiAoJChlbCkuY3NzKCctd2Via2l0LXRyYW5zZm9ybScpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcHJvcCA9ICQoZWwpLmNzcygnLXdlYmtpdC10cmFuc2Zvcm0nKTtcbiAgICAgICAgfSBlbHNlIGlmICgkKGVsKS5jc3MoJ3RyYW5zZm9ybScpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcHJvcCA9ICQoZWwpLmNzcygndHJhbnNmb3JtJyk7XG4gICAgICAgIH0gZWxzZSBpZiAoJChlbCkuY3NzKCctbW96LXRyYW5zZm9ybScpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcHJvcCA9ICQoZWwpLmNzcygnLW1vei10cmFuc2Zvcm0nKTtcbiAgICAgICAgfSBlbHNlIGlmICgkKGVsKS5jc3MoJy1tcy10cmFuc2Zvcm0nKSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHByb3AgPSAkKGVsKS5jc3MoJy1tcy10cmFuc2Zvcm0nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBbMCwgMCwgMF07XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBwcm9wXG4gICAgICAgICAgICAubWF0Y2goL21hdHJpeCg/OigzZClcXCgtezAsMX1cXGQrKD86LCAtezAsMX1cXGQrKSooPzosICgtezAsMX1cXGQrKSkoPzosICgtezAsMX1cXGQrKSkoPzosICgtezAsMX1cXGQrKSksIC17MCwxfVxcZCtcXCl8XFwoLXswLDF9XFxkKyg/OiwgLXswLDF9XFxkKykqKD86LCAoLXswLDF9XFxkKykpKD86LCAoLXswLDF9XFxkKykpXFwpKS8pO1xuICAgIFxuICAgICAgICBpZiAoIXJlc3VsdHMpXG4gICAgICAgICAgICByZXR1cm4gWzAsIDAsIDBdO1xuICAgICAgICBpZiAocmVzdWx0c1sxXSA9PSAnM2QnKVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMuc2xpY2UoMiwgNSk7XG4gICAgXG4gICAgICAgIHJlc3VsdHMucHVzaCgwKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHMuc2xpY2UoNSwgOCk7XG4gICAgfVxufVxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKFwiYWItbWVudVwiLCBBYk1lbnUpO1xuXG5jbGFzcyBBYk1lbnVCdG4gZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLm1haW5DbGFzcyA9IFwiYWItbWVudS1idG5cIjtcblxuICAgIH1cblxuICAgIF9yZW5kZXIoKSB7XG4gICAgICAgICQodGhpcykuYXR0cihcImhyZWZcIiwgXCJqYXZhc2NyaXB0OnZvaWQoMClcIik7XG5cbiAgICAgICAgJCh0aGlzKS5vbihcInRvdWNoc3RhcnQgbW91c2Vkb3duXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCQoXCJhYi1tZW51XCIpLmF0dHIoXCJ2aXNpYmxlXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgJChcImFiLW1lbnVcIikuYXR0cihcInZpc2libGVcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcImFiLW1lbnVcIikuYXR0cihcInZpc2libGVcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICBcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyh0aGlzLm1haW5DbGFzcyk7XG4gICAgfVxuXG4gICAgX2FkZEV2ZW50KCkgeyB9XG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLm1haW5DbGFzcykpIHtcbiAgICAgICAgICAgIC8qdGhpcy5zaGFkb3dEb20gPSB0aGlzLmF0dGFjaFNoYWRvdyh7XG4gICAgICAgICAgICAgICAgbW9kZTogJ29wZW4nXG4gICAgICAgICAgICB9KTsgKi9cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgICAgICAgdGhpcy5fYWRkRXZlbnQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGF0dHJOYW1lLCBvbGRWYWwsIG5ld1ZhbCkgeyB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoXCJhYi1tZW51LWJ0blwiLCBBYk1lbnVCdG4pOyIsIlwidXNlIHN0cmljdFwiO1xuXG53aW5kb3dbJ29uY2hhbmdlZm9yY2hlY2tib3gnXSA9IG51bGw7XG5jbGFzcyBBYk1vZGFsVXRpbCB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcblxuICAgICAgICB0aGlzLmRpdkJhY2tncm91bmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgfVxuXG4gICAgaGlkZSgpIHtcbiAgICAgICAgaWYgKCQoXCIjYWItbW9kYWxcIikubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAkKFwiI2FiLW1vZGFsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJCgnLmNoYXQtYm9keS1kaXYnKS5jc3MoXCJvdmVyZmxvdy15XCIsIFwic2Nyb2xsXCIpO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzaG93KHByb3ApIHtcbiAgICAgICAgdmFyIGlkID0gZ2VuZXJhdGVJRCgpO1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG5cbiAgICAgICAgLy9jb21wYXRpYmlsaWRhZGUgY29tIHZlcnNhbyBhbnRpZ2FcbiAgICAgICAgaWYgKHByb3AgJiYgcHJvcC5jYWxsQmFjaykge1xuICAgICAgICAgICAgcHJvcC5jYWxsYmFjayA9IHByb3AuY2FsbEJhY2s7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmhpZGUoKTtcblxuICAgICAgICAvL0NyaWEgZnVuZG8gcHJldG9cbiAgICAgICAgdGhpcy5kaXZCYWNrZ3JvdW5kLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC1iYWNrZ3JvdW5kXCIpO1xuICAgICAgICB0aGlzLmRpdkJhY2tncm91bmQuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1tb2RhbFwiKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiYm9keVwiKVswXS5hcHBlbmRDaGlsZChfdGhpcy5kaXZCYWNrZ3JvdW5kKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9LCAxKTtcblxuICAgICAgICAkKHRoaXMuZGl2QmFja2dyb3VuZCkub24oXCJtb3VzZWRvd24gdG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgIChlLnRhcmdldCA9PSB0aGlzKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmRpdkJhY2tncm91bmQuZ2V0QXR0cmlidXRlKFwiY2xvc2FibGVcIikgPT0gXCJ0cnVlXCIgJiYgZS50YXJnZXQuaWQgPT0gX3RoaXMuZGl2QmFja2dyb3VuZC5nZXRBdHRyaWJ1dGUoXCJpZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAocHJvcC5jbG9zYWJsZSkge1xuICAgICAgICAgICAgdGhpcy5kaXZCYWNrZ3JvdW5kLnNldEF0dHJpYnV0ZShcImNsb3NhYmxlXCIsIHByb3AuY2xvc2FibGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChwcm9wLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJwcm9tb2Npb25hbFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubW9kYWxQcm9tb2Npb25hbChwcm9wKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImNoZWNrYm94XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RhbENoZWNrT3JMaXN0KHByb3ApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwidGVsYVwiOlxuICAgICAgICAgICAgICAgIHRoaXMubW9kYWxUZWxhKHByb3ApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGlmIChwcm9wLmxpc3QgJiYgcHJvcC5saXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RhbENoZWNrT3JMaXN0KHByb3ApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9kYWxOb3JtYWwocHJvcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbW9kYWxOb3JtYWwocHJvcCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHZhciBkaXZXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZGl2V3JhcHBlci5jbGFzc0xpc3QuYWRkKFwiYWItbW9kYWwtd3JhcHBlclwiKTtcbiAgICAgICAgZGl2V3JhcHBlci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcImFiLW1vZGFsXCIgKyBcIl9kaXZXcmFwcGVyXCIpO1xuICAgICAgICB0aGlzLmRpdkJhY2tncm91bmQuYXBwZW5kQ2hpbGQoZGl2V3JhcHBlcik7XG5cbiAgICAgICAgLy9DcmlhIGphbmVsYSBicmFuY2EgcGFyYSBjb2xvY2FyIG8gdGV4dG8gZSBib3RvZXNcbiAgICAgICAgdmFyIGRpdk1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZGl2TW9kYWwuY2xhc3NMaXN0LmFkZChcImFiLW1vZGFsLXdpbmRvd1wiKTtcbiAgICAgICAgZGl2TW9kYWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1tb2RhbFwiICsgXCJfZGl2TW9kYWxcIik7XG4gICAgICAgIGRpdldyYXBwZXIuYXBwZW5kQ2hpbGQoZGl2TW9kYWwpO1xuXG4gICAgICAgIGlmIChwcm9wLnR5cGUpIHtcbiAgICAgICAgICAgIC8vU2UgdGl2ZXIgdHlwZSBzdWNlc3MsIGVycm9yLCBhbGVydGEsIGRpdnVsZ2FjYW8gZSBvcmllbnRhY2FvLCBhcHJlc2VudGEgaW1hZ2VtIG5vIGNvbnRlbnQgcmVwcmVzZW50YW5kbyBvIGNhc29cbiAgICAgICAgICAgIHZhciBkaXZNb2RhbEljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgZGl2TW9kYWxJY29uLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC1pY29uXCIpO1xuICAgICAgICAgICAgdGhpcy5kaXZCYWNrZ3JvdW5kLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC1cIiArIHByb3AudHlwZSk7XG4gICAgICAgICAgICBkaXZNb2RhbC5hcHBlbmRDaGlsZChkaXZNb2RhbEljb24pO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgdGhpcy5kaXZCYWNrZ3JvdW5kLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC1hbGVydGFcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZihwcm9wLm1heFdpZHRoKXtcbiAgICAgICAgICAgIGRpdk1vZGFsLnN0eWxlLm1heFdpZHRoID0gcHJvcC5tYXhXaWR0aDtcbiAgICAgICAgICAgIGRpdk1vZGFsLnN0eWxlLm1hcmdpbiA9IFwiYXV0b1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9TZSB0aXZlciB0aXR1bG8sIGFkaWNpb25hIGRpdiBkZSB0aXR1bG9cbiAgICAgICAgaWYgKHByb3AudGl0bGUpIHtcbiAgICAgICAgICAgIHZhciBkaXZUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBkaXZUaXRsZS5jbGFzc0xpc3QuYWRkKFwiYWItbW9kYWwtdGl0bGVcIik7XG4gICAgICAgICAgICBkaXZUaXRsZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcImFiLW1vZGFsX2RpdlRpdGxlXCIpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwcm9wLnRpdGxlID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZXIgPSBuZXcgWE1MU2VyaWFsaXplcigpO1xuICAgICAgICAgICAgICAgIGRpdlRpdGxlLmlubmVySFRNTCA9IHNlcmlhbGl6ZXIuc2VyaWFsaXplVG9TdHJpbmcocHJvcC50aXRsZVswXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRpdlRpdGxlLmlubmVySFRNTCA9IHByb3AudGl0bGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkaXZNb2RhbC5hcHBlbmRDaGlsZChkaXZUaXRsZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9TZSB0aXZlciB0ZXh0bywgYXByZXNlbnRhIHRleHRvXG4gICAgICAgIGlmIChwcm9wLnRleHQpIHtcbiAgICAgICAgICAgIHZhciBzcGFuVGV4dCA9ICQoXCI8c3Bhbi8+XCIpO1xuICAgICAgICAgICAgLy9zcGFuVGV4dC5odG1sKHByb3AudGV4dCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHByb3AudGV4dCA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHZhciBzZXJpYWxpemVyID0gbmV3IFhNTFNlcmlhbGl6ZXIoKTtcbiAgICAgICAgICAgICAgICBzcGFuVGV4dC5odG1sKHNlcmlhbGl6ZXIuc2VyaWFsaXplVG9TdHJpbmcocHJvcC50ZXh0WzBdKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNwYW5UZXh0Lmh0bWwocHJvcC50ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNwYW5UZXh0LmFkZENsYXNzKFwiYWItbW9kYWwtc3BhblwiKTtcbiAgICAgICAgICAgIHNwYW5UZXh0LmFwcGVuZFRvKGRpdk1vZGFsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ3JpYSBib3RvZXMgc29saWNpdGFkb3NcbiAgICAgICAgaWYgKHByb3AuYnV0dG9ucyAmJiBwcm9wLmJ1dHRvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy9QYXJhIGNhZGEgaXRlbSBcImJ1dHRvbnNcIiBubyBodG1sLCBpcsOhIGNyaWFyIHVtIGJvdMOjby5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcC5idXR0b25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGJ0bk1vZGFsTm9ybWFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFiLWJ1dHRvblwiKTtcbiAgICAgICAgICAgICAgICBidG5Nb2RhbE5vcm1hbC5zZXRBdHRyaWJ1dGUoXCJsYWJlbFwiLCBwcm9wLmJ1dHRvbnNbaV0udGl0bGUpO1xuICAgICAgICAgICAgICAgIGJ0bk1vZGFsTm9ybWFsLnNldEF0dHJpYnV0ZShcIm9yZGVyXCIsIGkpO1xuICAgICAgICAgICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBidG5Nb2RhbE5vcm1hbC5zZXRBdHRyaWJ1dGUoXCJ0aGVtZVwiLCBcInNlY29uZGFyeVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGl2TW9kYWwuYXBwZW5kQ2hpbGQoYnRuTW9kYWxOb3JtYWwpO1xuICAgICAgICAgICAgICAgICQoYnRuTW9kYWxOb3JtYWwpLm9uKFwidGFwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IG9yZGVyID0gcGFyc2VJbnQoJCh0aGlzKS5hdHRyKFwib3JkZXJcIikpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHByb3AuYnV0dG9uc1tvcmRlcl0uY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3AuYnV0dG9uc1tvcmRlcl0uY2FsbGJhY2suY2FsbChudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJChkaXZXcmFwcGVyKS5vbihcInRvdWNoc3RhcnQgbW91c2Vkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZGl2TW9kYWwuc2Nyb2xsSGVpZ2h0ID4gZGl2TW9kYWwuY2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmlkID09IFwiYWItbW9kYWxfZGl2V3JhcHBlclwiIHx8IGUudGFyZ2V0LmlkID09IFwiYWItbW9kYWxfZGl2VGl0bGVcIikge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAocHJvcCAmJiB0eXBlb2YgcHJvcC5vbm9wZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBwcm9wLm9ub3Blbi5jYWxsKG51bGwsIGRpdkNvbnRlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAyKTtcbiAgICB9XG5cbiAgICBtb2RhbFByb21vY2lvbmFsKHByb3ApIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICB0aGlzLmRpdkJhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ0cmFuc3BhcmVudFwiO1xuXG4gICAgICAgIGxldCBkaXZQcm9tbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGRpdlByb21vLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC1wcm9tb2Npb25hbC1jb250ZW50XCIpO1xuICAgICAgICB0aGlzLmRpdkJhY2tncm91bmQuYXBwZW5kQ2hpbGQoZGl2UHJvbW8pO1xuXG4gICAgICAgIGxldCBjbG9zZVByb21vID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgIGNsb3NlUHJvbW8uY2xhc3NMaXN0LmFkZChcImFiLW1vZGFsLXByb21vY2lvbmFsLWNsb3NlXCIpO1xuICAgICAgICBjbG9zZVByb21vLmlubmVyVGV4dCA9IFwiWFwiXG4gICAgICAgIGRpdlByb21vLmFwcGVuZENoaWxkKGNsb3NlUHJvbW8pO1xuICAgICAgICAkKGNsb3NlUHJvbW8pLm9uKFwidGFwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIF90aGlzLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwcm9wLmJ1dHRvbnNbMF0uY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBwcm9wLmJ1dHRvbnNbMF0uY2FsbGJhY2suY2FsbChudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IGRpdkltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGRpdkltZy5jbGFzc0xpc3QuYWRkKFwiYWItbW9kYWwtcHJvbW9jaW9uYWwtaW1hZ2VtXCIpO1xuICAgICAgICBkaXZQcm9tby5hcHBlbmRDaGlsZChkaXZJbWcpO1xuXG4gICAgICAgIGxldCBpbWdQcm9tbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgICAgIGltZ1Byb21vLnNldEF0dHJpYnV0ZShcInNyY1wiLCBwcm9wLmltZ1Byb21vKTtcbiAgICAgICAgZGl2SW1nLmFwcGVuZENoaWxkKGltZ1Byb21vKTtcblxuICAgICAgICBsZXQgdGl0bGVQcm9tbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcbiAgICAgICAgdGl0bGVQcm9tby5jbGFzc0xpc3QuYWRkKFwiYWItbW9kYWwtcHJvbW9jaW9uYWwtdGl0bGVcIik7XG4gICAgICAgIHRpdGxlUHJvbW8uaW5uZXJUZXh0ID0gcHJvcC50aXRsZTtcbiAgICAgICAgZGl2UHJvbW8uYXBwZW5kQ2hpbGQodGl0bGVQcm9tbyk7XG5cbiAgICAgICAgbGV0IHBQcm9tbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgICAgICBwUHJvbW8uY2xhc3NMaXN0LmFkZChcImFiLW1vZGFsLXByb21vY2lvbmFsLXRleHRcIik7XG4gICAgICAgIHBQcm9tby5pbm5lckhUTUwgPSBwcm9wLnRleHQ7XG4gICAgICAgIGRpdlByb21vLmFwcGVuZENoaWxkKHBQcm9tbyk7XG5cbiAgICAgICAgaWYgKHByb3AuYnV0dG9uc1swXSkge1xuICAgICAgICAgICAgbGV0IGJ0blByb21vID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFiLWJ1dHRvblwiKTtcbiAgICAgICAgICAgIGJ0blByb21vLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC1wcm9tb2Npb25hbC1idXR0b25cIik7XG4gICAgICAgICAgICBpZiAocHJvcC5idXR0b25zWzBdLnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgYnRuUHJvbW8uc2V0QXR0cmlidXRlKFwibGFiZWxcIiwgcHJvcC5idXR0b25zWzBdLnRpdGxlLnRvVXBwZXJPbmx5Rmlyc3RMZXR0ZXIoKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ0blByb21vLnNldEF0dHJpYnV0ZShcImxhYmVsXCIsIFwiRmVjaGFyXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGl2UHJvbW8uYXBwZW5kQ2hpbGQoYnRuUHJvbW8pO1xuICAgICAgICAgICAgJChidG5Qcm9tbykub24oXCJ0YXBcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHByb3AuYnV0dG9uc1swXS5jYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBwcm9wLmJ1dHRvbnNbMF0uY2FsbGJhY2suY2FsbChudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG1vZGFsQ2hlY2tPckxpc3QocHJvcCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMuZGl2QmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInRyYW5zcGFyZW50XCI7XG5cbiAgICAgICAgbGV0IGRpdlRlbGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBkaXZUZWxhLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC10ZWxhLXdpbmRvd1wiKTtcbiAgICAgICAgdGhpcy5kaXZCYWNrZ3JvdW5kLmFwcGVuZENoaWxkKGRpdlRlbGEpO1xuXG4gICAgICAgIGxldCBjbG9zZVRlbGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgY2xvc2VUZWxhLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC10ZWxhLWNsb3NlXCIpO1xuICAgICAgICBjbG9zZVRlbGEuaW5uZXJUZXh0ID0gXCJYXCJcbiAgICAgICAgZGl2VGVsYS5hcHBlbmRDaGlsZChjbG9zZVRlbGEpO1xuICAgICAgICAkKGNsb3NlVGVsYSkub24oXCJ0YXBcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgX3RoaXMuaGlkZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZGl2VGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBkaXZUaXRsZS5jbGFzc0xpc3QuYWRkKFwiYWItbW9kYWwtdGVsYS10aXRsZVwiKTtcbiAgICAgICAgZGl2VGl0bGUuaW5uZXJIVE1MID0gcHJvcC50aXRsZTtcbiAgICAgICAgZGl2VGVsYS5hcHBlbmRDaGlsZChkaXZUaXRsZSk7XG5cbiAgICAgICAgbGV0IGRpdkNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBkaXZDb250ZW50LmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC10ZWxhLWNvbnRlbnRcIik7XG4gICAgICAgIGRpdkNvbnRlbnQuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1tb2RhbC1jb250ZW50XCIpO1xuICAgICAgICBkaXZUZWxhLmFwcGVuZENoaWxkKGRpdkNvbnRlbnQpO1xuXG4gICAgICAgIGxldCBkaXZCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBkaXZCdXR0b24uY2xhc3NMaXN0LmFkZChcImFiLW1vZGFsLXRlbGEtYnV0dG9uc1wiKTtcbiAgICAgICAgZGl2VGVsYS5hcHBlbmRDaGlsZChkaXZCdXR0b24pO1xuXG4gICAgICAgIC8vU2UgdGl2ZXIgbGlzdGEgbmEgY2hhbWFkYSBkbyBtb2RhbCBubyBIVE1MLCBjcmlhIGEgbGlzdGFcbiAgICAgICAgaWYgKHByb3AubGlzdCAmJiBwcm9wLmxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy90cmF0YSBwYXJhIHF1YW5kbyBmb3IgbGlzdGEgbm9ybWFsIG91IGxpc3RhIGRlIGNoZWNrYm94XG4gICAgICAgICAgICBpZiAocHJvcC50eXBlID09IFwiY2hlY2tib3hcIikge1xuICAgICAgICAgICAgICAgIC8vYWRpY2lvbmEgYXR0ciBtYXgtc2VsZWN0IHBhcmEgbyBtb2RhbFxuICAgICAgICAgICAgICAgIGlmIChwcm9wW1wibWF4LXNlbGVjdFwiXSkge1xuICAgICAgICAgICAgICAgICAgICBkaXZDb250ZW50LnNldEF0dHJpYnV0ZShcIm1heC1zZWxlY3RcIiwgcHJvcFtcIm1heC1zZWxlY3RcIl0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vY3JpYSBvcyBjaGVja2JveCBubyBtb2RhbFxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvcC5saXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBtb2RhbENoZWNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFiLWNoZWNrYm94XCIpO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbENoZWNrLmNsYXNzTGlzdC5hZGQoXCJtb2RhbC1jaGVja2JveFwiKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxDaGVjay5zZXRBdHRyaWJ1dGUoXCJjYW5jZWwtY2FsbGJhY2tcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgICAgICAgICBkaXZDb250ZW50LmFwcGVuZENoaWxkKG1vZGFsQ2hlY2spO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wLmxpc3RbaV0uY29kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxDaGVjay5zZXRBdHRyaWJ1dGUoXCJjb2RlXCIsIHByb3AubGlzdFtpXS5jb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcC5saXN0W2ldLnN1YnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbENoZWNrLnNldEF0dHJpYnV0ZShcInN1YnRpdGxlXCIsIHByb3AubGlzdFtpXS5zdWJ0aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBtb2RhbENoZWNrLnNldEF0dHJpYnV0ZShcImlzLWNoZWNrZWRcIiwgcHJvcC5saXN0W2ldLmNoZWNrZWQgPT0gdW5kZWZpbmVkID8gXCJmYWxzZVwiIDogcHJvcC5saXN0W2ldLmNoZWNrZWQpO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbENoZWNrLnNldEF0dHJpYnV0ZShcImxhYmVsXCIsIHByb3AubGlzdFtpXS5sYWJlbCA9PSB1bmRlZmluZWQgPyBcIk7Dg08gSU5GT1JNQURPXCIgOiBwcm9wLmxpc3RbaV0ubGFiZWwpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wICYmIHByb3Aub25jaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd1snb25jaGFuZ2Vmb3JjaGVja2JveCddID0gcHJvcC5vbmNoYW5nZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxDaGVjay5zZXRBdHRyaWJ1dGUoXCJvbmNoYW5nZVwiLCAnb25jaGFuZ2Vmb3JjaGVja2JveCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbW9kYWxDaGVjay5zZXRBdHRyaWJ1dGUoXCJjYW5jZWwtY2FsbGJhY2tcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocHJvcC5idXR0b25zWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBidG5UZWxhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFiLWJ1dHRvblwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnRuVGVsYS5jbGFzc0xpc3QuYWRkKFwiYWItbW9kYWwtcHJvbW9jaW9uYWwtYnV0dG9uXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcC5idXR0b25zWzBdLnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidG5UZWxhLnNldEF0dHJpYnV0ZShcImxhYmVsXCIsIHByb3AuYnV0dG9uc1swXS50aXRsZS50b1VwcGVyT25seUZpcnN0TGV0dGVyKCkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnRuVGVsYS5zZXRBdHRyaWJ1dGUoXCJsYWJlbFwiLCBcIkZlY2hhclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkaXZCdXR0b24uYXBwZW5kQ2hpbGQoYnRuVGVsYSk7XG4gICAgICAgICAgICAgICAgICAgICQoYnRuVGVsYSkub24oXCJ0YXBcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjYWItbW9kYWwtY29udGVudFwiKS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY29kZVwiOiAkKHRoaXMpLmF0dHIoXCJjb2RlXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6ICQodGhpcykuYXR0cihcImxhYmVsXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN1YnRpdGxlXCI6ICQodGhpcykuYXR0cihcInN1YnRpdGxlXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNoZWNrZWRcIjogJCh0aGlzKS5hdHRyKFwiaXMtY2hlY2tlZFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcHJvcC5idXR0b25zWzBdLmNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcC5idXR0b25zWzBdLmNhbGxiYWNrLmNhbGwobnVsbCwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAvL1BhcmEgY2FkYSBpdGVtIG5hIGFycmF5IGxpc3QsIGlyw6EgY3JpYXIgMSBpdGVtIG5hIGxpc3RhXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wLmxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRpdkl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGl2U3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICAgICAgICAgICAgICBkaXZTcGFuLmlubmVySFRNTCA9IHByb3AubGlzdFtpXS50ZXh0O1xuICAgICAgICAgICAgICAgICAgICBkaXZTcGFuLnNldEF0dHJpYnV0ZShcImNvZGVcIiwgcHJvcC5saXN0W2ldLmNvZGUpO1xuICAgICAgICAgICAgICAgICAgICBkaXZTcGFuLnNldEF0dHJpYnV0ZShcImNvbnRlbnRcIiwgXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgICAgICAgICBkaXZJdGVtLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC1saXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICBkaXZDb250ZW50LmFwcGVuZENoaWxkKGRpdkl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBkaXZJdGVtLmFwcGVuZENoaWxkKGRpdlNwYW4pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vU2UgdGl2ZXIgc3VidGV4dG8sIGFkaWNpb25hIHRleHRvIGVtYmFpeG8gZG8gdGV4dG8gcHJpbmNpcGFsXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wLmxpc3RbaV0uc3VidGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpdlBhcmFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZQYXJhZy5pbm5lckhUTUwgPSBwcm9wLmxpc3RbaV0uc3VidGV4dDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdlBhcmFnLnNldEF0dHJpYnV0ZShcImNvbnRlbnRcIiwgXCJzdWJ0ZXh0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGl2U3Bhbi5hcHBlbmRDaGlsZChkaXZQYXJhZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcC5jYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpdkljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYWItaWNvbi1idXR0b25cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZJY29uLmNsYXNzTGlzdC5hZGQoXCJhYi1pY29uLWJ1dHRvbi1zZXRhXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGl2SXRlbS5hcHBlbmRDaGlsZChkaXZJY29uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdkl0ZW0uc2V0QXR0cmlidXRlKFwib3JkZXJcIiwgaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGRpdkl0ZW0pLm9uKFwidGFwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBuZXcgT2JqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS50ZXh0ID0gJCh0aGlzKS5jaGlsZHJlbihcIltjb250ZW50PXRleHRdXCIpWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3VidGV4dCA9ICQodGhpcykuY2hpbGRyZW4oXCJbY29udGVudD10ZXh0XVwiKS5jaGlsZHJlbihcIltjb250ZW50PXN1YnRleHRdXCIpLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmNvZGUgPSAkKHRoaXMpLmNoaWxkcmVuKFwiW2NvbnRlbnQ9dGV4dF1cIikuYXR0cihcImNvZGVcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcCAmJiB0eXBlb2YgcHJvcC5jYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wLmNhbGxiYWNrLmNhbGwobnVsbCwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGJ0blRlbGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYWItYnV0dG9uXCIpO1xuICAgICAgICAgICAgICAgIGJ0blRlbGEuc2V0QXR0cmlidXRlKFwibGFiZWxcIiwgXCJGZWNoYXJcIik7XG4gICAgICAgICAgICAgICAgZGl2QnV0dG9uLmFwcGVuZENoaWxkKGJ0blRlbGEpO1xuICAgICAgICAgICAgICAgICQoYnRuVGVsYSkub24oXCJ0YXBcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICQoXCJib2R5XCIpLnJlbW92ZUZvY3VzKCk7XG5cbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAocHJvcCAmJiB0eXBlb2YgcHJvcC5vbm9wZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBwcm9wLm9ub3Blbi5jYWxsKG51bGwsICQoZGl2Q29udGVudCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAyKTtcbiAgICB9XG5cbiAgICBtb2RhbFRlbGEocHJvcCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMuZGl2QmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInRyYW5zcGFyZW50XCI7XG5cbiAgICAgICAgbGV0IGRpdlRlbGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBkaXZUZWxhLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC10ZWxhLXdpbmRvd1wiKTtcbiAgICAgICAgdGhpcy5kaXZCYWNrZ3JvdW5kLmFwcGVuZENoaWxkKGRpdlRlbGEpO1xuXG4gICAgICAgIGxldCBjbG9zZVRlbGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgY2xvc2VUZWxhLmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC10ZWxhLWNsb3NlXCIpO1xuICAgICAgICBjbG9zZVRlbGEuaW5uZXJUZXh0ID0gXCJYXCJcbiAgICAgICAgZGl2VGVsYS5hcHBlbmRDaGlsZChjbG9zZVRlbGEpO1xuICAgICAgICAkKGNsb3NlVGVsYSkub24oXCJ0YXBcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgX3RoaXMuaGlkZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZGl2VGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBkaXZUaXRsZS5jbGFzc0xpc3QuYWRkKFwiYWItbW9kYWwtdGVsYS10aXRsZVwiKTtcbiAgICAgICAgZGl2VGl0bGUuaW5uZXJIVE1MID0gcHJvcC50aXRsZTtcbiAgICAgICAgZGl2VGVsYS5hcHBlbmRDaGlsZChkaXZUaXRsZSk7XG5cbiAgICAgICAgbGV0IGRpdkNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBkaXZDb250ZW50LmNsYXNzTGlzdC5hZGQoXCJhYi1tb2RhbC10ZWxhLWNvbnRlbnRcIik7XG4gICAgICAgIGRpdkNvbnRlbnQuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJhYi1tb2RhbC1jb250ZW50XCIpO1xuICAgICAgICBkaXZUZWxhLmFwcGVuZENoaWxkKGRpdkNvbnRlbnQpO1xuXG4gICAgICAgIGxldCBkaXZCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBkaXZCdXR0b24uY2xhc3NMaXN0LmFkZChcImFiLW1vZGFsLXRlbGEtYnV0dG9uc1wiKTtcbiAgICAgICAgZGl2VGVsYS5hcHBlbmRDaGlsZChkaXZCdXR0b24pO1xuXG4gICAgICAgIGRpdkNvbnRlbnQuaW5uZXJIVE1MID0gcHJvcC50ZXh0O1xuXG4gICAgICAgIC8vQ3JpYSBib3RvZXMgc29saWNpdGFkb3NcbiAgICAgICAgaWYgKHByb3AuYnV0dG9ucyAmJiBwcm9wLmJ1dHRvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy9QYXJhIGNhZGEgaXRlbSBcImJ1dHRvbnNcIiBubyBodG1sLCBpcsOhIGNyaWFyIHVtIGJvdMOjby5cbiAgICAgICAgICAgIGxldCBidG5IZWlnaHQgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wLmJ1dHRvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgYnRuVGVsYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhYi1idXR0b25cIik7XG4gICAgICAgICAgICAgICAgYnRuVGVsYS5zZXRBdHRyaWJ1dGUoXCJsYWJlbFwiLCBwcm9wLmJ1dHRvbnNbaV0udGl0bGUpO1xuICAgICAgICAgICAgICAgIGJ0blRlbGEuc2V0QXR0cmlidXRlKFwib3JkZXJcIiwgaSk7XG4gICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ0blRlbGEuc2V0QXR0cmlidXRlKFwidGhlbWVcIiwgXCJzZWNvbmRhcnlcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRpdkJ1dHRvbi5hcHBlbmRDaGlsZChidG5UZWxhKTtcbiAgICAgICAgICAgICAgICBidG5IZWlnaHQgPSBidG5IZWlnaHQgKyA2NDtcbiAgICAgICAgICAgICAgICAkKGJ0blRlbGEpLm9uKFwidGFwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IG9yZGVyID0gcGFyc2VJbnQoJCh0aGlzKS5hdHRyKFwib3JkZXJcIikpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHByb3AuYnV0dG9uc1tvcmRlcl0uY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3AuYnV0dG9uc1tvcmRlcl0uY2FsbGJhY2suY2FsbChudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGl2QnV0dG9uLnN0eWxlLmhlaWdodCA9IGJ0bkhlaWdodCArIFwicHhcIjtcbiAgICAgICAgICAgIGlmIChidG5IZWlnaHQgPiA2NCkge1xuICAgICAgICAgICAgICAgIGRpdkNvbnRlbnQuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJjYWxjKDEwMCUgLSAyMTBweCkgIWltcG9ydGFudDtcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkKFwiYm9keVwiKS5yZW1vdmVGb2N1cygpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHByb3AgJiYgdHlwZW9mIHByb3Aub25vcGVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgcHJvcC5vbm9wZW4uY2FsbChudWxsLCAkKGRpdkNvbnRlbnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgMik7XG4gICAgfVxufVxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vY29tcG9uZW50LXdyYXBwZXI6IGJyYWRlc2NvLWlucHV0LXBhc3N3b3JkLXVuZGVybGluZVxuY2xhc3MgQWJQYXNzd29yZCBleHRlbmRzIEFiSW5wdXQge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5jaGlsZENsYXNzID0gXCJhYi1wYXNzd29yZFwiO1xuICAgICAgICAvLyB0aGlzLmltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgICAgIHRoaXMuZXJyb3JDaGlsZCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuX2FkZEV2ZW50Q2hpbGQoKTtcbiAgICB9XG5cbiAgICBfcmVuZGVyQ2hpbGQoKSB7XG4gICAgICAgIC8vQ29sb2NhIGNsYXNzZSBwcmluY2lwYWwgZG8gb2JqZXRvXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCh0aGlzLmNoaWxkQ2xhc3MpO1xuXG4gICAgICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInBhc3N3b3JkXCIpO1xuXG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShcImtleWJvYXJkXCIpID09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKFwicGF0dGVyblwiLCBcIlswLTldKlwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUoXCJtYXhsZW5ndGhcIikpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKFwibWF4bGVuZ3RoXCIsIFwiMTBcIik7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIF9hZGRFdmVudENoaWxkKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIC8vSXIgcGFyYSBvIHByw7N4aW1vIGl0ZW0gcXVhbmRvIGFwZXJ0YXIgZW50ZXJcbiAgICAgICAgJCh0aGlzLmlucHV0KS5vbihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBnb1RvTmV4dFRhYmluZGV4KGUsICQodGhpcyksIFwidGFwXCIpO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuY2hpbGRDbGFzcykpIHtcbiAgICAgICAgICAgIC8qdGhpcy5zaGFkb3dEb20gPSB0aGlzLmF0dGFjaFNoYWRvdyh7XG4gICAgICAgICAgICAgICAgbW9kZTogJ29wZW4nXG4gICAgICAgICAgICB9KTsgKi9cbiAgICAgICAgICAgIHN1cGVyLmNvbm5lY3RlZENhbGxiYWNrKCk7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJDaGlsZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBvYnNlcnZlZEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXCJpZFwiLCBcImVycm9yXCIsIFwiaXMtZGlzYWJsZWRcIiwgXCJsYWJlbFwiLCBcIndpZHRoXCIsIFwibWF4bGVuZ3RoXCIsIFwid2lkdGgtb24tYmlnc2NyZWVuXCIsIFwidGFiLWluZGV4XCIsIFwiZ290by10YWItaW5kZXhcIiwgXCJ2YWx1ZVwiLCBcInZpc2libGVcIiwgXCJkZXNjcmlwdGlvblwiXTtcbiAgICB9XG5cbiAgICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2soYXR0ck5hbWUsIG9sZFZhbCwgbmV3VmFsKSB7XG4gICAgICAgIHN1cGVyLmF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpO1xuXG4gICAgICAgIGlmIChhdHRyTmFtZSA9PSBcImRlc2NyaXB0aW9uXCIpIHtcbiAgICAgICAgICAgIHRoaXMuc3Bhbi5pbm5lclRleHQgPSBuZXdWYWw7XG4gICAgICAgIH1cbiAgICB9XG5cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgnYWItcGFzc3dvcmQnLCBBYlBhc3N3b3JkKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuY2xhc3MgQWJSYWRpbyBleHRlbmRzIEhUTUxFbGVtZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMucmFkaW9pbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICAgICAgdGhpcy5yYWRpbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuc3BhbkxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgIHRoaXMuc3BhblN1YnRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG5cbiAgICAgICAgdGhpcy5tYWluQ2xhc3MgPSBcImFiLXJhZGlvXCI7XG5cbiAgICB9XG5cbiAgICBfcmVuZGVyKCkge1xuICAgICAgICAvL2NvbG9jYSBjbGFzc2VcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHRoaXMubWFpbkNsYXNzKTtcblxuICAgICAgICAvL0NyaWEgdW0gaWRcbiAgICAgICAgbGV0IGlkID0gZ2VuZXJhdGVJRCgpO1xuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJpZFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogSWRlbnRpZmljYcOnw6NvIGRvIGNhbXBvLiBBdHJpYnV0byBvYnJpZ2F0w7NyaW8gcGFyYSBpbnRlcmFnaXIgY29tIG8gaW5wdXR8IEFsZmFudW3DqXJpY298IHNpbXwgcmFuZG9taWNvIHxcbiAgICAgICAgICAgIGlkID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9hcm1hemVuYSBvIGNvbnRlw7pkbyBwYXNzYWRvIG5vIGh0bWxcbiAgICAgICAgbGV0IGNvbnRldWRvID0gdGhpcy5pbm5lckhUTUw7XG4gICAgICAgIHRoaXMuaW5uZXJIVE1MID0gXCJcIjtcblxuICAgICAgICAvL0NvbG9jYSBvcyBhdHJpYnV0b3Mgbm8gb2JqZXRvXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIndpZHRoXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBMYXJndXJhIGRvIGlucHV0LnwgQWxmYW51bcOpcmljb3wgbsOjb3wgMTAwJXxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGhcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL09icmlnYXRvcmlvIGNoZWNhZ2VtIGFiYWl4byBkbyB3aWR0aFxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhcmd1cmEgZG8gY29tcG9uZW50ZSBlbSB0ZWxhcyBtYWlvcmVzfCAlIG91IHB4fCBuw6NvfCB8XG4gICAgICAgICAgICBpZiAoYWJuZXIudXRpbHMuc2hvd0JpZ1NjcmVlbih0b3AuJChcImJvZHlcIikpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9DcmlhIGNoZWNrXG4gICAgICAgIHRoaXMucmFkaW9pbnB1dC5jbGFzc0xpc3QuYWRkKFwiYWItcmFkaW8taW5wdXRcIik7XG4gICAgICAgIHRoaXMucmFkaW9pbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwicmFkaW9cIik7XG4gICAgICAgIHRoaXMucmFkaW9pbnB1dC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIHRoaXMuZ2V0QXR0cmlidXRlKFwibmFtZVwiKSk7XG4gICAgICAgIHRoaXMucmFkaW9pbnB1dC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwicmRfcmFkaW9pbnB1dFwiKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLnJhZGlvaW5wdXQpO1xuXG4gICAgICAgIC8vQ3JpYSBvYmpldG9cbiAgICAgICAgdGhpcy5yYWRpby5jbGFzc0xpc3QuYWRkKFwiYWItcmFkaW8tcmFkaW9zcGFjZVwiKTtcbiAgICAgICAgdGhpcy5yYWRpby5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwicmRfcmFkaW9cIik7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5yYWRpbyk7XG5cbiAgICAgICAgLy9pbnNlcmUgbyBjb250ZcO6ZG8gbm8gb2JqZXRvXG4gICAgICAgIHRoaXMuc3BhbkxhYmVsLmNsYXNzTGlzdC5hZGQoXCJhYi1yYWRpby10aXRsZVwiKTtcbiAgICAgICAgdGhpcy5zcGFuTGFiZWwuc2V0QXR0cmlidXRlKFwiY29udGVudC1hcmVhXCIsIFwidHJ1ZVwiKVxuICAgICAgICB0aGlzLnNwYW5MYWJlbC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwicmRfbGFiZWxcIik7XG4gICAgICAgIGlmIChjb250ZXVkbykge1xuICAgICAgICAgICAgdGhpcy5zcGFuTGFiZWwuaW5uZXJIVE1MID0gY29udGV1ZG87XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJsYWJlbFwiKSkge1xuICAgICAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhYmVsIGRvIGNvbXBvbmVudGUgfCAgfCBuw6NvIHwgfFxuICAgICAgICAgICAgICAgIHRoaXMuc3BhbkxhYmVsLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibGFiZWxcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLnNwYW5MYWJlbCk7XG5cbiAgICAgICAgdGhpcy5zcGFuU3VidGl0bGUuY2xhc3NMaXN0LmFkZChcImFiLXJhZGlvLXN1YnRpdGxlXCIpO1xuICAgICAgICB0aGlzLnNwYW5TdWJ0aXRsZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwicmRfc3VidGl0bGVcIik7XG4gICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwic3VidGl0bGVcIik7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5zcGFuU3VidGl0bGUpO1xuXG4gICAgICAgIC8vRGVmaW5lIHNlIGRldmVyw6Egc2VyIGFsaW5oYWRvIGEgZGlyZWl0YVxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJwb3NpdGlvblwiKSA9PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiBsZWZ0O3JpZ2h0XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBQb3Npw6fDo28gZG8gaW5wdXR8IFBvc2l0aW9ufCBuw6NvfCBsZWZ0fFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5mbG9hdCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwicG9zaXRpb25cIik7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLnBhZGRpbmdSaWdodCA9IFwiMTVweFwiO1xuICAgICAgICAgICAgdGhpcy5yYWRpby5zdHlsZS50ZXh0QWxpZ24gPSBcInJpZ2h0XCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlc2FiaWxpdGEgbyBjYW1wbyBwYXJhIGFsdGVyYcOnw6NvLnwgU3RyaW5nfCBuw6NvfCB2YXppb3xcbiAgICAgICAgICAgIHRoaXMucmFkaW8uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLXJhZGlvLWRpc2FibGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy92ZXJpZmljYSBzZSB0ZW0gbWF4IHdpZHRoXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heC13aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTGFyZ3VyYSBtw6F4aW1hfCBweCB8IG7Do298IHZhemlvfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwic3VidGl0bGVcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFN1YnRpdHVsbyBkbyBjb21wb25lbnRlfCBCb29sZWFufCBuw6NvfCBmYWxzZXxcbiAgICAgICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwic3VidGl0bGVcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1jaGVja2VkXCIpID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIHNlIG8gaW5wdXQgZXN0YXLDoSBzZWxlY2lvbmFkbyBvdSBuw6NvfCBCb29sZWFufCBuw6NvfCBmYWxzZXxcbiAgICAgICAgICAgIHRoaXMucmFkaW9pbnB1dC5zZXRBdHRyaWJ1dGUoXCJjaGVja2VkXCIsIHRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9MaW1wYSB2YXJpYXZlaXNcbiAgICAgICAgaWQgPSBudWxsO1xuICAgICAgICBjb250ZXVkbyA9IG51bGw7XG4gICAgfVxuXG4gICAgX2FkZEV2ZW50KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAkKHRoaXMpLm9uKFwidGFwXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgIF90aGlzLnJhZGlvaW5wdXQuY2hlY2tlZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwib25jaGFuZ2VcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZuID0gd2luZG93W190aGlzLmdldEF0dHJpYnV0ZShcIm9uY2hhbmdlXCIpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm4uY2FsbCgkKF90aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLm1haW5DbGFzcykpIHtcbiAgICAgICAgICAgIC8qdGhpcy5zaGFkb3dEb20gPSB0aGlzLmF0dGFjaFNoYWRvdyh7IG1vZGU6ICdvcGVuJyB9KTsgKi9cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgICAgICAgdGhpcy5fYWRkRXZlbnQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gW1wiaXMtZGlzYWJsZWRcIiwgXCJ3aWR0aFwiLCBcIndpZHRoLW9uLWJpZ3NjcmVlblwiLCBcImlkXCIsIFwic3VidGl0bGVcIiwgXCJsYWJlbFwiLCBcIm5hbWVcIiwgXCJpcy1jaGVja2VkXCJdO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcblxuICAgICAgICBzd2l0Y2ggKGF0dHJOYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwiaXMtZGlzYWJsZWRcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmFkaW8uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItcmFkaW8tZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWRpby5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwiYWItcmFkaW8tZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgICAgIGNhc2UgXCJ3aWR0aFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICAgICAgY2FzZSBcIndpZHRoLW9uLWJpZ3NjcmVlblwiOlxuICAgICAgICAgICAgICAgIGlmIChhYm5lci51dGlscy5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICAgICAgY2FzZSBcImlkXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5yYWRpb2lucHV0LnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwicmRfcmFkaW9pbnB1dFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJhZGlvLnNldEF0dHJpYnV0ZShcImlkXCIsIG5ld1ZhbCArIFwicmRfcmFkaW9cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFuTGFiZWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJyZF9sYWJlbFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW5TdWJ0aXRsZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcInJkX3N1YnRpdGxlXCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgICAgIGNhc2UgXCJzdWJ0aXRsZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3BhblN1YnRpdGxlLmlubmVyVGV4dCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgICAgICBjYXNlIFwibGFiZWxcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW5MYWJlbC5pbm5lclRleHQgPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICAgICAgY2FzZSBcIm5hbWVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnJhZGlvaW5wdXQuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBuZXdWYWwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgICAgIGNhc2UgXCJpcy1jaGVja2VkXCI6XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJhZGlvaW5wdXQuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRUZXh0KHRleHQpIHtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuc3BhbkxhYmVsLmlubmVySFRNTCA9IHRleHQ7XG4gICAgfVxuXG4gICAgZ2V0VGV4dCgpIHtcblxuICAgICAgICByZXR1cm4gdGhpcy5zcGFuTGFiZWwuaW5uZXJUZXh0O1xuICAgIH1cblxuICAgIHNldE51bWJlcih0ZXh0KSB7XG4gICAgICAgIFxuICAgICAgICBpZiAodGV4dCA9PSAxIHx8IHRleHQgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5yYWRpb2lucHV0LmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yYWRpb2lucHV0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgZ2V0TnVtYmVyKCkge1xuXG4gICAgICAgIGlmICh0aGlzLnJhZGlvaW5wdXQuY2hlY2tlZCA9PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIxXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCIwXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoXCJhYi1yYWRpb1wiLCBBYlJhZGlvKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgIC8vZnVuY2FvIHBhcmEgY29ycmlnaXIgbyBkYXRhXG4gICAgJC5mbi5maWxsU2VsZWN0ID0gZnVuY3Rpb24gKHNlbGVjdEFyciwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpc1swXS5maWxsU2VsZWN0KHNlbGVjdEFyciwgY2FsbGJhY2spO1xuXG4gICAgICAgIHZhciBmbiA9IHdpbmRvd1tjYWxsYmFja107XG4gICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGZuLmNhbGwobnVsbCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWxsYmFjay5jYWxsKG51bGwpO1xuICAgICAgICB9XG4gICAgfTtcblxuXG59KTtcblxuY2xhc3MgQWJTZWxlY3QgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxhYmVsXCIpO1xuICAgICAgICB0aGlzLnNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gICAgICAgIHRoaXMub3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgIHRoaXMuaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgICAgdGhpcy5sZWdlbmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGVnZW5kXCIpO1xuXG4gICAgICAgIHRoaXMubWFpbkNsYXNzID0gXCJhYi1zZWxlY3RcIjtcblxuICAgIH1cblxuICAgIF9yZW5kZXIoKSB7XG4gICAgICAgIC8vQ3JpYSB1bSBpZFxuICAgICAgICB2YXIgaWQgPSBnZW5lcmF0ZUlEKCk7XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBJZGVudGlmaWNhZG9yIMO6bmljbyBkbyBvYmpldG8sIGNvbSBwcmVmaXhvIFwic2VsXCJ8IEFsZmFudW3DqXJpY28gfG7Do298IHJhbmTDtG1pY298XG4gICAgICAgICAgICBpZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCh0aGlzLm1haW5DbGFzcyk7XG5cbiAgICAgICAgLy9ubyBjYXNvIGRvIGNvbWJvIGphIGZpY2EgbWltaWZpY2Fkb1xuICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1zZWxlY3QtbWluXCIpO1xuXG4gICAgICAgIC8vQ29sb2NhIExhYmVsXG4gICAgICAgIHRoaXMubGFiZWwuY2xhc3NMaXN0LmFkZChcImFiLXNlbGVjdC1sYWJlbFwiKTtcbiAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwic2xfbGFiZWxcIik7XG4gICAgICAgIHRoaXMubGFiZWwuc2V0QXR0cmlidXRlKFwiZm9yXCIsIGlkICsgXCJzbF9pbnB1dFwiKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmxhYmVsKTtcblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJsYWJlbFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogQ29sb2NhciB1bWEgZGVzY3Jpw6fDo28gcXVlIHJlcHJlc2VudGUgbyB2YWxvciBxdWUgc2Vyw6EgY29sb2NhZG8gbm8gaW5wdXQgZGEgcMOhZ2luYXwgQWxmYW51bcOpcmljb3wgbsOjb3wgdmF6aW98XG4gICAgICAgICAgICB0aGlzLmxhYmVsLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibGFiZWxcIik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy9DcmlhIG8gY29tYm9cbiAgICAgICAgdGhpcy5zZWxlY3QuY2xhc3NMaXN0LmFkZChcImFiLXNlbGVjdC1zZWxlY3RcIik7XG4gICAgICAgIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJzbF9pbnB1dFwiKVxuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuc2VsZWN0KTtcblxuICAgICAgICAvL29uZm9jdXMgbm8gb2JqZXRvXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm9uZm9jdXNcIikpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZShcIm9uZm9jdXNcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJvbmZvY3VzXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vcHJlZW5jaGUgY29tYm9cbiAgICAgICAgdGhpcy5vcHRpb24uc2V0QXR0cmlidXRlKFwic2VsZWN0ZWRcIiwgdHJ1ZSk7XG4gICAgICAgIHRoaXMub3B0aW9uLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIFwiXCIpO1xuICAgICAgICB0aGlzLm9wdGlvbi5pbm5lclRleHQgPSBcIlNlbGVjaW9uZVwiO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuc2VsZWN0KTtcblxuICAgICAgICAvL2NvbG9jYSBjb3Igbm8gbGFiZWxcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGhcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IExhcmd1cmEgZG8gc2VsZWN0LiB8IEFsZmFudW3DqXJpY28gfCBuw6NvIHwgMTAwJSB8XG4gICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdmVyaWZpY2Egd2lkdGgtb24tYmlnc2NyZWVuXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTGFyZ3VyYSBkbyBjb21wb25lbnRlIGVtIHRlbGFzIG1haW9yZXN8ICUgb3UgcHh8IG7Do298IHxcbiAgICAgICAgICAgIGlmIChwbWIudXRpbHMuc2hvd0JpZ1NjcmVlbih0b3AuJChcImJvZHlcIikpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9kZXNhYmlsaXRhciBvIGNhbXBvIHF1YW5kbyBvIGF0cmlidXRvIGlzLWRpc2FibGVkIMOpIHRydWVcbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiaXMtZGlzYWJsZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiB0cnVlO2ZhbHNlXG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZXNhYmlsaXRhIG8gY2FtcG8gcGFyYSBhbHRlcmHDp8Ojby4gfCBCb29sZWFubyB8IG7Do28gfCB2YXppbyB8XG4gICAgICAgICAgICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY29sb2NhIHRhYmluZGV4XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInRhYi1pbmRleFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogT3JkZW0gZGUgdGFidWxhw6fDo28gbmEgcMOhZ2luYS4gfCBOdW3DqXJpY28gfCBuw6NvIHwgdmF6aW8gfFxuICAgICAgICAgICAgdGhpcy5zZWxlY3Quc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0YWItaW5kZXhcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9wYXJhIHF1YWwgaW5kZXggdmFpXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImdvdG8tdGFiLWluZGV4XCIpKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJnb3RvLXRhYi1pbmRleFwiLCB0aGlzLmdldEF0dHJpYnV0ZShcImdvdG8tdGFiLWluZGV4XCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vcGFyYSBxdWFsIGluZGV4IHZhaVxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJzdG9wLXRhYi1pbmRleFwiKSkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Quc2V0QXR0cmlidXRlKFwic3RvcC10YWItaW5kZXhcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJzdG9wLXRhYi1pbmRleFwiKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL01lc21vIGNvbXBvcnRhbWVudG8gcG9yw6ltIGNvbSBvdXRybyBub21lIGRlIGF0cmlidXRvLCBuZWNlc3PDoXJpbyBhanVzdGFyIHRvZG9zIHByb2pldG9zIHF1ZSB1c2FtIG8gZGUgY2ltYVxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmxlXCIpID09IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9Db2xvY2EgbWVuc2FnZW0gZGUgZXJybyBcbiAgICAgICAgdGhpcy5sZWdlbmQuY2xhc3NMaXN0LmFkZChcImFiLXNlbGVjdC1zcGFuXCIpO1xuICAgICAgICB0aGlzLmxlZ2VuZC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwic2xfc3BhblwiKTtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiZXJyb3JcIikpIHtcbiAgICAgICAgICAgIHRoaXMubGVnZW5kLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiZXJyb3JcIik7XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1zZWxlY3QtZXJyb3JcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL3NlIHRpdmVyIGRlc2NyacOnw6NvXG4gICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJkZXNjcmlwdGlvblwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGVnZW5kLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiZGVzY3JpcHRpb25cIik7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5sZWdlbmQpO1xuXG4gICAgICAgIHRoaXMuaW1nLmNsYXNzTGlzdC5hZGQoXCJhYi1zZWxlY3Qtc2V0YVwiKTtcbiAgICAgICAgdGhpcy5pbWcuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwib2JqZWN0L2FiLXNlbGVjdC9pbWcvc2V0YS1iYWl4by5zdmdcIik7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5pbWcpO1xuXG4gICAgICAgIC8vTGltcGFyIHZhcmlhdmVpc1xuICAgICAgICBpZCA9IG51bGw7XG4gICAgfVxuXG4gICAgX2FkZEV2ZW50KCkge1xuXG4gICAgICAgIHZhciBzZWxlY3RFbCA9ICQodGhpcy5zZWxlY3QpO1xuXG4gICAgICAgIC8vQW8gc2FpciBlbGUgdm9sdGEgbyBsYWJlbCBvdSBkZWl4YSBvIHZhbG9yXG4gICAgICAgIHNlbGVjdEVsLm9uKFwiYmx1clwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICAvL3RpcmEgY2xhc3NlIHF1ZSBtb3N0cmEgZm9jdXNcbiAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1zZWxlY3QtZm9jdXNcIik7XG5cbiAgICAgICAgICAgIC8vTmEgY2hlY2FyIGNvbnRldWRvXG4gICAgICAgICAgICBfdGhpcy5zZXRBdHRyaWJ1dGUoXCJjYW5jZWwtb25jaGFuZ2VcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgJCh0aGlzKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuXG4gICAgICAgICAgICAvL0NoYW1hIGEgZnVuY2FvIHF1ZSBjb2xjb3Ugbm8gb25ibHVyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwib25ibHVyXCIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZuID0gd2luZG93W190aGlzLmdldEF0dHJpYnV0ZShcIm9uYmx1clwiKV07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBmbi5jYWxsKCQoX3RoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcyA9IG51bGw7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vbmEgbXVkYW5jYVxuICAgICAgICBzZWxlY3RFbC5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICAvL3ZlcmlmaWNhIHNlIG8gY2FtcG8gw6kgb2JyaWdhdMOzcmlvXG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiaXMtcmVxdWlyZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5nZXRTZWxlY3RlZCh0aGlzKSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZW1vdmVBdHRyaWJ1dGUoXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRBdHRyaWJ1dGUoXCJlcnJvclwiLCBcIkNhbXBvIG9icmlnYXTDs3Jpb1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vQ2hhbWEgYSBmdW5jYW8gcXVlIGNvbGNvdSBubyBvbmNoYW5nZVxuICAgICAgICAgICAgaWYgKF90aGlzLmhhc0F0dHJpYnV0ZShcIm9uY2hhbmdlXCIpICYmIF90aGlzLmdldEF0dHJpYnV0ZShcImNhbmNlbC1vbmNoYW5nZVwiKSAhPSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgIHZhciBmdW5jdGlvbnNBcnJheSA9IF90aGlzLmdldEF0dHJpYnV0ZShcIm9uY2hhbmdlXCIpLnNwbGl0KFwiO1wiKTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZnVuY3Rpb25zQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZuID0gd2luZG93W2Z1bmN0aW9uc0FycmF5W2ldLnRyaW0oKV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoJChfdGhpcykpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25zQXJyYXlbaV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5yZW1vdmVBdHRyaWJ1dGUoXCJjYW5jZWwtb25jaGFuZ2VcIik7XG5cbiAgICAgICAgICAgIC8vQ2hhbWEgYSBmdW5jYW8gcXVlIGNvbGNvdSBubyBvbmJsdXJcbiAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJvbnZhbGlkYXRlXCIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZuID0gd2luZG93W190aGlzLmdldEF0dHJpYnV0ZShcIm9udmFsaWRhdGVcIildO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgZm4uY2FsbCgkKF90aGlzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMgPSBudWxsO1xuICAgICAgICB9KTtcblxuICAgICAgICBzZWxlY3RFbC5vbihcImZvY3VzXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICAvL2UucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIC8vZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgLy9tb3N0cmEgcXVlIGVzdGEgY29tIGZvY3VcbiAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi1zZWxlY3QtZm9jdXNcIik7XG4gICAgICAgICAgICBfdGhpcyA9IG51bGw7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vSXIgcGFyYSBvIHByw7N4aW1vIGl0ZW0gcXVhbmRvIGFwZXJ0YXIgZW50ZXJcbiAgICAgICAgc2VsZWN0RWwub24oXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcy5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgcmV0dXJuIGdvVG9OZXh0VGFiaW5kZXgoZXZlbnQsICQoX3RoaXMpLCBcInRhcFwiKTtcbiAgICAgICAgICAgIF90aGlzID0gbnVsbDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5jbGFzc0xpc3QuY29udGFpbnModGhpcy5tYWluQ2xhc3MpKSB7XG4gICAgICAgICAgICAvKnRoaXMuc2hhZG93RG9tID0gdGhpcy5hdHRhY2hTaGFkb3coe1xuICAgICAgICAgICAgICAgIG1vZGU6ICdvcGVuJ1xuICAgICAgICAgICAgfSk7ICovXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2FkZEV2ZW50KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IG9ic2VydmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcImVycm9yXCIsIFwiaXMtZGlzYWJsZWRcIiwgXCJsYWJlbFwiLCBcIndpZHRoXCIsIFwiaWRcIiwgXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIiwgXCJ0YWItaW5kZXhcIiwgXCJnb3RvLXRhYi1pbmRleFwiLCBcImRlc2NyaXB0aW9uXCIsIFwiaWNvblwiLCBcInZpc2libGVcIl07XG4gICAgfVxuXG4gICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGF0dHJOYW1lLCBvbGRWYWwsIG5ld1ZhbCkge1xuICAgICAgICBzd2l0Y2ggKGF0dHJOYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsICE9IHVuZGVmaW5lZCAmJiBuZXdWYWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxlZ2VuZC5pbm5lclRleHQgPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLXNlbGVjdC1lcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxlZ2VuZC5pbm5lclRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJkZXNjcmlwdGlvblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sZWdlbmQuaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJkZXNjcmlwdGlvblwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi1zZWxlY3QtZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiaXMtZGlzYWJsZWRcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZShcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0LnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImxhYmVsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5pbm5lclRleHQgPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ3aWR0aFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpZFwiOlxuICAgICAgICAgICAgICAgIGlmIChvbGRWYWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmltZy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcInNsX2ltZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJmb3JcIiwgbmV3VmFsICsgXCJzbF9pbnB1dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcInNsX2xhYmVsXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcInNsX2lucHV0XCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxlZ2VuZC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcInNsX3NwYW5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwid2lkdGgtb24tYmlnc2NyZWVuXCI6XG4gICAgICAgICAgICAgICAgaWYgKHBtYi51dGlscy5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJ0YWItaW5kZXhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCBuZXdWYWwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiZ290by10YWItaW5kZXhcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJnb3RvLXRhYi1pbmRleFwiLCBuZXdWYWwpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiZGVzY3JpcHRpb25cIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGVnZW5kLmlubmVyVGV4dCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpY29uXCI6XG4gICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwiI1wiICsgaWQgKyBcInNsX2ltZ1wiKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgIHZhciBpbWcgPSAkKFwiPGltZyAvPlwiKTtcbiAgICAgICAgICAgICAgICBpbWcuYXR0cihcImlkXCIsIGlkICsgXCJzbF9pbWdcIik7XG5cbiAgICAgICAgICAgICAgICAvL0NvbG9jYSBpY29uZVxuICAgICAgICAgICAgICAgIGlmIChvYmouYXR0cihcImVycm9yXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouYXR0cihcImVycm9yLWljb25cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZy5hdHRyKFwic3JjXCIsIG9iai5hdHRyKFwiZXJyb3ItaWNvblwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcuYXR0cihcInNyY1wiLCBvYmouYXR0cihcImljb25cIikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaW1nLmF0dHIoXCJzcmNcIiwgb2JqLmF0dHIoXCJpY29uXCIpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpbWcuYXBwZW5kVG8ob2JqKTtcbiAgICAgICAgICAgICAgICBpbWcgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgLy9NdWRhIGVzdGlsbyBjb20gaW1hZ2VtXG4gICAgICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwiYWItc2VsZWN0LWltZ1wiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcInZpc2libGVcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRUZXh0KHRleHQpIHtcblxuICAgIH1cblxuICAgIGdldFRleHQoKSB7XG4gICAgICAgIGxldCBpbmRleCA9IHRoaXMuc2VsZWN0Lm9wdGlvbnMuc2VsZWN0ZWRJbmRleDtcbiAgICAgICAgaWYgKGluZGV4ID09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgfSBcblxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Qub3B0aW9uc1tpbmRleF0udmFsdWU7XG4gICAgfVxuXG4gICAgc2V0TnVtYmVyKHRleHQpIHtcblxuICAgIH1cblxuICAgIGdldE51bWJlcigpIHtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5zZWxlY3Qub3B0aW9ucy5zZWxlY3RlZEluZGV4O1xuICAgICAgICBpZiAoaW5kZXggPT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9IFxuXG4gICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLnNlbGVjdC5vcHRpb25zW2luZGV4XS52YWx1ZSk7XG4gICAgfVxuXG4gICAgZ2V0U2VsZWN0ZWQoc2VsZWN0KSB7XG4gICAgICAgIHZhciBzZWxlY3RlZEluZGV4ID0gc2VsZWN0Lm9wdGlvbnMuc2VsZWN0ZWRJbmRleDtcblxuICAgICAgICBpZiAoc2VsZWN0ZWRJbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNlbGVjdC5vcHRpb25zW3NlbGVjdGVkSW5kZXhdLnZhbHVlID09IFwiXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZmlsbFNlbGVjdChzZWxlY3RBcnIpIHtcbiAgICAgICAgaWYgKCFzZWxlY3RBcnIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vYmxvcXVlaWEgY29tYm9cbiAgICAgICAgJCh0aGlzLnNlbGVjdCkuYmxvY2soKTtcblxuICAgICAgICAvL2xpbXBhIGNvbWJvXG4gICAgICAgIHRoaXMuc2VsZWN0LmlubmVySFRNTCA9IFwiXCI7XG5cbiAgICAgICAgLy9wcmVlbmNoZSBjb21ib1xuICAgICAgICB2YXIgb3B0aW9uc0FycmF5ID0gW107XG4gICAgICAgIG9wdGlvbnNBcnJheS5wdXNoKG9wdGlvbik7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0QXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvcHRpb25zQXJyYXkucHVzaChcIjxvcHRpb24gdmFsdWU9J1wiICsgc2VsZWN0QXJyW2ldLnZhbG9yICsgXCInPlwiICsgc2VsZWN0QXJyW2ldLm5vbWUgKyBcIjwvb3B0aW9uPlwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlbGVjdC5pbm5lckhUTUwgPSBvcHRpb25zQXJyYXkuam9pbihcIlwiKTtcblxuICAgICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIk9QVElPTlwiKTtcbiAgICAgICAgb3B0aW9uLnNldEF0dHJpYnV0ZShcInNlbGVjdGVkXCIsIHRydWUpO1xuICAgICAgICBvcHRpb24uc2V0QXR0cmlidXRlKFwidmFsdWVcIiwgXCJcIik7XG4gICAgICAgIG9wdGlvbi5pbm5lckhUTUwgPSBcIlNlbGVjaW9uZVwiO1xuICAgICAgICB0aGlzLnNlbGVjdC5wcmVwZW5kKG9wdGlvbik7XG5cbiAgICAgICAgJCh0aGlzLnNlbGVjdCkudW5ibG9jaygpO1xuICAgIH07XG5cbn1cblxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdhYi1zZWxlY3QnLCBBYlNlbGVjdCk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmNsYXNzIEFiVGV4dCBleHRlbmRzIEFiSW5wdXQge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5jaGlsZENsYXNzID0gXCJhYi10ZXh0XCI7XG4gICAgICAgIHRoaXMuZXJyb3JDaGlsZCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuYWJuZXIgPSBuZXcgQWJuZXJVdGlscygpO1xuXG4gICAgICAgIHRoaXMuX2FkZEV2ZW50Q2hpbGQoKTtcbiAgICB9XG5cbiAgICBfcmVuZGVyQ2hpbGQoKSB7XG4gICAgICAgIC8vYWRpY2lvbmEgY2xhc3NcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHRoaXMuY2hpbGRDbGFzcyk7XG4gICAgfVxuXG4gICAgX2FkZEV2ZW50Q2hpbGQoKSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcy5pbnB1dCk7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBhYm5lciA9IG5ldyBBYm5lclV0aWxzKCk7XG5cbiAgICAgICAgLy9ldmVudG8gY2hhbmdlIHF1YW5kbyBhbHRlcmFyIG8gdmFsb3IgZG8gaW5wdXRcbiAgICAgICAgaW5wdXQub24oXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgaWYgKF90aGlzLmdldEF0dHJpYnV0ZShcImxldHRlcnMtb25seVwiKSA9PSBcInRydWVcIiAmJiB0aGlzLnZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGFibmVyLnJlbW92ZUFjY2VudCh0aGlzLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGV4dDtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dG1hdGNoID0gdGhpcy52YWx1ZS5tYXRjaCgvXltBLVphLXogXSskLyk7XG4gICAgICAgICAgICAgICAgaWYgKHRleHRtYXRjaCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImVycm9yXCIsIFwiw4kgcGVybWl0aWRvIGFwZW5hcyBsZXRyYXNcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JDaGlsZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmVycm9yUGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZW1vdmVBdHRyaWJ1dGUoXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yQ2hpbGQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLmNoaWxkQ2xhc3MpKSB7XG4gICAgICAgICAgICAvKnRoaXMuc2hhZG93RG9tID0gdGhpcy5hdHRhY2hTaGFkb3coe1xuICAgICAgICAgICAgICAgIG1vZGU6ICdvcGVuJ1xuICAgICAgICAgICAgfSk7ICovXG4gICAgICAgICAgICBzdXBlci5jb25uZWN0ZWRDYWxsYmFjaygpO1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hpbGQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gWydpZCcsICdlcnJvcicsICdpcy1kaXNhYmxlZCcsICdsYWJlbCcsICd3aWR0aCcsICdtYXhsZW5ndGgnLCAnd2lkdGgtb24tYmlnc2NyZWVuJywgJ3RhYi1pbmRleCcsICdnb3RvLXRhYi1pbmRleCcsICd2YWx1ZSddO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcbiAgICAgICAgc3VwZXIuYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGF0dHJOYW1lLCBvbGRWYWwsIG5ld1ZhbCk7XG4gICAgfVxuXG59XG5cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgnYWItdGV4dCcsIEFiVGV4dCk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmNsYXNzIEFiVGV4dFJlYWRPbmx5IGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5sYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsZWdlbmRcIik7XG4gICAgICAgIHRoaXMudGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuXG4gICAgICAgIHRoaXMubWFpbkNsYXNzID0gXCJhYi10ZXh0LXJlYWQtb25seVwiO1xuICAgIH1cblxuICAgIF9yZW5kZXIoKSB7XG4gICAgICAgIC8vQ3JpYSB1bSBpZFxuICAgICAgICB2YXIgaWQgPSBnZW5lcmF0ZUlEKCk7XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBJZGVudGlmaWNhw6fDo28gZG8gY29tcG9uZW50ZS4gQXRyaWJ1dG8gb2JyaWdhdMOzcmlvIHBhcmEgaW50ZXJhZ2lyIGNvbSBvIG9iamV0byB8IEFsZmFudW3DqXJpY28gfCBzaW0gfCB2YXppbyB8XG4gICAgICAgICAgICBpZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY29udGVudEh0bWwgPSB0aGlzLmlubmVySFRNTCA7XG4gICAgICAgIHRoaXMuaW5uZXJIVE1MID0gXCJcIjtcblxuICAgICAgICAvL2NvbG9jYSBjbGFzc2VcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHRoaXMubWFpbkNsYXNzKTtcblxuICAgICAgICAvL3dpZHRoXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIndpZHRoXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgYSBsYXJndXJhIGRvIGNvbXBvbmVudGV8ICUgb3UgcHh8IG7Do298IHxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vdmVyaWZpY2Egd2lkdGgtb24tYmlnc2NyZWVuXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIndpZHRoLW9uLWJpZ3NjcmVlblwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIGEgbGFyZ3VyYSBkbyBjb21wb25lbnRlIGVtIHRlbGFzIG1haW9yZXN8ICUgb3UgcHh8IG7Do298IHxcbiAgICAgICAgICAgIGlmIChhYm5lci51dGlscy5zaG93QmlnU2NyZWVuKHRvcC4kKFwiYm9keVwiKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi10ZXh0LXJlYWQtb25seS1iaWdzY3JlZW5cIilcbiAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLXRleHQtcmVhZC1vbmx5LWJpZ3NjcmVlblwiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vQ29sb2NhIExhYmVsXG4gICAgICAgIHRoaXMubGFiZWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcImxhYmVsXCIpO1xuXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImxhYmVsXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBDb2xvY2FyIHVtYSBkZXNjcmnDp8OjbyBxdWUgcmVwcmVzZW50ZSBvIHZhbG9yIHF1ZSBzZXLDoSBjb2xvY2FkbyBubyBpbnB1dCBkYSBww6FnaW5hIHwgQWxmYW51bcOpcmljbyB8IG7Do28gfCB2YXppbyB8XG4gICAgICAgICAgICB0aGlzLmxhYmVsLmlubmVyVGV4dCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibGFiZWxcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmxhYmVsKTtcblxuICAgICAgICAvL0NvbG9jYSBJbnB1dFxuICAgICAgICB0aGlzLnRleHQuY2xhc3NMaXN0LmFkZChcImFiLXBhcmFncmFmby1tZWRpb1wiKTtcbiAgICAgICAgdGhpcy50ZXh0LnNldEF0dHJpYnV0ZShcImlkXCIsIGlkICsgXCJ0ZXh0XCIpO1xuICAgICAgICBpZiAoY29udGVudEh0bWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy50ZXh0LmlubmVySFRNTCA9IGNvbnRlbnRIdG1sO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy50ZXh0KTtcblxuICAgICAgICAvL3Zpc2libGVcbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwidmlzaWJsZVwiKSA9PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgIC8vdmFsdWVzOiB0cnVlO2ZhbHNlXG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgc2UgbyBjb21wb25lbnRlIGVzdGFyw6Egdmlzw612ZWwgfCBCb29sZWFuIHwgbsOjb3wgdHJ1ZSB8XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgfTtcblxuICAgICAgICAvL2xpbXBhIHZhcmlhdmVpc1xuICAgICAgICBpZCA9IG51bGw7XG4gICAgICAgIGNvbnRlbnRIdG1sID0gbnVsbDtcbiAgICB9XG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLm1haW5DbGFzcykpIHtcbiAgICAgICAgICAgIC8qdGhpcy5zaGFkb3dEb20gPSB0aGlzLmF0dGFjaFNoYWRvdyh7XG4gICAgICAgICAgICAgICAgbW9kZTogJ29wZW4nXG4gICAgICAgICAgICB9KTsgKi9cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBvYnNlcnZlZEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXCJsYWJlbFwiLCBcImlkXCIsIFwid2lkdGhcIiwgXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIiwgXCJ2aXNpYmxlXCJdO1xuICAgIH1cblxuICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayhhdHRyTmFtZSwgb2xkVmFsLCBuZXdWYWwpIHtcblxuICAgICAgICBzd2l0Y2ggKGF0dHJOYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwibGFiZWxcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmxhYmVsLmlubmVyVGV4dCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgIGNhc2UgXCJpZFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubGFiZWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJsYWJlbFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHQuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcIndpZHRoXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgIGNhc2UgXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIjpcbiAgICAgICAgICAgICAgICBpZiAoJChcImFiLXBhZ2VcIikuYXR0cihcImZ1bGxzY3JlZW5cIikgPT0gXCJ0cnVlXCIpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJ3aWR0aC1vbi1iaWdzY3JlZW5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgICAgICAgY2FzZSBcInZpc2libGVcIjpcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsID09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0VGV4dCh0ZXh0KSB7XG4gICAgICAgIHRoaXMudGV4dC5pbm5lckhUTUwgPSB0ZXh0O1xuICAgIH1cblxuICAgIGdldFRleHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHQuaW5uZXJUZXh0O1xuICAgIH1cblxuICAgIGdldFRleHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHQuaW5uZXJUZXh0O1xuICAgIH1cblxuICAgIHNldEh0bWwoKSB7XG5cbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ2FiLXRleHQtcmVhZC1vbmx5JywgQWJUZXh0UmVhZE9ubHkpOyIsIlwidXNlIHN0cmljdFwiO1xuXG5jbGFzcyBBYlRleHRBcmVhVW5kZXJsaW5lIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy50ZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZXh0YXJlYVwiKTtcbiAgICAgICAgdGhpcy5sYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiKTtcbiAgICAgICAgdGhpcy5zcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG5cbiAgICAgICAgdGhpcy5tYWluQ2xhc3MgPSBcImFiLXRleHQtYXJlYS11bmRlcmxpbmVcIjtcblxuICAgICAgICB0aGlzLl9hZGRFdmVudCgpO1xuICAgIH1cblxuICAgIF9yZW5kZXIoKSB7XG4gICAgICAgIC8vQ3JpYSB1bSBpZFxuICAgICAgICB2YXIgaWQgPSBnZW5lcmF0ZUlEKCk7XG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImlkXCIpKSB7XG4gICAgICAgICAgICBpZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImlkXCIsIGlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY29sb2NhIGNsYXNzZVxuICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQodGhpcy5tYWluQ2xhc3MpO1xuXG4gICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUoXCJtYXgtcm93c1wiKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJtYXgtcm93c1wiLCBcIjIwXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy93aWR0aFxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJ3aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIGEgbGFyZ3VyYSBkbyBjb21wb25lbnRlIHwgJSBvdSBweCB8IG7Do28gfCAxMDAlIHxcbiAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSB0aGlzLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9PYnJpZ2F0b3JpbyBjaGVjYWdlbSBhYmFpeG8gZG8gd2lkdGhcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwid2lkdGgtb24tYmlnc2NyZWVuXCIpKSB7XG4gICAgICAgICAgICBpZiAocG1iLnV0aWxzLnNob3dCaWdTY3JlZW4odG9wLiQoXCJib2R5XCIpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2lkdGggPSBvYmouYXR0cihcIndpZHRoLW9uLWJpZ3NjcmVlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ29sb2NhIFRleHRhcmVhXG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy50ZXh0YXJlYSk7XG4gICAgICAgIHRoaXMudGV4dGFyZWEuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcInR4YV9pbnB1dFwiKTtcblxuICAgICAgICAvL29uZm9jdXMgbm8gb2JqZXRvXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm9uZm9jdXNcIikpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dGFyZWEuc2V0QXR0cmlidXRlKFwib25mb2N1c1wiLCB0aGlzLmdldEF0dHJpYnV0ZShcIm9uZm9jdXNcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwibWF4bGVuZ3RoXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgYSBxdWFudGlkYWRlIG3DoXhpbWEgZGUgY2FyYWN0ZXJlcyBhIHNlciBkaWdpdGFkbyBubyBjYW1wbyB8IG51bWVyaWMgfCBuw6NvIHwgXG4gICAgICAgICAgICB0aGlzLnRleHRhcmVhLnNldEF0dHJpYnV0ZShcIm1heGxlbmd0aFwiLCB0aGlzLmdldEF0dHJpYnV0ZShcIm1heGxlbmd0aFwiKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJyb3dzXCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBEZWZpbmUgYSBxdWFudGlkYWRlIGRlIGxpbmhhcyBkYSBleGliacOnw6NvIGRvIGNhbXBvIHwgbnVtZXJpYyB8IG7Do28gfCAxIHxcbiAgICAgICAgICAgIHRoaXMudGV4dGFyZWEuc2V0QXR0cmlidXRlKFwicm93c1wiLCB0aGlzLmdldEF0dHJpYnV0ZShcInJvd3NcIikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoXCJyb3dzXCIsIFwiMVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQ29sb2NhIGxhYmVsXG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5sYWJlbCk7XG4gICAgICAgIHRoaXMubGFiZWwuc2V0QXR0cmlidXRlKFwiaWRcIiwgaWQgKyBcInR4YV9sYWJlbFwiKTtcbiAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJmb3JcIiwgaWQgKyBcInR4YV9pbnB1dFwiKTtcblxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJsYWJlbFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIG8gdGV4dG8gcXVlIHNlcsOhIGFwcmVzZW50YWRvIGNvbW8gbGFiZWwgZG8gY2FtcG8gfCB2YXJjaGFyIHwgbsOjbyB8IHxcbiAgICAgICAgICAgIHRoaXMubGFiZWwuaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJsYWJlbFwiKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL0NvbG9jYSBtZW5zYWdlbSBkZSBlcnJvIFxuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuc3Bhbik7XG4gICAgICAgIHRoaXMuc3Bhbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZCArIFwidHhhX3NwYW5cIik7XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwiZXJyb3JcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBtZW5zYWdlbSBkZSBlcnJvIGNhc28gbyBjYW1wbyBlc3RlamEgaW52w6FsaWRvIHwgdmFyY2hhciB8IG7Do28gfCB8XG4gICAgICAgICAgICB0aGlzLnNwYW4uaW5uZXJUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJlcnJvclwiKTtcbiAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLXRleHQtYXJlYS11bmRlcmxpbmUtZXJyb3JcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvL2Rlc2FiaWxpdGFyIG8gY2FtcG8gcXVhbmRvIG8gYXRyaWJ1dG8gaXMtZGlzYWJsZWQgw6kgdHJ1ZVxuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJpcy1kaXNhYmxlZFwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBzZSBvIGNhbXBvIGVzdGFyw6EgZGVzYXRpdmFkbyB8IHRydWUgb3UgZmFsc2UgfCBuw6NvIHwgZmFsc2UgfFxuICAgICAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcIm1heC13aWR0aFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogRGVmaW5lIGEgbGFyZ3VyYSBtw6F4aW1hIGRvIGNvbXBvbmVudGUgfCAlIG91IHB4IHwgbsOjbyB8IDEwMCUgfFxuICAgICAgICAgICAgdGhpcy5zdHlsZS5tYXhXaWR0aCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXdpZHRoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9jb2xvY2EgdGFiaW5kZXhcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKFwidGFiLWluZGV4XCIpKSB7XG4gICAgICAgICAgICAvL2Rlc2NyaXB0aW9uOiBPcmRlbSBkZSB0YWJ1bGHDp8OjbyBuYSBww6FnaW5hLnwgTnVtw6lyaWNvfCBuw6NvfCB2YXppb3xcbiAgICAgICAgICAgIHRoaXMudGV4dGFyZWEuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgdGhpcy5nZXRBdHRyaWJ1dGUoXCJ0YWItaW5kZXhcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9wYXJhIHF1YWwgaW5kZXggdmFpXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImdvdG8tdGFiLWluZGV4XCIpKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRhcmVhLnNldEF0dHJpYnV0ZShcImdvdG8tdGFiLWluZGV4XCIsIHRoaXMuZ2V0QXR0cmlidXRlKFwiZ290by10YWItaW5kZXhcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9wYXJhIHF1YWwgaW5kZXggdmFpXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcInN0b3AtdGFiLWluZGV4XCIpKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRhcmVhLnNldEF0dHJpYnV0ZShcInN0b3AtdGFiLWluZGV4XCIsIHRoaXMuZ2V0QXR0cmlidXRlKFwic3RvcC10YWItaW5kZXhcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLypcbiAgICAgICAgREFUQSBCSU5ESU5HXG4gICAgICAgIFdPUksgSU4gUFJPR1JFU1NcbiAgICAgICAgVVNFIEFUIFlPVVIgT1dOIFJJU0tcbiAgICAgICAgQkUgQVdBUkUgT0YgRFJBR09OU1xuICAgICAgICAtIEdBQlMgMDIvMTAvMjAxOVxuICAgICAgICAqL1xuXG4gICAgICAgIGlmICh0aGlzLmhhc0F0dHJpYnV0ZShcImRhdGEtYmluZGluZy1vYmpcIikpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRGF0YUJpbmRpbmcoKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgX2FkZEV2ZW50KCkge1xuICAgICAgICB2YXIgdGV4dGFyZWEgPSAkKHRoaXMudGV4dGFyZWEpO1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIHRleHRhcmVhLm9uKFwia2V5dXBcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiYXV0by1oZWlnaHRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoJCh0aGlzKVswXS5zY3JvbGxIZWlnaHQgPiAkKHRoaXMpWzBdLm9mZnNldEhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm93cyA9IHRoaXMuZ2V0QXR0cmlidXRlKFwicm93c1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1heFJvdyA9IF90aGlzLmdldEF0dHJpYnV0ZShcIm1heC1yb3dzXCIpO1xuICAgICAgICAgICAgICAgICAgICByb3dzKys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyb3dzID49IG1heFJvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwicm93c1wiLCByb3dzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9JciBwYXJhIG8gcHLDs3hpbW8gaXRlbSBxdWFuZG8gYXBlcnRhciBlbnRlclxuICAgICAgICAgICAgcmV0dXJuIGdvVG9OZXh0VGFiaW5kZXgoZXZlbnQsICQodGhpcyksIFwiZm9jdXNcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRleHRhcmVhLm9uKFwiYmx1clwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvL0J1Z0lPUyBSZXRpcmEgYSBtYXJjYWNhbyBkbyBmb2NvXG4gICAgICAgICAgICBfdGhpcy5yZW1vdmVBdHRyaWJ1dGUoXCJmb2N1cy1leGVjdXRlZFwiKTtcblxuICAgICAgICAgICAgLy9UcmlnYSBhcyB2YWxpZGHDp8O1ZXNcbiAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImNhbmNlbC1vbmNoYW5nZVwiLCBcInRydWVcIik7XG4gICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG5cbiAgICAgICAgICAgIC8vQ2hhbWEgYSBmdW5jYW8gcXVlIGNvbGNvdSBubyBvbmJsdXJcbiAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJvbmJsdXJcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm4gPSB3aW5kb3dbX3RoaXMuZ2V0QXR0cmlidXRlKFwib25ibHVyXCIpXTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoJChfdGhpcykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGV4dGFyZWEub24oXCJmb2N1c1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgLy9CdWdJT1NcbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRBdHRyaWJ1dGUoXCJmb2N1cy1leGVjdXRlZFwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImZvY3VzLWV4ZWN1dGVkXCIsIFwidHJ1ZVwiKTtcblxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgaWYgKF90aGlzLmdldEF0dHJpYnV0ZShcImlzLWRpc2FibGVkXCIpICE9IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgLy9Db2xvY2EgZm9jbyBubyBpbnB1dFxuICAgICAgICAgICAgICAgIF90aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi10ZXh0LWFyZWEtdW5kZXJsaW5lLW1pblwiKTtcblxuICAgICAgICAgICAgICAgICQodGhpcykuc2V0Q3Vyc29yUG9zaXRpb24oJChcInRleHRhcmVhXCIpWzBdLnZhbHVlLmxlbmd0aCk7XG5cbiAgICAgICAgICAgICAgICAvL0FycnVtYSBzY3JvbGwgbm8gbW9iaWxlIHF1YW5kbyBzb2JlIG8gdGVjbGFkbyBwYXJhIEFORFJPSURcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmlzQW5kcm9pZCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNjcm9sbEludG9WaWV3KCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL0NoYW1hIGEgZnVuY2FvIHF1ZSBjb2xvY291IG5vIG9uZm9jdXNcbiAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJvbmZvY3VzXCIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZuID0gd2luZG93W190aGlzLmdldEF0dHJpYnV0ZShcIm9uZm9jdXNcIildO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgZm4uY2FsbCgkKF90aGlzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL2V2ZW50byBjaGFuZ2UgcXVhbmRvIGFsdGVyYXIgbyB2YWxvciBkbyBpbnB1dFxuICAgICAgICB0ZXh0YXJlYS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgPT0gXCJcIiB8fCB0aGlzLnZhbHVlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiZm9jdXMtZXhlY3V0ZWRcIikgIT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLXRleHQtYXJlYS11bmRlcmxpbmUtbWluXCIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJyb3dzXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwicm93c1wiLCBfdGhpcy5nZXRBdHRyaWJ1dGUoXCJyb3dzXCIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcInJvd3NcIiwgXCIxXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NMaXN0LmFkZChcImFiLXRleHQtYXJlYS11bmRlcmxpbmUtbWluXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL3ZlcmlmaWNhIHNlIG8gY2FtcG8gw6kgb2JyaWdhdMOzcmlvXG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0QXR0cmlidXRlKFwiaXMtcmVxdWlyZWRcIikgPT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAvL3ZhbHVlczogdHJ1ZTtmYWxzZVxuICAgICAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IERlZmluZSBzZSBvIGNhbXBvIHNlcsOhIG9icmlnYXTDs3JpbyB8IHRydWUgb3UgZmFsc2UgfCBuw6NvIHwgZmFsc2UgfFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNldEF0dHJpYnV0ZShcImVycm9yXCIsIFwiQ2FtcG8gb2JyaWdhdMOzcmlvXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnJlbW92ZUF0dHJpYnV0ZShcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9zZSB0aXZlciBhanVzdGVcbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRBdHRyaWJ1dGUoXCJhdXRvLWhlaWdodFwiKSA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgIHdoaWxlICgkKHRoaXMpWzBdLnNjcm9sbEhlaWdodCA+ICQodGhpcylbMF0ub2Zmc2V0SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByb3dzID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJyb3dzXCIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWF4Um93ID0gX3RoaXMuZ2V0QXR0cmlidXRlKFwibWF4LXJvd3NcIik7XG4gICAgICAgICAgICAgICAgICAgIHJvd3MrKztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJyb3dzXCIsIHJvd3MpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocm93cyA+PSBtYXhSb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vQ2hhbWEgYSBmdW5jYW8gcXVlIGNvbGNvdSBubyBvbmJsdXJcbiAgICAgICAgICAgIGlmIChfdGhpcy5oYXNBdHRyaWJ1dGUoXCJvbmNoYW5nZVwiKSAmJiBfdGhpcy5nZXRBdHRyaWJ1dGUoXCJjYW5jZWwtb25jaGFuZ2VcIikgIT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm4gPSB3aW5kb3dbX3RoaXMuZ2V0QXR0cmlidXRlKFwib25jaGFuZ2VcIildO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgZm4uY2FsbCgkKF90aGlzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMucmVtb3ZlQXR0cmlidXRlKFwiY2FuY2VsLW9uY2hhbmdlXCIpO1xuXG4gICAgICAgICAgICAvL0NoYW1hIGEgZnVuY2FvIHF1ZSBjb2xjb3Ugbm8gb25ibHVyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaGFzQXR0cmlidXRlKFwib252YWxpZGF0ZVwiKSkge1xuICAgICAgICAgICAgICAgIHZhciBmbiA9IHdpbmRvd1tfdGhpcy5nZXRBdHRyaWJ1dGUoXCJvbnZhbGlkYXRlXCIpXTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGZuLmNhbGwoJChfdGhpcykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5jbGFzc0xpc3QuY29udGFpbnModGhpcy5tYWluQ2xhc3MpKSB7XG4gICAgICAgICAgICAvKnRoaXMuc2hhZG93RG9tID0gdGhpcy5hdHRhY2hTaGFkb3coe1xuICAgICAgICAgICAgICAgIG1vZGU6ICdvcGVuJ1xuICAgICAgICAgICAgfSk7ICovXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gW1wiZXJyb3JcIiwgXCJpcy1kaXNhYmxlZFwiLCBcImxhYmVsXCIsIFwiaWRcIiwgXCJ3aWR0aFwiLCBcIm1heGxlbmd0aFwiLCBcInJvd3NcIl07XG4gICAgfVxuXG4gICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGF0dHJOYW1lLCBvbGRWYWwsIG5ld1ZhbCkge1xuXG4gICAgICAgIHN3aXRjaCAoYXR0ck5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgIT0gdW5kZWZpbmVkICYmIG5ld1ZhbCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3Bhbi5pbm5lclRleHQgPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLXRleHQtYXJlYS11bmRlcmxpbmUtZXJyb3JcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgLyppZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJlcnJvci1pY29uXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4oXCIjXCIgKyBpZCArIFwidHhhX2ltZ1wiKS5hdHRyKFwic3JjXCIsIG9iai5hdHRyKFwiZXJyb3ItaWNvblwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH0qL1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShcImFiLXRleHQtYXJlYS11bmRlcmxpbmUtZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3Bhbi5pbm5lclRleHQgPSBcIlwiO1xuXG4gICAgICAgICAgICAgICAgICAgIC8qaWYgKG9iai5hdHRyKFwiaWNvblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwiI1wiICsgaWQgKyBcInR4YV9pbWdcIikuYXR0cihcInNyY1wiLCBvYmouYXR0cihcImljb25cIikpO1xuICAgICAgICAgICAgICAgICAgICB9Ki9cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpcy1kaXNhYmxlZFwiOlxuICAgICAgICAgICAgICAgIC8vcXVhbmRvIG8gYXRyaWJ1dG8gaXMtZGlzYWJsZWQgw6kgYWx0ZXJhZG8sIGFkaWNpb25hIG91IHJldGlyYSBhIGNsYXNzZSB1bmRlcmxpbmUtbWluXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBcInRydWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJhYi10ZXh0LWFyZWEtdW5kZXJsaW5lLW1pblwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50ZXh0YXJlYS52YWx1ZSA9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJhYi10ZXh0LWFyZWEtdW5kZXJsaW5lLW1pblwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRhcmVhLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImxhYmVsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5pbm5lclRleHQgPSBuZXdWYWw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJpZFwiOlxuICAgICAgICAgICAgICAgIHRoaXMudGV4dGFyZWEuc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJ0eGFfaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJmb3JcIiwgbmV3VmFsICsgXCJ0eGFfaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuZXdWYWwgKyBcInR4YV9sYWJlbFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW4uc2V0QXR0cmlidXRlKFwiaWRcIiwgbmV3VmFsICsgXCJ0eGFfc3BhblwiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcIndpZHRoXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IG5ld1ZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcIm1heGxlbmd0aFwiOlxuICAgICAgICAgICAgICAgIHRoaXMudGV4dGFyZWEuc2V0QXR0cmlidXRlKFwibWF4bGVuZ3RoXCIsIG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJyb3dzXCI6XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoXCJyb3dzXCIsIG5ld1ZhbCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJkYXRhLWJpbmRpbmctb2JqXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVEYXRhQmluZGluZyhvYmopO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjcmVhdGVEYXRhQmluZGluZygpIHtcblxuICAgICAgICBuZXcgcG1iLnV0aWxzLkRhdGFCaW5kaW5nKHtcbiAgICAgICAgICAgIG9iamVjdDogdGhpcy5nZXRBdHRyaWJ1dGUoXCJkYXRhLWJpbmRpbmctb2JqXCIpXG4gICAgICAgIH0pXG4gICAgICAgIC5hZGRCaW5kaW5nKHRoaXMudGV4dGFyZWEsIFwidmFsdWVcIiwgXCJjaGFuZ2VcIik7XG5cbiAgICB9XG5cbiAgICBzZXRUZXh0KHRleHQpIHtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS52YWx1ZSA9IHRleHQ7XG4gICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcImFiLXRleHQtYXJlYS11bmRlcmxpbmUtbWluXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0VGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dGFyZWEudmFsdWU7XG4gICAgfVxufVxuXG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ2FiLXRleHQtYXJlYS11bmRlcmxpbmUnLCBBYlRleHRBcmVhVW5kZXJsaW5lKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuJC5mbi5pbmNyZW1lbnRSZXF1ZXN0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBjdXJyID0gMDtcbiAgICBpZiAodGhpcy5hdHRyKFwiY3VycmVudC1yZXF1ZXN0XCIpKSB7XG4gICAgICAgIGN1cnIgPSBwYXJzZUludCh0aGlzLmF0dHIoXCJjdXJyZW50LXJlcXVlc3RcIikpO1xuICAgIH1cblxuICAgIGN1cnIrKztcbiAgICB0aGlzLmF0dHIoXCJjdXJyZW50LXJlcXVlc3RcIiwgY3Vycik7XG59XG5cbiQuZm4ucmVzZXRSZXF1ZXN0ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucmVtb3ZlQXR0cihcImN1cnJlbnQtcmVxdWVzdFwiKTtcbn1cblxuY2xhc3MgQWJQYWdlIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5odG1sT2JqID0gJChcImh0bWwsYm9keVwiKVswXTtcblxuICAgICAgICAvL3BhZ2VMb2FkZXJcbiAgICAgICAgdGhpcy5wYWdlTG9hZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMud3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMubG9hZEJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRoaXMuYmFyUmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB0aGlzLmxvYWRUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG5cbiAgICAgICAgdGhpcy5tYWluQ2xhc3MgPSBcImFiLXBhZ2VcIjtcbiAgICB9XG5cbiAgICBfcmVuZGVyKCkge1xuICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQodGhpcy5tYWluQ2xhc3MpO1xuXG4gICAgICAgIC8vQ3JpYSB1bSBpZFxuICAgICAgICBpZiAoIXRoaXMuaGFzQXR0cmlidXRlKFwiaWRcIikpIHtcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IEF0cmlidXRvIHBhcmEgaWRlbnRpZmljYXIgbyBvYmpldG98IEFsZmFudW3DqXJpY298IG7Do298IHZhemlvfFxuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBnZW5lcmF0ZUlEKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcGFyYW1ldHJvc1xuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJmdWxsc2NyZWVuXCIpICE9IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgLy92YWx1ZXM6IHRydWU7ZmFsc2VcbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb246IFVzYSBvIHRhbWFuaG8gdG90YWwgZGEgdGVsYSB8IHRydWUgb3UgZmFsc2UgfCBuw6NvIHwgdHJ1ZSB8XG4gICAgICAgICAgICB0aGlzLmh0bWxPYmouc3R5bGUubWFyZ2luID0gXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMuaHRtbE9iai5zdHlsZS5wYWRkaW5nID0gXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMuaHRtbE9iai5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgICAgICAgICAgdGhpcy5odG1sT2JqLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXG4gICAgICAgICAgICB0aGlzLnN0eWxlLnRvcCA9IFwiMHB4XCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmxlZnQgPSBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5ib3R0b20gPSBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5yaWdodCA9IFwiMHB4XCI7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgICAgICAgICAgdGhpcy5zdHlsZS5wb3NpdGlvbiA9IFwiZml4ZWRcIjtcbiAgICAgICAgfSBlbHNle1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcInBhZ2UtLWxpbWl0ZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxvciBwYWRyYW9cbiAgICAgICAgdGhpcy5zdHlsZS56SW5kZXggPSBcIjBcIjtcblxuICAgICAgICAvL3NlIGV4aXN0aXIgdW0gbWF4LXJlcXVlc3QsIGNvbnN0cnVpciBvIHNpc3RlbWEgZGUgbG9hZFxuICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoXCJtYXgtcmVxdWVzdFwiKSkge1xuICAgICAgICAgICAgLy9kZXNjcmlwdGlvbjogTcOheGltbyBkZSByZXF1ZXN0cyBxdWUgdGVyw6EgbmEgcMOhZ2luYSBwYXJhIG8gbG9hZGVyIHwgTnVtw6lyaWNvIHwgbsOjbyB8IDAgfFxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlTG9hZGVyKCk7XG4gICAgICAgIH0gZWxzZXtcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJodG1sXCIpLmNsYXNzTGlzdC5hZGQoXCJodG1sLXBhZ2UtbG9hZGVkXCIpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLm1haW5DbGFzcykpIHtcbiAgICAgICAgICAgIC8qdGhpcy5zaGFkb3dEb20gPSB0aGlzLmF0dGFjaFNoYWRvdyh7XG4gICAgICAgICAgICAgICAgbW9kZTogJ29wZW4nXG4gICAgICAgICAgICB9KTsgKi9cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBvYnNlcnZlZEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXCJsb2FkZXItdmlzaWJpbGl0eVwiLCBcImN1cnJlbnQtcmVxdWVzdFwiXTtcbiAgICB9XG5cbiAgICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2soYXR0ck5hbWUsIG9sZFZhbCwgbmV3VmFsKSB7XG4gICAgICAgIGlmIChhdHRyTmFtZSA9PSBcImxvYWRlci12aXNpYmlsaXR5XCIpIHtcbiAgICAgICAgICAgIGlmIChuZXdWYWwgIT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMubG9nbykuZmFkZU91dCgxMDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICQodGhpcy5wYWdlTG9hZCkuZmFkZU91dCgxMDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wYWdlTG9hZC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUxvYWRlcigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMucGFnZUxvYWQpLmZhZGVJbigxMDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gZWxzZSBpZiAoYXR0ck5hbWUgPT0gXCJjdXJyZW50LXJlcXVlc3RcIikge1xuICAgICAgICAgICAgdmFyIHJlcUF0dWFsID0gcGFyc2VJbnQobmV3VmFsKTtcbiAgICAgICAgICAgIHZhciByZXFNYXggPSBwYXJzZUludCh0aGlzLmdldEF0dHJpYnV0ZShcIm1heC1yZXF1ZXN0XCIpKTtcbiAgICAgICAgICAgIHZhciB0b3RhbCA9ICgoMTAwIC8gcmVxTWF4KSAqIHJlcUF0dWFsKTtcblxuICAgICAgICAgICAgdGhpcy5iYXJSYW5nZS5zdHlsZS53aWR0aCA9IHRvdGFsICsgXCIlXCI7XG5cbiAgICAgICAgICAgIGlmICh0b3RhbCA+PSAxMDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShcImxvYWRlci12aXNpYmlsaXR5XCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImh0bWxcIikuY2xhc3NMaXN0LmFkZChcImh0bWwtcGFnZS1sb2FkZWRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcUF0dWFsID0gbnVsbDtcbiAgICAgICAgICAgIHJlcU1heCA9IG51bGw7XG4gICAgICAgICAgICB0b3RhbCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfY3JlYXRlTG9hZGVyKCkge1xuXG4gICAgICAgIHRoaXMucGFnZUxvYWQuY2xhc3NMaXN0LmFkZChcImFiLXBhZ2UtbG9hZGVyXCIpO1xuICAgICAgICB0aGlzLnBhZ2VMb2FkLnNldEF0dHJpYnV0ZShcImlkXCIsIFwiYWItcGFnZS1sb2FkZXJcIik7XG4gICAgICAgIHRoaXMucGFnZUxvYWQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLnBhZ2VMb2FkKTtcblxuICAgICAgICB0aGlzLndyYXBwZXIuY2xhc3NMaXN0LmFkZChcImFiLXBhZ2UtbG9hZGVyLXdyYXBwZXJcIik7XG4gICAgICAgIHRoaXMucGFnZUxvYWQuYXBwZW5kQ2hpbGQodGhpcy53cmFwcGVyKTtcblxuICAgICAgICB0aGlzLmxvYWRCYXIuY2xhc3NMaXN0LmFkZChcImFiLXBhZ2UtbG9hZGVyLXBhdGhcIik7XG4gICAgICAgIHRoaXMud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmxvYWRCYXIpO1xuXG4gICAgICAgIHRoaXMuYmFyUmFuZ2UuY2xhc3NMaXN0LmFkZChcImFiLXBhZ2UtbG9hZGVyLXJhbmdlXCIpO1xuICAgICAgICB0aGlzLmJhclJhbmdlLnNldEF0dHJpYnV0ZShcImlkXCIsIFwiYWItcGFnZS1sb2FkZXItcmFuZ2VcIik7XG4gICAgICAgIHRoaXMubG9hZEJhci5hcHBlbmRDaGlsZCh0aGlzLmJhclJhbmdlKTtcblxuICAgICAgICB0aGlzLmxvYWRUZXh0LmNsYXNzTGlzdC5hZGQoXCJhYi1wYWdlLWxvYWRlci10ZXh0XCIpO1xuICAgICAgICB0aGlzLmxvYWRUZXh0LmlubmVyVGV4dCA9IFwiY2FycmVnYW5kby4uLlwiO1xuICAgICAgICB0aGlzLndyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5sb2FkVGV4dCk7XG4gICAgfVxufVxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdhYi1wYWdlJywgQWJQYWdlKTsiXX0=
